$(function(){function e(e){$.ajax({type:"POST",url:PmanagePHP.getAdminProjectList,dataType:"json",data:{filter:e},beforeSend:function(){$("#proj_list").empty().append(Strack.loading_dom("null"))},success:function(e){var a="",i=$("#proj_list");$("#st-load").remove(),e.forEach(function(e){a+=o(e)}),a?($("#pactive_notice").remove(),i.append(a),t()):0==$("#pactive_notice").length&&i.before('<div id="pactive_notice" class="datagrid-empty-no">'+PmanagePHP.No_Filter_Project+"</div>")}})}function t(){var e=$("#sproj_id").val();if(e>0){var t=$("#mproj_item_"+e);t.addClass("templates-active"),$(".admin-temp-list").scrollTop(t.offset().top)}}function a(e,t,a){var o=$(e),r=$(t);$.ajax({type:"POST",url:PmanagePHP.getProjectDetails,dataType:"json",data:{project_id:a},beforeSend:function(){o.prepend(Strack.loading_dom("white"))},success:function(e){$("#st-load").remove(),r.empty().append(i(e.data));var t=$("#mg-proj-img .proj_thumb_ck");$("#mg-proj-img,.mg-blur-mask").hover(function(){t.addClass("img-blur").after(s())},function(){$(".mg-blur-mask").remove(),t.removeClass("img-blur")}),Strack.combobox_widget(8,"#proj_status",PmanagePHP.getProjectStatusList,"id","name",e.data.status_id,390,28,{template_id:e.data.template_id}),Strack.OpenDateBox("#proj_start",390,28,Strack.UnixToDate(e.data.start_date,!1,8)),Strack.OpenDateBox("#proj_end",390,28,Strack.UnixToDate(e.data.end_date,!1,8)),Strack.color_pick_widget("#proj_color","hex","light",e.data.backgroud_color,340)}})}function o(e){var t="";return t+='<div id="mproj_item_'+e.project_id+'" class="item mproj-item"><a href="javascript:;" class="header" onclick="obj.switch_project(this,'+e.project_id+');">'+Strack.build_thumb_dom(e.thumb_min,"icon-uniF1ED")+'<div class="mproj-content text-ellipsis">'+e.name+"</div></a></div>"}function i(e){var t="",a=[{type:"input",lang:StrackPHP.Name,placeholder:PmanagePHP.Input_Project_Name,dom_id:"proj_name",field:"name",need:"yes",value:e.name},{type:"input",lang:StrackPHP.ProjectCode,placeholder:PmanagePHP.Add_Pcode_input,dom_id:"proj_code",field:"code",need:"yes",value:e.code},{type:"input",lang:StrackPHP.Rate,placeholder:PmanagePHP.Input_Project_Rate,dom_id:"proj_rate",field:"rate",need:"yes",value:e.rate},{type:"input",lang:StrackPHP.Color,placeholder:"",dom_id:"proj_color",field:"backgroud_color",need:"yes",value:e.backgroud_color},{type:"combobox",lang:StrackPHP.Project_Status,placeholder:"",dom_id:"proj_status",field:"status_id",need:"yes",value:""},{type:"datebox",lang:StrackPHP.Start_Date,placeholder:"",dom_id:"proj_start",field:"start_date",need:"no",value:""},{type:"datebox",lang:StrackPHP.End_Date,placeholder:"",dom_id:"proj_end",field:"end_date",need:"no",value:""},{type:"textarea",lang:StrackPHP.Project_Description,placeholder:PmanagePHP.Input_Project_Description,dom_id:"proj_description",field:"description",need:"no",value:e.description}];return t+='<form id="modify_project" autocomplete="off" ><div class="ui one column grid"><div class="column"><div id="mg-proj-img" class="mg-proj-img"><a href="javascript:;" onclick="obj.upload_project_thumb('+e.project_id+');">'+Strack.build_thumb_dom(e.thumb_max)+'</a></div></div><div class="one column row">'+r(a)+"</div></div></form>"}function r(e){var t="";return e.forEach(function(e){t+=n(e)}),t}function n(e){var t="";return t+='<div class="column"><div class="form-field form-required term-name-wrap overflow-hide"><label for="'+e.dom_id+'">'+e.lang+"</label>"+d(e)+"</div></div>"}function d(e){var t="";switch(e.type){case"input":t+='<p class="right-pinput"><input  id="'+e.dom_id+'" class="form-control form-input" type="text" wiget-type="input" wiget-need="'+e.need+'" wiget-field="'+e.field+'" wiget-name="'+e.lang+'" style="max-width: 380px;" placeholder="'+e.placeholder+'" value="'+e.value+'" ></p>';break;case"combobox":case"datebox":t+='<p class="right-pinput"><input  id="'+e.dom_id+'" class="form-input" wiget-type="'+e.type+'" wiget-need="'+e.need+'" wiget-field="'+e.field+'" wiget-name="'+e.lang+'"></p>';break;case"textarea":t+='<p class="right-pinput st-textarea"><textarea id="'+e.dom_id+'" type="text" class="form-input" wiget-type="textarea" wiget-need="'+e.need+'" wiget-field="'+e.field+'" wiget-name="'+e.lang+'" placeholder="'+e.placeholder+'">'+e.value+"</textarea></p>"}return t}function s(){var e="";return e+='<div class="mg-blur-mask" style="width: 250px;height: 140px"><div class="mg-blur-title">'+PmanagePHP.Modify_Thumb+"</div></div>"}obj={switch_project:function(e,t){var o=$(e),i=$("#sproj_id");i.val()>0?$(".mproj-item").removeClass("templates-active"):($(".temp-setlist-no").hide(),$(".admin-temp-rheader").show()),i.val(t),o.parent().addClass("templates-active"),a(".temp-setlist-wrap","#proj_infos",t)},upload_project_thumb:function(e){Strack.open_dialog("dialog",{title:StrackPHP.Upload_Thumb,width:480,height:180,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mproj_id",type:"hidden",name:"proj_id",valid:1,value:e},{case:102,id:"Mproj_canvas"}],items:[{case:1,id:"Mproj_thumb",type:"text",lang:StrackPHP.Name,name:"proj_thumb",valid:0,value:""}],footer:[{obj:"choice_thumb",type:4,title:""},{obj:"proj_thumb",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){Strack.upload_image("img_up_bnt","Mproj_thumb","Mproj_canvas")},close:function(){Strack.G.Jcrop_Canvas=null}})},proj_thumb:function(){if(Strack.G.Jcrop_Canvas){var t=$("input[id=Mproj_id]").val(),o=Strack.G.Jcrop_Canvas.toDataURL("image/jpg");$.ajax({type:"POST",url:PmanagePHP.uploadProjectThumb,dataType:"json",data:{project_id:t,img:o},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(o){$.messager.progress("close"),200==parseInt(o.status)?(Strack.dialog_cancel(),e(),a(".temp-setlist-wrap","#proj_infos",t),Strack.top_message({bg:"g",msg:o.message})):layer.msg(o.message,{icon:7,time:1200,anim:6})}})}else layer.msg(PmanagePHP.Please_Select_Image,{icon:2,time:1200,anim:6})},project_save:function(){var t=Strack.validate_form("modify_project");if(200==t.status){var o=$("#sproj_id").val();t.data.project_id=o,$.ajax({type:"POST",url:PmanagePHP.modifyProject,data:t.data,dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(t){$.messager.progress("close"),200==parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),e(),a(".temp-setlist-wrap","#proj_infos",o)):layer.msg(t.message,{icon:7,time:1200,anim:6})}})}},project_delete:function(){$.messager.prompt(PmanagePHP.Delete_Project_Title,PmanagePHP.Delete_Project_Confirm,function(t){if(t){var a=$("#sproj_id").val();$.ajax({type:"POST",url:PmanagePHP.deleteProject,dataType:"json",data:{adminPass:t,project_id:a},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(t){$.messager.progress("close"),200==parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),$(".temp-setlist-no").show(),$(".admin-temp-rheader").hide(),$("#proj_infos").empty(),$("#sproj_id").val(""),e()):layer.msg(t.message,{icon:7,time:1200,anim:6})}})}else layer.msg(PmanagePHP.Admin_Operation_Password_Null,{icon:2,time:1200,anim:6})})},project_filter:function(t){var a=$("#search_val").val(),o="";a.length>0&&(o=JSON.stringify({name:["LIKE","%"+a+"%"]}),obj.refresh_details()),e(o)},refresh_details:function(){$("#sproj_id").val(0),$(".temp-setlist-no").show(),$(".admin-temp-rheader").hide(),$("#proj_infos").empty()}},e("")});