$(function(){function e(e,t){Strack.open_dialog("dialog",{title:TypesPHP.TyModify,width:480,height:340,content:Strack.dialog_dom({type:1,hidden:[{case:101,id:"Mtype_id",type:"hidden",name:"type_id",valid:1,value:e.type_id}],items:[{case:1,id:"Mtype_name",type:"text",lang:StrackPHP.Name,name:"type_name",valid:1,value:e.type_name},{case:1,id:"Mtype_code",lang:TypesPHP.Code,name:"type_code",valid:1,value:e.alias},{case:2,id:"Mtype_color",lang:StrackPHP.Color,name:"type_color",valid:7},{case:2,id:"Mtypes-dept",lang:TypesPHP.Related_Department,name:"dept_id",valid:1}],footer:[{obj:"type_update",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){Strack.color_pick_widget("#Mtype_color","hex","light",e.type_color,320),Strack.combobox_widget(5,"#Mtypes-dept",TypesPHP.DeptList,"dept_id","dept_name",e.dept_id,378,30,"scope_name")},close:function(){t.datagrid("reload")}})}obj={type_add:function(){var e=$("input[name=type-name]").val(),t=$("input[name=type-color]").val(),a=$("input[name=type-alias]").val(),i=Strack.get_combos_val("#types-dept","combobox","getValue");e.length<1?layer.msg(TypesPHP.TyName_Null,{icon:2,time:1200,anim:6}):a.length<1?layer.msg(TypesPHP.TyCode_Null,{icon:2,time:1200,anim:6}):6!=t.length?layer.msg(TypesPHP.TyColor_Null,{icon:2,time:1200,anim:6}):i.length<1?layer.msg(TypesPHP.TyDept_Null,{icon:2,time:1200,anim:6}):$.ajax({type:"POST",url:TypesPHP.AddTypes,data:{type_name:e,type_color:t,dept_id:i,alias:a},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){switch($.messager.progress("close"),parseInt(e)){case-1:layer.msg(TypesPHP.TyName_CF,{icon:7,time:1200,anim:6});break;case-2:layer.msg(TypesPHP.TyName_Length,{icon:7,time:1200,anim:6});break;case-3:layer.msg(TypesPHP.TyColor_Only,{icon:7,time:1200,anim:6});break;case-5:layer.msg(TypesPHP.TyCode_Length,{icon:7,time:1200,anim:6});break;case-7:layer.msg(TypesPHP.TyAlias_Unique,{icon:7,time:1200,anim:6});break;default:$("input[name=type-name]").val(""),$("input[name=type-color]").val(""),$("input[name=type-alias]").val(""),Strack.top_message({bg:"g",msg:TypesPHP.AddStepSC}),$("#types-dept").combobox("clear"),$("#datagrid_box").datagrid("reload")}}})},type_modify:function(){var t=a.datagrid("getSelections");if(t.length<1)layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6});else if(t.length>1)layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6});else{var i=t[0];e(i,a)}},type_update:function(){Strack.ajax_dialog_form("#st_dialog_form input",t,TypesPHP.MDTypes,{back:function(e){switch(parseInt(e)){case-1:layer.msg(TypesPHP.TyName_CF,{icon:7,time:1200,anim:6});break;case-2:layer.msg(TypesPHP.TyName_Length,{icon:7,time:1200,anim:6});break;case-3:layer.msg(TypesPHP.TyColor_Only,{icon:7,time:1200,anim:6});break;case-5:layer.msg(TypesPHP.TyCode_Length,{icon:7,time:1200,anim:6});break;case-7:layer.msg(TypesPHP.TyAlias_Unique,{icon:7,time:1200,anim:6});break;default:Strack.top_message({bg:"g",msg:TypesPHP.MDStepSC}),$("#dialog").dialog("close"),$("#datagrid_box").datagrid("reload")}}})},type_delete:function(){for(var e=a.datagrid("getSelections"),t=[],i=0;i<e.length;i++)t.push(e[i].type_id);Strack.ajax_grid_delete(e,TypesPHP.Detype_notice,TypesPHP.DEtypes,{type_ids:t.join(",")},"",TypesPHP.Detype_success)},type_cancel:function(){$("#dialog").dialog("close")}},Strack.color_pick_widget("#picker","hex","light"),Strack.combobox_widget(5,"#types-dept",TypesPHP.DeptList,"dept_id","dept_name","",300,30,"scope_name");var t={};t["type_name-1"]=TypesPHP.TyName_Null,t["type_color-1"]=TypesPHP.TyColor_Null,t["type_code-1"]=TypesPHP.TyCode_Null,t["dept_id-1"]=TypesPHP.TyDept_Null;var a=$("#datagrid_box").datagrid({url:TypesPHP.DataTypes,rownumbers:!0,nowrap:!0,fitColumns:Strack.FitColumns(".admin-dept-right",474),height:Strack.panel_height(".admin-dept-right",0),adaptive:{dom:".admin-dept-right",min_width:474},columns:[[{field:"type_id",align:"center",checkbox:!0},{field:"type_color",title:StrackPHP.Color,align:"center",width:136,formatter:function(e,t,a){return'<div class="picker-color" style="background-color: #'+e+'">#'+e+"</div>"}},{field:"type_name",title:StrackPHP.Name,align:"center",width:260},{field:"dept_name",title:TypesPHP.Related_Department,align:"center",width:260}]],toolbar:"#tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(t,i){a.datagrid("selectRow",t),e(i,a)}})});