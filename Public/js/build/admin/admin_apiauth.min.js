$(function(){function e(e){Strack.open_dialog("dialog",{title:ApiauthPHP.Group_Title,width:480,height:360,content:Strack.dialog_dom({type:1,hidden:[{case:101,id:"Mgroup_id",type:"hidden",name:"id",valid:1,value:e.api_gid}],items:[{case:1,id:"Mgroup_name",type:"text",lang:StrackPHP.Name,name:"title",valid:1,value:e.title},{case:2,id:"Mgroup_auth",lang:ApiauthPHP.Auth_Choice,name:"rules"}],footer:[{obj:"api_group_update",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){$("#Mgroup_auth").combotree({url:ApiauthPHP.GroupList,value:e.rules,multiple:!0,checkbox:!0,queryParams:{rule_type:20}})},close:function(){$("#datagrid_box").datagrid("unselectAll")}})}obj={api_group_choice:function(){$("#group-tree").hasClass("tree_all")?($("#group-tree").removeClass("tree_all"),$(".tree-checkbox").each(function(){$(this).removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox0")})):($("#group-tree").addClass("tree_all"),$(".tree-checkbox").each(function(){$(this).removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox1")}))},api_group_add:function(){var e=$("#group-tree").tree("getChecked"),t=$("input[name=group-name]").val();if(t.length<1)layer.msg(ApiauthPHP.NullNotice,{icon:2,time:1200,anim:6});else{var i;i=e.length<1?ApiauthPHP.NullAuth:StrackPHP.Confirm_OP,$.messager.confirm(StrackPHP.Warning,i,function(i){if(i){for(var a=[],r=0;r<e.length;r++)a.push(e[r].id);$.ajax({type:"POST",url:ApiauthPHP.AddGroup,data:{title:t,rules:a.join(",")},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close"),-1==e?layer.msg(ApiauthPHP.Group_Exist,{icon:7,time:1200,anim:6}):-2==e?layer.msg(ApiauthPHP.NullAuth,{icon:7,time:1200,anim:6}):(Strack.top_message({bg:"g",msg:ApiauthPHP.AddApiauthSC}),$("#datagrid_box").datagrid("reload"))}})}})}},api_group_modify:function(){var t=i.datagrid("getSelections");t.length<1?layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6}):t.length>1?layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6}):e(t[0])},api_group_update:function(){Strack.ajax_dialog_form("#st_dialog_form input",t,ApiauthPHP.MDGroup,{back:function(e){-1==e?layer.msg(ApiauthPHP.Group_Exist,{icon:7,time:1200,anim:6}):-2==e?layer.msg(ApiauthPHP.NullAuth,{icon:7,time:1200,anim:6}):-3==e?layer.msg(StrackPHP.Illegal_Operation,{icon:7,time:1200,anim:6}):(Strack.top_message({bg:"g",msg:ApiauthPHP.MDApiauthSC}),$("#dialog").dialog("close"),$("#datagrid_box").datagrid("reload"))}})},api_group_delete:function(){for(var e=i.datagrid("getSelections"),t=[],a=0;a<e.length;a++)t.push(e[a].api_gid);Strack.ajax_grid_delete(e,ApiauthPHP.Group_Delete_Notice,ApiauthPHP.DEGroup,{ids:t.join(",")},"",ApiauthPHP.DEApiauthSC)}};var t={};t["title-1"]=ApiauthPHP.NullNotice,$("#group-tree").tree({url:ApiauthPHP.GroupList,checkbox:!0,queryParams:{rule_type:20}});var i=$("#datagrid_box").datagrid({url:ApiauthPHP.DataApiGroup,rownumbers:!0,nowrap:!0,fitColumns:Strack.FitColumns(".admin-dept-right",300),height:Strack.panel_height(".admin-dept-right",0),adaptive:{dom:".admin-dept-right",min_width:300},columns:[[{field:"api_gid",checkbox:!0},{field:"title",title:StrackPHP.Name,align:"center",width:300},{field:"status",title:StrackPHP.Status,align:"center",width:300,formatter:function(e,t,i){return 1==parseInt(e)?StrackPHP.Normal:StrackPHP.Disable}}]],toolbar:"#tb",pagination:!0,pageSize:10,pageList:[10,20],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(t,a){i.datagrid("selectRow",t),e(a)}})});