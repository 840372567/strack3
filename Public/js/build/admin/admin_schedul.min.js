$(function(){function e(){$.ajax({type:"POST",url:SchedulPHP.getSchedulWorkdaySetting,beforeSend:function(){$("#sc_workhours").append(Strack.loading_dom("white","","workhour"))},dataType:"json",success:function(e){$("#workday_start").timespinner({height:35,width:500,value:l(e.start)}),$("#workday_end").timespinner({height:35,width:500,value:l(e.end)}),$("#Exclude_Date").combobox({url:SchedulPHP.getSchedulExcludeList,width:500,height:35,valueField:"id",textField:"name",value:e.exDate,multiple:!0});var a=e.days.split(",");$("#workday_list").find(".workday-item").each(function(){$.inArray($(this).data("day"),a)>=0&&$(this).addClass("workday-ac")}),$("#st-load_workhour").remove()}})}function a(){$.ajax({type:"POST",url:SchedulPHP.getReminderSetting,dataType:"json",beforeSend:function(){$("#sc_workhours").append(Strack.loading_dom("white","","reminders"))},success:function(e){$("#reminders_title").val(e.rtitle),$("#reminders_body").val(e.rbody),Strack.init_open_switch({dom:"#reminders_on",value:e.ropen,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100}),$("#st-load_reminders").remove()}})}function t(){$("#datagrid_timelog").datagrid({url:SchedulPHP.getTimelogData,rownumbers:!0,nowrap:!0,height:Strack.panel_height("#sc_ctimelog",0),DragSelect:!0,adaptive:{dom:"#sc_ctimelog",min_width:300,exth:0},columns:[[{field:"timelog_issue_id",checkbox:!0},{field:"name",title:StrackPHP.Name,align:"center",width:300}]],toolbar:"#timelog_tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,a){$(this).datagrid("selectRow",e),i(a,"datagrid_box")}})}function i(e,a){Strack.open_dialog("dialog",{title:SchedulPHP.Modify_Timelog_Item,width:480,height:180,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mtimelog_id",type:"hidden",name:"timelog_issue_id",valid:1,value:e.timelog_issue_id}],items:[{case:1,id:"Mtimelog_iname",type:"text",lang:SchedulPHP.Timelog_Item_Name,name:"name",valid:"1,128",value:e.name}],footer:[{obj:"update_timelog",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),close:function(){$("#"+a).datagrid("reload")}})}function d(){$("#datagrid_calendar").datagrid({url:SchedulPHP.getTimeCalendarData,rownumbers:!0,nowrap:!0,height:Strack.panel_height("#sc_calendar",0),DragSelect:!0,adaptive:{dom:"#sc_calendar",min_width:300,exth:0},columns:[[{field:"calendar_id",checkbox:!0},{field:"name",title:StrackPHP.Name,align:"center",width:220},{field:"start_date",title:StrackPHP.StartDate,align:"center",width:160},{field:"end_date",title:StrackPHP.EndDate,align:"center",width:160},{field:"type_name",title:StrackPHP.Type,align:"center",width:160},{field:"user_name",title:StrackPHP.Created_by,align:"center",width:180}]],toolbar:"#calendar_tb",pagination:!0,pageSize:50,pageList:[50,100],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,a){$(this).datagrid("selectRow",e),n(a,"datagrid_box")}})}function n(e,a){Strack.open_dialog("dialog",{title:SchedulPHP.Modify_Time_Calendar,width:480,height:380,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mcalendar_id",type:"hidden",name:"calendar_id",valid:1,value:e.calendar_id}],items:[{case:1,id:"Mcalendar_name",type:"text",lang:SchedulPHP.Time_calendar_name,name:"name",valid:"1,128",value:e.name},{case:2,id:"Mcalendar_start",type:"text",lang:SchedulPHP.Time_calendar_start,name:"start_date",valid:"1",value:""},{case:2,id:"Mcalendar_end",type:"text",lang:SchedulPHP.Time_calendar_end,name:"end_date",valid:"1",value:""},{case:2,id:"Mcalendar_type",type:"text",lang:StrackPHP.Type,name:"type",valid:"1",value:e.type}],footer:[{obj:"update_timeCalendar_set",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){Strack.OpenDateBox("#Mcalendar_start",378,26,e.start_date),Strack.OpenDateBox("#Mcalendar_end",378,26,e.end_date),Strack.combobox_widget("#Mcalendar_type",{url:SchedulPHP.getCalendarTypeList,valueField:"id",textField:"name",width:378,height:26,value:e.type})},close:function(){$("#"+a).datagrid("reload")}})}function l(e){var a=Math.floor(e/3600),t=Math.floor(e%3600/60);return Strack.PrefixInteger(a,2)+":"+Strack.PrefixInteger(t,2)}function r(i){switch($(".temp-setlist-tab").removeClass("temp-d-active"),$("#sc_"+i).addClass("temp-d-active"),i){case"workhours":e();break;case"reminders":a();break;case"ctimelog":t();break;case"calendar":d()}}obj={switch_schedul:function(e,a){var t=$(e).data("tab");$("#sc_nomenu").hide(),$(".templates-items").removeClass("templates-active"),$(e).parent().addClass("templates-active"),r(t)},check_workday:function(e){$(e).data("day");$(e).hasClass("workday-ac")?$(e).removeClass("workday-ac"):$(e).addClass("workday-ac")},save_work_time:function(){var e=$("#workday_start"),a=e.timespinner("getHours"),t=e.timespinner("getMinutes"),i=$("#workday_end"),d=i.timespinner("getHours"),n=i.timespinner("getMinutes"),l=Strack.get_combos_val("#Exclude_Date","combobox","getValues"),r=[],o=l||[],c=3600*a+60*t,s=3600*d+60*n;c||(c=0),s||(s=0),$("#workday_list").find(".workday-item").each(function(){$(this).hasClass("workday-ac")&&r.push($(this).data("day"))}),$.ajax({type:"POST",url:SchedulPHP.saveSchedulWorkdaySetting,data:{start:c,end:s,exDate:o.join(","),days:r.join(",")},dataType:"json",beforeSend:function(){$("#sc_workhours").append(Strack.loading_dom("white","","workhour"))},success:function(e){$("#st-load_workhour").remove(),Strack.top_message({bg:"g",msg:e.message})}})},save_reminder_set:function(){var e=Strack.get_switch_val(),a=$("#reminders_title").val(),t=$("#reminders_body").val();e>0&&0==a.length?layer.msg(SchedulPHP.Reminders_Title_NULL,{icon:2,time:1200,anim:6}):e>0&&0==t.length?layer.msg(SchedulPHP.Reminders_Content_NULL,{icon:2,time:1200,anim:6}):$.ajax({type:"POST",url:SchedulPHP.saveReminderSetting,data:{ropen:e,rtitle:a,rbody:t},dataType:"json",beforeSend:function(){$("#sc_reminders").append(Strack.loading_dom("white","","reminders"))},success:function(e){$("#st-load_reminders").remove(),Strack.top_message({bg:"g",msg:SchedulPHP.Reminder_Save_SC})}})},add_timelog:function(){Strack.open_dialog("dialog",{title:SchedulPHP.Add_Timelog_Item,width:480,height:180,content:Strack.dialog_dom({type:"normal",items:[{case:1,id:"timelog_iname",type:"text",lang:SchedulPHP.Timelog_Item_Name,name:"name",valid:"1,128",value:""}],footer:[{obj:"update_timelogissue",type:1,title:StrackPHP.Submit},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]})})},update_timelogissue:function(){Strack.ajax_dialog_form("#st_dialog_form input","",SchedulPHP.addTimelogIssue,{back:function(e){200==parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_timelog").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},modify_timelog:function(){var e=$("#datagrid_timelog").datagrid("getSelections");e.length<1?layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6}):e.length>1?layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6}):i(e[0],"datagrid_box")},update_timelog:function(){Strack.ajax_dialog_form("#st_dialog_form input","",SchedulPHP.modifyTimelogIssue,{back:function(e){200==parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_timelog").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},delete_timelog:function(){Strack.ajax_grid_delete("datagrid_timelog","timelog_issue_id",SchedulPHP.Delete_Timelog_Notice,SchedulPHP.deleteTimelogIssue)},add_calendar:function(){Strack.open_dialog("dialog",{title:SchedulPHP.Add_TimeCalendar_Title,width:480,height:380,content:Strack.dialog_dom({type:"normal",items:[{case:1,id:"calendar_name",type:"text",lang:SchedulPHP.Time_calendar_name,name:"name",valid:"1,128",value:""},{case:1,id:"calendar_start",type:"text",lang:SchedulPHP.Time_calendar_start,name:"start_date",valid:"1",value:""},{case:1,id:"calendar_end",type:"text",lang:SchedulPHP.Time_calendar_end,name:"end_date",valid:"1",value:""},{case:1,id:"calendar_type",type:"text",lang:StrackPHP.Type,name:"type",valid:"1",value:""}],footer:[{obj:"submit_calendar",type:1,title:StrackPHP.Submit},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){Strack.OpenDateBox("#calendar_start",378,26),Strack.OpenDateBox("#calendar_end",378,26),Strack.combobox_widget("#calendar_type",{url:SchedulPHP.getCalendarTypeList,valueField:"id",textField:"name",width:378,height:26})}})},submit_calendar:function(){Strack.ajax_dialog_form("#st_dialog_form input","",SchedulPHP.addTimeCalendar,{back:function(e){200===parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_calendar").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},modify_calendar:function(){var e=$("#datagrid_calendar").datagrid("getSelections");e.length<1?layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6}):e.length>1?layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6}):n(e[0],"datagrid_box")},update_timeCalendar_set:function(){Strack.ajax_dialog_form("#st_dialog_form input","",SchedulPHP.modifyTimeCalendar,{back:function(e){200==parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_calendar").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},delete_calendar:function(){Strack.ajax_grid_delete("datagrid_calendar","calendar_id",SchedulPHP.Delete_Timelog_Notice,SchedulPHP.deleteTimeCalendar)}}});