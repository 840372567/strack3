$(function(){function e(e){Strack.open_dialog("dialog",{title:GroupPHP.Group_Title,width:480,height:360,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mgroup_id",type:"hidden",name:"id",valid:1,value:e.group_id}],items:[{case:1,id:"Mgroup_name",type:"text",lang:StrackPHP.Name,name:"title",valid:1,value:e.title},{case:2,id:"Mgroup_auth",lang:GroupPHP.Auth_Choice,name:"rules"}],footer:[{obj:"group_update",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){$("#Mgroup_auth").combotree({url:GroupPHP.GroupList,value:e.rules,multiple:!0,checkbox:!0,queryParams:{rule_type:10}})},close:function(){$("#datagrid_box").datagrid("unselectAll")}})}obj={group_choice:function(){$("#group-tree").hasClass("tree_all")?($("#group-tree").removeClass("tree_all"),$(".tree-checkbox").each(function(){$(this).removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox0")})):($("#group-tree").addClass("tree_all"),$(".tree-checkbox").each(function(){$(this).removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox1")}))},group_add:function(){var e=$("#group-tree").tree("getChecked"),t=$("input[name=group-name]").val();if(t.length<1)layer.msg(GroupPHP.NullNotice,{icon:2,time:1200,anim:6});else{var r;r=e.length<1?GroupPHP.NullAuth:StrackPHP.Confirm_OP,$.messager.confirm(StrackPHP.Warning,r,function(r){if(r){for(var a=[],o=0;o<e.length;o++)a.push(e[o].id);$.ajax({type:"POST",url:GroupPHP.AddGroup,data:{title:t,rules:a.join(",")},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close"),-1==e?layer.msg(GroupPHP.Group_Exist,{icon:7,time:1200,anim:6}):-2==e?layer.msg(GroupPHP.NullAuth,{icon:7,time:1200,anim:6}):(Strack.top_message({bg:"g",msg:GroupPHP.Group_Add_SC}),$("#datagrid_box").datagrid("reload"))}})}})}},group_modify:function(){var t=r.datagrid("getSelections");t.length<1?layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6}):t.length>1?layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6}):e(t[0])},group_update:function(){Strack.ajax_dialog_form("#st_dialog_form input",t,GroupPHP.MDGroup,{back:function(e){-1==e?layer.msg(GroupPHP.Group_Exist,{icon:7,time:1200,anim:6}):-2==e?layer.msg(GroupPHP.NullAuth,{icon:7,time:1200,anim:6}):-3==e?layer.msg(StrackPHP.Illegal_Operation,{icon:7,time:1200,anim:6}):(Strack.top_message({bg:"g",msg:GroupPHP.Group_Modify_SC}),$("#dialog").dialog("close"),$("#datagrid_box").datagrid("reload"))}})},group_delete:function(){for(var e=r.datagrid("getSelections"),t=[],a=0;a<e.length;a++)t.push(e[a].group_id);Strack.ajax_grid_delete(e,GroupPHP.Group_Delete_Notice,GroupPHP.DEGroup,{ids:t.join(",")},"",GroupPHP.Group_Delete_SC)}};var t={};t["title-1"]=GroupPHP.NullNotice,$("#group-tree").tree({url:GroupPHP.GroupList,checkbox:!0,queryParams:{rule_type:10}});var r=$("#datagrid_box").datagrid({url:GroupPHP.DataGroup,rownumbers:!0,nowrap:!0,fitColumns:Strack.FitColumns(".admin-dept-right",300),height:Strack.panel_height(".admin-dept-right",0),adaptive:{dom:".admin-dept-right",min_width:300,exth:0},columns:[[{field:"group_id",checkbox:!0},{field:"title",title:StrackPHP.Name,align:"center",width:300},{field:"status",title:StrackPHP.Status,align:"center",width:300,formatter:function(e,t,r){return 1==parseInt(e)?StrackPHP.Normal:StrackPHP.Disable}}]],toolbar:"#tb",pagination:!0,pageSize:10,pageList:[10,20],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(t,a){r.datagrid("selectRow",t),e(a)}})});