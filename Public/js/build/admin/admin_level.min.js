$(function(){function e(e,a){Strack.open_dialog("dialog",{title:LevelPHP.Modify_Level_Title,width:480,height:300,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mlevel_id",type:"hidden",name:"level_id",valid:1,value:e.level_id}],items:[{case:1,id:"Mlevel_name",type:"text",lang:StrackPHP.Name,name:"name",valid:"1,128",value:e.name},{case:1,id:"Mlevel_code",type:"text",lang:StrackPHP.Code,name:"code",valid:"1,128",value:e.code},{case:1,id:"Mlevel_score",type:"text",lang:LevelPHP.Score,name:"score",valid:"1,2",value:e.score}],footer:[{obj:"tlevel_update",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){$("#Mlevel_name").inputmask("*{1,128}"),$("#Mlevel_code").inputmask("alphaDash"),$("#Mlevel_score").inputmask("9{1,2}")},close:function(){$("#"+a).datagrid("reload")}})}function a(e){var a="";return e>=1&&e<30?a="D":e>=30&&e<60?a="C":e>=60&&e<80?a="B":e>=80&&e<=100&&(a="A"),a}obj={level_add:function(){var e=Strack.validate_form("add_level");200==e.status&&$.ajax({type:"POST",url:LevelPHP.addLevel,data:e.data,dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close"),200==parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),obj.level_reset()):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},level_modify:function(){var a=$("#datagrid_box").datagrid("getSelections");a.length<1?layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6}):a.length>1?layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6}):e(a[0],"datagrid_box")},tlevel_update:function(){Strack.ajax_dialog_form("#st_dialog_form input","",LevelPHP.modifyLevel,{back:function(e){200==parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message})):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},level_delete:function(){Strack.ajax_grid_delete("datagrid_box","level_id",LevelPHP.Delete_Level_Notice,LevelPHP.deleteLevel)},level_reset:function(){$("#datagrid_box").datagrid("reload")}},$("#level_name").inputmask("*{1,128}"),$("#level_code").inputmask("alphaDash"),$("#level_score").inputmask("9{1,2}").on("blur",function(){$("#level_score_n").html(a($(this).val()))}),$("#datagrid_box").datagrid({url:LevelPHP.getLevelData,rownumbers:!0,nowrap:!0,height:Strack.panel_height(".admin-dept-right",0),DragSelect:!0,adaptive:{dom:".admin-dept-right",min_width:1004,exth:0},columns:[[{field:"level_id",align:"center",checkbox:!0},{field:"name",title:StrackPHP.Name,align:"center",width:260},{field:"code",title:StrackPHP.Code,align:"center",width:220},{field:"score",title:LevelPHP.Score,align:"center",width:220},{field:"group",title:StrackPHP.Group,align:"center",width:220,formatter:function(e,t,l){return a(t.score)}}]],toolbar:"#tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(a,t){$(this).datagrid("selectRow",a),e(t,"datagrid_box")}})});