var Strack={set_cookie:function(t,e,a){Strack.remove_cookie(t);var i=new Date;a<=0&&(a=1),i.setTime(i.getTime()+864e5*a),document.cookie=t+"="+encodeURI(e)+"; expires="+i.toGMTString()+";path=/"},get_cookie:function(t){var e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]*)(;|$)"));return null!=e?decodeURIComponent(e[2]):""},remove_cookie:function(t){var e=new Date;""!==Strack.get_cookie(t)&&(e.setTime(e.getTime()-864e5),document.cookie=t+"=;expires="+e.toGMTString())},save_storage:function(t,e){sessionStorage.setItem(t,e)},read_storage:function(t){return sessionStorage.getItem(t)},delete_storage:function(t){sessionStorage.removeItem(t)},clear_all_storage:function(){sessionStorage.clear()},get_page_uuid:function(){var t=$(document.body),e={identity:t.data("identity"),created:t.data("created")};return e.page_uuid=e.identity+"_"+e.created,e},css:function(t,e){if(!e||0===e.length)throw new Error('CSS "path" is required !');var a=document.getElementById(t);$(a).append("<link type='text/css' rel='stylesheet' href='"+e+"' />")},js:function(t,e){if(!e||0===e.length)throw new Error('JS "path" is required !');var a=document.getElementById(t);$(a).append("<script type='text/javascript' language='javascript' src='"+e+"'/><\/script>")},html_encode:function(t){return $("<div/>").text(t).html()},html_decode:function(t){return $("<div/>").html(t).text()},get_obj_by_id:function(t){return document.getElementById(t)},array_distinct:function(t,e){for(var a=[],i=t.concat(e),d={},r=0;r<i.length;r++)i[r]in d?d[i[r]]++:d[i[r]]=1;for(x in d)1==d[x]&&a.push(x);return a},array_group:function(t,i){return t.reduce(function(t,e,a){return t[e[i]]=t[e[i]]||[],t[e[i]].push(e),t},{})},get_base_path:function(t){var e=t.split("/");return e.pop(),e.join("/")},trim_spaces:function(t,e){var a=t.replace(/(^\s+)|(\s+$)/g,"");return"g"===e.toLowerCase()&&(a=a.replace(/\s/g,"")),a},string_ucwords:function(t){return t.substring(0,1).toUpperCase()+t.substring(1)},prefix_integer:function(t,e){return(Array(e).join(0)+t).slice(-e)},time_to_frame:function(t,e){var a=t*(e||Strack.G.FrameRates.film);return Math.round(a)},replace_textarea:function(t){if(t){var e=new RegExp("\r\n","g");t=t.replace(e,"<br>")}return t},revert_textarea:function(t){var e=new RegExp("＜br＞","g"),a=new RegExp("＜p＞","g");return t=(t=t.replace(e,"\r\n")).replace(a," ")},replace_html_tag:function(t){return t=t.replace(/<\/?[^>]*>/g,"")},remove_html_ext:function(t){return t.replace(".html","")},hex_to_rgb:function(t,e){var a=("#"+t).toLowerCase();if(a&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(a)){if(4===a.length){for(var i="#",d=1;d<4;d+=1)i+=a.slice(d,d+1).concat(a.slice(d,d+1));a=i}for(var r=[],o=1;o<7;o+=2)r.push(parseInt("0x"+a.slice(o,o+2)));return"RGBA("+r.join(",")+","+e+")"}return a},current_time:function(){return Date.parse(new Date)/1e3},remove_parent:function(t){$(t).parent().remove()},date_format:function(t,e){var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return e},MDFormat:function(t){t=new Date(t);var e,a,i,d=(new Date).getFullYear(),r=t.getFullYear(),o=Strack.date_format(t,"yyyy-M-d"),n="",s=[StrackLang.January,StrackLang.February,StrackLang.March,StrackLang.April,StrackLang.May,StrackLang.June,StrackLang.July,StrackLang.August,StrackLang.September,StrackLang.October,StrackLang.November,StrackLang.December],l=new Date,c=new Date,_=new Date;return e=Strack.date_format(l,"yyyy-M-d"),c.setHours(0,0,0,0),c.setDate(c.getDate()-1),a=Strack.date_format(c,"yyyy-M-d"),_.setHours(0,0,0,0),_.setDate(_.getDate()+1),i=Strack.date_format(_,"yyyy-M-d"),e==o?n=StrackLang.Today:a==o?n=StrackLang.Yesterday:i==o?n=StrackLang.Tomorrow:(n=s[t.getMonth()]+" "+t.getDate()+StrackLang.UnitTH,r!=d&&(n="("+r+") "+n)),n},lastMFirst:function(t){var e=new Date,a=e.getFullYear(),i=e.getMonth()+1;return 0==i&&(i=12,a-=1),i<10&&(i="0"+i),"today"==t?a+"-"+i+"-"+e.getDate():a+"-"+i+"-01"},getLastDay:function(t,e){var a=t,i=e++;12<e&&(i-=12,a++);var d=new Date(a,i,1);return new Date(d.getTime()-864e5).getDate()},lastMonthDate:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),d=new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);return 1==a?(e=t.getFullYear()-1,a=12):a-=1,e%4==0&&e%100!=0&&(d[2]=29),d[a]<i&&(i=d[a]),i<10&&(i="0"+i),a<10&&(a="0"+a),e+"-"+a+"-"+i},getTime2Time:function(t,e){var a=t,i=e;return((a=Date.parse(a)/1e3)-(i=Date.parse(i)/1e3))/86400},generate_hidden_param:function(){var t,e={};return $("#page_hidden_param").find("input").each(function(){t=$(this).attr("name"),e[t]=$(this).val()}),e},copy_to_clipboard:function(){layer.msg(StrackLang.Copy_Clipboard_SC)},number_add_zero:function(t,e){return(""+t).length<e?(new Array(e+1).join("0")+t).slice(-e):""+t},add_animate_effect:function(t,e,a,i,d,r){$(t).hasClass(e)||($(t).addClass(e),a&&($(i).hide(),$(t).append(r)),window.setTimeout(function(){$(t).removeClass(e)},1e3))},init_lazy_load:function(t,e){$(t).lazyload({container:$(e),event:"scroll",effect:"fadeIn"})},fall_load_data:function(t,d,r,o){$(t).on("scroll",function(){var t=this.scrollTop||this.scrollTop,e=this.scrollHeight||this.scrollHeight,a=this.clientHeight||this.clientHeight;if(o&&o(),t===e-a){d.page_number++;var i=Math.ceil(d.total/d.page_size);d.page_number<=i&&r&&r(d)}})},array_to_json:function(t){var e="";for(var a in t)e+=a+"="+t[a]+"&";return e=e.substring(0,e.length-1)},validate_form:function(t){var o={},n=200;return $("#"+t+" .form-input").each(function(){var t=$(this).attr("id"),e=$(this).attr("wiget-type"),a=$(this).attr("wiget-need"),i=$(this).attr("wiget-field"),d=$(this).attr("wiget-name"),r="";switch(e){case"input":case"textarea":r=$("#"+t).val();break;case"combobox":r=Strack.get_combos_val("#"+t,"combobox","getValue");break;case"combobox_s":r=Strack.get_combos_val("#"+t,"combobox","getValues");break;case"switch":r=Strack.get_switch_val("#"+t);break;case"datebox":r=(r=$("#"+t).datebox("getValue"))||"";break;case"json":r=Strack.get_json_editor_val(t)}if("yes"===a&&0===r.length)return n=404,layer.msg(d+" : "+StrackLang.Required_Field,{icon:2,time:1200,anim:6}),!1;o[i]=r}),{status:n,message:"",data:o}},validate_date_format:function(t){var e=!1,a=t.split("-"),i=0,d=0,r=0,o=0,n=0,s=0;if(3==a.length){var l=a[2].split(" ");if(2==l.length){var c=l[1].split(":");i=a[0],d=a[1],r=l[0],o=c[0],n=c[1];var _=!1;if((s=0)<=o&&o<=23&&0<=n&&n<=59&&0<=s&&s<=59?_=!0:24==o&&0==n&&0==s&&(_=!0),_){var m=!1;i%4==0&&(m=!0),(4==d||6==d||9==d||11==d)&&0<=r&&r<=30?e=!0:2!=d&&0<=r&&r<=31&&(e=!0),e||(m?2==d&&0<=r&&r<=29&&(e=!0):2==d&&0<=r&&r<=28&&(e=!0))}}}return e},check_email:function(t){return!0!=!new RegExp(/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]$/).test(t)},check_auth_format:function(t){return!(t.length<1||t.indexOf("/")<1)},check_long:function(t,e){return t.length==e},valid_form:function(t,e,a){if(isNaN(t)){var i=t.split(","),d=parseInt(i[0]),r=parseInt(i[1]);return d===r?e.length<d?{status:!1,error_num:-1,message:a+""+StrackLang.Error_Valid_Fixed+" "+d}:{status:!0,error_num:0,message:""}:e.length<d||e.length>r?{status:!1,error_num:-1,message:a+""+StrackLang.Error_Valid_Range+" "+d+"-"+r}:{status:!0,error_num:0,message:""}}switch(t){case 0:return{status:!0,error_num:0,message:""};case 1:return""===e||null===e?{status:!1,error_num:-1,message:a+""+StrackLang.Error_Valid_Empty}:{status:!0,error_num:0,message:""};case 2:return Strack.check_email(e)?{status:!0,error_num:0,message:""}:{status:!1,error_num:-1,message:a+""+StrackLang.Error_Format};case 3:return Strack.check_auth_format(e)?{status:!0,error_num:0,message:""}:{status:!1,error_num:-1,message:a+""+StrackLang.Error_Format};default:return{status:!1,error_num:666,message:StrackLang.Illegal_Operation}}},dialog_dom:function(t){var e,a="",i="",d="",r="";switch(e=t.hidden?t.hidden:[],t.type){case"normal":d+='<div class="st-dialog-main">',r+=Strack.dialog_hide(e),r+=Strack.dialog_form(t.items),i=Strack.dialog_footer(t.footer,""),a+=Strack.dialog_build(d,"",r,i);break;case"adv_filter":d+='<div class="st-dialog-datalist pitem-wrap">',r+=Strack.dialog_hide(e),r+='<div id="adv_fdialog" class="adv-filter-main"><div class="dgcb-query-all"><div class="query-all-name aign-left">'+StrackLang.ConditionalLogic+'</div><div class="query-all-input aign-left"><input id="logic_comb"></div><a href="javascript:;" onclick="Strack.add_filter_group(this)" class="query-all-btn aign-left"><i class="icon-uniEA33"></i>'+StrackLang.AddFilterGroup+'</a></div><div id="dg_adv_filter" class="dgcb-query-wrap"></div></div>',i=Strack.dialog_footer(t.footer,""),a+=Strack.dialog_build(d,"",r,i);break;case"adv_sort":var o=[{case:106,lang:StrackLang.Sort_First_By,index:"first"},{case:106,lang:StrackLang.Then_By,index:"second"},{case:106,lang:StrackLang.Then_By,index:"third"}];r+=Strack.dialog_hide(e),i=Strack.dialog_footer(t.footer,"");var n="";o.forEach(function(t){n+=Strack.dialog_items(t)}),d+='<div class="st-dialog-main">',r+="<div>"+n+"</div>",a+=Strack.dialog_build(d,"",r,i);break;case"relationship_set":r+=Strack.dialog_hide(e),d+='<div class="st-dialog-main">',r+='<div class="st-dg-relate-r"><div class="dg-relate-r-t">'+StrackLang.Related_Module_Title+'</div><div class="dg-relate-r-list"><table class="ui celled striped table"><tbody id="related_module_list" ></tbody></table></div></div>',r+='<div class="st-dg-relate-l"><div class="st-dialog-toolbar"><a href="javascript:;" class="easyui-linkbutton" iconCls="icon-add" plain="true"onclick="Strack.dialog_relationship_item();">'+StrackLang.Add+'</a></div><div id="st_relationship" class="st-dialog-relate"></div></div>',i=Strack.dialog_footer(t.footer,""),a+=Strack.dialog_build(d,"",r,i);break;case"download":break;case"avatar":d+='<div class="st-dialog-main">',r+=Strack.dialog_hide(e),r+=Strack.dialog_avatar(t.header_extra,t.footer),a+=Strack.dialog_build(d,"",r,i);break;case"item_operation":d+='<div class="st-dialog-main">',r+=Strack.dialog_hide(e),r+=Strack.dialog_form(t.items),r+='<div class="st-dialog-up"><ul id="st_dialog_item" class="dg-report-list"></ul></div>',i=Strack.dialog_footer(t.footer,""),a+=Strack.dialog_build(d,"",r,i);break;case"media":d+='<div id="media_main" class="st-dialog-media pitem-wrap">',r+=Strack.dialog_media(t.media),a+=Strack.dialog_build(d,"",r,"");break;case"datagrid":d+='<div class="st-dialog-datalist pitem-wrap">',r+=Strack.dialog_hide(e),r+=Strack.dialog_grid(t.grid),i=Strack.dialog_footer(t.footer,""),a+=Strack.dialog_build(d,"",r,i);break;case"add_custom_field":d+='<div class="st-dialog-datalist pitem-wrap">',r+=Strack.dialog_hide(e),r+=Strack.dialog_custom_field(),i=Strack.dialog_footer(t.footer,""),a+=Strack.dialog_build(d,"",r,i);break;case"add_entity_task":d+='<div class="st-dialog-entity-task pitem-wrap">',r+=Strack.dialog_hide(e),r+=Strack.dialog_add_entity_task(t.entity_title),i=Strack.dialog_footer(t.footer,""),a+=Strack.dialog_build(d,"",r,i)}return a},dialog_build:function(t,e,a,i){var d="";return d+=t,d+=e,d+='<form id="st_dialog_form" style="height: 100%">'+a+"</form>",d+=i,d+="</div>"},dialog_hide:function(t){var e="";return t.forEach(function(t){e+=Strack.dialog_items(t)}),'<div id="st_dialog_form_hide">'+e+"</div>"},dialog_form:function(t){var e="";return t.forEach(function(t){e+=Strack.dialog_base_item(t.lang,t)}),e},dialog_footer:function(t,e){var a="<footer>";return e&&(a+='<div class="st-dialog-lfooter">'+Strack.dialog_button(0,e)+"</div>"),a+='<div class="st-dialog-footer">'+Strack.dialog_button(0,t)+"</div>",a+="</footer>"},dialog_grid:function(t){var e="";return e+='<div id="'+t.wrap_dom+'" class="entity-datalist" style="height: '+t.height+'px ;width: 100%" >',t.toolbar_show&&(e+='<div id="'+t.toolbar_id+'" class="proj_tb tb-padding-grid-small st-buttons-blue" style="overflow: hidden">'+Strack.dialog_grid_toolbar(t.toolbar_dom)+"</div>"),t.top_notice&&(e+='<div class="dg-data-notice text-ellipsis">'+t.top_notice+"</div>"),e+='<table id="'+t.table_dom+'" ></table></div>'},dialog_grid_toolbar:function(t){var e="";return t.forEach(function(t){e+=Strack.toolbar_dom_build(t)}),e},toolbar_dom_build:function(t){var e="";switch(t.type){case"button":e+='<a href="javascript:;" class="easyui-linkbutton" iconCls="'+t.icon+'" plain="true" onclick="'+t.obj+'(this);">'+t.title+"</a>"}return e},dialog_custom_field:function(){var t="";return t+='<div class="stdg-add-field"><div class="stdg-field-left aign-left"><div class="stdg-left-header">'+StrackLang.Field_Type+'</div><div id="stdg_fd_list" class="stdg-left-wrap"></div></div><div class="stdg-field-right aign-left"><div id="stdg_fd_title" class="stdg-right-header">'+StrackLang.Please_One_Field_Type+'</div><div id="stdg_fd_main" class="stdg-right-wrap"></div></div></div>'},dialog_add_entity_task:function(t){var e="",a=Strack.dialog_form([{case:2,id:"Mentity",lang:t,name:"entity_ids",valid:"1"},{case:2,id:"Mstep",lang:StrackLang.Step,name:"step_ids",valid:"1"}]),i=Strack.dialog_form([{case:2,id:"Nup_fields",type:"text",lang:StrackLang.Fields,name:"fields",valid:1,value:""}]);return e+='<div class="stdg-etask-wrap"><div class="stdg-etask-left"><div class="stdg-etask-l-input">'+a+'</div><div id="stdg_etask_list" class="stdg-etask-l-list"><div class="datagrid-empty-no">'+StrackLang.Please_Select_Step+'</div></div></div><div class="stdg-etask-right"><div class="etask-right-null"><div class="datagrid-empty-no">'+StrackLang.Please_Select_Base+'</div></div><div class="etask-right-main"><div class="etask-right-input">'+i+'</div><div class="st-dialog-up"><ul id="st_dialog_item" class="dg-report-list"></ul></div></div></div></div>'},remove_entity_step_task:function(t){var e=$(t).closest(".stdg-etask-l-item"),a=e.attr("id"),i=e.attr("data-stepcode"),d=e.attr("data-stepid"),r=$(t).closest(".etask-l-lists");if(e.remove(),Strack.reset_entity_step_task_data({type:"remove",param:{id:d,code:i},step_code:i,md5_name:a}),0===r.find(".stdg-etask-l-item").length){var o=$(t).data("step");$("#"+o).combobox("unselect",d)}},remove_entity_step_task_group:function(t,e){$("#etask_g_"+e.code).remove(),Strack.check_entity_step_task_list(t)},copy_entity_step_task:function(t){var e=$(t).closest(".stdg-etask-l-item"),a=(e.attr("id"),e.attr("data-stepcode")),i=e.attr("data-stepid"),d={step_id:$(t).data("step"),list_id:$(t).data("list"),combox_id:$(t).data("combox"),edit_id:$(t).data("edit")},r=$(t).data("md5name"),o=Strack.check_item_operate_fields(d.combox_id,d.edit_id);Strack.G.entityStepTaskAddData.data[a][r]=o.up_data,o.allow_up&&e.after(Strack.entity_step_task_item_dom(d,{id:i,code:a,md5_name:r}),"new")},add_entity_step_task_group:function(t,e,a){var i=Strack.entity_step_task_item_dom(t,e,a),d=$("#"+t.list_id);if(0===d.find(".etask-l-list-g").length&&d.empty(),"new"===a)d.append(Strack.entity_step_task_group_dom(e,i,a));else{var r=$("#etask_g_"+e.step_code);0<r.length?r.find(".etask-l-lists").append(i):d.append(Strack.entity_step_task_group_dom(e,i,a))}},entity_step_task_item_dom:function(t,e,a){var i="",d="new"===a?e.code+"_"+Math.floor(1e4*Math.random()+1):e.code,r="new"===a?e.code:e.step_code;return i+='<div id="'+d+'" class="stdg-etask-l-item" data-stepcode="'+r+'" data-stepid="'+e.id+'"><a href="javascript:;" class="etask-l-item-bnt etask-l-remove" onclick="Strack.remove_entity_step_task(this)" title="'+StrackLang.Delete+'" data-step="'+t.step_id+'"><i class="icon-uniE6DB"></i></a><a href="javascript:;" class="etask-l-item-bnt etask-l-copy" onclick="Strack.copy_entity_step_task(this)" title="'+StrackLang.Copy+'" data-md5name="'+d+'" data-combox="'+t.combox_id+'" data-step="'+t.step_id+'" data-list="'+t.list_id+'" data-edit="'+t.edit_id+'"><i class="icon-uniE92A"></i></a><a href="javascript:;" class="text-ellipsis etask-l-item-name" onclick="Strack.set_entity_step_task(this)" data-combox="'+t.combox_id+'" data-list="'+t.list_id+'" data-edit="'+t.edit_id+'">'+d+"</a></div>",Strack.reset_entity_step_task_data({type:"add",param:e,step_code:r,md5_name:d,mode:a}),i},reset_entity_step_task_data:function(e){if("add"===e.type){if(Strack.G.entityStepTaskAddData.data.hasOwnProperty(e.step_code)||(Strack.G.entityStepTaskAddData.data[e.step_code]={}),"old"!==e.mode)if(e.param.md5_name&&$("#"+e.param.md5_name).hasClass("etask-l-active")){var t=Strack.G.entityStepTaskAddData.data[e.step_code][e.param.md5_name],a=[];t.base.forEach(function(t){0<=$.inArray(t.field,["base-name","base-code"])&&(t.value=e.md5_name),a.push(t)}),t.base=a,Strack.G.entityStepTaskAddData.data[e.step_code][e.md5_name]=t}else Strack.G.entityStepTaskAddData.data[e.step_code][e.md5_name]={base:[{field:"base-name",field_type:"built_in",value:e.md5_name,variable_id:0},{field:"base-code",field_type:"built_in",value:e.md5_name,variable_id:0}]}}else if("remove"===e.type){var i=Strack.G.entityStepTaskAddData.data[e.step_code],d={};for(var r in i)e.md5_name!==r&&(d[r]=i[r]);Strack.G.entityStepTaskAddData.data[e.step_code]=d}},entity_step_task_group_dom:function(t,e,a){var i="",d="new"===a?t.name:t.step_name;return i+='<div id="etask_g_'+("new"===a?t.code:t.step_code)+'" class="etask-l-list-g"><div class="etask-l-list-title text-ellipsis">'+d+'</div><div class="etask-l-lists">'+e+"</div></div>"},set_entity_step_task:function(t){var e=$(t).closest(".stdg-etask-l-item"),a=e.attr("id"),i=e.attr("data-stepcode"),d=$(t).data("list"),r=$(t).data("combox"),o=$(t).data("edit"),n=$("#"+d),s=$("#"+o),l=n.find(".etask-l-active"),c=!0;if(0<l.length){var _=l.attr("id"),m=l.attr("data-stepcode"),u=Strack.check_item_operate_fields(r,o);c=u.allow_up,Strack.G.entityStepTaskAddData.data[m][_]=u.up_data}else"m_review_task_item"===o&&$("#step_task_details").show(),$(".etask-right-null").hide(),$(".etask-right-main").show();if(c){n.find(".stdg-etask-l-item").removeClass("etask-l-active"),e.addClass("etask-l-active"),l.addClass("form_ok");var g=Strack.G.entityStepTaskAddData.data[i][a],p={};if($.isEmptyObject(g))p["base-name"]=a,p["base-code"]=a;else for(var f in g)g[f].forEach(function(t){p[t.field]=t.value});$(".form-tip").remove(),s.find(".field_edit_item").each(function(){var t=$(this).attr("data-editor"),e=$(this).attr("data-field"),a=$(this).attr("data-multiple");if(p.hasOwnProperty(e))switch(t){case"combobox":"yes"===a?$(this).combobox("setValues",p[e]):$(this).combobox("setValue",p[e]);break;case"datebox":$(this).datebox("setValue",p[e]);break;case"checkbox":"yes"===p[e]?$(this).attr("checked","checked"):$(this).attr("checked","");break;default:$(this).val(p[e])}else switch(t){case"combobox":$(this).combobox("clear");break;case"datebox":$(this).datebox("clear");break;case"checkbox":$(this).attr("checked","");break;default:$(this).val("")}})}else l.removeClass("form_ok")},check_entity_step_task_list:function(t){var e=$("#"+t.list_id);0===e.find(".etask-l-list-g").length&&(e.empty().append('<div class="datagrid-empty-no">'+StrackLang.Please_Select_Step+"</div>"),$(".etask-right-main").hide(),$(".etask-right-null").show())},dialog_avatar:function(t,e){var a="";return a+='<div class="up-avatar"><header id="crop_avatar_js"></header><div class="user-avatar">'+$("#"+t.user_data.dom_id).html()+'</div><div class="user-avatar-wrap"><span class="avatar-w-title"><p>'+t.lang+'</p></span></div></div><div class="crop-avatar-wrap"><div class="crop-avatar-img"></div><div class="crop-avatar-view"><div class="avatar-view-sm1"></div><div class="avatar-view-sm2"></div><div class="avatar-view-sm3"></div></div><div class="crop-avatar-footer"><a href="javascript:;" class="file">'+StrackLang.Select_Image_File+'<input id="img_upload" type="file" name="" id=""></a><div class="user-avatar-button">'+Strack.dialog_button(0,e)+"</div></div></div>"},dialog_button:function(t,e){for(var a="",i=t;i<e.length;i++){switch(e[i].type){case 1:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgsub" onclick="obj.'+e[i].obj+'();">';break;case 2:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgcel" onclick="obj.'+e[i].obj+'();">';break;case 3:a+='<a href="javascript:;" id="'+e[i].id+'" class="st-dialog-button button-dgcel">';break;case 4:a+='<a href="javascript:;" class="st-dialog-button file">'+StrackLang.Select_Image_File+'<input id="img_up_bnt" type="file" name="">';break;case 5:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgsub" onclick="Strack.'+e[i].obj+'();">';break;case 6:a+='<input id="'+e[i].obj+'" class="aign-left" name="'+e[i].obj+'" type="file" multiple="true">';break;case 7:a+='<a href="javascript:;" class="st-dialog-button st-button-base stdown-filter project_filter" onclick="Strack.'+e[i].obj+"(this,"+e[i].value[3]+","+e[i].value[0]+","+e[i].value[1]+","+e[i].value[2]+');" data-dtype="'+e[i].value[3]+'" data-height="'+e[i].value[1]+'">'+e[i].title+'<i class="dropdown icon project_filter"></i></a>';break;case 8:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgcel" onclick="Strack.'+e[i].obj+'();">';break;case 9:a+='<div id="dailog_error" class="dailog-error aign-left" style="width:'+e[i].width+'"><div class="error-icon aign-left icon-left"><i class="icon-uniEA30"></i></div><div class="error-notice aign-left text-ellipsis"></div></div>';break;case 10:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgcel" onclick="Strack.'+e[i].obj+'(this);" data-tab="prev">';break;case 11:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgsub" onclick="Strack.'+e[i].obj+'(this);" data-tab="next">';break;case 12:a+='<div class="dailog-upexcel aign-left"><input id="'+e[i].obj+'" class="aign-left" name="'+e[i].obj+'" type="file" multiple="true"></div>';break;case 13:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgsstop" onclick="obj.'+e[i].obj+'();">';break;case 14:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgsstop" onclick="Strack.'+e[i].obj+'();">';break;default:a+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgsub" onclick="obj.'+e[i].obj+'();">'}[7,9].indexOf(e[i].type)<0&&(a+=e[i].title,a+="</a>")}return a},dialog_relationship_item:function(){var t=Math.floor(1e3*Math.random()+1),e=$("#Mmodule_id").val(),a=$("#hide_temp_id").val();return $("#st_relationship").append(Strack.dialog_items({case:108,index:t})),Strack.combobox_widget("#first_"+t,{url:StrackPHP.getRelationshipModuleList,valueField:"id",textField:"name",width:160,value:e,queryParams:{module_id:e,template_id:a,type:"entity",position:"first"}}),Strack.combobox_widget("#second_"+t,{url:StrackPHP.getRelationshipModuleList,valueField:"id",textField:"name",width:160,queryParams:{module_id:e,template_id:a,type:"entity",position:"second"}}),t},dialog_items:function(t){var e=t.case,a="",i="";switch(t.mask&&(i=t.mask),e){case 1:a='<input id="'+t.id+'" class="dialog-widget-val" data-widget="input" type="'+t.type+'" autocomplete="off" data-name="'+t.name+'" data-valid="'+t.valid+'" value="'+t.value+"\" data-inputmask=\"'alias':'"+i+"'\">";break;case 2:a='<input id="'+t.id+'" class="dialog-widget-val" data-widget="widget" data-name="'+t.name+'" data-valid="'+t.valid+'" >';break;case 3:a='<div class="dialog-json-editor"><div id="'+t.id+'" class="dialog-widget-val" data-widget="json" data-name="'+t.name+'" data-valid="'+t.valid+'"></div></div>';break;case 4:a='<div id="'+t.id+'" class="dialog-widget-val" data-widget="datalist" data-name="'+t.name+'" ></div>';break;case 5:a='<div class="template-columns-wrap" ><div class="template-columns-item template-margin" ><div id="template-field"  ></div></div><div class="template-columns-item" ><table id="template-columns" ></table></div></div>';break;case 6:a+='<a class="admin-softicon-amd" href="javascript:;" onclick="obj.'+t.name+"("+t.sid+');">',a+='<img class="admin-softicon-md" src="'+StrackPHP.UPLOADS+"/SoftwareIcon/"+t.value+'.jpg">',a+="</a>";break;case 7:a='<textarea id="'+t.id+'" class="dialog-widget-val" data-widget="textarea" data-name="'+t.name+'" data-valid="'+t.valid+'">'+t.value+"</textarea>";break;case 8:a+='<div id="'+t.id+'" data-name="'+t.name+'" data-valid="'+t.valid+'"><div class="'+t.value+'"></div></div>';break;case 9:a+='<div id="queue" class="img_queue"></div>';break;case 11:a+='<div id="queue" class="single_queue"></div>';break;case 10:a+='<div style="" class="st-dialog-tags"><input id="'+t.id+'" class="combo-tags dialog-widget-val" data-widget="tags" data-name="'+t.name+'" placeholder="'+StrackLang.InputTag+'" style="width: calc(100% - 10px); padding: 2px 5px 3px;"></div>';break;case 101:a='<input id="'+t.id+'" class="dialog-widget-val" data-widget="input" type="'+t.type+'" data-name="'+t.name+'"  data-valid="'+t.valid+'" value="'+t.value+'">';break;case 102:a='<div id="'+t.id+'" class="hidden"></div>';break;case 103:a='<div id="dg_comb_list" class="dg-comb-list"></div>';break;case 104:a='<div id="dg_comb_display" class="dg-cb-display"><div class="dgcb-disp-name aign-left">'+StrackLang.Summafield+'</div><div class="dgcb-disp-input aign-left"><input id="Fdgcb_field" ></div><div class="dgcb-cal-name aign-left">'+StrackLang.Calculation+'</div><div class="dgcb-cal-input aign-left"><input id="Fdgcb_cal" ></div></div>';break;case 105:a='<div id="dg_comb_query" class="dg-cb-query"><div class="dgcb-query-all"><div class="query-all-name aign-left">'+StrackLang.ConditionalLogic+'</div><div class="query-all-input aign-left"><input id="logic_comb"></div><a href="javascript:;" onclick="Strack.add_filter_group(this)" class="query-all-btn aign-left"><i class="icon-uniEA33"></i>'+StrackLang.AddFilterGroup+'</a></div><div id="dgcb_qwrap" class="dgcb-query-wrap"></div></div>';break;case 106:a='<div class="st-dialog-items"><div class="st-dialog-name">'+t.lang+'</div><div id="shang_'+t.index+'" class="st-dialog-input" data-name="'+t.index+'" style="overflow: hidden;"><div class="input-left aign-left"><input  id="sort_'+t.index+'" autocomplete="off" type="text"></div><div class="input-right aign-left"><input id="sort_'+t.index+'_func" autocomplete="off" type="text"></div></div></div>';break;case 107:a='<div class="template-columns-wrap" ><div class="template-columns-item template-margin" ><div id="template_field" ></div></div><div class="template-columns-item" ><input id="m_view_id" value="0" type="hidden"/><div class="st-dialog-items"><div class="st-dialog-name">'+StrackLang.Name+'</div><div class="st-dialog-input"><input id="m_view_name" /></div></div><div class="st-dialog-items"><div class="st-dialog-name">'+StrackLang.Public+'</div><div class="st-dialog-input"><input id="m_view_share" /></div></div></div></div>';break;case 108:a='<div class="st-dialog-items"><div class="st-dialog-input" data-name="'+t.index+'" style="overflow: hidden;"><div class="input-left aign-left"><input  id="first_'+t.index+'" autocomplete="off" type="text"></div><div class="input-right aign-left"><input id="second_'+t.index+'" autocomplete="off" type="text"></div><a href="javascript:;" class="a-close-bnt aign-left" onclick="Strack.remove_parent(this)"><i class=" icon-uniE6DB"></i></a></div></div>';break;default:a="404"}return a},dialog_base_item:function(t,e){var a='<div class="st-dialog-items">',i=0<e.valid.length?"required":"";switch(parseInt(e.case)){case 103:a+='<div class="st-dialog-name '+i+'"><div class="g-comb-name aign-left">'+t+'</div><a href="javascript:;" onclick="Strack.add_cf_comb_item(this)" class="dg-comb-add aign-left"><i class="icon-uniEA33 icon-right"></i></a></div>';break;default:a+='<div class="st-dialog-name '+i+'">'+t+"</div>"}return a+='<div class="st-dialog-input">'+Strack.dialog_items(e)+"</div></div>"},switch_top_nav:function(t){var e=$(t).attr("data-tools");switch(e){case"timelog":Strack.load_side_timelog("active")}$("#tools_slider_"+e).sidebar("toggle")},toggle_slider_tab:function(t){var e=$(t).attr("data-panel"),a=$(t).attr("data-tab");switch(e){case"timelog":Strack.load_side_timelog(a)}},load_side_timelog:function(t){switch($("#slider_timelog_wrap").find(".sd-tg-tab").removeClass("active"),$("#slider_tg_tab_"+t).addClass("active"),$(".slider-menu-main").removeClass("active"),$("#slider_tg_main_"+t).addClass("active"),$("#slider_tg_refresh").attr("data-tab",t),t){case"active":$.ajax({type:"POST",url:StrackPHP.getSideTimelogMyTimer,dataType:"json",contentType:"application/json",beforeSend:function(){$("#slider_timelog_wrap").prepend(Strack.loading_dom("white","","timelog")),$("#slider_timer_list").empty()},success:function(t){t.forEach(function(t){Strack.init_active_timer(t)}),Strack.check_timer_exit(),$("#st-load_timelog").remove()}});break;case"history":Strack.load_timelog_slider_history("#slider_tg_history_list",{page_number:1,page_size:30,status:"new"})}},load_timelog_slider_history:function(e,a){$.ajax({type:"POST",url:StrackPHP.getSideTimelogMyData,dataType:"json",data:{page_number:a.page_number,page_size:a.page_size},beforeSend:function(){$("#slider_timelog_wrap").prepend(Strack.loading_dom("white","","timelog"))},success:function(t){"new"===a.status&&($(e).empty(),a.status="more",a.total=t.total,Strack.fall_load_data(e,a,function(t){Strack.load_timelog_slider_history(e,a)})),Strack.fill_timelog_history_list(e,t.rows),$("#st-load_timelog").remove()}})},fill_timelog_history_list:function(e,t){var a;t.forEach(function(t){0<(a=$("#timelog_g_"+t.group)).length?a.prepend(Strack.timelog_history_item_dom(t)):$(e).append(Strack.timelog_history_group_dom(t))})},timelog_history_group_dom:function(t){var e="";return e+='<div class="time-item-title"><div class="time-title-show">'+t.created+'</div></div><div id="timelog_g_'+t.group+'" class="timelog-group">'+Strack.timelog_history_item_dom(t)+"</div>"},timelog_history_item_dom:function(t){var e="";return e+='<li id="timelog_i_'+t.id+'" class="time-base-item"><div class="acrive-task-show"><div class="time-task-info aign-left"><div href="javascript:;" class="task-step text-ellipsis">'+t.title+'</div><div href="javascript:;" class="task-belog-to text-ellipsis">'+t.belong+'</div></div><div class="time-date-show aign-left"><div class="itime-total">'+Strack.format_timer_time(t.duration)+'</div><div class="itime-range">'+t.start_time+" - "+t.end_time+'</div></div><div class="time-task-close aign-left"><a href="javascript:;" onclick="Strack.delete_timelog_history_item(this);" data-timeid="'+t.id+'"><i class="icon-uniEA36"></i></a></div></div></li>'},refresh_timelog_slider:function(t){var e=$(t).attr("data-tab");Strack.load_side_timelog(e)},init_active_timer:function(t){var e="timer_"+Math.floor(1e4*Math.random()+1);Strack.add_side_timer_item(e,{status:"stop",time:"00:00",value:t.link_id,disabled:!0}),Strack.run_timer(e,t.timer_start);var a=$("#item_"+e);a.addClass("active"),a.attr("data-timerid",t.id)},add_side_timer:function(t){var e="timer_"+Math.floor(1e4*Math.random()+1);Strack.add_side_timer_item(e,{status:"start",time:"00:00",value:"",disabled:!1})},add_side_timer_item:function(t,e){$("#slider_timer_list .datagrid-empty-no").remove(),$("#slider_timer_list").prepend(Strack.side_timer_dom(t,e)),Strack.combobox_widget("#"+t,{url:StrackPHP.getTimeLogIssuesCombobox,prompt:StrackLang.Please_Select_Timer_Issue,valueField:"id",textField:"name",groupField:"group_lang",value:e.value,disabled:e.disabled,width:220,onSelect:function(t){}})},start_timer:function(a){var i=$(a).data("id"),t=$("#"+i).combobox("getRowValue","id");$.isEmptyObject(t)?layer.msg(StrackLang.Please_Select_Timelog_Issue,{icon:2,time:1200,anim:6}):$.ajax({type:"POST",url:StrackPHP.addTimelogTimer,dataType:"json",data:t,beforeSend:function(){$("#slider_timer_list").prepend(Strack.loading_dom("white","","timer"))},success:function(t){if(200===parseInt(t.status)){Strack.top_message({bg:"g",msg:t.message}),$("#"+i).combobox("disable"),Strack.run_timer(i,0);var e=$(a).closest(".tg-ac-item");e.addClass("active"),e.attr("data-timerid",t.data.id),e.find(".control-bnt").empty().append(Strack.timer_control_bnt("stop",i)),Strack.check_timer_exit()}else layer.msg(t.message,{icon:7,time:1200,anim:6});$("#st-load_timer").remove()}})},stop_timer:function(t){var e=$(t).data("id"),a=$(t).closest(".tg-ac-item").attr("data-timerid");$.ajax({type:"POST",url:StrackPHP.stopTimelogTimer,dataType:"json",data:{timer_id:a},beforeSend:function(){$("#slider_timer_list").prepend(Strack.loading_dom("white","","timer"))},success:function(t){200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),$("#"+e).combobox("destroy"),$("#item_"+e).remove(),clearInterval(Strack.G.TllogTerval[e]),Strack.check_timer_exit()):layer.msg(t.message,{icon:7,time:1200,anim:6}),$("#st-load_timer").remove()}})},delete_timer:function(t){var e=$(t).data("id"),a=$(t).closest(".tg-ac-item");if(a.hasClass("active")){var i=a.attr("data-timerid");$.ajax({type:"POST",url:StrackPHP.deleteTimelog,dataType:"json",data:{primary_ids:i},beforeSend:function(){$("#slider_timer_list").prepend(Strack.loading_dom("white","","timer"))},success:function(t){200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),$("#"+e).combobox("destroy"),$("#item_"+e).remove(),clearInterval(Strack.G.TllogTerval[e]),Strack.check_timer_exit()):layer.msg(t.message,{icon:7,time:1200,anim:6}),$("#st-load_timer").remove()}})}else $("#"+e).combobox("destroy"),$("#item_"+e).remove(),Strack.check_timer_exit()},delete_timelog_history_item:function(t){var e=$(t).data("timeid");0<e&&$.ajax({type:"POST",url:StrackPHP.deleteTimelog,dataType:"json",data:{primary_ids:e},beforeSend:function(){$("#slider_timelog_wrap").prepend(Strack.loading_dom("white","","timelog"))},success:function(t){200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),$("#timelog_i_"+e).remove()):layer.msg(t.message,{icon:7,time:1200,anim:6}),$("#st-load_timelog").remove()}})},run_timer:function(t,e){var a=$("#item_"+t).find(".time"),i=0<e?e:0;Strack.G.TllogTerval[t]=setInterval(function(){a.html(Strack.format_timer_time(i)),i++},1e3)},format_timer_time:function(t){var e=t,a=parseInt(e/86400),i=parseInt(e%86400/3600),d=parseInt(e%86400%3600/60),r=e%86400%360%60,o="";return 0!==a&&(o+=a+StrackLang.Days+" "),0===i&&0===a||(o+=Strack.fix_timer_number(i,2)+":"),0===d&&0===i&&0===a||(o+=Strack.fix_timer_number(d,2)+":"),o+=Strack.fix_timer_number(r,2),0===a&&0===i&&0===d&&(o+=" "+StrackLang.Unit_Sec),0===a&&0===i&&0!==d&&(o+=" "+StrackLang.Unit_Min),o},fix_timer_number:function(t,e){return(""+t).length<e?(new Array(e+1).join("0")+t).slice(-e):""+t},check_timer_exit:function(){var t=$("#slider_timer_list"),e=t.find(".tg-ac-item").length;0===e&&t.empty().append('<div class="datagrid-empty-no text-center">'+StrackLang.Datagird_No_Data+"</div>"),Strack.top_tool_number("#top_timer_number",e)},side_timer_dom:function(t,e){var a="";return a+='<div id="item_'+t+'" class="ui grid tg-ac-item"><div class="center aligned four column row"><div class="seven wide column"><div style="padding-left: 20px"><input id="'+t+'" autocomplete="off"></div></div><div class="five wide column button-wrap time">'+e.time+'</div><div class="two wide column button-wrap control-bnt">'+Strack.timer_control_bnt(e.status,t)+'</div><div class="two wide column button-wrap"><a href="javascript:;" class="button" onclick="Strack.delete_timer(this)" data-id="'+t+'"><button class="ui basic gray button">'+StrackLang.Delete+"</button></a></div></div></div>"},timer_control_bnt:function(t,e){var a="";return a+="start"===t?'<a href="javascript:;" class="button" onclick="Strack.start_timer(this)" data-id="'+e+'"><button class="ui basic green button">'+StrackLang.Start+"</button></a>":'<a href="javascript:;" class="button" onclick="Strack.stop_timer(this)" data-id="'+e+'"><button class="ui basic red button">'+StrackLang.Stop+"</button></a>"},item_start_timelog:function(t){var e=$(t).data("linkid"),a=$(t).data("timelogid"),i=$(t).data("moduleid");$.ajax({type:"POST",url:StrackPHP.startOrStopTimelog,data:{id:e,timelog_id:a,module_id:i},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),Strack.top_tool_number("#top_timer_number",t.data.timer_number),0<a?obj.init_timelog_bnt({color:"green",id:0}):obj.init_timelog_bnt({color:"red",id:t.data.id})):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},top_header:function(){$.ajax({type:"POST",url:StrackPHP.getTopRightData,dataType:"json",success:function(t){var e=t.user_data;Strack.top_tool_number("#top_timer_number",t.timer_number),Strack.top_tool_number("#top_msg_number",t.message_number),$("#top_avatar").append(Strack.build_avatar(e.user_id,e.avatar,Strack.upper_first_str(e.pinyin)));var a=$("#padmin_avatar");0<a.length&&(a.empty().append(Strack.build_avatar(e.user_id,e.avatar,Strack.upper_first_str(e.pinyin))),$("#padmin_name").html(e.name)),0<$("#acinfo_menu").length&&($("#acinfo_avatar").empty().append(Strack.build_avatar(e.user_id,e.avatar,Strack.upper_first_str(e.pinyin))),$("#acinfo_name").html(e.name))}})},top_tool_number:function(t,e){0<parseInt(e)?$(t).html(e).addClass("st-sup-ac"):$(t).removeClass("st-sup-ac").empty()},load_notes:function(i,d){var r=$(i.content_id).find('[data-tab="note"]');$.ajax({type:"POST",url:StrackPHP.getNoteListData,data:d,dataType:"json",beforeSend:function(){"new"===d.status&&r.addClass("loading")},success:function(t){var e=$("#"+i.list_id);if("new"===d.status){d.total=t.note_list.total,i.avatar_id&&$(i.avatar_id).empty().append(Strack.build_avatar(t.user_data.user_id,t.user_data.avatar,Strack.upper_first_str(t.user_data.pinyin))),r.removeClass("loading");var a={item_id:d.item_id,project_id:d.project_id,module_id:d.module_id,module_type:d.module_type,structure_id:d.structure_id,list_id:i.list_id,parent_id:0};$(".simditor-body").attr("contenteditable",!1),Strack.init_note_editor(i.editor_id,0,a,"panel",!0),Strack.fall_load_data(i.page_id,d,function(t){t.status="more",Strack.load_notes(i,t)},function(){i.details_top_bar&&($(i.tab_id).offset().top<80?$("#"+i.tab_bar_id).show(200):$("#"+i.tab_bar_id).hide(200))}),e.empty()}e.append(Strack.show_note_list(t.note_list)),Strack.init_note_att_event()}})},init_note_att_event:function(){$(".note-att").each(function(){Strack.init_thumb_media($(this).data("id"))}),$(".weixinAudio").weixinAudio({})},init_note_editor:function(t,a,e,i,d){Strack.G.GeditorParam["e_"+a]=e;Strack.G.Geditor["e_"+a]=new Simditor({textarea:$("#"+t),placeholder:StrackLang.Add_Note_Notice,toolbarHidden:d,toolbartype:a,panel_type:"main",toolbar:["color","bold","emoji","|","strikethrough","ol","ul","blockquote","table","hr"],footer_control:!0,from:i,module_type:e.module_type,emoji:{imagePath:"images/emoji/"},mention:{url:StrackPHP.getAtUserList,nameKey:"name",pinyinKey:"pinyin",abbrKey:"abbr",param:e}}),0===a&&Strack.G.Geditor["e_"+a].on("focus",function(t,e){Strack.hide_note_reply(),$(".toolbar_"+a).show(),Strack.G.mediaScreenshotStatus&&obj.exit_media_painter()})},show_note_reply:function(t){var e=$(t).attr("data-noteid");Strack.hide_note_reply(),$(t).parent().hide().after(Strack.note_reply_editor(e));var a=Strack.G.GeditorParam.e_0;a.parent_id=e,Strack.init_note_editor("editor-reply_"+e,e,a,"panel",!1)},hide_note_reply:function(){$(".reply-editor").each(function(){Strack.close_note(this)})},note_reply_editor:function(t){return'<div id="reply-wrap_'+t+'" class="reply-editor" toolbar_type="'+t+'"><textarea id="editor-reply_'+t+'" autocomplete="off"></textarea></div>'},show_note_list:function(t){var e="";return t.rows.forEach(function(t){e+='<div class="comment comment_note_'+t.id+'">',e+=Strack.notes_item_dom(t),e+="</div>"}),e},notes_item_dom:function(t){var e="";e+='<a href="javascript:;" class="avatar avatar-show" title="'+t.user_data.name+'">',e+=Strack.build_avatar(t.user_data.user_id,t.user_data.avatar,Strack.upper_first_str(t.user_data.pinyin));var a="";switch(t.type){case"text":a=t.text;break;case"audio":a+='<p class="weixinAudio"> <audio src="'+t.audio_data.path+'" id="media" width="1" height="1" preload></audio> <span id="audio_area" class="db audio_area"> <span class="audio_wrp db"> <span class="audio_play_area"> <i class="icon_audio_default"></i> <i class="icon_audio_playing"></i> </span> <span id="audio_length" class="audio_length tips_global">'+t.audio_data.duration+'</span> <span class="db audio_info_area"> <span class="audio_source tips_global">'+t.audio_data.description+'</span> </span> <span id="audio_progress" class="progress_bar" style="width: 0%;"></span> </span> </span> </p>',a+=t.text}var i="";i+='<a href="javascript:;" onclick="Strack.edit_note(this)" class="note-editicon" data-noteid="'+t.id+'"><i class="icon-uniF040 icon-left"></i></a>',i+='<a href="javascript:;" onclick="Strack.delete_note(this)" class="note-editicon" data-noteid="'+t.id+'"><i class="icon-uniE765"></i></a>';var d="";0<t.reply_data.length&&(d=StrackLang.Reply+" #"+t.parent_id+" "+t.reply_data.reply_user_name);var r="main_"+Math.floor(1e4*Math.random()+1);return e+='</a><div class="content">'+Strack.init_note_tag(t.tag_data)+'<div class="note-toolbar"><a href="javascript:;" class="author" target="_blank">#'+t.id+" "+t.user_data.name+'</a><span class="reply_auth_name">'+d+'</span><div class="metadata"><span class="date">'+t.last_updated+'</span></div><div class="aign-right note-tedit">'+i+'</div></div><div class="text  editor-style ntext_'+t.id+'"><div class="simditor-body">'+a+'</div></div><div class="note-att" data-id="'+r+'">'+Strack.show_note_img_att(r,t.media_data)+"</div>",e+='<div class="actions"><a class="reply" onclick="Strack.show_note_reply(this)" data-noteid="'+t.id+'">'+StrackLang.Reply+"</a></div>",e+="</div>",e+=Strack.init_link_note(t.link_note_data)},init_link_note:function(t){var e="";if(t.length){var a="";t.forEach(function(t){a+='<a href="javascript:;" onclick="Strack.edit_note(this)" data-noteid="'+t.id+'"> # '+t.id+"</a>"}),e+='<div class="link-note"><ul class="link-note-wrap"><li class="link-note-item"><span class="link-icon"><i class="icon-uniE612"></i></span><span class="link-title">'+StrackLang.Link_Note+'</span><div class="link-note-bnt">'+a+"</div></li></ul></div>"}return e},init_note_tag:function(t){if(t.length){var e="";t.forEach(function(t){e+=Strack.note_tag_dom(t)});var a="";return"yes"===Strack.read_storage("note-tag-show")&&(a="note-tags-show"),'<a href="javascript:;" class="note-tags '+a+'" onclick="Strack.toggle_note_tag_show(this)">'+e+"</a>"}return""},note_tag_dom:function(t){return t?'<span class="card-label mod-card-front" title="'+t.name+'" style="background-color: #'+t.color+'">'+t.name+"</span>":""},toggle_note_tag_show:function(t){$(t).hasClass("note-tags-show")?($(".note-tags").removeClass("note-tags-show"),Strack.save_storage("note-tag-show","no")):($(".note-tags").addClass("note-tags-show"),Strack.save_storage("note-tag-show","yes"))},delete_note:function(e){var a=$(e).attr("data-noteid");$.messager.confirm(StrackLang.Confirmation_Box,StrackLang.Note_Delete_Confirm,function(t){t&&$.ajax({type:"POST",url:StrackPHP.deleteNote,dataType:"json",data:{primary_ids:a},beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){Strack.top_message({bg:"g",msg:t.message}),$.messager.progress("close"),$(e).closest(".comment").remove()}})})},close_note:function(t){var e=$(t).attr("toolbar_type");if(Strack.destroy_note_img_uploadifive(e),$(".ed_rethumb_"+e).empty().removeClass("simditor-fields-ac"),0<e){var a=$("#reply-wrap_"+e);a.prev().show(),a.remove()}else $(".toolbar_"+e).hide(),Strack.G.Geditor["e_"+e].setValue(""),$(".fieldsbar_"+e).removeClass("simditor-fields-ac").find("li").each(function(){$(this).find("input.ed_fiedlds").combobox("destroy"),$(this).remove()})},reset_note:function(t){$(".ed_rethumb_"+t).empty().removeClass("simditor-fields-ac"),Strack.G.Geditor["e_"+t].setValue(""),$(".fieldsbar_"+t).removeClass("simditor-fields-ac").find("li").each(function(){$(this).find("input.ed_fiedlds").combobox("destroy"),$(this).remove()})},data_url_to_file:function(t){for(var e=t.split(","),a=e[0].match(/:(.*?);/)[1],i=atob(e[1]),d=i.length,r=new Uint8Array(d);d--;)r[d]=i.charCodeAt(d);return new File([r],"img.png",{type:a})},add_note:function(t){var e=$(t).attr("toolbar_type"),a=$("#nodeimg_"+e+" .uploadifive-queue-item").length,i=Strack.G.Geditor["e_"+e].getValue(),d=$("#screenshot_list .pyn-st-img img");0<d.length?Strack.add_review_img_to_uploadfive(e,d):0<i.length||0<a?0<a?$("#nodeimg_bnt_"+e).uploadifive("upload"):Strack.update_note(e,StrackPHP.addNote,"add"):layer.msg(StrackLang.Note_Text_Empty_Or_Media_Empty,{icon:2,time:1200,anim:6})},add_review_img_to_uploadfive:function(t,e){$(".simditor-rethumb").hasClass("simditor-fields-ac")?(e.each(function(){$("#nodeimg_bnt_"+t).uploadifive("addQueueItem",Strack.data_url_to_file($(this).attr("src")))}),$("#nodeimg_bnt_"+t).uploadifive("upload")):Strack.note_add_image(t,function(){e.each(function(){$("#nodeimg_bnt_"+t).uploadifive("addQueueItem",Strack.data_url_to_file($(this).attr("src")))}),$("#nodeimg_bnt_"+t).uploadifive("upload")})},update_note:function(e,t,a,i,d){var r=Strack.G.Geditor["e_"+e].body,o=$(".fieldsbar_"+e),n=Strack.G.GeditorParam["e_"+e];d&&(n.media_server=d),n.type="text",n.id=e,n.text=Strack.G.Geditor["e_"+e].getValue();var s=[];r.find("a").each(function(){$(this).hasClass("simditor-mention")&&s.push($(this).data("uid"))}),n.at_user_ids=s.join(","),n.status_id=0,n.stick="no",n.version_id=0,n.tags="",o.find(".ed_fiedlds").each(function(){var t=$("#"+$(this).attr("id"));switch($(this).attr("data-input")){case"status":n.status_id=t.combobox("getValue");break;case"stick":n.stick=t.combobox("getValue");break;case"tag":var e=t.combobox("getValues");n.tags=e.join(",")}});var l=i||[];"add"===a&&(n.images=l),$.ajax({type:"POST",url:t,data:JSON.stringify(n),dataType:"json",contentType:"application/json",beforeSend:function(){d||$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){if($.messager.progress("close"),200===parseInt(t.status))switch($("#screenshot_list .pyn-st-img").length&&$("#screenshot_list").html('<div class="pyn-st-null">'+StrackLang.Screenshot_Null+"</div>"),Strack.top_message({bg:"g",msg:t.message}),a){case"add":$("#"+n.list_id).prepend('<div class="comment comment_note_'+e+'"">'+Strack.notes_item_dom(t.data)+"</div>"),Strack.init_note_att_event(),Strack.reset_note(e);break;case"modify":Strack.dialog_cancel(),$(".comment_note_"+e).empty().append(Strack.notes_item_dom(t.data))}else layer.msg(t.message,{icon:7,time:1200,anim:6})}})},edit_note:function(t){var i=$(t).attr("data-noteid");0<i&&(Strack.hide_note_reply(),$.ajax({type:"POST",url:StrackPHP.getOneNoteData,data:{note_id:i},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(a){Strack.G.Note_Uploadifive_Imgs=[],$.messager.progress("close"),Strack.open_dialog("dialog",{title:StrackLang.Modify_Note,width:700,height:470,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mnote_id",type:"hidden",name:"note_id",valid:1,value:i}],items:[{case:7,id:"Mnote_text",type:"text",lang:"",name:"note_text",valid:1,value:a.text}],footer:[{obj:"modify_note",type:11,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){var t=Strack.G.GeditorParam.e_0;if(t.parent_id=i,Strack.init_note_editor("Mnote_text",i,t,"dialog",!1),$("#st_dialog_form").find(".simditor-body").css({height:"140px"}),Strack.editor_footer_item(i,"stick",StrackLang.Stick,a.stick),a.status_id&&Strack.editor_footer_item(i,"status",StrackLang.Status,a.status_id),a.tag_data.length){var e=[];a.tag_data.forEach(function(t){0<t.tag_id&&e.push(t.tag_id)}),Strack.editor_footer_item(i,"tag",StrackLang.Tags,e)}}})}}))},modify_note:function(){var e=$("#Mnote_id").val();0<Strack.G.Geditor["e_"+e].getValue().length?Strack.update_note(e,StrackLang.modifyNote,"modify"):$.messager.confirm(StrackLang.Confirmation_Box,StrackLang.Note_Is_Empty,function(t){t&&Strack.update_note(e,StrackPHP.modifyNote,"modify")})},click_editor_footer:function(t){var e=$(t).attr("toolbar_type"),a=$(t).attr("toolbar_area");switch($(t).toggleClass("ntool-active"),a){case"image":Strack.note_add_image(e);break;default:var i=$(t).attr("lang");Strack.editor_footer_item(e,a,i,"")}},editor_footer_item:function(t,e,a,i){var d=$(".fieldsbar_"+t),r="ed_field_"+e+"_"+t,o=$("#"+r);0===o.length?(d.addClass("simditor-fields-ac"),Strack.init_editor_footer_item(d.find("ul"),t,r,e,a,i)):(o.find("input.ed_fiedlds").combobox("destroy"),o.remove(),0===d.find("li").length&&d.removeClass("simditor-fields-ac"))},init_editor_footer_item:function(t,e,a,i,d,r){var o="",n="ed_input_"+i+"_"+e;o+='<li id="'+a+'" class="e-fields-item" ><div class="e-fiedlds-name aign-left">'+d+'</div><div class="e-fiedlds-input"><input id="'+n+'" class="ed_fiedlds" data-input="'+i+'"></div></li>',t.append(o);var s=Strack.G.GeditorParam["e_"+e],l=!1;"tag"===(s.area=i)&&(l=!0),$("#"+n).combobox({url:StrackPHP.getNoteWidgetData,valueField:"id",textField:"name",queryParams:s,multiple:l,value:r,width:320,onLoadSuccess:function(){var t=$(this).combobox("getData");t.length&&0===r.length&&$(this).combobox("select",t[0].id)}})},note_add_image:function(t,e){var a=$(".ed_rethumb_"+t);if(a.hasClass("simditor-fields-ac"))Strack.destroy_note_img_uploadifive(t),a.removeClass("simditor-fields-ac").empty();else{var i="";i+='<div id="nodeimg_'+t+'" class="rethumb-images aign-left"></div><div class="rethumb-add aign-right"><input id="nodeimg_bnt_'+t+'" class="aign-left" name="nodeimg_bnt_'+t+'" type="file" multiple="true"></div>',a.addClass("simditor-fields-ac").empty().append(i),Strack.init_note_img_uploadifive(t,{},e)}},init_note_img_uploadifive:function(i,t,e){Strack.get_media_server(function(a){$("#nodeimg_bnt_"+i).uploadifive({auto:!1,removeCompleted:!0,formData:{timestamp:Strack.current_time(),token:a.token,size:"250×140"},queueID:"nodeimg_"+i,uploadScript:a.upload_url,onUpload:function(t){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},onInit:function(){e&&e()},onUploadComplete:function(t,e){var a=JSON.parse(e);200===parseInt(a.status)&&Strack.G.Note_Uploadifive_Imgs.push(a.data)},onQueueComplete:function(t,e){Strack.update_note(i,StrackPHP.addNote,"add",Strack.G.Note_Uploadifive_Imgs,a)}})})},destroy_note_img_uploadifive:function(t){$("#nodeimg_bnt_"+t).uploadifive("destroy")},follow_item:function(t){var e=$(t),a={module_id:e.attr("data-moduleid"),module_type:e.attr("data-moduletype"),follow_status:e.attr("data-followstatus"),link_id:e.attr("data-linkid")};"yes"===a.follow_status?$.messager.confirm(StrackLang.Confirmation_Box,StrackLang.Confirm_UnFollow,function(t){t&&Strack.do_follow_item(e,a)}):Strack.do_follow_item(e,a)},do_follow_item:function(e,t){$.ajax({type:"POST",url:StrackPHP.followItem,data:t,dataType:"json",beforeSend:function(){e.addClass("disabled")},success:function(t){e.removeClass("disabled"),200===parseInt(t.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message}),e.attr("data-followstatus",t.data.follow_status),e.html(t.data.follow_status_name)):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},open_action_slider:function(t){var e=$(t).data("from"),a=$(t).data("moduleid"),i=$(t).data("projectid"),d=$("#action_search_bnt");switch($("#action_list_slider").sidebar("toggle"),d.attr("data-from",e).attr("data-moduleid",a).attr("data-projectid",i),e){case"grid":var r=$(t).data("grid"),o=$("#"+r).datagrid("getSelections"),n=[];o.forEach(function(t){n.push(t.id)}),d.attr("data-grid",r).attr("data-ids",n.join(",")),Strack.load_sidebar_action_list({from:e,grid:r,module_id:a,project_id:i,filter:""});break;case"details":var s=$(t).data("linkid");d.attr("data-ids",s),Strack.load_sidebar_action_list({from:e,grid:"",module_id:a,project_id:i,filter:""})}},search_action:function(t){var e=$(t),a=$("#action_search_box").val(),i="";0<a.length&&(i={name:["-lk","%"+a+"%"]});var d={from:e.data("from"),grid:e.data("grid"),module_id:e.data("moduleid"),project_id:e.data("projectid"),filter:i};Strack.load_sidebar_action_list(d)},load_sidebar_action_list:function(i){$.ajax({type:"POST",url:StrackPHP.getSidebarActionData,dataType:"json",data:i,beforeSend:function(){$("#action_list_slider").append(Strack.loading_dom("white","","action"))},success:function(t){var e="",a="";t.common.forEach(function(t){e+=Strack.action_list_item_dom(t,i,"common")}),t.other.forEach(function(t){a+=Strack.action_list_item_dom(t,i,"other")}),$("#common_action_list").empty().append(e),$("#other_action_list").empty().append(a),$("#st-load_action").remove()}})},action_list_item_dom:function(t,e,a){var i="",d="other"===a?StrackLang.Set_Action_Common:StrackLang.Cancel_Action_Common;return i+='<div class="column dgat-item"><a href="javascript:;" class="dgat-img" onclick="Strack.click_run_action(this)" data-from="'+e.from+'" data-grid="'+e.grid+'" data-actionid="'+t.id+'" data-moduleid="'+t.module_id+'"><div class="action-icon"><div class="soft-avatar"><img src="'+t.thumb+'"></div></div></a><div class="dgat-dcname"><strong>'+t.name+'</strong></div><div class="dgat-dcname">'+t.version+'</div><div class="dgat-bnt" ><a href="javascript:;" onclick="Strack.toggle_action_common(this)" data-type="'+a+'" data-actionid="'+t.id+'" data-moduleid="'+t.module_id+'">'+d+"</a></div></div>"},toggle_action_common:function(t){var e=$(t).data("type"),a=$(t).data("actionid"),i=$(t).data("moduleid"),d="common"===e?"cancel":"set";$.ajax({type:"POST",url:StrackPHP.setActionCommonStatus,data:{mode:d,action_id:a,module_id:i},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),Strack.search_action(Strack.get_obj_by_id("action_search_bnt"))):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},close_action_slider:function(t){$("#action_list_slider").sidebar("toggle")},click_run_action:function(s){Strack.Websocket.init("action",{url:"ws://localhost:9888",afterInit:function(t){if("error"===t.status)layer.msg(t.message,{icon:7,time:1200,anim:6});else{var e=$(s).data("from"),a=$(s).data("actionid"),i=$(s).data("moduleid");switch(e){case"grid_edit":case"grid":var d=$(s).data("grid"),r=$("#"+d).datagrid("getSelections");if(0<r.length){var o=[];r.forEach(function(t){o.push(t.id)}),Strack.run_action({action_id:a,module_id:i,link_ids:o})}else layer.msg(StrackLang.Please_Select_Grid_One,{icon:2,time:1200,anim:6});break;default:var n=$("#action_search_bnt").data("ids");Strack.run_action({action_id:a,module_id:i,link_ids:n})}}}})},run_action:function(e){$.ajax({type:"POST",url:StrackPHP.getActionModuleData,dataType:"json",contentType:"application/json",data:JSON.stringify(e),beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),Strack.Websocket.List.send("action",{action_id:e.action_id,link_ids:e.link_ids,module_data:t})}})},word_limit:function(t,e){return e<t.length?t.substr(0,e)+"...":t},format_step_task:function(e){var a="",i={};return e.field_data&&e.field_data.forEach(function(t){i[e.config.fields]=t.fields.value,a+=Strack.widget_input_dom(e.config,t.primary.value,Strack.widget_input_value(e.config,i,e.project_id),"grid",!1)}),a},load_grid_columns:function(id,param,callback){var loading_type=param.loading_type?param.loading_type:"white";$.ajax({type:"POST",url:StrackPHP.getGridColumns,data:param,dataType:"json",beforeSend:function(){$(param.loading_id).append(Strack.loading_dom(loading_type,"","grid_columns"))},success:function(data){var col_main,index=0,cols=[],frozecol_main,froze_index=0,froze_cols=[],columns_field_config=data.grid.columnsFieldConfig;col_main=1===data.grid.columns.length?(index=0,data.grid.columns[0]):(index=1,data.grid.columns[1]),col_main.forEach(function(val){val.outreach_formatter?val.formatter=function(value,row,index){return eval(val.outreach_formatter)}:val.step&&(val.formatter=function(t,e,a){return Strack.format_step_task({project_id:param.project_id,config:columns_field_config[val.field],field_data:t})}),val.editor&&"combobox"===val.editor.type&&(val.editor.options={height:31,valueField:"id",textField:"name",method:"post",url:StrackPHP.getWidgetData,queryParams:{primary:0,project_id:param.project_id,module:val.module,field_type:val.field_type,fields:val.field,variable_id:val.variable_id,frozen_module:data.grid.frozen_module,flg_module:val.flg_module,module_id:param.module_id}},val.group&&(val.editor.options.groupField="group")),cols.push(val)}),data.grid.columns[index]=cols,frozecol_main=1===data.grid.frozenColumns.length?(froze_index=0,data.grid.frozenColumns[0]):(froze_index=1,data.grid.frozenColumns[1]),frozecol_main.forEach(function(val){val.outreach_formatter?val.formatter=function(value,row,index){return eval(val.outreach_formatter)}:val.step&&(val.formatter=function(t,e,a){return Strack.format_step_task({project_id:param.project_id,config:columns_field_config[val.field],field_data:t})}),val.editor&&"combobox"===val.editor.type&&(val.editor.options={height:31,valueField:"id",textField:"name",method:"post",url:StrackPHP.getWidgetData,queryParams:{primary:0,project_id:0,field_type:val.field_type,fields:val.field}},val.group&&(val.editor.options.groupField=val.group)),froze_cols.push(val)}),data.grid.frozenColumns[froze_index]=froze_cols,callback(data),$("#st-load_grid_columns").remove()}})},load_view_config:function(t,i,d){$.ajax({type:"POST",url:StrackPHP.getListViewConfig,data:i,dataType:"json",success:function(t){var e=$("#"+i.tool_id),a=e.find(".grid_sort");a.append(Strack.toolbar_down_init("sort",i.module_code,t.sort_list,i.opts,"list")),Strack.init_show_sort_down_icon(a,t.sort_config.sort_data,t.sort_config.sort_type),e.find(".grid_group").append(Strack.toolbar_down_init("group",i.module_code,t.group_list,i.opts,"list")),e.find(".grid_view").append(Strack.toolbar_view_init("view",t.view_list,"list")),d(t)}})},toolbar_down_init:function(e,t,a,i){var d,r="";for(var o in"show"===e&&(Strack.G.gridFieldCache[a.toolbarConfig.page_name]={}),t)for(var n in t[o])d="",$.isEmptyObject(t[o][n].fields)||(t[o][n].fields.forEach(function(t){d+=Strack.toolbar_down_item(e,t,i),"show"===e&&(Strack.G.gridFieldCache[a.toolbarConfig.page_name][t.value_show]=t)}),r+='<div class="divider"></div>',r+=Strack.toolbar_down_other(t[o][n].title,d));return r},toolbar_down_other:function(t,e){var a="";return a+='<div class="item"><i class="dropdown icon"></i>'+t+'<div class="menu st-down-menu">'+e+"</div></div>"},toolbar_down_item:function(t,e,a){var i="",d=t+"_"+e.module+"_"+e.fields,r=e.is_checked?"icon-checked":"icon-unchecked";return i+='<a href="javascript:;" id="'+d+'" class="item '+(t+"-field")+'" onclick="Strack.click_down_item(this);" panel="'+a+'" from="'+t+'" field="'+e.fields+'" field_type="'+e.field_type+'" field_width="'+e.width+'" field_sort="'+e.sort+'" field_edit="'+e.edit+'" module="'+e.module+'" table="'+e.table+'" module_type="'+e.module_type+'" belong="'+e.belong+'" editor="'+e.editor+'" lang="'+e.lang+'" value_show="'+e.value_show+'"><i class="icon-left '+r+'"></i>'+e.lang+"</a>"},toolbar_step_init:function(t,e,a,i){var d="";return e.forEach(function(t){d+=Strack.toolbar_step_dom(t,a)}),d},toolbar_step_dom:function(t,e){var a="";t.is_checked&&(a='<i class="icon-uniEA39"></i>');var i="";return i+='<a href="javascript:;" id="stid_'+t.code+'" class="item steps_box" onclick="Strack.toggle_steps(this);" data-step="'+t.code+'" data-stepid="'+t.id+'" data-grid="'+e.id+'" data-maindom="'+e.searchConfig.filterBar.main_dom+'"><div class="steps_box_icon">'+a+'</div><div class="steps_box_color" style="background-color:#'+t.color+'"></div><div class="steps_box_name">'+t.name+"</div></a>"},toolbar_common_action:function(e,a,t){var i="";return t.forEach(function(t){t.grid=e,t.module_id=a.moduleId,i+=Strack.common_action_dom("grid_edit",t)}),i},common_action_dom:function(t,e){var a="",i=e.link_id?e.link_id:0;return a+='<a href="javascript:;" class="item group-field" onclick="Strack.click_run_action(this);" data-from="'+t+'" data-grid="'+e.grid+'" data-actionid="'+e.id+'" data-linkid="'+i+'" data-moduleid="'+e.module_id+'">'+e.name+"</a>"},show_all_steps:function(t){var e={mode:"show_all",grid:$(t).data("grid"),maindom:$(t).data("maindom")};Strack.show_or_hide_steps(e)},hide_all_steps:function(t){var e={mode:"hide_all",grid:$(t).data("grid"),maindom:$(t).data("maindom")};Strack.show_or_hide_steps(e)},toggle_steps:function(t){var e={mode:"",step:$(t).data("step"),step_id:$(t).data("stepid"),grid:$(t).data("grid"),maindom:$(t).data("maindom")};$(t).hasClass("hide")?(e.mode="show",$(t).removeClass("hide")):(e.mode="hide",$(t).addClass("hide")),Strack.show_or_hide_steps(e)},show_or_hide_steps:function(e){var a,i=$("#"+e.grid),t=i.datagrid("options").columns[1],d=[];switch(t.forEach(function(t){t.step&&(0<=$.inArray(e.mode,["show","hide"])&&t.belong===e.step||0<=$.inArray(e.mode,["hide_all","show_all"]))&&d.push({field:t.field,belong:t.belong})}),e.mode){case"show":d.forEach(function(t){(a=$("."+t.belong+"_h")).is(":hidden")&&t.belong===e.step&&(a.show(),i.datagrid("showColumn",t.field))});break;case"hide":d.forEach(function(t){t.belong===e.step&&(i.datagrid("hideColumn",t.field),$("."+t.belong+"_h").hide())});break;case"show_all":d.forEach(function(t){(a=$("."+t.belong+"_h")).is(":hidden")&&(a.show(),i.datagrid("showColumn",t.field))});break;case"hide_all":d.forEach(function(t){i.datagrid("hideColumn",t.field),$("."+t.belong+"_h").hide()})}Strack.show_or_hide_steps_icon(e)},show_or_hide_steps_icon:function(t){var e;$("#"+t.maindom).find(".steps_box").each(function(){switch(e=$(this).data("step"),t.mode){case"show":t.step===e&&$(this).find(".steps_box_icon").html('<i class="icon-uniEA39"></i>');break;case"hide":t.step===e&&$(this).find(".steps_box_icon").empty();break;case"show_all":$(this).find(".steps_box_icon").html('<i class="icon-uniEA39"></i>');break;case"hide_all":$(this).find(".steps_box_icon").empty()}})},toolbar_view_init:function(e,t,a){var i="",d="",r="";return $.isEmptyObject(t)||(r+='<div class="divider"></div>',r+=Strack.toolbar_view_item(e,t.checked,"view-g-active",a),$(".current_view").text("（"+t.checked.name+"）"),t.self.forEach(function(t){i+=Strack.toolbar_view_item(e,t,"",a)}),r+='<div class="divider"></div>',r+=Strack.toolbar_down_other(StrackLang.Self_View,i),t.public.forEach(function(t){d+=Strack.toolbar_view_item(e,t,"",a)}),r+='<div class="divider"></div>',r+=Strack.toolbar_down_other(StrackLang.Public_View,d)),r},toolbar_view_item:function(t,e,a,i){var d="",r=e.checked?"icon-checked":"icon-unchecked",o=e.show_artist?'<span style="color: #777"> ( '+e.user_name+" ) </span>":"";return d+='<a href="javascript:;" class="item view-g-item '+a+'" onclick="Strack.click_down_item(this);" panel="'+i+'" from="'+t+'" view_id="'+e.id+'" view_name="'+e.name+'" view_public="'+e.public+'" allow_edit="'+e.allow_edit+'"><i class="icon-left '+r+'"></i>'+e.name+o+"</a>"},build_view_toolbar:function(e,a){$.ajax({type:"POST",url:StrackPHP.getViewData,dataType:"json",data:{module_id:e.module_id,structure_id:e.structure_id,tab_name:e.tab_name},success:function(t){Strack.build_toolbar_sort(e,t.sort_fields),Strack.build_toolbar_group(e,t.group_fields),a(t)}})},build_toolbar_sort:function(e,t){var a=$("#"+e.tab_name+"_sort_"+e.structure_id),i="";if(0<a.length){switch(e.tab_name){case"list":t.forEach(function(t){i+=Strack.sort_field_dow(e,t)})}a.empty().append(i)}},sort_field_dow:function(t,e){var a="";return a+='<a href="javascript:;" id="sort_field_'+t.tab_name+"_"+t.structure_id+"_"+e.field+'" class="item sort_fields" onclick="Strack.sort_change(this);" data-field="'+e.field+'" data-pid="'+e.p_id+'" data-structureid="'+e.structure_id+'" data-grid="'+e.grid+'"><i class="icon-left sort_list icon-unchecked"></i>'+e.lang+"</a>"},build_toolbar_group:function(e,t){var a=$("#"+e.tab_name+"_group_"+e.structure_id),i="";if(0<a.length){switch(e.tab_name){case"list":t.forEach(function(t){i+=Strack.group_field_dow(e,t)})}a.empty().append(i)}},group_field_dow:function(t,e){var a="";return a+='<a href="javascript:;" id="group_field_'+t.tab_name+"_"+t.structure_id+"_"+e.field+'" onclick="Strack.group_sort_change(this);" data-field="'+e.field+'" data-pid="'+e.p_id+'" data-structureid="'+e.structure_id+'" data-grid="'+e.grid+'"><i class="icon-left filter_list icon-unchecked"></i>'+e.lang+"</a>"},project_warn:function(t){return'<div class="page-warning"><i class="icon-uniF071"></i>'+t+"</div>"},init_breadcrumb:function(a,t,i){$.ajax({type:"POST",url:StrackPHP.getModuleBreadcrumb,dataType:"json",data:t,beforeSend:function(){$("#"+a).append(Strack.loading_dom("white","","breadcrumb"))},success:function(t){var e=Strack.breadcrumb_dom(t);$("#"+a).empty().append(e),i&&i(e)}})},details_url:function(t,e){return Strack.remove_html_ext(StrackPHP.details)+"/"+t.module_id+"-"+t.project_id+"-"+e+".html"},breadcrumb_dom:function(t){var e=[],a=Strack.remove_html_ext(StrackPHP.details);return t.forEach(function(t){"no"===t.is_self?e.push('<a class="section" href="'+a+"/"+t.module_id+"-"+t.project_id+"-"+t.item_id+'.html" title="('+t.module_lang+") "+t.name+'">('+t.module_lang+") "+t.name+"</a>"):e.push('<div class="section" title="'+t.name+'">'+t.name+"</div>")}),'<div class="ui small breadcrumb" >'+e.join('<div class="divider"> / </div>')+"</div>"},init_tab_list:function(d,t,r){$.ajax({type:"POST",url:StrackPHP.getTabConfig,dataType:"json",data:t,beforeSend:function(){$("#"+d).append(Strack.loading_dom("white","","tab"))},success:function(t){var e=$("#"+d),a=e.find(".tabs-tab-list"),i="";t.forEach(function(t){i+=Strack.tab_item_dom(d,t)}),a.empty().append(i),Strack.tab_auto_hide(e),a[0].scrollWidth>document.body.clientWidth&&e.addClass("tabs-nav-container-scrolling"),r(t),$("#st-load_tab").remove()}})},tab_auto_hide:function(t){var e=t.find(".tabs-tab-prev"),a=t.find(".tabs-tab-next");t.on("mresize",function(){Strack.init_tab_scrolling(t,e,a)})},tab_item_dom:function(t,e){var a="";return a+='<a href="javascript:;" id="'+e.tab_id+'" class="item tab_item" onclick="Strack.select_tab_item(this);"  data-parentid="'+t+'" data-tabid="'+e.tab_id+'" data-group="'+e.group+'" data-type="'+e.type+'" data-moduleid="'+e.module_id+'">'+e.name+"</a>"},select_tab_item:function(t){var e=$(t).attr("data-parentid"),a=$(t).attr("data-tabid"),i=$(t).attr("data-moduleid"),d=$(t).attr("data-type"),r=$(t).attr("data-group");switch(e){case"details_tab":obj.show_details_tab_page({tab_id:a,type:d,group:r,module_id:i})}},active_select_tab:function(t,e){$("#"+t).find(".tabs-tab-list .tab_item").each(function(){$(this).attr("data-tabid")===e?$(this).addClass("active"):$(this).removeClass("active")})},init_tab_scrolling:function(t,e,a){var i=0,d=t.find(".tabs-tab-list"),r=d[0].scrollWidth;Strack.G.leftScrolling=0,d.scrollLeft(0),e.addClass("tabs-tab-btn-disabled"),a.removeClass("tabs-tab-btn-disabled"),r>document.body.clientWidth?t.hasClass("scrolling_active")||(t.addClass("scrolling_active"),t.addClass("tabs-nav-container-scrolling"),e.addClass("tabs-tab-arrow-show").addClass("tabs-tab-btn-disabled").on("click",function(){$(this).hasClass("tabs-tab-btn-disabled")||(i=d.width(),0<Strack.G.leftScrolling&&(Strack.G.leftScrolling=d.scrollLeft()-i,d.scrollLeft(Strack.G.leftScrolling),a.removeClass("tabs-tab-btn-disabled"),Strack.G.leftScrolling<=0&&e.addClass("tabs-tab-btn-disabled")))}),a.addClass("tabs-tab-arrow-show").on("click",function(){$(this).hasClass("tabs-tab-btn-disabled")||(i=d.width(),Strack.G.leftScrolling<=r&&(Strack.G.leftScrolling=i+d.scrollLeft(),d.scrollLeft(Strack.G.leftScrolling),e.removeClass("tabs-tab-btn-disabled"),Strack.G.leftScrolling>=r&&a.addClass("tabs-tab-btn-disabled")))})):(t.removeClass("tabs-nav-container-scrolling"),t.removeClass("scrolling_active"),t.find(".tabs-tab-prev").removeClass("tabs-tab-arrow-show").off("click"),t.find(".tabs-tab-next").removeClass("tabs-tab-arrow-show").off("click"))},dialog_cancel:function(){$("#dialog").dialog("close")},scheduler_tips:function(a,t){$.ajax({url:StrackPHP.getSchedulerTips,type:"post",data:{resourceId:t},dataType:"json",success:function(t){var e="";t.forEach(function(t){e+="<p>"+t+"</p>"}),layer.tips(e,a,{tips:[3,"#464646"],time:2e4})}})},widget_field_validate:function(e){var a="";return["status_id"].every(function(t){return 0<=e.indexOf(t)?(a=t,!1):(a=e,!0)}),a},widget_input_value:function(t,e,a){var i={value:e[t.fields],project_id:a};switch(Strack.widget_field_validate(t.fields)){case"status_id":i.show_val=Strack.widget_status_dom(e[t.module+"_status_icon"],e[t.module+"_status_name"],e[t.module+"_status_color"]),i.bg_clolor=e[t.module+"_status_color"],i.font_set=!0;break;default:i.show_val=e[t.value_show],i.bg_clolor="",i.font_set=""}return i},generate_widget:function(t,e,a,i,d){var r=d||"",o="";return t.forEach(function(t){"yes"===t.show&&(o+=Strack.widget_input_dom(t,a,Strack.widget_input_value(t,e,i),r,!0))}),o},widget_input_dom:function(t,e,a,i,d){var r,o,n=a.bg_clolor?Strack.hex_to_rgb(a.bg_clolor,.3):"transparent",s=a.font_set?"font-size-10":"",l=a.show_val?a.show_val:"",c=t.fields+"_"+e+"_"+Math.floor(1e4*Math.random()+1),_="";switch(r=a.value&&!/^[0-9]+.?[0-9]*$/.test(a.value)?a.value.toString().replace(/\"/g,"&quot;"):a.value,i){case"grid":case"min":o={wrap:"item-list-pt",lang:"item-list-ptn",content:"item-list-input",hide:"icon-hide-min"};break;case"max":default:o={wrap:"task-info-items",lang:"task-info-title",content:"task-info-content",hide:"icon-hide"}}var m={};switch(t.editor){case"textarea":m.ellipsis="info-textarea";break;default:m.ellipsis="text-ellipsis"}_+='<div class="'+o.wrap+' overflow-hide">',d&&(_+='<div class="'+o.lang+' aign-left">'+t.lang+"</div>");var u=t.module+"_"+t.fields+"_"+e;if(_+='<div class="widget_input '+o.content+" aign-left item-hover "+u+" "+s+' " style="background-color:'+n+'">',"none"!==t.editor){var g=t.fields.split("_");1<g.length&&"id"===g[1]&&(g=g[0]),_+='<a href="javascript:;" class="aign-right '+o.hide+' widget-edit" onclick="Strack.widget_input_edit(this)"  data-widgetid="'+c+'" data-module="'+t.module+'" data-flgmodule="'+g+'" data-table="'+t.table+'" data-fields="'+t.fields+'" data-fieldtype="'+t.field_type+'" data-value="'+r+'" data-primary="'+e+'"  data-editor="'+t.editor+'" data-mask="'+t.mask+'" data-multiple="'+t.multiple+'" data-projectid="'+a.project_id+'">',_+='<i class="icon-uniE684"></i>'}else _+='<a href="javascript:;" class="aign-right '+o.hide+' widget-edit">',_+='<i class="icon-uniE63D2"></i>';return _+="</a>",_+='<div class="info-content-show  '+m.ellipsis+" widget-show-"+c+'">',_+=l,_+="</div>",_+="</div>",_+="</div>"},widget_input_edit:function(t){var e=$(t).parent().width(),a=$(t).parent().height();a=35<a?35:a;var i=$(t).attr("data-module"),d=$(t).attr("data-fields"),r=$(t).attr("data-flgmodule"),o=$(t).attr("data-fieldtype"),n=$(t).attr("data-widgetid"),s=$(t).attr("data-value"),l=$(t).attr("data-primary"),c=$(t).attr("data-editor"),_=$(t).attr("data-validate"),m=$(t).attr("data-mask"),u=$(t).attr("data-multiple"),g=$(t).attr("data-projectid"),p="";if(_){var f=_.split(",");p="length["+f[0]+","+f[1]+"]"}Strack.widget_edit_active(t,e,a,{module:i,fields:d,flg_module:r,frozen_module:i,field_type:o,widgetid:n,value:s,primary:l,editor:c,validate:p,mask:m,multiple:u,project_id:g})},widget_edit_active:function(t,e,a,i){Strack.widget_update();var d,r=$(t),o=r.parent();if(r.hide().next().hide(),o.hasClass("widget-active")){o.addClass("widget-show").find(".info-content-edit").show(),d=o.find(".info-content-edit").find("input").eq(0).attr("id");var n=$("#"+d);switch(i.editor){case"combobox":n.combobox("setValue",i.value);break;case"datebox":n.datebox("setValue",i.value);break;case"tags":var s=o.find(".info-content-show"),l="";n.parent().find("span").remove(),n.parent().prepend(s.html()).find("span").each(function(){l=Strack.TagsDOM($(this).attr("data-id")),$(this).append(l)});break;case"checkbox":1===parseInt(i.value)?n.prop("checked","checked"):n.removeAttr("checked");break;default:n.val(i.value)}}else{var c="";switch(d=i.widgetid,i.editor){case"textarea":o.append('<div class="info-content-edit"><textarea id="'+d+'" class="widget-edit" data-module="'+i.module+'" data-field="'+i.fields+'" data-oldval="'+i.value+'" data-fieldtype="'+i.field_type+'" data-widgetid="'+i.widgetid+'"  data-primary="'+i.primary+'"  data-editor="'+i.editor+'" ></textarea></div>').addClass("widget-active widget-show");break;default:0<=$.inArray(i.editor,["input","combobox","datebox"])&&(c="info-content-comb"),o.append('<div class="info-content-edit '+c+'"><input id="'+d+'" class="widget-edit" data-module="'+i.module+'" data-field="'+i.fields+'" data-oldval="'+i.value+'" data-fieldtype="'+i.field_type+'" data-widgetid="'+i.widgetid+'"  data-primary="'+i.primary+'"  data-editor="'+i.editor+'" /></div>').addClass("widget-active widget-show")}Strack.widget_init_dom(d,e,a,i)}},active_inputmask:function(t,e){e&&$("#"+t).inputmask(e)},widget_init_dom:function(t,e,a,i){var d=$("#"+t);switch(i.editor){case"input":case"text":0<=i.validate.indexOf(",")?"length["+i.validate+"]":i.validate,d.css({width:e-32,height:a-2,padding:"0px 15px"}).addClass("widget-edit").val(i.value).select(),Strack.active_inputmask(t,i.mask);break;case"combobox":var r=!1;switch("yes"===i.multiple&&(r=!0),i.field){case"assignee":case"cc":d.combobox({url:StrackPHP.getWidgetData,queryParams:i,valueField:"id",textField:"name",groupField:i.group,multiple:r,width:e,height:a,editable:!0,value:i.value,formatter:function(t){return Strack.build_comb_avatar(t)}}).next().find("input").eq(0).addClass("widget-edit");break;default:d.combobox({url:StrackPHP.getWidgetData,queryParams:i,valueField:"id",textField:"name",groupField:i.group,multiple:r,width:e,height:a,editable:!0,value:i.value}).next().find("input").eq(0).addClass("widget-edit")}break;case"checkbox":var o;o=!(0===parseInt(i.value)||!i.value),d.attr("type","checkbox").attr("checked",o).parent().css("padding","0px 10px");break;case"datebox":d.datebox({width:e,height:a,editable:!1,value:i.value}).next().find("input").eq(0).addClass("widget-edit");break;case"datetimebox":d.datetimebox({width:e,height:a,editable:!1,value:i.value}).next().find("input").eq(0).addClass("widget-edit");break;case"tags":var n=d.parent().parent().find(".info-content-show"),s="";d.css({width:"calc(100% - 10px)",padding:"2px 5px 3px"}).addClass("widget-edit").attr("placeholder",StrackLang.InputTag).parent().css({"background-color":"#FFF",border:"1px solid #C6C4C4",padding:" 0px 10px"}).addClass("widget-edit").prepend(n.html()).find("span").each(function(){s=Strack.TagsDOM($(this).attr("data-id")),$(this).append(s)}),d.on("blur",function(){Strack.AddTags(this,$(this).val())});break;case"textarea":d.html(i.value)}},widget_update:function(){var t=$(".widget-show");if(0<t.length){var e=t.find("a").eq(0),a=t.find(".info-content-edit").find("input").eq(0).attr("id"),i=e.attr("data-table"),d=e.attr("data-module"),r=e.attr("data-fields"),o=e.attr("data-fieldtype"),n=e.attr("data-editor"),s=e.attr("data-widgetid"),l=e.attr("data-primary"),c=$("#"+a),_="",m=c.attr("data-oldval");switch(t.removeClass("widget-show").find("a").eq(0).show().next().show().next().hide(),n){case"text":_=c.val();break;case"combobox":switch(r){case"cc":(_=Strack.get_combos_val("#"+a,"combobox","getValues"))&&(_=_.join(","));break;default:_=Strack.get_combos_val("#"+a,"combobox","getValue")}break;case"datebox":_=c.datebox("getValue");break;case"checkbox":_=c.is(":checked")?1:0;break;case"tags":var u=[];c.parent().find("span").each(function(){u.push($(this).attr("data-id"))}),_=0<u.length?u.join(","):"";break;case"textarea":var g=t.find(".info-content-edit").find("textarea").eq(0).attr("id");_=$("#"+g).val()}_!==m&&$.ajax({type:"POST",url:StrackPHP.updateWidget,dataType:"json",data:{editor:n,table:i,module:d,field:r,field_type:o,primary_value:l,widget_id:s,old_val:m,val:_},success:function(t){200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),Strack.update.widget(t)):Strack.top_message({bg:"r",msg:t.message})}})}},listen_keyboard_event:function(e){var a={};$(document).on("keydown",function(t){switch(t.keyCode){case 13:t.preventDefault(),a.code="enter",e(a)}})},load_info_panel:function(a,i){$.ajax({type:"POST",url:a.url,data:a.data,beforeSend:function(){$(a.id).prepend(Strack.loading_dom(a.loading_type),a.mask)},success:function(t){var e=Strack.generate_widget(t.config,t.data,t.data.id,a.data.project_id,a.pos);$(a.id).empty().append(e),$("#st-load_"+a.mask).remove(),i&&i(t)}})},get_item_fields:function(t,e){$.ajax({type:"POST",url:StrackPHP.getFields,dataType:"json",contentType:"application/json",data:JSON.stringify(t),success:function(t){e(t)}})},item_operate_dialog:function(t,r,e){var a="";switch(r.mode){case"create":a=StrackLang.Submit;break;case"modify":a=StrackLang.Update}Strack.open_dialog("dialog",{title:t,width:620,height:380,content:Strack.dialog_dom({type:"item_operation",hidden:[{case:101,id:"Nmodule_id",type:"hidden",name:"module_id",valid:1,value:r.module_id},{case:101,id:"Npage",type:"hidden",name:"page",valid:1,value:r.page},{case:101,id:"Nproject_id",type:"hidden",name:"project_id",valid:1,value:r.project_id},{case:101,id:"Nmode",type:"hidden",name:"mode",valid:1,value:r.mode},{case:101,id:"Ntype",type:"hidden",name:"type",valid:1,value:r.type},{case:101,id:"Nprimary_id",type:"hidden",name:"primary_id",valid:1,value:r.primary_id}],items:[{case:2,id:"Nup_fields",type:"text",lang:StrackLang.Fields,name:"fields",valid:1,value:""}],footer:[{obj:"item_operate_update",type:5,title:a},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel},{obj:"save_dialog_setting",type:8,title:StrackLang.Save_Setting}]}),inits:function(){Strack.get_item_fields(r,function(a){var e=[];for(var i in a.field_list)for(var d in a.field_list[i])a.field_list[i][d].fields.forEach(function(t){t.field_group_name=a.field_list[i][d].title,t.project_id=r.project_id,t.module_id=r.module_id,t.frozen_module=t.frozen_module,t.flg_module=t.flg_module,t.fields=t.module+"-"+t.id,e.push(t)});$("#Nup_fields").combobox({data:e,width:350,valueField:"fields",textField:"lang",groupField:"field_group_name",multiple:!0,value:"",onSelect:function(t){if(0===$("#dgup_i_"+t.fields).length){var e=Strack.field_item_dom(t,r);$("#st_dialog_item").append(e.item_dom),Strack.field_item_init(e.dom_id,r.project_id,t)}},onUnselect:function(t){$("#dgup_i_"+t.fields).remove()},onLoadSuccess:function(){var e=$(this);a.user_setting.forEach(function(t){e.combobox("select",t)})}})})},close:function(){e()}})},field_item_dom:function(t,e){var a="",i="dgup_"+t.fields+Math.floor(1e3*Math.random()+1),d="";return d=t.field_group_name?t.lang+" ("+t.field_group_name+")":t.lang,{item_dom:a+='<li id="dgup_i_'+t.fields+'" class="dg-report-item" data-field="'+t.fields+'"><a href="javascript:;" onclick="Strack.field_item_delete(this)" class="dg-report-de aign-left"  data-field="'+t.fields+'" data-mode="'+e.mode+'"><i class="icon-uniE6DB"></i></a><div class="dg-report-step aign-left">'+d+'</div><div class="dg-report-user st-dialog-input aign-left">'+Strack.field_editor_dom(i,t)+"</div></li>",dom_id:i}},field_item_init:function(t,e,a){a.primary=e,Strack.widget_init_dom(t,260,25,a)},field_item_delete:function(t){var e=$(t).data("field");$("#Nup_fields").combobox("unselect",e)},field_editor_dom:function(t,e){var a="",i="";i=e.field_group_name?e.lang+" ("+e.field_group_name+")":e.lang;var d="built_in"===e.field_type?0:e.variable_id;switch(e.editor){case"textarea":a='<textarea id="'+t+'" class="field_edit_item widget-edit" data-field="'+e.fields+'" data-variableid="'+d+'" data-fieldtype="'+e.field_type+'" data-lang="'+i+'" data-editor="'+e.editor+'" data-multiple="'+e.multiple+'" data-table="'+e.module+'"></textarea>';break;default:a='<input id="'+t+'" class="field_edit_item" data-field="'+e.fields+'" data-variableid="'+d+'" data-fieldtype="'+e.field_type+'" data-lang="'+i+'" data-editor="'+e.editor+'" data-multiple="'+e.multiple+'" data-table="'+e.module+'">'}return a},item_operate_update:function(){var t={};$("#st_dialog_form_hide").find("input").each(function(){t[$(this).attr("data-name")]=$(this).val()}),t.primary_id=$("#Nprimary_id").val();var e=Strack.check_item_operate_fields("Nup_fields","st_dialog_form");e.allow_up&&$.ajax({type:"POST",url:StrackPHP.updateItemDialog,data:JSON.stringify({param:t,data:e.up_data}),contentType:"application/json",dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),Strack.dialog_cancel()):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},check_item_operate_fields:function(t,e){var a=Strack.get_combos_val("#"+t,"combobox","getValues"),l={},c=!0;return a?($(".form-tip").remove(),$("#"+e).find(".field_edit_item").each(function(){var t=$(this).attr("data-lang"),e=$(this).attr("data-editor"),a=$(this).attr("data-field"),i=$(this).attr("data-fieldtype"),d=$(this).attr("data-multiple"),r=$(this).attr("data-variableid"),o=$(this).attr("data-table"),n="";switch(e){case"combobox":if("yes"===d){var s=Strack.get_combos_val(this,"combobox","getValues");n=s?s.join(","):""}else n=Strack.get_combos_val(this,"combobox","getValue");break;case"datebox":n=$(this).datebox("getValue");break;case"checkbox":n=$(this).is(":checked")?"yes":"no";break;default:n=$(this).val()}if(!n&&0!==n)return $(this).closest("li").append(Strack.dialog_error_icon("e")),layer.msg(t+" : "+StrackLang.Required_Field,{icon:2,time:1200,anim:6}),c=!1;$(this).closest("li").append(Strack.dialog_error_icon("t")),l.hasOwnProperty(o)?l[o].push({field:a,field_type:i,value:n,variable_id:r}):l[o]=[{field:a,field_type:i,value:n,variable_id:r}]})):(c=!1,layer.msg(StrackLang.Please_Select_Field,{icon:2,time:1200,anim:6})),{allow_up:c,up_data:l}},entity_add_task:function(t){var e=$(t).closest(".datagrid-toolbar"),a=$(t).attr("data-lang"),i=$(t).attr("data-modulecode"),d=$(t).attr("data-taskmoduleid"),r=$("#page_hidden_param input[name=module_name]").val(),o=e.attr("data-grid"),n=e.attr("data-page"),s=e.attr("data-maindom"),l=e.attr("data-bardom"),c=e.attr("data-moduleid"),_=e.attr("data-projectid"),m=$("#"+o).datagrid("getSelections"),u=[];m.forEach(function(t){u.push(parseInt(t.id))}),0<u.length?Strack.open_dialog("dialog",{title:StrackLang.Add_Task,width:920,height:500,content:Strack.dialog_dom({type:"add_entity_task",entity_title:a,hidden:[{case:101,id:"Nmodule_id",type:"hidden",name:"module_id",valid:1,value:c},{case:101,id:"Ntask_module_id",type:"hidden",name:"task_module_id",valid:1,value:d},{case:101,id:"Nmodule_name",type:"hidden",name:"module_name",valid:1,value:r},{case:101,id:"Nproject_id",type:"hidden",name:"project_id",valid:1,value:_},{case:101,id:"Ngrid",type:"hidden",name:"grid",valid:1,value:o},{case:101,id:"Npage",type:"hidden",name:"page",valid:1,value:n},{case:101,id:"Ntype",type:"hidden",name:"type",valid:1,value:"add_entity_task"},{case:101,id:"Nmain_dom",type:"hidden",name:"main_dom",valid:1,value:s},{case:101,id:"Nbar_dom",type:"hidden",name:"bar_dom",valid:1,value:l}],items:[],footer:[{obj:"entity_add_task_submit",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel},{obj:"save_dialog_setting",type:8,title:StrackLang.Save_Setting}]}),inits:function(){Strack.combobox_widget("#Mentity",{url:StrackPHP.getWidgetData,valueField:"id",textField:"name",multiple:!0,queryParams:{module:"entity",field_type:"built_in",fields:"entity_id",flg_module:"entity",project_id:_,entity_module_id:c},onLoadSuccess:function(){$(this).combobox("setValues",u)}});var e={step_id:"Mstep",list_id:"stdg_etask_list",combox_id:"Nup_fields",edit_id:"st_dialog_item"};Strack.combobox_widget("#Mstep",{url:StrackPHP.getEntityStepList,valueField:"id",textField:"name",multiple:!0,queryParams:{project_id:_,module_code:i},onSelect:function(t){Strack.add_entity_step_task_group(e,t,"new")},onUnselect:function(t){Strack.remove_entity_step_task_group(e,t)}});var r={mode:"create",field_list_type:["edit"],module_id:d,project_id:_,page:n,type:"add_entity_task_panel"};Strack.get_item_fields(r,function(a){var e=[];for(var i in a.field_list)for(var d in a.field_list[i])a.field_list[i][d].fields.forEach(function(t){t.field_group_name=a.field_list[i][d].title,t.project_id=r.project_id,t.module_id=r.module_id,t.frozen_module=t.frozen_module,t.flg_module=t.flg_module,t.fields=t.module+"-"+t.id,e.push(t)});$("#Nup_fields").combobox({data:e,width:350,valueField:"fields",textField:"lang",groupField:"field_group_name",multiple:!0,value:"",onSelect:function(t){if(0===$("#dgup_i_"+t.fields).length){var e=Strack.field_item_dom(t,r);if($("#st_dialog_item").append(e.item_dom),Strack.field_item_init(e.dom_id,r.project_id,t),"name"===t.id||"code"===t.id){var a=$("#stdg_etask_list .etask-l-active").find(".etask-l-item-name").html();$("#"+e.dom_id).val(a)}}},onUnselect:function(t){$("#dgup_i_"+t.fields).remove()},onLoadSuccess:function(){var e=$(this);a.user_setting.forEach(function(t){e.combobox("select",t)})},onChange:function(t,e){$(".stdg-etask-l-item").removeClass("form_ok")}})})},close:function(){Strack.G.entityStepTaskAddData={status:!1,data:{}}}}):layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6})},entity_add_task_submit:function(){if($.isEmptyObject(Strack.G.entityStepTaskAddData.data))layer.msg(StrackLang.Please_Select_Step,{icon:2,time:1200,anim:6});else{var t=$("#stdg_etask_list").find(".etask-l-active");if(0<t.length){var e=t.attr("id"),a=t.attr("data-stepcode"),i=Strack.check_item_operate_fields("Nup_fields","st_dialog_form");Strack.G.entityStepTaskAddData.data[a][e]=i.up_data,i.allow_up&&t.addClass("form_ok")}if(Strack.G.entityStepTaskAddData.status=!0,$(".stdg-etask-l-item").each(function(){$(this).hasClass("form_ok")||(Strack.G.entityStepTaskAddData.status=!1)}),Strack.G.entityStepTaskAddData.status){var d={entity_param:{},task_rows:Strack.G.entityStepTaskAddData.data};if($("#st_dialog_form_hide").find("input").each(function(){d.entity_param[$(this).attr("data-name")]=$(this).val()}),d.entity_ids=$("#Mentity").combobox("getRowValues","id"),d.step_ids=$("#Mstep").combobox("getRowValues","id"),0<d.entity_ids.length)$.ajax({type:"POST",url:StrackPHP.batchSaveEntityBase,data:JSON.stringify(d),contentType:"application/json",dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),Strack.dialog_cancel()):layer.msg(t.message,{icon:7,time:1200,anim:6})}});else{var r=$("#Nmodule_name").val();layer.msg(r+" : "+StrackLang.Required_Field,{icon:2,time:1200,anim:6})}}else layer.msg(StrackLang.Please_Fill_Step_Task_Data,{icon:2,time:1200,anim:6})}},import_excel_data:function(t){var e=$("#import_excel_slider");e.hasClass("load-active")?Strack.reset_import_excel_step_data():e.addClass("load-active");var a=$(t).closest(".datagrid-toolbar"),i=Math.floor(1e5*Math.random()+1),o={page:a.attr("data-page"),module_id:a.attr("data-moduleid"),grid:a.attr("data-grid"),project_id:a.attr("data-projectid"),main_dom:a.attr("data-maindom"),bar_dom:a.attr("data-bardom"),batch_number:i};Strack.G.importExcelStep=$("#import_excel_step").step({mustStep:[],stepCallBack:function(i){var t={method:StrackLang.Please_Select_Import_Mode,import_paste:StrackLang.Please_Paste_Excel_Data,import_file:StrackLang.Please_Select_Excel_File,mapping:StrackLang.Must_Field_Completely_Mapping,result:""},d=!0,r="";if(["method","import","mapping","result"].forEach(function(t,e){if(!(e+1<i&&d))return!1;switch(r=t){case"method":var a=$(".import-method-active");0<a.length?Strack.G.importExcelData.method=a.attr("data-method"):d=!1;break;case"import":if(Strack.G.importExcelData.method)switch(Strack.G.importExcelData.method){case"paste":0===$("#import_method_paste").val().length&&(d=!1);break;case"file":0===$(".uploadifive-queue-item").length&&(d=!1)}else d=!1;break;case"mapping":$("#import_ex_must").find(".menu-icon").each(function(){if($(this).hasClass("icon-unchecked"))return d=!1})}return e+1,!!d&&void 0}),d)switch(parseInt(i)){case 1:Strack.G.importExcelStep.goStep(i),Strack.reset_import_excel_step_bnt(i);break;case 2:Strack.G.importExcelStep.goStep(i),$(".import-method-panel").hide(),Strack.init_excel_format_widget(o),Strack.reset_import_excel_step_bnt(i);break;case 3:switch(Strack.G.importExcelData.method){case"paste":Strack.format_excel_paste_data(o);break;case"file":Strack.format_excel_file_data()}break;case 4:Strack.import_excel_step_submit(o);break;default:Strack.format_excel_file_data(0)}else{var e="";switch(r){case"import":e=t[r+"_"+Strack.G.importExcelData.method];break;default:e=t[r]}layer.msg(e,{icon:2,time:1200,anim:6})}}}),e.sidebar("toggle")},close_import_excel_panel:function(){$("#import_excel_slider").sidebar("toggle")},reset_import_excel_step_data:function(){Strack.G.importExcelData={},$("#import_ex_list .step-list").hide(),$(".excel-in-submit").hide(),$("#import_excel_bnt_upload").hide(),$("#import_excel_bnt_prev").hide(),$("#import_excel_bnt_next").show(),$("#import_excel_bnt_submit").hide(),$(".import-excel-card").removeClass("import-method-active"),$(".import-method-panel").hide();var t=$("#method_paste_header");t.hasClass("switchbutton-f")&&(t.switchbutton("clear"),$("#import_method_paste").empty());var e=$("#method_file_header");e.hasClass("switchbutton-f")&&(e.switchbutton("clear"),$("#excel_upload_widget").uploadifive("clearQueue"))},reset_import_excel_step_bnt:function(t){var e=$("#import_excel_bnt_upload"),a=$("#import_excel_bnt_prev"),i=$("#import_excel_bnt_next"),d=$("#import_excel_bnt_submit");switch(t){case 1:e.hide(),a.hide(),i.show(),d.hide();break;case 2:"file"===Strack.G.importExcelData.method&&e.show(),a.show(),i.show(),d.hide();break;case 4:e.hide(),a.show(),i.hide(),d.show();break;default:e.hide(),a.show(),i.show(),d.hide()}},import_excel_step_prev:function(){Strack.G.importExcelStep.preStep()},import_excel_step_next:function(){Strack.G.importExcelStep.nextStep()},init_excel_format_widget:function(t){var e=$("#excel_format_paste"),a=$("#excel_format_file");switch($(".import-method-"+Strack.G.importExcelData.method).show(),Strack.G.importExcelData.method){case"paste":e.hasClass("load_active")||(e.addClass("load_active"),Strack.init_open_switch({dom:"#method_paste_header",value:0,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100}));break;case"file":a.hasClass("load_active")||(a.addClass("load_active"),Strack.init_open_switch({dom:"#method_file_header",value:0,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100}),Strack.init_excel_file_upload(t))}},format_excel_paste_data:function(t){var e=new CSV($("#import_method_paste").val(),{cellDelimiter:"\t"}),a=Strack.get_switch_val("#method_paste_header"),i=e.parse();$.ajax({type:"POST",url:StrackPHP.formatExcelPasteData,data:JSON.stringify({has_header:a,parsed:i,module_id:t.module_id,project_id:t.project_id,page:t.page}),contentType:"application/json",beforeSend:function(){$("#import_excel_step").append(Strack.loading_dom("white","","excel_data"))},success:function(t){200===parseInt(t.status)?(Strack.G.importExcelStep.goStep(3),Strack.reset_import_excel_step_bnt(3),Strack.init_format_datagrid(t.data)):layer.msg(t.message,{icon:7,time:1200,anim:6}),$("#st-load_excel_data").remove()}})},format_excel_file_data:function(){var t=Strack.get_switch_val("#method_file_header");$("#excel_upload_widget").uploadifive("settings","formData","has_header",t),$(".uploadifive-queue-item").hasClass("complete")?(Strack.G.importExcelStep.goStep(3),Strack.reset_import_excel_step_bnt(3)):$("#excel_upload_widget").uploadifive("upload")},init_excel_file_upload:function(t){$("#excel_upload_widget").uploadifive({auto:!1,removeCompleted:!1,formData:{timestamp:Strack.current_time(),batch_number:t.batch_number,module_id:t.module_id,project_id:t.project_id,page:t.page,has_header:0},multi:!1,queueSizeLimit:1,fileSizeLimit:"10MB",fileType:"text/csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",queueID:"import_method_queue",uploadScript:StrackPHP.formatExcelFileData,onUploadComplete:function(t,e){var a=JSON.parse(e);200===parseInt(a.status)?(Strack.G.importExcelStep.goStep(3),Strack.reset_import_excel_step_bnt(3),Strack.init_format_datagrid(a.data)):layer.msg(a.message,{icon:7,time:1200,anim:6})},onQueueComplete:function(t,e){}})},select_import_excel_method:function(t){$(".import-excel-card").removeClass("import-method-active"),$(t).addClass("import-method-active")},init_format_menu:function(t){var e="iconCls:'icon-unchecked'",a=$("#excel_fields_menu");if(a.hasClass("st-menu")){$("#import_ex_must").find(".menu-item").each(function(){a.menu("removeItem",this)}),$("#import_ex_other").find(".menu-item").each(function(){a.menu("removeItem",this)});var i="";t.forEach(function(t){i="fexn_"+t.fields,"yes"===t.require?a.menu("appendItem",{parent:$("#import_ex_must_wrap")[0],id:i,text:t.lang,iconCls:"icon-unchecked"}):a.menu("appendItem",{parent:$("#import_ex_other_wrap")[0],id:i,text:t.lang,iconCls:"icon-unchecked"}),$("#"+i).attr("data-bnt","mapping_field").attr("data-fields",t.fields).attr("data-mapping","").attr("data-fieldtype",t.field_type)})}else{var d="",r="";t.forEach(function(t){"yes"===t.require?d+='<div id="fexn_'+t.fields+'"  data-options="'+e+'" data-bnt="mapping_field" data-fields="'+t.fields+'" data-mapping="" data-fieldtype="'+t.field_type+'">'+t.lang+"</div>":r+='<div id="fexn_'+t.fields+'"  data-options="'+e+'" data-bnt="mapping_field" data-fields="'+t.fields+'" data-mapping="" data-fieldtype="'+t.field_type+'">'+t.lang+"</div>"}),$("#import_ex_must").empty().append(d),$("#import_ex_other").empty().append(r),a.menu({onClick:function(t){var e=$("#excel_fields_val").val(),a=$("#cell_ckt_"+e),i=a.parent(),d=a.attr("data-ckfield"),r=$("#fexn_"+d),o=$(t.target);switch(o.data("bnt")){case"cancel_mapping":r.data("mapping",""),r.find(".menu-icon").removeClass("icon-checked").addClass("icon-unchecked"),$(this).menu("enableItem",r[0]),a.attr("data-ckfield","").html(StrackLang.Non_Mapping_Field),i.removeClass("excel-tac").removeClass("mapping-active");break;case"mapping_field":if(!i.hasClass("mapping-active")){i.addClass("mapping-active");var n=$(t.target).data("fields"),s=$(t.target).find(".menu-text").html();$(t.target).attr("data-mapping",e),i.addClass("excel-tac"),a.attr("data-ckfield",n).html(s),o.find(".menu-icon").removeClass("icon-unchecked").addClass("icon-checked"),$(this).menu("disableItem",t.target)}}}})}return{}},build_import_ex_columns:function(t,e){var a=[],i="";return a.push({field:"ex_del_bnt",col_type:"bnt",title:StrackLang.Delete,align:"center",width:85,formatter:function(t,e,a){return'<a href="javascript:;" class="button" onclick="Strack.import_excel_grid_bnt(this)"><button class="ui basic red button">'+StrackLang.Delete+"</button></a>"}}),t.forEach(function(t){i="",0<=$.inArray(t,e)?a.push({field:t,col_type:"field",title:t,align:"center",width:130,formatter:function(t,e,a){return i=StrackPHP.ROOT+t,Strack.build_grid_thumb_dom(i)}}):a.push({field:t,col_type:"field",title:t,align:"center",width:130,editor:{type:"text"}})}),[a]},import_excel_grid_bnt:function(t){var e=$(t).closest(".datagrid-row").attr("datagrid-row-index");$("#import_excel_datagrid").datagrid("deleteRow",e)},init_format_datagrid:function(t){Strack.init_format_menu(t.fields),Strack.G.InputExCkfields={};var e={};t.header.forEach(function(t){e[t]={field_type:"excel",editor:"text",variable_id:0,primary:"",field_map:t,table:"Excel",module:"excel",module_type:"excel",field_value_map:t}});var a=$("#import_excel_datagrid");a.hasClass("datagrid-f")?a.datagrid("setOptions",{columnsFieldConfig:e,columns:Strack.build_import_ex_columns(t.header,t.images_column)}).datagrid("loadData",t.body):a.datagrid({data:t.body,fitColumns:!1,height:Strack.panel_height(".mapping-fields-wrap",0),rowheight:49,differhigh:!0,singleSelect:!0,HeaderField:!0,HeaderHeight:50,HeaderFieldData:{},cellUpdateMode:"manual",columnsFieldConfig:e,adaptive:{dom:".mapping-fields-wrap",min_width:1004,exth:115},frozenColumns:[[{field:"id",checkbox:!0}]],columns:Strack.build_import_ex_columns(t.header,t.images_column)}).datagrid("enableCellEditing").datagrid("disableCellSelecting").datagrid("gotoCell",{index:0,field:"id"}).datagrid("columnMoving")},show_excel_check_fields:function(t,e){$("#excel_fields_val").val($(t).data("field")),$("#excel_fields_menu").menu("show",{left:e.clientX,top:e.clientY+15})},import_excel_step_submit:function(i){var t={};$("#import_ex_must").find(".menu-item").each(function(){$(this).data("mapping")&&(t[$(this).data("fields")]=$(this).data("mapping"))}),$("#import_ex_other").find(".menu-item").each(function(){$(this).data("mapping")&&(t[$(this).data("fields")]=$(this).data("mapping"))});var e=$("#import_excel_datagrid").datagrid("getData");$.ajax({type:"POST",url:StrackPHP.submitImportExcelData,dataType:"json",contentType:"application/json",data:JSON.stringify({param:i,field_mapping:t,grid_data:e.rows}),beforeSend:function(){$("#import_excel_step").append(Strack.loading_dom("white"))},success:function(t){if(Strack.G.importExcelStep.goStep(4),Strack.reset_import_excel_step_bnt(4),$(".excel-in-submit").hide(),200===parseInt(t.status)){var e=$("#excel_in_success");e.show(),e.find(".success-number").html(t.data.success_total),$("#"+i.grid).datagrid("reload")}else{var a=$("#excel_in_error");a.show(),a.find(".error-code").html(t.status),a.find(".error-line").html(t.data.line),a.find(".error-msg").html(t.data.message)}$("#st-load").remove()}})},close_import_excel:function(){$("#import_excel_slider").sidebar("toggle")},change_field_col:function(a){var i=$("#"+a);$(".iex_text").on("blur",function(){var t=$(this).attr("data-index"),e=i.datagrid("selectRow",t).datagrid("getSelected");e[$(this).closest("td").attr("field")]=$(this).val(),i.datagrid("updateRow",{index:t,row:e}),$(this).off("blur"),Strack.change_field_col(a)})},export_excel_file:function(t){var e=$(t).closest(".grid-toolbar").attr("data-grid");Strack.export_excel_dialog(e)},export_excel_dialog:function(t){Strack.open_dialog("dialog",{title:StrackLang.Export_Excel,width:480,height:180,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Egrid",type:"hidden",name:"grid",valid:1,value:t}],items:[{case:1,id:"Ename",type:"text",lang:StrackLang.Name,name:"excel_name",valid:1,value:""}],footer:[{obj:"export_excel",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]})})},export_excel:function(){var t=$("#Egrid").val(),e=$("#Ename").val(),a=$("#"+t).datagrid("options"),i=a.columns;$.ajax({type:"POST",url:StrackPHP.exportExcel,data:JSON.stringify({filter_data:JSON.parse(a.queryParams.filter_data),columns_data:i,excel_name:e,page:a.pageSize,rows:a.page_numberber}),contentType:"application/json",success:function(t){if(200===parseInt(t.status)){Strack.top_message({bg:"g",msg:t.message}),Strack.dialog_cancel();var e=StrackPHP.downloadExcel+"?id="+t.data.id;window.open(e)}else layer.msg(t.message,{icon:7,time:1200,anim:6})}})},manage_fields:function(t){var e=$(t).closest(".grid-toolbar"),a={lang:$(t).attr("data-lang"),page_name:e.attr("data-page"),grid:e.attr("data-grid"),module_id:e.attr("data-moduleid"),project_id:e.attr("data-projectid")};Strack.manage_fields_dialog(a)},manage_fields_dialog:function(t){Strack.open_dialog("dialog",{title:t.lang,width:680,height:464,content:Strack.dialog_dom({type:"datagrid",grid:{wrap_dom:"dialog_wrap",table_dom:"dialog_data",toolbar_show:!0,toolbar_id:"dialog_tb",toolbar_dom:[{obj:"Strack.add_custom_field",type:"button",icon:"icon-add",title:StrackLang.Add_Custom_Field}],top_notice:StrackLang.Manage_Custom_Fields_Notice,height:328},hidden:[{case:101,id:"Nlang",type:"hidden",name:"lang",valid:1,value:t.lang},{case:101,id:"Npage_name",type:"hidden",name:"page_name",valid:1,value:t.page_name},{case:101,id:"Nproject_id",type:"hidden",name:"project_id",valid:1,value:t.project_id},{case:101,id:"Ngrid",type:"hidden",name:"grid",valid:1,value:t.grid},{case:101,id:"Nmodule_id",type:"hidden",name:"module_id",valid:1,value:t.module_id}],footer:[{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){$("#dialog_data").datagrid({url:StrackPHP.getCustomFieldsList,fitColumns:!1,height:Strack.panel_height("#dialog_wrap",0),differhigh:!1,rowheight:49,DragSelect:!0,queryParams:t,columnsFieldConfig:{name:{field_type:"built_in",field_map:"name",field_value_map:"name",primary:"variable_id",module:"variable",table:"Variable"},code:{field_type:"built_in",field_map:"code",field_value_map:"code",primary:"variable_id",module:"variable",table:"Variable"}},columns:[[{field:"variable_delete",title:StrackLang.Delete,align:"center",findex:0,width:60,formatter:function(t,e,a){return'<i class="icon-remove p-cursor"></i>'}},{field:"variable_id",title:StrackLang.ID,align:"center",findex:1,width:60},{field:"name",title:StrackLang.Name,align:"center",findex:2,width:160,editor:{type:"text"}},{field:"code",title:StrackLang.Code,align:"center",findex:3,width:160,editor:{type:"text"}},{field:"type",title:StrackLang.Field_Type,align:"center",findex:4,width:120}]],onClickCell:function(t,e,a){"variable_delete"===e&&Strack.del_custom_field(t)},toolbar:"#dialog_tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1}).datagrid("enableCellEditing").datagrid("disableCellSelecting").datagrid("gotoCell",{index:0,field:"id"})},close:function(){Strack.G.IsNewfileds&&(Strack.G.IsNewfileds=!1,window.location.reload())}})},del_custom_field:function(t){$("#dialog_data").datagrid("selectRow",t),Strack.G.IsNewfileds=!0,Strack.ajax_grid_delete("dialog_data","variable_id",StrackLang.Del_Custom_Field_Notice,StrackPHP.deleteCustomField,"",!0)},add_custom_field:function(){var t={lang:$("#Nlang").val(),page_name:$("#Npage_name").val(),grid:$("#Ngrid").val(),module_id:$("#Nmodule_id").val(),project_id:$("#Nproject_id").val()},e=!1;Strack.G.IsNewfileds&&(Strack.G.IsNewfileds=!1,e=!0),Strack.dialog_cancel(),Strack.open_dialog("dialog",{title:StrackLang.Add_Custom_Field,width:820,height:520,content:Strack.dialog_dom({type:"add_custom_field",hidden:[{case:101,id:"Nlang",type:"hidden",name:"lang",valid:1,value:t.lang},{case:101,id:"Npage_name",type:"hidden",name:"page_name",valid:1,value:t.page_name},{case:101,id:"Nproject_id",type:"hidden",name:"project_id",valid:1,value:t.project_id},{case:101,id:"Ngrid",type:"hidden",name:"grid",valid:1,value:t.grid},{case:101,id:"Nmodule_id",type:"hidden",name:"module_id",valid:1,value:t.module_id}],footer:[{obj:"save_custom_field",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){$.ajax({type:"POST",url:StrackPHP.whetherSupportHorizontalRelation,dataType:"json",data:{module_id:t.module_id},success:function(t){var e=[{field_type:"text",lang:StrackLang.Input},{field_type:"combobox",lang:StrackLang.Combobox},{field_type:"datebox",lang:StrackLang.Datebox},{field_type:"datetimebox",lang:StrackLang.Datetimebox},{field_type:"textarea",lang:StrackLang.Text},{field_type:"checkbox",lang:StrackLang.Checkbox}];200===parseInt(t.status)&&e.push({field_type:"horizontal_relationship",lang:StrackLang.Horizontal_Relationship});var a="";e.forEach(function(t){a+=Strack.custom_field_type(t)}),$("#stdg_fd_list").empty().append(a)}})},close:function(){Strack.manage_fields_dialog(t),e&&(Strack.G.IsNewfileds=!0,e=!1)}})},custom_field_type:function(t){var e="";return e+='<a href="javascript:;" onclick="Strack.select_field_type(this)" class="stdg-left-item" data-fieldtype="'+t.field_type+'" data-lang="'+t.lang+'">'+t.lang+"</a>"},select_field_type:function(t){var e=$(t).data("lang"),a=$(t).data("fieldtype");$(".stdg-left-item").removeClass("stdg-item-ac"),$(t).addClass("stdg-item-ac"),$("#stdg_fd_title").html(e),Strack.fill_select_field_dom(a)},fill_select_field_dom:function(t){var e=null,a="",i=$("#stdg_fd_main");switch(t){case"text":e=Strack.custom_f_text_conf(t);break;case"combobox":e=Strack.custom_f_comb_conf(t);break;case"textarea":case"checkbox":e=Strack.custom_f_textarea_conf(t);break;case"datebox":case"datetimebox":e=Strack.custom_f_date_conf(t);break;case"horizontal_relationship":e=Strack.custom_f_horizontal_conf(t)}switch(e.hide.forEach(function(t){a+=Strack.dialog_items(t)}),e.show.forEach(function(t){a+=Strack.dialog_base_item(t.lang,t)}),i.empty().append(a),t){case"datebox":case"datetimebox":case"text":case"combobox":case"textarea":case"checkbox":case"horizontal_relationship":Strack.combobox_widget("#Fd_inputMask",{url:StrackPHP.getInputMaskList,valueField:"id",textField:"name",width:378,height:26,value:"arbitrary",onChange:function(t,e){var a=$("#Fd_inputMask_length").closest(".st-dialog-items");0<=$.inArray(t,["arbitrary","integer_no_range","letter_no_range"])?a.show():a.hide()}});var d=$("#Nmodule_id").val();Strack.combobox_widget("#Fd_horizontal",{url:StrackPHP.getHorizontalRelationList,valueField:"id",textField:"name",width:378,height:26,queryParams:{module_id:d}})}$(":input").inputmask()},custom_f_text_conf:function(t){return{hide:[{case:101,id:"Fd_type",type:"hidden",name:"field_type",valid:1,value:t}],show:[{case:1,id:"Fd_name",type:"text",lang:StrackLang.Field_Name,name:"name",valid:"1,128",value:"",mask:"*{1,128}"},{case:1,id:"Fd_code",type:"text",lang:StrackLang.Code,name:"code",valid:"1,128",value:"",mask:"alphaDash"},{case:2,id:"Fd_inputMask",type:"text",lang:StrackLang.Input_Mask,name:"input_mask",valid:"",value:""},{case:1,id:"Fd_inputMask_length",type:"text",lang:StrackLang.Input_Mask_Length,name:"input_mask_length",valid:"",value:"",mask:"9{1,999999999}"}]}},custom_f_comb_conf:function(t){return{hide:[{case:101,id:"Fd_type",type:"hidden",name:"field_type",valid:1,value:t}],show:[{case:1,id:"Fd_name",type:"text",lang:StrackLang.Field_Name,name:"name",valid:"1,128",value:"",mask:"*{1,128}"},{case:1,id:"Fd_code",type:"text",lang:StrackLang.Code,name:"code",valid:"1,128",value:"",mask:"alphaDash"},{case:103,id:"Fd_comblist",type:"text",lang:StrackLang.Combo_List,name:"comb_list",valid:1,value:""}]}},custom_f_textarea_conf:function(t){return{hide:[{case:101,id:"Fd_type",type:"hidden",name:"field_type",valid:1,value:t}],show:[{case:1,id:"Fd_name",type:"text",lang:StrackLang.Field_Name,name:"name",valid:"1,128",value:"",mask:"*{1,128}"},{case:1,id:"Fd_code",type:"text",lang:StrackLang.Code,name:"code",valid:"1,128",value:"",mask:"alphaDash"}]}},custom_f_date_conf:function(t){return{hide:[{case:101,id:"Fd_type",type:"hidden",name:"field_type",valid:1,value:t}],show:[{case:1,id:"Fd_name",type:"text",lang:StrackLang.Field_Name,name:"name",valid:"1,128",value:"",mask:"*{1,128}"},{case:1,id:"Fd_code",type:"text",lang:StrackLang.Code,name:"code",valid:"1,128",value:"",mask:"alphaDash"}]}},custom_f_horizontal_conf:function(t){return{hide:[{case:101,id:"Fd_type",type:"hidden",name:"field_type",valid:1,value:t}],show:[{case:1,id:"Fd_name",type:"text",lang:StrackLang.Field_Name,name:"name",valid:"1,128",value:"",mask:"*{1,128}"},{case:1,id:"Fd_code",type:"text",lang:StrackLang.Code,name:"code",valid:"1,128",value:"",mask:"alphaDash"},{case:2,id:"Fd_horizontal",type:"text",lang:StrackLang.Relation_Module_List,name:"relation_module",valid:"",value:""}]}},add_cf_comb_item:function(t){$("#dg_comb_list").append(Strack.cf_comb_item_dom()),Strack.rebuild_comb_index()},cf_comb_item_dom:function(){return'<div class="dg-cblist-item"><div class="dgcb-id aign-left"><input type="text" disabled="disabled"></div><div class="dgcb-name aign-left"><input type="text"></div><a href="javascript:;" onclick="Strack.del_cf_comb_item(this)" class="dgcb-deitem aign-left"><i class="icon-uniEA34 icon-right"></i></a></div>','<div class="dg-cblist-item"><div class="dgcb-id aign-left"><input type="text" disabled="disabled"></div><div class="dgcb-name aign-left"><input type="text"></div><a href="javascript:;" onclick="Strack.del_cf_comb_item(this)" class="dgcb-deitem aign-left"><i class="icon-uniEA34 icon-right"></i></a></div>'},del_cf_comb_item:function(t){$(t).parent().remove(),Strack.rebuild_comb_index()},rebuild_comb_index:function(){var t=0;$("#dg_comb_list").find(".dg-cblist-item").each(function(){t+=10,$(this).find(".dgcb-id input").val(t)})},save_custom_field:function(){var t=$("#Fd_type").val(),d=[],r=!1,e={};if($(".st-dialog-input").children("i").remove(),$("#stdg_fd_main").find(".st-dialog-input").each(function(){var t=$(this).children("input"),e="",a="",i="";if(!$.isEmptyObject(t[0])){if(e=t.attr("data-name"),i=t.data("valid"),a=t.hasClass("combobox-f")?Strack.get_combos_val("#"+t.attr("id"),"combobox","getValue"):$("#"+t.attr("id")).val(),!(0==i||0<a.length)){switch(e){case"name":layer.msg(StrackLang.Varname_Null,{icon:2,time:1200,anim:6});break;case"code":layer.msg(StrackLang.Varcode_Null,{icon:2,time:1200,anim:6});break;case"field_scope":layer.msg(StrackLang.Varscope_Null,{icon:2,time:1200,anim:6});break;case"date_format":layer.msg(StrackLang.Varfdate_Null,{icon:2,time:1200,anim:6})}return t.parent().append(Strack.dialog_error_icon("e")),r=!1}d.push({field:e,value:a}),t.parent().append(Strack.dialog_error_icon("t")),r=!0}}),r)switch(e.base_data=d,t){case"combobox":var a=$("#dg_comb_list").find(".dgcb-name input"),i=[];0<a.length?(a.each(function(){var t=$(this).val();if(!t)return layer.msg(StrackLang.MenuVal_Null,{icon:2,time:1200,anim:6}),r=!1;i.push(t)}),e.field_type="combobox",e.comb_data=i):(r=!1,layer.msg(StrackLang.MenuVal_length,{icon:2,time:1200,anim:6}));break;default:e.field_type=t}if(r){var o={};if($("#st_dialog_form_hide").find("input").each(function(){o[$(this).attr("data-name")]=$(this).val()}),e.base_data.push({field:"action_scope",value:"current"}),"text"===e.field_type){var n={field:"mask",value:""},s={};switch(e.base_data.forEach(function(t){s[t.field]=t.value}),s.input_mask){case"arbitrary":n.value=0<parseInt(s.input_mask_length)?"*{1,"+s.input_mask_length+"}":"*{1,999999999999999999}";break;case"integer_no_range":n.value=0<parseInt(s.input_mask_length)?"9{1,"+s.input_mask_length+"}":"9{1,999999999999999999}";break;case"letter_no_range":n.value=0<parseInt(s.input_mask_length)?"a{1,"+s.input_mask_length+"}":"a{1,999999999999999999}";break;default:n.value=s.input_mask}e.base_data.push(n)}$.ajax({type:"POST",url:StrackPHP.addCustomFields,data:JSON.stringify({param:o,field_data:e}),dataType:"json",contentType:"application/json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message})):layer.msg(t.message,{icon:7,time:1200,anim:6})}})}},frozen_col:function(t,e){var a=$(t).closest("td").attr("field"),i=$(t).find("i"),d=$(t).data("index"),r=$(t).closest(".datagrid-view").find(".datagrid-f").attr("id"),o=$("#"+r);e.stopPropagation(),i.hasClass("icon-uniF023")?o.datagrid("FrozenColumn",{field:a,index:d,isfrozen:"frozen"}).datagrid("reload"):o.datagrid("FrozenColumn",{field:a,index:d,isfrozen:"nofrozen"}).datagrid("reload"),o.datagrid("highlightViewSave")},build_comb_avatar:function(t){var e="";return e+='<div class="comb-avatar"><div class="comb-aimg aign-left">'+Strack.build_avatar(t.avatar,"e-avatar-small","d-avatar-small",Strack.JointLetter(t.first_name,t.last_name))+'</div><div class="comb-name text-ellipsis aign-left">'+t.uname+"</div></div>"},widget_status_dom:function(t,e,a){var i="";return i+='<i class="'+t+' icon-left" style="color:'+Strack.hex_to_rgb(a,1)+'" ></i>',i+=e},init_filter_event:function(t){t.find(".filter-task-panel input,.filter-task-panel textarea").off("change").on("change",function(){"checkbox"!=$(this).attr("type")&&Strack.filter_auto(this)})},filter_auto:function(t){$(t).closest(".datagrid-filter").find(".filter_auto_in").is(":checked")&&Strack.filter_apply($(t))},filter_manual:function(t){Strack.filter_apply($(t))},filter_apply:function(t){var e=t.closest(".grid-filter-right").find(".filter-items");if(0<e.length){var a,i,d,r,o,n,s,l,c,_,m,u,g,p=[];e.each(function(){switch(a=$(this).attr("field"),i=$(this).attr("field_type"),d=$(this).attr("variable_id"),r=$(this).attr("editor"),o=$(this).attr("module"),n=$(this).attr("module_type"),s=$(this).attr("table"),l=$(this).find(".filter-input-wrap"),r){case"text":case"textarea":c=Strack.get_combos_val(l.find(".term-list")[0],"combobox","getValue"),(_=l.find(".input-text").val())&&c&&p.push({field:a,field_type:i,variable_id:d,value:_,condition:c,editor:r,module_code:o,module_type:n,table:s});break;case"combobox":var t=l.find(".in-combobox"),e=t.combobox("options");g=e.multiple?(_=Strack.get_combos_val(t[0],"combobox","getValues"),"IN"):(_=Strack.get_combos_val(t[0],"combobox","getValue"),"EQ"),_&&p.push({field:a,field_type:i,variable_id:d,value:_,condition:g,editor:r,module_code:o,module_type:n,table:s});break;case"datebox":m=l.find(".in-date-term").prop("checked"),u=l.find(".in-date-range").prop("checked"),m&&(c=Strack.get_combos_val(l.find(".term-list")[0],"combobox","getValue"),(_=l.find(".term-date").datebox("getValue"))&&c&&p.push({field:a,field_type:i,variable_id:d,value:_,condition:c,editor:r,module_code:o,module_type:n,table:s})),u&&(c=l.find(".start-date").datebox("getValue"),(_=l.find(".end-date").datebox("getValue"))&&c&&p.push({field:a,field_type:i,variable_id:d,value:c+","+_,condition:"BETWEEN",editor:r,module_code:o,module_type:n,table:s}))}});var f=t.closest(".datagrid-filter"),v=f.attr("data-maindom"),h=f.attr("data-bardom");$("#"+v).find(".datagrid-f").datagrid("setFilterParams",{filter_input:[],filter_panel:p,filter_advance:[]}).datagrid("reload"),Strack.save_filter_cache(h,"filter_panel",p),Strack.show_nosaved_filter(h,"filter_panel",StrackLang.Panel_Filter)}else layer.msg(StrackLang.Please_Choice_Filter,{icon:2,time:1200,anim:6})},group_sort_change:function(t){var e=$(t).data("grid"),r=$(t).data("ptype"),o=$(t).data("pid"),n=$(t).data("sort");$("#"+e);$(t).hasClass("field-disable")&&($("#gasc_sort_"+r).addClass("field-disable"),$("#gdesc_sort_"+r).addClass("field-disable"),$(".gitem_"+r).each(function(){if($(this).find("i").hasClass("icon-checked")){$("#g"+n+"_sort_"+r).removeClass("field-disable");var t,e={},a=$(this).data("field"),i=$(this).data("grid"),d=$("#"+i);t=[{sortName:a,sortOrder:e[a]=n}],Strack.DataSortAc(d,$(this),r,e,t,"noadv",!0),Strack.save_storage("GroupSort_"+o+"_"+r,JSON.stringify(t)),Strack.delete_storage("AdvSort_"+o+"_"+r)}}))},thumb_media_widget:function(t,e){var a="",i=Math.floor(1e4*Math.random()+1),d={id:i,has_media:e.has_media,media_param:e.param};a+='<div class="item-thumb-warp"><div id="light_box_main_'+i+'" class="task-thumb-show" data-id="'+i+'">'+Strack.thumb_media_preview_dom(d)+'</div><div id="light_box_video_'+i+'" class="light-video">'+Strack.thumb_media_preview_video_dom(d)+'</div><div class="ui secondary vertical menu thumb-menu-bnt" data-linkid="'+e.link_id+'" data-moduleid="'+e.module_id+'"><div class="ui dropdown item"><i class="icon-uniF03A"></i><div class="menu"><a href="javascript:;" class="item" onclick="Strack.change_item_media(this)">'+StrackLang.Modify_Thumb+'</a><a href="javascript:;" class="item" onclick="Strack.clear_item_thumb(this)">'+StrackLang.Clear_Thumb+"</a></div></div></div></div>",$(t).empty().append(a),"yes"===e.has_media&&Strack.init_thumb_media(i),Strack.init_dropdown()},init_thumb_media:function(t){lightGallery(document.getElementById("light_box_main_"+t),{appendSubHtmlTo:".lg-item",addClass:"lg-comments",mode:"lg-fade",enableDrag:!1,enableSwipe:!1})},thumb_media_preview_dom:function(t){var e="",a=t.media_param;return"yes"===t.has_media&&0<=$.inArray(a.type,["image","video"])?e+=Strack.light_box_item_dom(t.id,a).main_dom:e+='<div class="task-thumb-null"><i class="icon-left-p '+t.media_param.icon+'"></i></div>',e},thumb_media_preview_video_dom:function(t){var e="";"yes"===t.has_media&&"video"===t.media_param.type&&(e+='<video class="lg-video-object lg-html5" controls preload="none" loop="loop" ><source src="'+(t.media_param.base_url+t.media_param.md5_name+".mp4")+'" type="video/mp4">Your browser does not support HTML5 video.</video>');return e},show_note_img_att:function(t,e){var a,i,d="",r="";return"yes"===e.has_media&&e.param.forEach(function(t){i="item"+Math.floor(1e4*Math.random()+1),a=Strack.light_box_item_dom(i,t),d+=a.main_dom,r+=a.video_dom}),'<div id="light_box_main_'+t+'">'+d+"</div>"+r},light_box_item_dom:function(t,e){var a="",i="";switch(e.type){case"image":var d=[],r="",o="",n="",s=0;e.size.forEach(function(t){r=e.base_url+e.md5_name+"_"+t+"."+e.ext,"origin"===t?(s=e.width,n=r):s=t.split("×")[0],s<999999&&(o=r),d.push(r+" "+s)}),a='<a class="light-box" data-responsive="'+d.join(",")+'" data-src="'+n+'" ><img src="'+o+'" /><div class="light-poster"><i class="icon icon-uniE647"></i></div></a>';break;case"video":var l=e.base_url+e.md5_name+".jpg";a='<a class="light-box" data-poster="'+l+'"  data-html="#light_box_video_'+t+'" ><img class="img-responsive" src="'+l+'"><div class="light-poster"><i class="icon icon-uniE647"></i></div></a>',i+='<div id="light_box_video_'+t+'" class="light-video"><video class="lg-video-object lg-html5" controls preload="none" loop="loop" ><source src="'+(e.base_url+e.md5_name+".mp4")+'" type="video/mp4">Your browser does not support HTML5 video.</video></div>'}return{main_dom:a,video_dom:i}},build_thumb_dom:function(t,e){var a="";return a+=t?'<img class="proj_thumb_ck" src="'+t+'">':'<div class="panel-thumb-null proj_thumb_ck"><i class="'+e+'"></i></div>'},build_grid_thumb_dom:function(t){var e="",a="";return a+='<a href="#" class="athumb"  >'+(e+=t?'<img src="'+t+'">':'<i class="icon-left-p icon-uniE61A"></i>')+"</a>"},get_media_server:function(e){$.ajax({type:"POST",url:StrackPHP.getMediaUploadServer,dataType:"json",success:function(t){200===parseInt(t.status)?(Strack.G.Media_Server=t.data,e(t.data)):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},save_media_data:function(t,e){$.ajax({type:"POST",url:StrackPHP.saveMediaData,dataType:"json",data:JSON.stringify(t),contentType:"application/json",success:function(t){200===parseInt(t.status)?Strack.top_message({bg:"g",msg:t.message}):layer.msg(t.message,{icon:7,time:1200,anim:6}),e(t)}})},upload_avatar_dialog:function(t){var e=$(t).attr("data-userid"),a=$(t).attr("data-moduleid"),i=$(t).attr("data-avatarid");Strack.get_media_server(function(t){Strack.open_dialog("dialog",{title:StrackLang.Modify_Avatar,width:580,height:700,top:null,content:Strack.dialog_dom({type:"avatar",header_extra:{user_data:{dom_id:i,user_id:e,module_id:a},lang:StrackLang.Modify_Avatar},hidden:[{case:101,id:"Nuser_id",type:"hidden",name:"user_id",valid:1,value:e},{case:101,id:"Nmodule_id",type:"hidden",name:"module_id",valid:1,value:a}],footer:[{obj:"upload_avatar",type:5,title:StrackLang.Upload},{id:"delete_img",type:3,title:StrackLang.Clear_Canvas},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.js("crop_avatar_js",StrackPHP.JS+"/jquery.Jcrop.min.js"),$(".user-avatar-wrap").hide(),Strack.upload_preview({UpBtn:"img_upload",Showpanel:!0,Canvas:"canvas_crop_img",Cancel:[".user-avatar",".user-avatar-wrap","#delete_img"],Jcrop:"canvas_crop_tool",Width:522,Height:302,MinLimit:90})},close:function(){Strack.G.Jcrop_Thumb=null}})})},upload_avatar:function(){if(Strack.G.Jcrop_Thumb){var e=$("#Nuser_id").val(),a=$("#Nmodule_id").val(),t=Strack.G.Jcrop_Canvas.toDataURL("image/jpg"),i=Strack.G.Media_Server;$.ajax({type:"POST",url:i.upload_url,dataType:"json",data:{token:i.token,size:"90×90",crop:JSON.stringify({x:Strack.G.Jcrop_Thumb.x,y:Strack.G.Jcrop_Thumb.y,w:Strack.G.Jcrop_Thumb.w,h:Strack.G.Jcrop_Thumb.h}),base64Img:t},beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){200===parseInt(t.status)?Strack.save_media_data({link_id:e,module_id:a,media_server:i,media_data:t.data},function(t){$.messager.progress("close"),Strack.dialog_cancel()}):($.messager.progress("close"),layer.msg(t.message,{icon:7,time:1200,anim:6}))}})}else layer.msg(StrackLang.Please_Select_Image_File,{icon:2,time:1200,anim:6})},change_item_media:function(t){var e=$(t).closest(".thumb-menu-bnt"),a=e.attr("data-linkid"),i=e.attr("data-moduleid");Strack.open_change_item_media({link_id:a,module_id:i,mode:"single"})},open_change_item_media:function(d,r){Strack.get_media_server(function(i){Strack.open_dialog("dialog",{title:StrackLang.Modify_Thumb,width:480,height:240,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mlink_id",type:"hidden",name:"link_id",valid:1,value:d.link_id},{case:101,id:"Mmode",type:"hidden",name:"mode",valid:1,value:d.mode},{case:101,id:"Mmodule_id",type:"hidden",name:"module_id",valid:1,value:d.module_id}],items:[{case:11,id:"Mmedia_queue",type:"text",lang:StrackLang.Media_Attachment,name:"media_queue",valid:0,value:""}],footer:[{obj:"choice_media",type:6,title:""},{obj:"upload_item_thumb",type:5,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){$("#choice_media").uploadifive({auto:!1,formData:{timestamp:Strack.current_time(),token:i.token,size:"250×140"},multi:!1,queueSizeLimit:1,queueID:"queue",uploadScript:i.upload_url,onUpload:function(t){0==t?layer.msg(StrackLang.Please_Select_File,{icon:2,time:1200,anim:6}):$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},onUploadComplete:function(t,e){var a=JSON.parse(e);200===parseInt(a.status)?(Strack.save_media_data({link_id:d.link_id,mode:d.mode,module_id:d.module_id,media_server:i,media_data:a.data},function(t){$.messager.progress("close"),Strack.dialog_cancel()}),r&&r(e)):layer.msg(a.message,{icon:7,time:1200,anim:6})}})}})})},upload_item_thumb:function(){0<$(".uploadifive-queue-item").length?$("#choice_media").uploadifive("upload"):layer.msg(StrackLang.Please_Select_File,{icon:2,time:1200,anim:6})},clear_item_thumb:function(t){var e=$(t).closest(".thumb-menu-bnt"),a=e.attr("data-linkid"),i=e.attr("data-moduleid");Strack.submit_clear_item_thumb({link_id:a,module_id:i,mode:"single"})},submit_clear_item_thumb:function(t){$.ajax({type:"POST",url:StrackPHP.clearMediaThumbnail,dataType:"json",data:t,beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message})):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},grid_change_item_thumb:function(t){var e=$(t).data("grid"),a=$(t).data("moduleid"),i=$("#"+e).datagrid("getSelections");if(0<i.length){var d=[];i.forEach(function(t){d.push(t.id)}),Strack.open_change_item_media({link_id:d.join(","),module_id:a,mode:"batch"})}else layer.msg(StrackLang.Please_Select_Grid_One,{icon:2,time:1200,anim:6})},grid_clear_item_thumb:function(t){var e=$(t).data("grid"),a=$(t).data("moduleid"),i=$("#"+e).datagrid("getSelections");if(0<i.length){var d=[];i.forEach(function(t){d.push(t.id)}),Strack.submit_clear_item_thumb({link_id:d.join(","),module_id:a,mode:"batch"})}else layer.msg(StrackLang.Please_Select_Grid_One,{icon:2,time:1200,anim:6})},toggle_media_menu:function(t,e){var a=$(".st-menu-left"),i=$(".st-menu-right"),d=$(t).data("page"),r="";if(e)switch(r=e){case"show":a.css({width:"240px"}),i.css({left:"241px"}),a.removeClass("st-m-hide");break;case"hide":a.css({width:"60px"}),i.css({left:"61px"}),a.addClass("st-m-hide")}else a.hasClass("st-m-hide")?(r="show",a.css({width:"240px"}),i.css({left:"241px"}),a.removeClass("st-m-hide")):(r="hide",a.css({width:"60px"}),i.css({left:"61px"}),a.addClass("st-m-hide"));Strack.save_storage(d,r)},toggle_filter:function(t){var e=$(t).attr("data-maindom"),a=$(t).attr("data-bardom");Strack.do_toggle_filter(t,a,e)},apply_toggle_filter:function(t,e){var a=$("#"+e).find(".search-filter-button");Strack.do_toggle_filter(a[0],t,e)},do_toggle_filter:function(t,e,a){var i=$("#"+e),d=$("#"+a);0<$(t).find(".icon-uniF141").length?($(t).html('<i class="icon-uniF142"></i>'),i.removeClass("filter-full-active").addClass("filter-full-hide").css({width:0}),d.css("width","100%")):($(t).html('<i class="icon-uniF141"></i>'),i.removeClass("filter-full-hide").addClass("filter-full-active"),i.hasClass("filter-min")?(d.css("width","calc(100% - 200px)"),i.css({width:200})):(d.css("width","calc(100% - 380px)"),i.css({width:380})))},toggle_filter_field:function(t){var e=$(t).attr("data-bardom"),a=$(t).offset();$("#search_list_"+e).css({top:a.top+30,left:a.left}).show()},toggle_filter_main:function(t){var e=$(t).closest(".datagrid-filter"),a=e.attr("data-maindom"),i=e.attr("data-bardom"),d=$("#"+i),r=$("#"+a),o=d.find(".filter-label-list");0<$(t).find(".icon-uniE94E").length?($(t).html('<i class="icon-uniE957"></i>'),d.removeClass("filter-min").css({width:380}),o.addClass("filter-lable-hide"),r.css("width","calc(100% - 380px)")):($(t).html('<i class="icon-uniE94E"></i>'),d.addClass("filter-min").css({width:200}),o.removeClass("filter-lable-hide"),r.css("width","calc(100% - 200px)"))},show_filter_filter:function(t){$(t).closest(".grid-filter-right").find(".filter-task-list").toggle()},toggle_filter_item:function(t){var e=$(t),a=e.closest(".grid-filter-right"),i=e.attr("from"),d={field:e.attr("field"),project_id:e.attr("project_id"),field_type:e.attr("field_type"),variable_id:e.attr("variable_id"),module:e.attr("module_code"),editor:e.attr("editor"),lang:e.attr("lang"),table:e.attr("table"),belong:e.attr("belong"),value_show:e.attr("value_show"),flg_module:e.attr("flg_module"),frozen_module:e.attr("frozen_module")};switch(i){case"bar":if(e.hasClass("item-active")){var r=e.closest(".grid-filter-right");Strack.destroy_filter_item(r,d.field,d.module)}else{e.addClass("item-active").find("i").removeClass("icon-unchecked").addClass("icon-checked"),Strack.filter_item_base(a,d);var o=a.find(".no-filter-task");0<o.length&&o.remove()}break;case"search":var n=e.closest(".filter-task-list"),s=n.attr("data-maindom");if(e.hasClass("item-active")){e.removeClass("item-active").find("i").removeClass("icon-checked").addClass("icon-unchecked");var l=!0;n.find(".field-item").each(function(){$(this).find("i").hasClass("icon-checked")&&(l=!1)}),l&&$("#"+s).find(".search-filter-field").removeClass("search-bar-active")}else e.addClass("item-active").find("i").removeClass("icon-unchecked").addClass("icon-checked"),$("#"+s).find(".search-filter-field").addClass("search-bar-active")}},clear_searchbox:function(t,e){$("#"+t).find("#grid_search").searchbox("clear"),$("#search_list_"+e).find(".field-item").each(function(){$(this).find("i").hasClass("icon-checked")&&Strack.toggle_filter_item(this)})},delete_filter_item:function(t){var e=$(t),a=e.closest(".filter-items").attr("field"),i=e.closest(".filter-items").attr("module"),d=e.closest(".grid-filter-right");Strack.destroy_filter_item(d,a,i)},destroy_filter_item:function(t,e,a){$("#fitem_"+a+"_"+e).remove(),t.find(".filter-task-list .item-active").each(function(){$(this).attr("field")==e&&$(this).attr("module")==a&&$(this).removeClass("item-active").find("i").removeClass("icon-checked").addClass("icon-unchecked")}),0==t.find(".filter-items").length&&t.find(".filter-task-panel").html('<div class="no-filter-task">'+StrackLang.No_Filter_Item+"</div>")},filter_item_delete:function(t){var e=$(t).attr("filter_id"),a=$(t).closest(".datagrid-filter"),i=(a.attr("data-bardom"),a.attr("data-maindom"));if(e){var d=$("#"+i).find(".datagrid-table");$.ajax({type:"POST",url:StrackPHP.deleteFilter,dataType:"json",data:{id:e},beforeSend:function(){d.datagrid("loading")},success:function(t){Strack.top_message({bg:"g",msg:t.message}),d.datagrid("loaded").datagrid("reloadFilterTags")}})}},filter_item_stick:function(t){var e=$(t).attr("filter_id"),a="yes"==$(t).attr("stick")?"no":"yes",i=$(t).closest(".datagrid-filter"),d=(i.attr("data-bardom"),i.attr("data-maindom"));if(e){var r=$("#"+d).find(".datagrid-table");$.ajax({type:"POST",url:StrackPHP.stickFilter,dataType:"json",data:{filter_id:e,stick:a},beforeSend:function(){r.datagrid("loading")},success:function(t){Strack.top_message({bg:"g",msg:t.message}),r.datagrid("loaded").datagrid("reloadFilterTags")}})}},save_filter_condition:function(t){var e=$(t).closest(".datagrid-filter").find(".unsaved-filter-item");if(e.is(":hidden"))layer.msg(StrackLang.No_Filter_Need_Save,{icon:2,time:1200,anim:6});else{var a=e.find(".fbar-save-bnt");Strack.save_active_filter(a[0])}},save_active_filter:function(t){var e=$(t).closest(".datagrid-filter"),a=e.attr("data-bardom"),i=e.attr("data-maindom"),d=e.attr("data-page"),r=e.attr("data-projectid"),o=e.attr("data-moduletype"),n=e.attr("data-modulecode"),s=($("#"+a).find(".unsaved-filter-item").attr("data-from"),$("#"+i).find(".datagrid-table")),l=$(s).datagrid("options"),c=JSON.parse(l.queryParams.filter_data);c&&Strack.open_dialog("dialog",{title:StrackLang.Save_Filter,width:480,height:360,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mproject_id",type:"hidden",name:"project_id",valid:1,value:r},{case:101,id:"Mpage",type:"hidden",name:"page",valid:1,value:d},{case:101,id:"Mmodule_type",type:"hidden",name:"module_type",valid:1,value:o},{case:101,id:"Mmodule_code",type:"hidden",name:"module_code",valid:1,value:n},{case:101,id:"Mfilter",type:"hidden",name:"filter",valid:1,value:""},{case:101,id:"Mgrid",type:"hidden",name:"grid",valid:1,value:s.attr("id")}],items:[{case:1,id:"Mfilter_name",type:"text",lang:StrackLang.Name,name:"name",valid:"1,64",value:""},{case:2,id:"Mfilter_color",lang:StrackLang.Color,name:"color",valid:"1",value:""},{case:2,id:"Mfilter_stick",lang:StrackLang.Stick,name:"stick",valid:"1"},{case:2,id:"Mfilter_public",lang:StrackLang.Public,name:"public",valid:"1"}],footer:[{obj:"do_save_active_filter",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){$("#Mfilter").val(JSON.stringify(c)),Strack.combobox_widget("#Mfilter_color",{url:StrackPHP.getFilterColorList,valueField:"id",textField:"name",value:"grey",formatter:function(t){return'<div class="combo-icons-warp" style="overflow: hidden"><div class="ui '+t.id+' label filter-tag-label"></div><div class="combo-name">'+t.name+"</div></div>"}}),Strack.combobox_widget("#Mfilter_stick",{url:StrackPHP.getStickType,valueField:"id",textField:"name",value:"no"}),Strack.combobox_widget("#Mfilter_public",{url:StrackPHP.getStickType,valueField:"id",textField:"name",value:"yes"})}})},do_save_active_filter:function(){var t=$("#Mgrid").val(),e=$("#"+t);Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",StrackPHP.saveFilter,{back:function(t){Strack.top_message({bg:"g",msg:t.message}),e.datagrid("reloadFilterTags",t.data),e.datagrid("highlightViewSave"),Strack.dialog_cancel()}})},delete_unsave_filter:function(t){if($(t).closest(".filter-tag-item").hasClass("filter-tag-ac"))Strack.reset_filter_default(t);else{var e=$(t).closest(".datagrid-filter").attr("data-bardom");$("#"+e).find(".unsaved-filter-item").hide()}},reset_filter_default:function(t){var e=$(t).closest(".datagrid-filter"),a=e.attr("data-bardom"),i=e.attr("data-maindom");Strack.do_reset_filter(i,a,!0)},do_reset_filter:function(t,e,a){if(a){var i=$("#"+t).find(".datagrid-table"),d=$(i);d.datagrid("setFilterParams",{filter_input:[],filter_panel:[],filter_advance:[]}).datagrid("reload"),d.datagrid("highlightViewSave")}var r=$("#"+e),o=r.find(".unsaved-filter-item");o.hide(),r.find(".filter-tag-item").removeClass("filter-tag-ac");var n=o.attr("data-from");switch(Strack.clear_filter_cache(e),n){case"filter_input":Strack.clear_searchbox(t,e)}},get_filter_cache:function(t,e){var a=Strack.read_storage("grid_filter_"+t);if(a){var i=JSON.parse(a);return i.from==e?i.data:null}return null},save_filter_cache:function(t,e,a){Strack.save_storage("grid_filter_"+t,JSON.stringify({from:e,data:a}))},clear_filter_cache:function(t){Strack.delete_storage("grid_filter_"+t)},filter_item_base:function(t,e){var a="",i="fitem_"+e.module+"_"+e.field;return a+='<div id="'+i+'" class="filter-items" field="'+e.field+'" field_type="'+e.field_type+'" variable_id="'+e.variable_id+'" editor="'+e.editor+'" module="'+e.module+'" table="'+e.table+'" ><div class="filter-ilabel"><label class="aign-left"><strong>'+e.lang+'</strong><span class="text-faded"> ( '+e.belong+' ) </span></label><a href="javascript:;" class="pfilter-delete aign-right" onclick="Strack.delete_filter_item(this)"><i class="icon-uniE6DB"></i></a></div><div class=\'p-filter-inpt filter-input-wrap\'>'+Strack.filter_item_widget(e.editor,e)+"</div></div>",t.find(".filter-task-panel").append(a),Strack.init_filter_item("#"+i,e.editor,e),Strack.init_filter_event(t),a},init_filter_item:function(t,e,a){switch(e){case"combobox":case"checkbox":var i=$(t).find(".in-combobox")[0];Strack.combobox_widget(i,{url:StrackPHP.getWidgetData,valueField:"id",textField:"name",width:279,height:28,queryParams:{type:e,fields:a.value_show,field_type:a.field_type,variable_id:a.variable_id,project_id:a.project_id,module:a.module,primary:a.primary,flg_module:a.flg_module,frozen_module:a.frozen_module},formatter:function(t){switch(a.fields){case"assignee":case"created_by":return Strack.build_comb_avatar(t);default:return t.name}},onLoadSuccess:function(){},onChange:function(t,e){Strack.filter_auto(this)}});break;case"text":case"textarea":var d=$(t).find(".term-list")[0];Strack.combobox_widget(d,{data:Strack.filter_express(["EQ","NEQ","LIKE","NOTLIKE"]),valueField:"id",textField:"name",height:28,onChange:function(t,e){$(this).data("ptype"),$(this).data("filter");Strack.filter_auto(this)}});break;case"datebox":case"datetimebox":var r=$(t).find(".in-date-term"),o=$(t).find(".in-date-range"),n=$(t).find(".data-input-wrap");r.on("click",function(){o.attr("checked",!1),r.is(":checked")?(n.empty().append(Strack.filter_item_widget("date_term",a)),Strack.init_filter_item(n,"date_term",a)):n.empty()}),o.on("click",function(){r.attr("checked",!1),o.is(":checked")?(n.empty().append(Strack.filter_item_widget("date_range",a)),Strack.init_filter_item(n,"date_range",a)):n.empty()});break;case"date_term":var s=t.find(".term-list"),l=t.find(".term-date");Strack.combobox_widget(s[0],{data:Strack.filter_express(["EQ","NEQ","GT","EGT","LT","ELT"]),valueField:"id",textField:"name",height:28,onChange:function(t,e){$(this).data("ptype"),$(this).data("filter");Strack.filter_auto(this)}}),Strack.filter_date_box(l[0],"",28,"",!1,8);break;case"date_range":var c=t.find(".start-date"),_=t.find(".end-date");Strack.filter_date_box(c[0],"",28,"",!1,8),Strack.filter_date_box(_[0],"",28,"",!1,8)}},filter_express:function(t){var e=[];return t.forEach(function(t){e.push(Strack.express_item(t))}),e},express_item:function(t){switch(t){case"EQ":return{id:"EQ",name:StrackLang.Exp_EQ};case"NEQ":return{id:"NEQ",name:StrackLang.Exp_NEQ};case"GT":return{id:"GT",name:StrackLang.Exp_GT};case"EGT":return{id:"EGT",name:StrackLang.Exp_EGT};case"LT":return{id:"LT",name:StrackLang.Exp_LT};case"ELT":return{id:"ELT",name:StrackLang.Exp_ELT};case"LIKE":return{id:"LIKE",name:StrackLang.Exp_LIKE};case"NOTLIKE":return{id:"NOTLIKE",name:StrackLang.Exp_NOTLIKE};case"BETWEEN":return{id:"BETWEEN",name:StrackLang.Exp_BETWEEN};case"NOT BETWEEN":return{id:"NOT BETWEEN",name:StrackLang.Exp_NOT_BETWEEN};case"IN":return{id:"IN",name:StrackLang.Exp_IN};case"NOT IN":return{id:"NOT IN",name:StrackLang.Exp_NOT_IN}}},filter_item_widget:function(t,e){var a="";switch(t){case"combobox":case"checkbox":a+='<input class="in-combobox" />';break;case"text":case"textarea":a+='<div  class="pf-widget-term aign-left"><input class="term-list" /></div><div  class="pf-widget-input aign-left"><input class="input-text" type="text" /></div>';break;case"datebox":case"datetimebox":a='<div class=\'pf-widget-date\'><div class="widget-date-item"><div class="aign-left"><input type="checkbox" class="in-date-term"></div><div class="widget-date-name aign-left">'+StrackLang.Date+'</div></div><div class="widget-date-item"><div class="aign-left"><input type="checkbox" class="in-date-range"></div><div class="widget-date-name aign-left">'+StrackLang.Date_Range+'</div></div><div class="p-filter-inpt data-input-wrap"></div></div>';break;case"date_term":a='<div class="pf-widget-term aign-left"><input class="term-list"></div><div class="pf-widget-input aign-left"><input class="term-date"></div>';break;case"date_range":a='<div class="pf-widget-even aign-left interval-right-10"><input class="start-date"></div><div class="pf-widget-even aign-left"><input class="end-date"></div>'}return a},stick_filter_bar:function(t){var e=$(t).closest(".datagrid-filter").attr("data-page"),a=$(t).find("span"),i="";i=$(t).hasClass("stick-on")?(a.html(StrackLang.Keep_Display),$(t).removeClass("stick-on"),"no"):(a.html(StrackLang.Cancel_Keep),$(t).addClass("stick-on"),"yes"),$.ajax({type:"POST",url:StrackPHP.saveUserFilterKeepConfig,data:{stick:i,page:e},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),Strack.top_message({bg:"g",msg:t.message})}})},get_logic_list:function(){return[{id:"and",name:"and"},{id:"or",name:"or"}]},open_advance_filter:function(t){var e=$(t).closest(".datagrid-filter"),a=e.attr("data-moduleid"),i=e.attr("data-maindom"),d=e.attr("data-bardom"),r=e.attr("data-projectid"),o=e.attr("data-page");Strack.dialog_cancel(),Strack.open_dialog("dialog",{title:StrackLang.Advanced_Filter,width:620,height:440,content:Strack.dialog_dom({type:"adv_filter",hidden:[{case:101,id:"Fmodule_id",type:"hidden",name:"module_id",valid:1,value:a},{case:101,id:"Fpage",type:"hidden",name:"page",valid:1,value:o},{case:101,id:"Fmaindom",type:"hidden",name:"maindom",valid:1,value:i},{case:101,id:"Fbardom",type:"hidden",name:"maindom",valid:1,value:d},{case:101,id:"Fproject_id",type:"hidden",name:"project_id",valid:1,value:r}],footer:[{obj:"do_advance_filter",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.combobox_widget("#logic_comb",{data:Strack.get_logic_list(),valueField:"id",textField:"name",width:70,height:26,value:"and"}),Strack.init_advance_filter(d)}})},init_advance_filter:function(t){var a=Strack.get_filter_cache(t,"filter_advance"),i=["logic","multiple","number"];if(a)if(1<parseInt(a.number)){var d="";Strack.init_advance_group(a.number,"multiple"),$(".dgcb-query-group").each(function(t){for(var e in a[t])$.inArray(e,i)<0&&Strack.init_advance_item(this,a[t][e],"multiple");d=$(this).find(".advh_logic").attr("id"),$("#"+d).combobox("setValue",a[t].logic)}),$("#logic_comb").combobox("setValue",a.logic)}else Strack.init_advance_group(a.number,"single"),$(".dgcb-query-group").each(function(){for(var t in a)$.inArray(t,i)<0&&Strack.init_advance_item(this,a[t],"single")}),$("#logic_comb").combobox("setValue",a.logic)},init_advance_group:function(t){for(var e=0;e<t;e++)Strack.add_filter_group("")},init_advance_item:function(t,e,a){var i="group_"+Math.floor(1e3*Math.random()+1),d=$(t).closest(".dgcb-query-group"),r=$("#Fpage").val(),o=$("#Fproject_id").val(),n=$("#Fmodule_id").val(),s=null;switch(e.editor){case"text":case"textarea":s=["EQ","NEQ","LIKE","NOTLIKE"];break;case"combobox":case"checkbox":s=["EQ","IN","NOT IN"];break;case"datebox":case"datetimebox":s=["EQ","NEQ","GT","EGT","LT","ELT","BETWEEN"]}switch(d.find(".dgcb-query-cond").append(Strack.adv_filter_group_dom(i)),$("#condth_"+i).attr("data-field",e.field).attr("data-fieldtype",e.field_type).attr("data-variableid",e.variable_id).attr("data-editor",e.editor).attr("data-module",e.module_code).attr("data-moduletype",e.module_type).attr("data-multiple",a).attr("data-table",e.table),Strack.combobox_widget("#Fds_"+i,{url:StrackPHP.getAdvanceFilterFields,valueField:"id",textField:"lang",width:120,height:25,value:StrackLang[e.table]+"."+e.field,groupField:"belong",queryParams:{module_id:n,page:r,project_id:o},onSelect:function(t){var e=$(this).closest(".dgcb-cond-item"),a=e.find(".cond_lgoic").attr("id"),i=e.find(".cond-entity-in"),d=e.find(".cond_value").attr("id");e.attr("data-field",t.fields).attr("data-fieldtype",t.field_type).attr("data-variableid",t.variable_id).attr("data-editor",t.editor).attr("data-module",t.module).attr("data-moduletype",t.module_type).attr("data-valueshow",t.value_show).attr("data-multiple","single").attr("data-table",t.table),Strack.init_adv_filter_cond(a,d,i,t)}}),Strack.combobox_widget("#Fls_"+i,{data:Strack.filter_express(s),valueField:"id",textField:"name",width:120,height:25,value:e.condition,onSelect:function(t){var e="date_"+Math.floor(1e3*Math.random()+1),a=$(this).closest(".dgcb-cond-item"),i=a.attr("data-editor"),d=a.find(".cond-entity-in"),r=a.find(".cond_value").attr("id"),o="";switch(t.id){case"IN":case"NOT IN":$("#"+r).combobox("setOptions",{multiple:!0,value:""}).combobox("reload"),a.attr("data-multiple","multiple");break;case"BETWEEN":o='<input id="'+r+'" class="cond_value" style="width: 180px;display: none"><div class="cond-v-start aign-left"><input id="Fdis_'+e+'" class="condv_sdate cond_v_date" style="width: 90px;"></div><div class="cond-v-end aign-left"><input id="Fdie_'+e+'" class="condv_edate cond_v_date" style="width: 90px;"></div>',d.empty().append(o),Strack.filter_date_box("#Fdis_"+e,"",25,"",!1,8),Strack.filter_date_box("#Fdie_"+e,"",25,"",!1,8);break;default:switch(i){case"combobox":$("#"+r).combobox("setOptions",{multiple:!1,value:""}).combobox("reload"),a.attr("data-multiple","single");break;case"datebox":case"datetimebox":d.empty().append('<input id="'+r+'" class="cond_value" style="width: 180px">'),Strack.filter_date_box("#"+r,"",25,"",!1,8)}}}}),e.editor){case"text":case"textarea":$("#Fvs_"+i).val(e.value);break;case"combobox":case"checkbox":var l="",c=!1;l="EQ"===e.condition?e.value:(c=!0,e.value.split(",")),Strack.combobox_widget("#Fvs_"+i,{url:StrackPHP.getWidgetData,valueField:"id",textField:"name",height:25,value:l,queryParams:{primary:0,project_id:o,module:e.remote,module_type:e.module_type,field_type:e.field_type,variable_id:e.variable_id,fields:e.value_show},multiple:c});break;case"datebox":case"datetimebox":if("BETWEEN"===e.condition){var _,m="date_"+Math.floor(1e3*Math.random()+1),u=e.value.split(",");_='<input id="Fvs_'+i+'" class="cond_value" style="width: 180px;display: none"><div class="cond-v-start aign-left"><input id="Fdis_'+m+'" class="condv_sdate cond_v_date" style="width: 90px;"></div><div class="cond-v-end aign-left"><input id="Fdie_'+m+'" class="condv_edate cond_v_date" style="width: 90px;"></div>',$("#condth_"+i).find(".cond-entity-in").empty().append(_),Strack.filter_date_box("#Fdis_"+m,"",25,u[0],!1,8),Strack.filter_date_box("#Fdie_"+m,"",25,u[1],!1,8)}else Strack.filter_date_box("#Fvs_"+i,"",25,e.value,!1,8)}},do_advance_filter:function(){var t=$("#Fmaindom").val(),e=$("#Fbardom").val(),a=Strack.scan_advance_filter(),i=$("#"+t).find(".datagrid-table");$.isEmptyObject(a.adv_filter)||($(i).datagrid("setFilterParams",{filter_input:[],filter_panel:[],filter_advance:a.adv_filter}).datagrid("reload"),Strack.save_filter_cache(e,"filter_advance",a.adv_filter),Strack.show_nosaved_filter(e,"filter_advance",StrackLang.Advanced_Filter),Strack.dialog_cancel())},show_nosaved_filter:function(t,e,a){var i=$("#"+t),d=i.find(".unsaved-filter-item");i.find(".exist-filter-item .filter-tag-item").removeClass("filter-tag-ac"),d.find(".filter-tag-item").addClass("filter-tag-ac"),d.attr("data-from",e).find(".filter-tag-name").html(a),d.show()},scan_advance_filter:function(t){var e=$("#dg_adv_filter").find(".dgcb-query-group"),a=$(".dgcb-query-group").length,o={},i="",n=0,s=!0;switch(e.length){case 0:20!=t&&layer.msg(StrackLang.Advanced_Filter_Group_Null,{icon:2,time:1200,anim:6});break;case 1:(i=Strack.get_combos_val("#logic_comb","combobox","getValue"))?(e.each(function(){var t=$(this).find(".dgcb-cond-item"),e=null,a=0;t.each(function(){if(!(e=Strack.get_adv_fd_item(this)))return o={},layer.msg(StrackLang.Advanced_Filter_Full_Null,{icon:2,time:1200,anim:6}),s=!1;o[a]=e,a++})}),$.isEmptyObject(o)||(o.logic=i,o.number=a)):(layer.msg(StrackLang.Advanced_Filter_Logic_Null,{icon:2,time:1200,anim:6}),s=!1);break;default:(i=Strack.get_combos_val("#logic_comb","combobox","getValue"))?(e.each(function(){var t=$(this).find(".dgcb-cond-item"),e=null,a={},i=0,d=$(this).find(".advh_logic").attr("id"),r=Strack.get_combos_val("#"+d,"combobox","getValue");if(t.each(function(){if(!(e=Strack.get_adv_fd_item(this)))return!(a={});a[i]=e,i++}),$.isEmptyObject(a))return o={},layer.msg(StrackLang.Advanced_Filter_Full_Null,{icon:2,time:1200,anim:6}),s=!1;a.logic=r,o[n]=a,n++}),$.isEmptyObject(o)||(o.logic=i,o.number=a)):(layer.msg(StrackLang.Advanced_Filter_Logic_Null,{icon:2,time:1200,anim:6}),s=!1)}return{adv_filter:o,go_on:s,item_num:a}},get_adv_fd_item:function(t){var e=$(t).attr("data-editor"),a=$(t).attr("data-field"),i=$(t).attr("data-fieldtype"),d=$(t).attr("data-module"),r="built_in"==$(t).attr("data-fieldtype")?0:$(t).attr("data-variableid"),o=$(t).attr("data-valueshow"),n=$(t).attr("data-multiple"),s=$(t).attr("data-table"),l=$(t).find(".cond_field").attr("id"),c=$(t).find(".cond_lgoic").attr("id"),_=$(t).find(".cond_value").attr("id"),m="",u=Strack.get_combos_val("#"+l,"combobox","getValue"),g=Strack.get_combos_val("#"+c,"combobox","getValue");if(e){switch(e){case"combobox":case"checkbox":switch(n){case"single":m=Strack.get_combos_val("#"+_,"combobox","getValue");break;case"multiple":m=Strack.get_combos_val("#"+_,"combobox","getValues").join(",")}break;case"text":m=$(t).find(".cond_value").val();break;case"datebox":case"datetimebox":switch(g){case"BETWEEN":var p,f,v=$(t).find(".condv_sdate").attr("id"),h=$(t).find(".condv_edate").attr("id"),k=[];p=$("#"+v).datebox("getValue"),f=$("#"+h).datebox("getValue"),m=p&&f?(k.push(p),k.push(f),k.join(",")):"";break;default:m=$("#"+_).datebox("getValue")}}return u&&g&&m?($(t).find(".cond-entity-en").empty().append(Strack.dialog_error_icon("t")),{field:a,field_type:i,variable_id:r,module_code:d,value_show:o,table:s,condition:g,value:m,editor:e,multiple:n}):($(t).find(".cond-entity-en").empty().append(Strack.dialog_error_icon("e")),!1)}return $(t).find(".cond-entity-en").empty().append(Strack.dialog_error_icon("e")),!1},add_filter_group:function(t){var e="group_"+Math.floor(1e3*Math.random()+1);$("#dg_adv_filter").append(Strack.filter_group_dom(e,"display-hide")),Strack.combobox_widget("#"+e,{data:Strack.get_logic_list(),valueField:"id",textField:"name",width:70,height:26,value:"and"}),Strack.toggle_filter_group()},filter_group_dom:function(t,e){var a="";return a+='<div class="dgcb-query-group"><div class="dgcb-query-hd"><div class="dgcb-item-log aign-left '+e+'"><div class="query-all-name aign-left">'+StrackLang.ConditionalLogic+'</div><div class="query-all-input aign-left"><input id="'+t+'" class="advh_logic" style="width: 53px;"></div></div><div class="dgcb-item-btn aign-left"><a href="javascript:;" onclick="Strack.add_adv_filter_item(this)" class="query-all-btn aign-left"><i class="icon-uniEA33"></i>'+StrackLang.AddFilterItem+'</a></div><div class="dgcb-item-btn aign-right"><a href="javascript:;" onclick="Strack.delete_filter_group(this)" class="query-all-btn aign-left"><i class="icon-uniE6DB"></i></a></div></div><div class="dgcb-query-cond"></div></div>'},adv_filter_group_dom:function(t){var e="";return e+='<div id="condth_'+t+'" class="dgcb-cond-item"><div class="cond-entity-fd aign-left"><input id="Fds_'+t+'" class="cond_field" style="width: 120px;"></div><div class="cond-entity-lg aign-left"><input id="Fls_'+t+'" class="cond_lgoic" style="width: 120px;"></div><div class="cond-entity-in aign-left"><input id="Fvs_'+t+'" class="cond_value" style="width: 180px;" ></div><a href="javascript:;" onclick="Strack.delete_filter_cond(this)" class="cond-entity-de aign-left"><i class="icon-uniEA34"></i></a><div class="cond-entity-en aign-left"></div></div>'},add_adv_filter_item:function(t){var e="group_"+Math.floor(1e3*Math.random()+1),a=$(t).closest(".dgcb-query-group"),i=$("#Fmodule_id").val(),d=($("#Fmodule_code").val(),$("#Fproject_id").val()),r=$("#Fpage").val();a.find(".dgcb-query-cond").append(Strack.adv_filter_group_dom(e)),Strack.combobox_widget("#Fds_"+e,{url:StrackPHP.getAdvanceFilterFields,valueField:"id",textField:"lang",width:120,height:25,groupField:"belong",queryParams:{module_id:i,project_id:d,page:r},onSelect:function(t){var e=$(this).closest(".dgcb-cond-item"),a=e.find(".cond_lgoic").attr("id"),i=e.find(".cond-entity-in"),d=e.find(".cond_value").attr("id");e.attr("data-field",t.fields).attr("data-fieldtype",t.field_type).attr("data-variableid",t.variable_id).attr("data-editor",t.editor).attr("data-module",t.module_alias).attr("data-moduletype",t.module_type).attr("data-remote",t.remote).attr("data-valueshow",t.value_show).attr("data-multiple","single").attr("data-table",t.table),Strack.init_adv_filter_cond(a,d,i,t)}}),Strack.combobox_widget("#Fls_"+e,{data:Strack.filter_express(["EQ","NEQ","GT","EGT","LT","ELT"]),valueField:"id",textField:"name",width:120,height:25,onSelect:function(t){var e="date_"+Math.floor(1e3*Math.random()+1),a=$(this).closest(".dgcb-cond-item"),i=a.attr("data-editor"),d=a.find(".cond-entity-in"),r=a.find(".cond_value").attr("id"),o="";switch(t.id){case"IN":case"NOT IN":$("#"+r).combobox("setOptions",{multiple:!0,value:""}).combobox("reload"),a.attr("data-multiple","multiple");break;case"BETWEEN":o='<input id="'+r+'" class="cond_value" style="width: 180px;display: none"><div class="cond-v-start aign-left"><input id="Fdis_'+e+'" class="condv_sdate cond_v_date" style="width: 90px;"></div><div class="cond-v-end aign-left"><input id="Fdie_'+e+'" class="condv_edate cond_v_date" style="width: 90px;"></div>',d.empty().append(o),Strack.filter_date_box("#Fdis_"+e,"",25,"",!1,8),Strack.filter_date_box("#Fdie_"+e,"",25,"",!1,8);break;default:switch(i){case"combobox":$("#"+r).combobox("setOptions",{multiple:!1,value:""}).combobox("reload"),a.attr("data-multiple","single");break;case"datebox":case"datetimebox":d.empty().append('<input id="'+r+'" class="cond_value" style="width: 180px">'),Strack.filter_date_box("#"+r,"",25,"",!1,8)}}}})},init_adv_filter_cond:function(t,e,a,i){var d=null,r=$("#Fproject_id").val();switch(a.empty().append('<input id="'+e+'" class="cond_value" style="width: 180px;" >'),i.editor){case"text":case"textarea":d=["EQ","NEQ","LIKE","NOTLIKE"];break;case"combobox":case"checkbox":d=["EQ","IN","NOT IN"],Strack.combobox_widget("#"+e,{url:StrackPHP.getWidgetData,valueField:"id",textField:"name",height:25,queryParams:{primary:0,project_id:r,module:i.remote,module_type:i.module_type,field_type:i.field_type,fields:i.value_show,variable_id:i.variable_id}});break;case"datebox":case"datetimebox":d=["EQ","NEQ","GT","EGT","LT","ELT","BETWEEN"],Strack.filter_date_box("#"+e,"",25,"",!1,8)}$("#"+t).combobox("loadData",Strack.filter_express(d)).combobox("setValue","EQ")},delete_filter_cond:function(t){$(t).closest(".dgcb-cond-item").remove()},delete_filter_group:function(t){$(t).closest(".dgcb-query-group").remove(),Strack.toggle_filter_group()},toggle_filter_group:function(){var t=$("#dg_adv_filter").find(".dgcb-query-group"),e=$(".dgcb-item-log");1<t.length?e.removeClass("display-hide"):e.addClass("display-hide")},toggle_ac_filter:function(t){var e=$(t).attr("filter_type"),a=$(t).attr("filter_id"),i=$(t).closest(".datagrid-filter"),d=i.attr("data-maindom"),r=i.attr("data-bardom"),o=$("#"+d).find(".datagrid-table");if(i.find(".filter-tag-item").removeClass("filter-tag-ac"),$(t).closest(".filter-tag-item").addClass("filter-tag-ac"),"exist"==e)$.ajax({type:"POST",url:StrackPHP.getFilterSingle,data:{filter_id:a},dataType:"json",success:function(t){var e=o.datagrid("options"),a=JSON.parse(e.queryParams.filter_data);a.filter.filter_advance=t.filter.filter_advance,a.filter.filter_input=t.filter.filter_input,a.filter.filter_panel=t.filter.filter_panel,a.filter.request=t.filter.request,e.queryParams.filter_data=JSON.stringify(a),o.datagrid("setOptions",{queryParams:e.queryParams}).datagrid("reload"),o.datagrid("highlightViewSave")}});else{var n=$(t).closest(".unsaved-filter-item").attr("data-from"),s=o.datagrid("options"),l=JSON.parse(s.queryParams.filter_data);l[n]=Strack.get_filter_cache(r,n),s.queryParams.filter_data=JSON.stringify(l),o.datagrid("setOptions",{queryParams:s.queryParams.filter_data}).datagrid("reload")}},click_down_item:function(t){var e=$(t),a=(e.attr("panel"),e.attr("belong")),i=e.attr("from"),d={field:e.attr("field"),field_type:e.attr("field_type"),module_code:e.attr("module"),module_type:e.attr("module_type"),table:e.attr("table"),value_show:e.attr("value_show"),editor:e.attr("editor"),lang:e.attr("lang"),sort:e.attr("field_sort"),edit:e.attr("field_edit"),belong:a,width:e.attr("field_width")},r=$(t).closest(".entity-datalist").find(".datagrid-table");r.datagrid("highlightViewSave");var o=Strack.toggle_item_icon(t,i);switch(i){case"show":o?r.datagrid("addQueryFields",d).datagrid("reload"):r.datagrid("cutQueryFields",d).datagrid("reload");break;case"group":if(o){var n=r.datagrid("options").columnsFieldConfig,s=Strack.generate_grid_group_data(d.value_show,d.module_code,n);r.datagrid("setOptions",{groupActive:!0,groupField:d.value_show,groupFormatter:function(t,e){return'<span class="">'+t+"( "+e.length+" )</span>"}}).datagrid("setFilterParams",{group:s}).datagrid("reload")}else r.datagrid("setOptions",{groupActive:!1}).datagrid("setFilterParams",{group:""}).datagrid("reload");break;case"sort":var l,c={};c[l=d.module_code+"_"+d.value_show]="asc",o?Strack.sort_grid_icon(r,[l],c,"single"):Strack.sort_grid_icon(r,[],{},"single");break;case"view":var _=$(t).closest(".grid-toolbar"),m=$(t).attr("view_id"),u=_.attr("data-page"),g=_.attr("data-projectid");Strack.toggle_view(m,u,g)}},toggle_item_icon:function(t,e){var a=$(t).find("i"),i=!1;if(a.hasClass("icon-unchecked")){switch(e){case"group":$(t).closest(".grid_group").find(".group-field i").removeClass("icon-checked").addClass("icon-unchecked"),a.removeClass("icon-unchecked").addClass("icon-checked");break;case"sort":break;case"view":$(t).closest(".grid-toolbar").find(".view-g-item i").removeClass("icon-checked").addClass("icon-unchecked"),a.removeClass("icon-unchecked").addClass("icon-checked");break;case"project_status":case"project_time":var d=$(t).attr("options"),r=$(t).closest("."+e);"all"===d||"project_time"===e?r.find(".view-g-item i").removeClass("icon-checked").addClass("icon-unchecked"):$(r.find(".view-g-item i")[0]).removeClass("icon-checked").addClass("icon-unchecked"),a.removeClass("icon-unchecked").addClass("icon-checked");break;default:a.removeClass("icon-unchecked").addClass("icon-checked")}i=!0}else switch(e){case"view":break;default:a.removeClass("icon-checked").addClass("icon-unchecked")}return i},generate_grid_group_data:function(t,e,a){var i={};return t.length&&("custom"===a[e+"_"+t].field_type?i[a[e+"_"+t].field_value_map+".value"]="asc":i[a[e+"_"+t].field_map]="asc"),i},delete_group:function(t){$(t).attr("data-panel");$(t).closest(".grid_group").find(".group-field i").removeClass("icon-checked").addClass("icon-unchecked");var e=$(t).closest(".entity-datalist").find(".datagrid-table");e.datagrid("setOptions",{groupActive:!1}).datagrid("setFilterParams",{group:""}).datagrid("reload"),e.datagrid("highlightViewSave")},sort_grid_item:function(t){var e,a=$(t).data("grid"),i=$(t).data("field"),d=$(t).attr("data-sort"),r=$("#"+a),o={};switch(d){case"asc":e="desc";break;case"desc":e="empty";break;default:e="asc"}"empty"!==e&&(o["base_"+i]=e),r.datagrid("highlightViewSave"),Strack.sort_grid_icon(r,["base_"+i],o,"single")},sort_grid_icon:function(t,e,a,i){Strack.init_sort_grid_icon(t,e,a,i);var d=t.closest(".entity-datalist").find(".grid_sort");Strack.init_sort_icon(d,e,a,i),t.datagrid("setOptions",{sortConfig:{sort_type:i,sort_data:a}});var r=t.datagrid("options").columnsFieldConfig,o=Strack.generate_grid_sort_data(e,a,r);t.datagrid("setFilterParams",{sort:o}).datagrid("reload"),t.datagrid("setOptions",{sortData:a}),"advance"==i&&Strack.dialog_cancel()},generate_grid_sort_data:function(t,e,a){var i={};return console.log(a),console.log(t),t.forEach(function(t){console.log(t),"custom"===a[t].field_type?i[a[t].field_value_map+".value"]=e[t]:i[a[t].field_map]=e[t]}),i},init_sort_grid_icon:function(t,e,a,i){var d;t.closest(".datagrid-view").find(".datagrid-sort").each(function(){d=$(this).closest("td").attr("field"),$(this).removeClass("datagrid-sort-desc datagrid-sort-asc").children("a").attr("data-sort",""),0<=$.inArray(d,e)&&("empty"!==a[d]&&$(this).addClass("datagrid-sort-"+a[d]).children("a").attr("data-sort",a[d]),$(this).find("a").attr("data-sort",a[d]))})},init_sort_icon:function(t,e,a,i){var d;Strack.show_sort_down_icon(t,e,a,i),t.find(".sort-field").each(function(){d=$(this).attr("value_show"),0<=$.inArray(d,e)&&"empty"!==a[d]?$(this).find("i").removeClass("icon-unchecked").addClass("icon-checked"):$(this).find("i").removeClass("icon-checked").addClass("icon-unchecked")})},init_show_sort_down_icon:function(t,e,a){var i=[];for(var d in e)i.push(d);i.length&&Strack.show_sort_down_icon(t,i,e,a)},show_sort_down_icon:function(t,e,a,i){var d;t.find(".sort-bnt").each(function(){switch(d=$(this).attr("data-sort")){case"asc":case"desc":d==a[e[0]]&&"single"==i?$(this).removeClass("field-disable"):$(this).addClass("field-disable");break;case"advance":"advance"==i?$(this).removeClass("field-disable"):$(this).addClass("field-disable")}})},dropdown_sort:function(t){var e,a=$(t).attr("data-panel"),i=$(t).attr("data-sort"),d=$(t).closest(".grid_sort"),r="",o="",n={};switch(d.find(".sort-field").each(function(){e=$(this).attr("value_show"),o=$(this).attr("module"),$(this).find("i").hasClass("icon-checked")&&(r=o+"_"+e)}),a){case"list":r&&(n[r]=i,Strack.init_sort_icon(d,[r],n,"single"),obj.do_list_sort([r],n)),Strack.highlight_view_save(t);break;case"grid":var s=$(t).closest(".entity-datalist").find(".datagrid-table");r&&(n[r]=i,Strack.sort_grid_icon(s,[r],n,"single"))}},sort_cancel:function(t){switch($(t).attr("data-panel")){case"list":var e=$(t).closest(".grid_sort");Strack.init_sort_icon(e,[],{},"single"),obj.do_list_sort([],{}),Strack.highlight_view_save(t);break;case"grid":var a=$(t).closest(".entity-datalist").find(".datagrid-table");a.datagrid("setOptions",{sortConfig:{}}),Strack.sort_grid_icon(a,[],{},"single"),a.datagrid("highlightViewSave")}},advance_sort:function(t){var e,a=$(t).attr("data-panel");switch(a){case"list":e=$(t).closest(".list-toolbar"),Strack.highlight_view_save(t);break;case"grid":e=$(t).closest(".grid-toolbar")}var i=e.attr("data-projectid"),d=e.attr("id"),r=e.attr("data-grid"),o=e.attr("data-page"),n=e.attr("data-moduleid");Strack.open_dialog("dialog",{title:StrackLang.Sort_Adv,width:420,height:320,content:Strack.dialog_dom({type:"adv_sort",hidden:[{case:101,id:"Mpanel",type:"hidden",name:"panel",valid:1,value:a},{case:101,id:"Mpanel_id",type:"hidden",name:"panel_id",valid:1,value:d},{case:101,id:"Mgrid",type:"hidden",name:"grid",valid:1,value:r}],footer:[{obj:"do_advance_sort",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.combobox_widget("#sort_first,#sort_second,#sort_third",{url:StrackPHP.getSortFields,valueField:"id",textField:"lang",width:160,height:25,groupField:"belong",queryParams:{project_id:i,page:o,panel:a,module_id:n,field_list_type:["sort"]},onSelect:function(t){var e=$(this).closest(".dgcb-cond-item"),a=e.find(".cond_lgoic").attr("id"),i=e.find(".cond-entity-in"),d=e.find(".cond_value").attr("id");e.attr("data-field",t.fields).attr("data-fieldtype",t.field_type).attr("data-variableid",t.variable_id).attr("data-editor",t.editor).attr("data-module",t.module_alias).attr("data-moduletype",t.module_type).attr("data-remote",t.remote).attr("data-valueshow",t.value_show).attr("data-multiple","single").attr("data-table",t.table),Strack.init_adv_filter_cond(a,d,i,t)}}),Strack.combobox_widget("#sort_first_func,#sort_second_func,#sort_third_func",{url:StrackPHP.getSortList,valueField:"id",textField:"name",width:110,height:25})}})},do_advance_sort:function(){var t=$("#Mgrid").val(),e=$("#Mpanel").val(),a=$("#Mpanel_id").val(),i=$("#"+t),d=Strack.get_combos_val("#sort_first","combobox","getValue"),r=Strack.get_combos_val("#sort_second","combobox","getValue"),o=Strack.get_combos_val("#sort_third","combobox","getValue"),n=Strack.get_combos_val("#sort_first_func","combobox","getValue"),s=Strack.get_combos_val("#sort_second_func","combobox","getValue"),l=Strack.get_combos_val("#sort_third_func","combobox","getValue"),c=$("#sort_first").combobox("getRowValue","id"),_=$("#sort_second").combobox("getRowValue","id"),m=$("#sort_third").combobox("getRowValue","id"),u=[];$("#shang_first,#shang_second,#shang_third").find("i").remove();var g={};if(d&&n)switch($("#shang_first").append(Strack.dialog_error_icon("t")),g[c.module+"_"+c.value_show]=n,u.push(c.module+"_"+c.value_show),c.module,r&&s&&($("#shang_second").append(Strack.dialog_error_icon("t")),g[_.module+"_"+_.value_show]=s,u.push(_.module+"_"+_.value_show)),o&&l&&($("#shang_third").append(Strack.dialog_error_icon("t")),g[m.module+"_"+m.value_show]=l,u.push(m.module+"_"+m.value_show)),e){case"list":var p=$("#"+a).find(".grid_sort");Strack.init_sort_icon(p,u,g,"advance"),obj.do_list_sort(u,g),Strack.dialog_cancel();break;case"grid":Strack.sort_grid_icon(i,u,g,"advance")}else layer.msg(StrackLang.AdvSort_Null,{icon:2,time:1200,anim:6}),$("#shang_first").append(Strack.dialog_error_icon("e"))},save_view:function(t){var e=Strack.select_view_param(t);if(0<e.view_id&&"allow"==e.allow_edit){var a,i=$(t).attr("data-panel");switch(i){case"grid":a=$(t).closest(".grid-toolbar"),$(t).closest(".entity-datalist").find(".datagrid-table").datagrid("delHighlightViewSave");break;case"list":a=$(t).closest(".list-toolbar"),Strack.del_highlight_view_save(t)}var d={panel:i,page:a.attr("data-page"),project_id:a.attr("data-projectid"),maindom:a.attr("data-maindom"),bardom:a.attr("data-bardom")},r=Strack.get_view_data(d);Strack.submit_save_view(e.view_id,r,d)}else Strack.save_as_view(t)},submit_save_view:function(t,e,a){$.ajax({type:"POST",url:StrackPHP.saveView,dataType:"json",data:{id:t,page:a.page,project_id:a.project_id,view_data:JSON.stringify(e)},beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message})}})},select_view_param:function(t){var e;switch($(t).attr("data-panel")){case"grid":e=$(t).closest(".grid-toolbar");break;case"list":e=$(t).closest(".list-toolbar")}var a=e.find(".view-g-item"),i={};return a.each(function(){$(this).find("i").hasClass("icon-checked")&&(i.view_id=parseInt($(this).attr("view_id")),i.allow_edit=$(this).attr("allow_edit"))}),i},save_as_view:function(t){var e,a=$(t).attr("data-panel");switch(a){case"grid":e=$(t).closest(".grid-toolbar");break;case"list":e=$(t).closest(".list-toolbar")}Strack.open_dialog("dialog",{title:StrackLang.Save_View,width:480,height:240,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mpanel",type:"hidden",name:"panel",valid:1,value:a},{case:101,id:"Mpage",type:"hidden",name:"page",valid:1,value:e.attr("data-page")},{case:101,id:"Mproject_id",type:"hidden",name:"project_id",valid:1,value:e.attr("data-projectid")},{case:101,id:"Mmaindom",type:"hidden",name:"maindom",valid:1,value:e.attr("data-maindom")},{case:101,id:"Mbardom",type:"hidden",name:"bardom",valid:1,value:e.attr("data-bardom")}],items:[{case:1,id:"Mview_name",type:"text",lang:StrackLang.Name,name:"name",valid:"1,128",value:""},{case:2,id:"Mview_public",lang:StrackLang.Public,name:"public",valid:"1",value:""}],footer:[{obj:"submit_save_as_view",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.combobox_widget("#Mview_public",{url:StrackPHP.getPublicType,valueField:"id",textField:"name",value:"yes"})}})},submit_save_as_view:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",StrackPHP.saveAsView,{back:function(t){Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message}),window.location.reload()}},{extra:function(t){return t.view_data=JSON.stringify(Strack.get_view_data({panel:t.panel,page:t.page,project_id:t.project_id,maindom:t.maindom,bardom:t.bardom})),t}})},modify_view:function(t){var e;switch($(t).attr("data-panel")){case"grid":e=$(t).closest(".grid-toolbar");break;case"list":e=$(t).closest(".list-toolbar")}var a=e.find(".view-g-active"),i={view_id:a.attr("view_id"),view_name:a.attr("view_name"),view_public:a.attr("view_public"),allow_edit:a.attr("allow_edit")};0<parseInt(i.view_id)&&"allow"==i.allow_edit?Strack.open_dialog("dialog",{title:StrackLang.Modify_View_Title,width:480,height:240,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mview_id",type:"hidden",name:"view_id",valid:1,value:i.view_id}],items:[{case:1,id:"Mview_name",type:"text",lang:StrackLang.Name,name:"name",valid:"1,128",value:i.view_name},{case:2,id:"Mview_public",lang:StrackLang.Public,name:"public",valid:"1",value:""}],footer:[{obj:"submit_modify_view",type:5,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.combobox_widget("#Mview_public",{url:StrackPHP.getPublicType,valueField:"id",textField:"name",value:i.view_public})}}):layer.msg(StrackLang.View_Deny_Modify,{icon:2,time:1200,anim:6})},submit_modify_view:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",StrackPHP.modifyView,{back:function(t){Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message}),window.location.reload()}})},get_view_data:function(t){var e={};switch(t.panel){case"list":e=obj.get_list_view_data(t);break;case"grid":var a=$("#"+t.maindom).find(".datagrid-table").datagrid("options"),i=JSON.parse(a.queryParams.filter_data),d=a.sortData;e.sort={sort_query:i.filter.sort,sort_data:d},e.group=i.filter.group;var r=[];if(1<a.frozenColumns.length){var o=[];a.frozenColumns[0].forEach(function(t){o.push({colspan:t.colspan,frozen_status:!0})}),a.columns[0].forEach(function(t){t.frozen_status=!1,o.push(t)});var n=[];a.frozenColumns[1].forEach(function(t){t&&"id"!=t.field&&n.push({field:t.field,width:parseInt(t.width),frozen_status:!0})}),a.columns[1].forEach(function(t){if(t&&"id"!=t.field)if(t.step){var e={field:t.field,title:t.title,align:"center",width:parseInt(t.width),findex:t.findex,hidden:t.hidden,drag:t.drag,step:!0,step_index:t.step_index,belong:t.belong,frozen_status:!1};0<=$.inArray(t.step_index,["first","last"])&&(e.bdc=t.bdc,e.cbd=t.cbd,e.cellClass=t.cellClass,e.deltaWidth=t.deltaWidth),n.push(e)}else n.push({field:t.field,width:parseInt(t.width),frozen_status:!1})}),r.push(o,n)}else a.frozenColumns[0].forEach(function(t){t&&"id"!=t.field&&r.push({field:t.field,width:parseInt(t.width),frozen_status:!0})}),a.columns[0].forEach(function(t){t&&"id"!=t.field&&r.push({field:t.field,width:parseInt(t.width),frozen_status:!1})});e.fields=r;var s=$("#"+a.filterConfig.id).find(".exist-filter-item .filter-tag-ac").attr("filter_id");e.filter=0<s?{filter_id:s,sort:{sort_data:d,sort_query:i.filter.sort},group:i.filter.group,request:i.filter.request,filter_input:i.filter.filter_input,filter_panel:i.filter.filter_panel,filter_advance:i.filter.filter_advance}:{filter_id:0,sort:{sort_data:{},sort_query:{}},group:{},request:{},filter_input:{},filter_panel:{},filter_advance:{}}}return e},toggle_view:function(t,e,a){$.ajax({type:"POST",url:StrackPHP.toggleView,dataType:"json",data:{view_id:t,project_id:a,page:e},beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),window.location.reload()}})},delete_view:function(t){var e,a=Strack.select_view_param(t);switch($(t).attr("data-panel")){case"grid":e=$(t).closest(".grid-toolbar");break;case"list":e=$(t).closest(".list-toolbar")}var i=e.attr("data-page");0<a.view_id&&"allow"==a.allow_edit?$.ajax({type:"POST",url:StrackPHP.deleteView,dataType:"json",data:{id:a.view_id,page:i},beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),window.location.reload()}}):layer.msg(StrackLang.View_Deny_Remove,{icon:2,time:1200,anim:6})},highlight_view_save:function(t){$(t).closest(".list-toolbar").find(".grid-view-bnt").addClass("dg-bnt-active")},del_highlight_view_save:function(t){$(t).closest(".list-toolbar").find(".grid-view-bnt").removeClass("dg-bnt-active")},dialog_error_icon:function(t){var e="";switch(t){case"e":e+='<i class="dialog-form-error form-tip icon-uniF00D"></i>';break;case"t":e+='<i class="dialog-form-ok form-tip icon-uniF00C"></i>'}return e},dropdown_reset:function(){var t,e,a,i,d;$(".stdown-filter").each(function(){t=$(this).data("dtype"),i=$(this).data("height"),0<$("#filter_proj_"+t).length&&(e=$(this).offset().top,a=$(this).offset().left,100<t&&$(window).height()<e+i+71?(d=e-i-41,$("#filter_proj_"+t).css({top:d+35,left:a-160})):$("#filter_proj_"+t).css({top:e+30,left:a-160}))})},loading_dom:function(t,e,a){var i="",d=e;switch(d||(d=""),a=a?"_"+a:"",t){case"black":i='<div id="st-load'+a+'" class="ui active dimmer st-load"><div class="ui text loader">'+d+"</div></div>";break;case"white":i='<div id="st-load'+a+'" class="ui active inverted dimmer st-load"><div class="ui text loader">'+d+"</div></div>";break;case"null":i='<div id="st-load'+a+'" class="ui active inverted stnull dimmer st-load"><div class="ui text loader">'+d+"</div></div>"}return i},upper_first_str:function(t){return""==t||null==t||"string"!=typeof t?"":t.charAt(0).toUpperCase()},build_avatar:function(t,e,a){return e?'<img class="avatar_path_'+t+'" src="'+e+'" />':'<span class="avatar_path_'+t+'">'+a+"</span>"},change_avatar:function(t){$(".avatar_path_"+t.user_id).parent().empty().append(Strack.build_avatar(t.user_id,t.avatar,Strack.upper_first_str(t.pinyin)))},ajax_grid_delete:function(e,a,t,i,d,r){var o=""|d,n=$("#"+e).datagrid("getSelections"),s=[];n.forEach(function(t){s.push(t[a])}),n.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):$.messager.confirm(StrackLang.Confirmation_Box,t,function(t){t&&$.ajax({type:"POST",url:i,data:{primary_ids:s.join(","),param:o},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(r||Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message}),$("#"+e).datagrid("reload")):layer.msg(t.message,{icon:7,time:1200,anim:6})}})})},ajax_base_delete:function(e,t,a,i){$.messager.confirm(StrackLang.Confirmation_Box,t,function(t){t&&$.ajax({type:"POST",url:a,data:{primary_ids:e},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message}),i(t)):layer.msg(t.message,{icon:7,time:1200,anim:6})}})})},ajax_dialog_form:function(t,e,a,i,d){var r=Strack.submit_dialog_form(t),o="";if(r.error_num<0)if(0<e.length)switch(r.error_num){case-1:case-2:o=r.error_name+""+r.error_num,layer.msg(e[o],{icon:2,time:1200,anim:6});break;default:o="illegal",layer.msg(StrackLang.Illegal_Operation,{icon:2,time:1200,anim:6})}else layer.msg(r.error_message,{icon:2,time:1200,anim:6});else{var n;if(n=d?d.extra(r):r,!a)return n;$.ajax({type:"POST",url:a,data:JSON.stringify(n),dataType:"json",contentType:"application/json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),i&&i.back(t)}})}},submit_dialog_form:function(t){$(".form-tip").remove();var _={},m="",u=["input","widget","json","textarea","tags","datalist"];return $(t).each(function(){if(m=$(this).attr("data-widget"),0<=$.inArray(m,u)){var t,e=$(this).attr("id"),a=$(this).data("valid"),i=$(this).data("name"),d=this.className,r=$(this).attr("type"),o=null;switch(m){case"input":case"text":case"textarea":o=$(this).val();break;case"json":o=Strack.get_json_editor_val(e);break;case"widget":var n=d.split(" ");switch(String(n[1])){case"combobox-f":o=0<(t=Strack.get_combos_val("#"+this.id,"combobox","getValues")).length?t.join(","):"";break;case"combotree-f":o=0<(t=Strack.get_combos_val("#"+this.id,"combotree","getValues")).length?t.join(","):"";break;case"datebox-f":(o=$("#"+this.id).datebox("getValue"))||(o="");break;case"switchbutton-f":o=Strack.get_switch_val("#"+this.id);break;default:o=$(this).val()}break;case"tags":var s=[];$("#st_dialog_form").find(".tag-items").each(function(){s.push($(this).data("id"))}),o=s.join(",")}if(a){var l=$(this).closest(".st-dialog-input").prev().html(),c=Strack.valid_form(a,o,l);if(!c.status)return Strack.get_valid_icon(this.id,-1,r),_.error_message=c.message,_.error_num=parseInt(c.error_num),_.error_name=i,!1;Strack.get_valid_icon(this.id,1,r),_[i]=o}else _[i]=o}}),_},get_valid_icon:function(t,e,a){if("hidden"!==a){var i=$("#"+t);switch(e){case 1:i.parent().append(Strack.dialog_error_icon("t"));break;case-1:i.parent().append(Strack.dialog_error_icon("e"));break;default:i.parent().append(Strack.dialog_error_icon("t"))}}},rule_grid_header_checkbox:function(t){var e,a,i=$(t).data("pos"),d=$(t).data("field"),r=$(t).find(".tree-checkbox"),o=$(".datagrid-row td[field = "+d+"]"),n=$("#rule_header_checkbox_"+d),s=0,l=0,c=0,_=0,m={};switch(i){case"header":r.hasClass("tree-checkbox1")||r.hasClass("tree-checkbox2")?(r.removeClass("tree-checkbox1").removeClass("tree-checkbox2").addClass("tree-checkbox0"),o.each(function(){$(this).find(".tree-checkbox").removeClass("tree-checkbox1").removeClass("tree-checkbox2").addClass("tree-checkbox0")})):(r.removeClass("tree-checkbox0").removeClass("tree-checkbox2").addClass("tree-checkbox1"),o.each(function(){$(this).find(".tree-checkbox").removeClass("tree-checkbox0").removeClass("tree-checkbox2").addClass("tree-checkbox1")}));break;case"parent":var u=$(t).data("code");r.hasClass("tree-checkbox1")||r.hasClass("tree-checkbox2")?(r.removeClass("tree-checkbox1").removeClass("tree-checkbox2").addClass("tree-checkbox0"),o.each(function(){a=$(this).find(".dg-rule-checkbox"),(p=a.data("parent"))===u?($(this).find(".tree-checkbox").removeClass("tree-checkbox1").removeClass("tree-checkbox2").addClass("tree-checkbox0"),c++,s++,0<$(this).find(".tree-checkbox1").length&&(_++,l++)):p&&(s++,0<$(this).find(".tree-checkbox1").length&&l++),a.data("code")===u&&(e=a)})):(r.removeClass("tree-checkbox0").removeClass("tree-checkbox2").addClass("tree-checkbox1"),o.each(function(){a=$(this).find(".dg-rule-checkbox"),(p=a.data("parent"))===u?($(this).find(".tree-checkbox").removeClass("tree-checkbox0").removeClass("tree-checkbox2").addClass("tree-checkbox1"),c++,s++,0<$(this).find(".tree-checkbox1").length&&(_++,l++)):p&&(s++,0<$(this).find(".tree-checkbox1").length&&l++),a.data("code")===u&&(e=a)})),(m={top_item_number:s,top_checked_number:l,top_checkbox:n,parent_items:[]}).parent_items[d]={parent_item_number:c,parent_checked_number:_,parent_checkbox:e},Strack.reset_rule_grid_data(m);break;case"single":var g,p=$(t).data("parent");r.hasClass("tree-checkbox1")||r.hasClass("tree-checkbox2")?r.removeClass("tree-checkbox1").removeClass("tree-checkbox2").addClass("tree-checkbox0"):r.removeClass("tree-checkbox0").removeClass("tree-checkbox2").addClass("tree-checkbox1"),o.each(function(){(a=$(this).find(".dg-rule-checkbox")).data("code")===p&&(e=a),(g=a.data("parent"))===p?(c++,s++,0<$(this).find(".tree-checkbox1").length&&(_++,l++)):g&&(s++,0<$(this).find(".tree-checkbox1").length&&l++)}),(m={top_item_number:s,top_checked_number:l,top_checkbox:n,parent_items:[]}).parent_items[d]={parent_item_number:c,parent_checked_number:_,parent_checkbox:e},Strack.reset_rule_grid_data(m)}},init_rule_grid_data:function(t){var e,a,i,d,r={view:{top_item_number:0,top_checked_number:0,top_checkbox:null,parent_items:{}},create:{top_item_number:0,top_checked_number:0,top_checkbox:null,parent_items:{}},clear:{top_item_number:0,top_checked_number:0,top_checkbox:null,parent_items:{}},modify:{top_item_number:0,top_checked_number:0,top_checkbox:null,parent_items:{}},delete:{top_item_number:0,top_checked_number:0,top_checkbox:null,parent_items:{}}};for(var o in $("#rule_tab_project_field").find(".dg-rule-checkbox").each(function(){switch(e=$(this).attr("data-pos"),a=$(this).attr("data-field"),e){case"header":r[a].top_checkbox=$(this);break;case"parent":i=$(this).attr("data-code"),r[a].parent_items[i]={parent_item_number:0,parent_checked_number:0,parent_checkbox:$(this)};break;case"single":d=$(this).attr("data-parent"),i=$(this).attr("data-code"),r[a].top_item_number++,r[a].parent_items[d].parent_item_number++,$(this).find(".tree-checkbox").hasClass("tree-checkbox1")&&(r[a].top_checked_number++,r[a].parent_items[d].parent_checked_number++)}}),r)Strack.reset_rule_grid_data(r[o])},reset_rule_grid_data:function(t){var e,a=t.top_checkbox.find(".tree-checkbox");for(var i in 0<t.top_checked_number?t.top_checked_number===t.top_item_number?a.removeClass("tree-checkbox0").removeClass("tree-checkbox2").addClass("tree-checkbox1"):a.removeClass("tree-checkbox0").removeClass("tree-checkbox1").addClass("tree-checkbox2"):a.removeClass("tree-checkbox1").removeClass("tree-checkbox2").addClass("tree-checkbox0"),t.parent_items){var d=(e=t.parent_items[i]).parent_checkbox.find(".tree-checkbox");0<e.parent_checked_number?e.parent_checked_number===e.parent_item_number?d.removeClass("tree-checkbox0").removeClass("tree-checkbox2").addClass("tree-checkbox1"):d.removeClass("tree-checkbox0").removeClass("tree-checkbox1").addClass("tree-checkbox2"):d.removeClass("tree-checkbox1").removeClass("tree-checkbox2").addClass("tree-checkbox0")}},color_pick_widget:function(t,e,a,i,d){$(t).addClass("color-pick"),$(t).val(i),d&&$(t).attr("style","width:"+d+"px;border-color:#"+i),$(t).colpick({layout:e,submit:0,color:i,colorScheme:a,onChange:function(t,e,a,i,d){$(i).css("border-color","#"+e),d||$(i).val(e)}}).keyup(function(){$(this).colpickSetColor(this.value)})},build_dialog:function(t){$("body").append('<div id="'+t+'"></div>')},open_dialog:function(t,e){Strack.build_dialog(t),$("#"+t).dialog({title:e.title,width:e.width,height:e.height,top:e.top,closed:!1,cache:!1,modal:!0,content:e.content,onMove:function(t,e){Strack.dropdown_reset()},onOpen:function(){e.inits&&e.inits.call(this)},onClose:function(){$(this).dialog("destroy"),e.close&&e.close.call(this)}})},init_json_editor:function(t,e,a){var i=e||{},d=document.getElementById(t);Strack.G.jsonEditor[t]=new JSONEditor(d,i),a&&Strack.G.jsonEditor[t].set(a)},destroy_json_editor:function(t){Strack.G.jsonEditor[t]&&(Strack.G.jsonEditor[t].destroy(),delete Strack.G.jsonEditor[t])},get_json_editor_val:function(t){return Strack.G.jsonEditor[t]?Strack.G.jsonEditor[t].get():{}},get_combos_val:function(t,e,a){var i,d="";return e?(i=$(t)[e]("panel"),d=$(t)[e](a),i.children("div").hasClass("combobox-item-selected")||"combotree"==e?d:d=""):d},combobox_widget:function(t,e){var a=e||{};$(t).combobox(a)},set_switch_val:function(t){return 1===parseInt(t)},init_open_switch:function(a,i){var t=a.height?a.height:26,e={checked:Strack.set_switch_val(a.value),width:a.width,height:t,onText:a.onText,offText:a.offText,onChange:function(t){var e;e=t?1:0,$(a.dom).next().children("input").val(e),i&&i(e)}};a.disabled&&(e.disabled=a.disabled),$(a.dom).switchbutton(e),$(a.dom).next().prepend('<input type="hidden" name="switchbutton" value="'+a.value+'" >')},OpenDateBox:function(t,e,a,i){$(t).datebox({width:e,height:a,value:i,editable:!1})},filter_date_box:function(t,e,a,i,d){$(t).datebox({width:e,height:a,value:i,editable:!1,onSelect:function(t){$(this).data("ptype"),$(this).data("filter");Strack.filter_auto(this)}})},get_switch_val:function(t){var e;return"undefined"!==(e=t?$(t).next().children("input").val():$(".switchbutton input[name=switchbutton]").val())?parseInt(e):0},panel_height:function(t,e){return $(t).height()-e},auto_resize_datagrid:function(t,e,a,i,d){d?$(e).on("mresize",function(){Strack.do_resize_datagrid(t,e,a,i)}):$(window).resize(function(){Strack.do_resize_datagrid(t,e,a,i)})},do_resize_datagrid:function(t,e,a,i){var d;$(e).is(":hidden")?(d=$(e).show().offset(),Strack.resize_datagrid_active(t,d,a,i),$(e).removeAttr("style")):(d=$(e).offset(),Strack.resize_datagrid_active(t,d,a,i),Strack.dropdown_reset())},resize_datagrid_active:function(t,e,a,i){var d=$(t).closest(".entity-datalist").next(".datagrid-filter").width();d=0<d?d:0;var r=$(".grid-right-wrap"),o=0;r.is(":hidden")||(o=0<(o=r.width())?o+1:0);var n=$.data(t,"datagrid"),s=n.options,l=n.dc,c=n.panel,_=window.innerWidth-e.left-2-d-o,m=window.innerHeight-e.top-2-i,u=l.view,g=l.view1,p=l.view2,f=g.children("div.datagrid-header"),v=p.children("div.datagrid-header"),h=f.find("table"),k=v.find("table");c.css({width:_,height:m}),u.width(_);var b=f.children("div.datagrid-header-inner").show();g.width(b.find("table").width()),s.showHeader||b.hide(),p.width(_-g._outerWidth()),g.children()._outerWidth(g.width()),p.children()._outerWidth(p.width());var S=f.add(v).add(h).add(k);S.css("height","");var y=0;y=s.HeaderHeight?s.HeaderHeight:Math.max(h.height(),k.height()),S._outerHeight(y);var w=l.body2.children("table.datagrid-btable-frozen")._outerHeight(),x=w+v._outerHeight()+p.children(".datagrid-footer")._outerHeight();c.children(":not(.datagrid-view,.datagrid-mask,.datagrid-mask-msg)").each(function(){x+=$(this)._outerHeight()});c.outerHeight(),c.height();g.add(p).children("div.datagrid-body").css({marginTop:w,height:isNaN(parseInt(m))?"":m-x}),u.height(p.height()),p.find(".datagrid-body").css("overflow","auto")},fit_columns:function(t,e){return $(t).width()>e},get_datagrid_select_data:function(t,e){var a=$(t).datagrid("getSelections"),i=[];a.forEach(function(t){i.push(t.id)}),a.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):e(i)},save_dialog_setting:function(){var e=$("#Ntype").val(),t=$("#Npage").val(),a=[];$(".dg-report-de").each(function(){a.push($(this).attr("data-field"))}),$.ajax({type:"POST",url:StrackPHP.saveDialogSetting,dataType:"json",data:{fields:JSON.stringify(a),type:e,page:t},beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){Strack.G.DialogAddSetting[e]=t,$.messager.progress("close"),Strack.top_message({bg:"g",msg:StrackLang.Dialog_Setting_Save_SC})}})},top_fields_config:function(t){$(t).data("id"),$(t).data("projectid");var e=$(t).data("moduleid"),a=$(t).data("modulecode"),i=$(t).data("templateid");Strack.template_set_dialog({datalist_url:StrackPHP.getModuleBaseColumns,title:StrackLang.Template_Details_Top_Field,temp_id:i,module_code:a,module_id:e,category:"details_top_field",id_field:"fields",text_field:"lang",text_field_lang:StrackLang.Column,group:"belong_table",limit:3})},template_set_dialog:function(d){Strack.open_dialog("dialog",{title:d.title,width:800,height:520,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mtemp_id",type:"hidden",name:"temp_id",valid:1,value:d.temp_id},{case:101,id:"Mid_field",type:"hidden",name:"id_field",valid:1,value:d.id_field},{case:101,id:"Mmodule_code",type:"hidden",name:"module_code",valid:1,value:d.module_code},{case:101,id:"Mcategory",type:"hidden",name:"category",valid:1,value:d.category}],items:[{case:5,id:"",type:"text",lang:"",name:"",valid:"",value:0}],footer:[{obj:"update_config_set",type:5,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){var i;$("#template-field").datalist({url:d.datalist_url,width:320,height:380,idField:d.id_field,valueField:d.id_field,textField:d.text_field,groupField:d.group,checkbox:!0,singleSelect:!1,queryParams:{module_code:d.module_code,category:d.category,module_id:d.module_id,project_id:0,template_id:d.temp_id},onLoadSuccess:function(t){var a=$(this);$.ajax({type:"POST",url:StrackPHP.getTemplateConfig,dataType:"json",data:{template_id:d.temp_id,module_code:d.module_code,category:d.category},beforeSend:function(){$("#dialog").prepend(Strack.loading_dom("white","","config"))},success:function(t){var e=[{field:d.id_field,checkbox:!0},{field:d.text_field,title:d.text_field_lang,align:"center",width:160}];d.group&&e.push({field:d.group,title:StrackLang.Group,align:"center",width:160}),$("#template-columns").datagrid({data:[],width:380,height:380,rownumbers:!0,fitColumns:!0,columns:[e],dragSelection:!0,onLoadSuccess:function(){(i=$(this)).datagrid("enableDnd")}}),t.forEach(function(t){a.datalist("selectRecord",t[d.id_field])}),$("#st-load_config").remove()}})},onSelect:function(t,e){var a=$("#template-columns");(a.datagrid("appendRow",e),i.datagrid("enableDnd"),0<d.limit)&&(a.datagrid("getRows").length>d.limit&&$(this).datagrid("unselectRow",t))},onUnselect:function(t,e){var a=$("#template-columns"),i=a.datagrid("getRowIndex",e);a.datagrid("deleteRow",i)}})}})},update_config_set:function(){var t=$("#Mtemp_id").val(),e=$("#Mmodule_code").val(),a=$("#Mcategory").val(),i=$("#Mid_field").val(),d=$("#template-columns").datagrid("getRows"),r=[];d.forEach(function(t){switch(a){case"detail_top_field":r.push({fields:t[i],module:t.module,table:t.table});break;default:var e={};e[i]=t[i],r.push(e)}});var o={template_id:t,module_code:e,category:a,config:r};$.ajax({type:"POST",url:StrackPHP.modifyUserConfig,data:JSON.stringify(o),dataType:"json",contentType:"application/json",beforeSend:function(){$("#dialog").prepend(Strack.loading_dom("white","","config"))},success:function(t){$("#st-load_config").remove(),Strack.top_message({bg:"g",msg:t.message}),Strack.dialog_cancel()}})},upload_image:function(t,e,d,r){var a=["gif","jpeg","jpg","bmp","png"],i=[StrackLang.Image_Format_Limit,StrackLang.Browser_Support];document.getElementById(t).onchange=function(){if(this.value){if(!RegExp(".("+a.join("|")+")$","i").test(this.value.toLowerCase()))return Strack.top_message({bg:"r",msg:i[0]}),this.value="",!1;if(-1<navigator.userAgent.indexOf("MSIE"))return Strack.top_message({bg:"r",msg:i[1]}),this.value="",!1;if($("#"+e).val(this.value),this.files[0]){var t=new FileReader;t.addEventListener("load",function(t){var e=t.target.result,i=new Image;i.addEventListener("load",function(){var t=0<parseInt(r)?r:280,e=i.width*(t/i.height);$("#"+d).empty().append('<canvas id="img_cas" width="'+e+'" height="'+t+'"></canvas>');var a=document.getElementById("img_cas");a.getContext("2d").drawImage(i,0,0,e,t),Strack.G.Jcrop_Canvas=a},!1),i.src=e},!1),t.readAsDataURL(this.files[0])}}}},top_message:function(t){var e;switch(String(t.bg)){case"r":e="error";break;case"g":e="success";break;case"w":e="warn";break;default:e="success"}layer.msg(t.msg,{offset:"10px",skin:"a-bounceinT layui-layer-bmsg layui-layer-"+e,time:3e3})},upload_preview:function(t){var b=this,S=null,y=null,w="",x="";b.IsNull=function(t){return"function"!=typeof t&&(null==t||null==t||""==t||0==t.length)},b.DefautlSetting={UpBtn:"",Canvas:"",Cancel:[""],Jcrop:"",Showpanel:!1,Width:100,Height:100,MinLimit:50,ImgType:["gif","jpeg","jpg","bmp","png"],ErrMsg:[StrackLang.Image_Format_Limit,StrackLang.Browser_Support],callback:function(){}},b.Setting={UpBtn:b.IsNull(t.UpBtn)?b.DefautlSetting.UpBtn:t.UpBtn,Canvas:b.IsNull(t.Canvas)?b.DefautlSetting.Canvas:t.Canvas,Cancel:b.IsNull(t.Cancel)?b.DefautlSetting.Cancel:t.Cancel,Jcrop:b.IsNull(t.Jcrop)?b.DefautlSetting.Jcrop:t.Jcrop,Showpanel:b.IsNull(t.Showpanel)?b.DefautlSetting.Showpanel:t.Showpanel,Width:b.IsNull(t.Width)?b.DefautlSetting.Width:t.Width,Height:b.IsNull(t.Height)?b.DefautlSetting.Height:t.Height,MinLimit:b.IsNull(t.MinLimit)?b.DefautlSetting.MinLimit:t.MinLimit,ImgType:b.IsNull(t.ImgType)?b.DefautlSetting.ImgType:t.ImgType,ErrMsg:b.IsNull(t.ErrMsg)?b.DefautlSetting.ErrMsg:t.ErrMsg,callback:b.IsNull(t.callback)?b.DefautlSetting.callback:t.callback},b.drawImg=function(t,k){if(t){var e=new FileReader;e.addEventListener("load",function(t){var e=t.target.result,h=new Image;h.addEventListener("load",function(){var d,t,e,a,i,r,o,n,s=h.width,l=h.height,c=b.Setting.Width,_=b.Setting.Height,m=b.Setting.MinLimit,u=s/l;e=(c-(d=c/m<=u?m*u:u<=m/_?m<s?s:m:c<=s?c:l<=_?_*u:s))/2,a=-((t=d/u)-_)/2,i=-((n=_<t?_:t)-_)/2,r=(c-(o=c<d?c:d))/2,$(".crop-avatar-img").html('<canvas id="'+k+'" height="'+n+'px" width="'+o+'px" style="position: absolute;top:'+i+"px;left:"+r+'px">'),y=document.getElementById(k);var g=(Strack.G.Jcrop_Canvas=y).getContext("2d");g.globalCompositeOperation="copy",""!=b.Setting.Jcrop&&(null!=S&&""!=S&&$(".jcrop-holder").remove(),$("#"+k).parent().after('<div id="'+b.Setting.Jcrop+'"></div>'),$("#"+b.Setting.Jcrop).css({width:o+"px",height:n+"px",top:i+"px",left:r+"px"}),$("#"+b.Setting.Jcrop).Jcrop({minSize:[m,m],onChange:function(t){var e=(Strack.G.Jcrop_Thumb=t).x,a=t.y,i=m/t.w;$(".avatar-view-sm1>img").css({"margin-top":"-"+a*i+"px","margin-left":"-"+e*i+"px",width:d*i+"px"}),$(".avatar-view-sm2>img").css({"margin-top":"-"+2*a/3*i+"px","margin-left":"-"+2*e/3*i+"px",width:2*d/3*i+"px"}),$(".avatar-view-sm3>img").css({"margin-top":"-"+a/3*i+"px","margin-left":"-"+e/3*i+"px",width:d/3*i+"px"})},aspectRatio:1},function(){this.getBounds(),(S=this).animateTo([0,0,m,m])}));var p=0,f=0;if(o<d&&(p=e),n<t&&(f=a),w=d,x=t,g.drawImage(h,p,f,d,t),""!=b.Setting.Jcrop){var v=y.toDataURL("image/png");$(".avatar-view-sm1").html('<img  src="'+v+'" />'),$(".avatar-view-sm2").html('<img  src="'+v+'" />'),$(".avatar-view-sm3").html('<img  src="'+v+'" />'),$(".avatar-view-sm2>img").css({width:2*d/3+"px"}),$(".avatar-view-sm3>img").css({width:d/3+"px"})}},!1),h.src=e},!1),e.readAsDataURL(t)}},b.Cancel=function(){y&&(y.getContext("2d").clearRect(0,0,w,x),null!=S&&""!=S&&($(".jcrop-holder").remove(),$(".avatar-view-sm1,.avatar-view-sm2,.avatar-view-sm3").empty(),Strack.G.Jcrop_Thumb=""),y=null,Strack.G.Jcrop_Canvas=y)},b.Bind=function(){if(document.getElementById(b.Setting.UpBtn).onchange=function(){if(this.value){if(!RegExp(".("+b.Setting.ImgType.join("|")+")$","i").test(this.value.toLowerCase()))return Strack.top_message({bg:"r",msg:b.Setting.ErrMsg[0]}),this.value="",!1;if(-1<navigator.userAgent.indexOf("MSIE"))return Strack.top_message({bg:"r",msg:b.Setting.ErrMsg[1]}),this.value="",!1;b.drawImg(this.files[0],b.Setting.Canvas),b.Setting.callback()}},b.Setting.Cancel){for(var t="",e=$(".crop-avatar-wrap"),a=0;a<b.Setting.Cancel.length;a++)t+=b.Setting.Cancel[a]+",";t=t.substring(0,t.length-1),b.Setting.Showpanel?(e.show(),$(t).click(function(){b.Cancel()})):$(t).click(function(){e.slideToggle(function(){b.Cancel()})})}},b.Bind()},global_loading:function(){return'<div class="global-loading-wrap"><div class="global-masked"><i class="icon-strack_logo"></i></div></div>','<div class="global-loading-wrap"><div class="global-masked"><i class="icon-strack_logo"></i></div></div>'},cancel_global_loading:function(){setTimeout(function(){$(".global-masked").hide(),$(".global-loading-wrap").addClass("a-fadeout"),setTimeout(function(){$(".global-loading-wrap").remove()},1e3)},500)},init_dropdown:function(){$(".ui.menu , .ui.dropdown").dropdown({on:"hover"})},close_warn_message:function(t){$(t).closest(".globel-warn-msg").remove()},click_admin_menu:function(t){Strack.save_storage("admin_menu_top",$(".admin-page-left").scrollTop())},on_before_unload_notice:function(){return"The current page is not saved! Is it overloaded?"},build_top_menu:function(){$.ajax({type:"POST",url:StrackPHP.getTopMenuData,dataType:"json",data:{menu_name:Strack.G.MenuName,module_id:Strack.G.ModuleId,project_id:Strack.G.ProjectId},success:function(t){Strack.TopMenuData=t.menu_data,Strack.generate_top_menu(t.menu_data),0<=$.inArray(Strack.G.MenuName,["project_inside","project_detail"])&&($(".nav-breadcrumb-name").attr("title",t.project_data.current_project.name),$(".nav-breadcrumb-text").html(t.project_data.current_project.name),Strack.top_menu_project_item_dom(t.project_data),$(".nav-project-head").show()),Strack.top_menu_on_resize()}})},generate_top_menu:function(t){var e=$("#nav_main_bar").width(),a=$("#nav_main_list"),i=$("#nav_hide_list"),d=$(".nav-main-bar-hide");d.hide().removeClass("nav_main_active"),a.empty(),i.empty();var r,o=46,n="",s=!0,l=!1;t.forEach(function(t){e<o?(l=!0,s&&($("#"+n).remove(),"yes"===r.active&&d.addClass("nav_main_active"),i.append(Strack.top_menu_hide_dom(r)),s=!1),i.append(Strack.top_menu_hide_dom(t))):a.append(Strack.top_menu_main_dom(t)),n="top_m_"+(r=t).code,o+=$("#top_m_"+t.code).width()+2}),l?d.show():$(".nav-main-bar-show").css("margin-left",(e-o)/2)},refresh_top_menu:function(t){Strack.TopMenuData=t,Strack.generate_top_menu(t)},top_menu_on_resize:function(){$(".header-main").on("mresize",function(){Strack.generate_top_menu(Strack.TopMenuData)})},top_menu_project_item_dom:function(e){var a="",i=Strack.remove_html_ext(StrackPHP.Project_Url)+"/"+e.project_last_url;e.active_project_list.forEach(function(t){a+='<a href="'+i+t.project_id+'.html" class="item" data-value="'+e.current_project.name+'"><span class="project-menu-name text-ellipsis">'+t.name+"</span></a>"}),$("#to_menu_project_list").empty().append(a)},top_menu_main_dom:function(t){var e="",a="yes"===t.active?"nav_main_active":"";return e+='<li id="top_m_'+t.code+'" class="nav-main-items '+a+'">',"#"!==t.url?e+='<a href="'+t.url+'">'+t.name+"</a>":e+='<a href="'+t.url+'" >'+t.name+"</a>",e+="</li>"},top_menu_hide_dom:function(t){var e="",a="yes"===t.active?"active":"";return"yes"===t.active&&$(".nav-main-bar-hide").addClass("nav_main_active"),e+='<a href="'+t.url+'" class="item '+a+'" data-text="'+t.name+'">'+t.name+"</a>"},body_click_event:function(){$(document).mouseup(function(t){var e=$(".widget_input");(!e.is(t.target)&&0===e.has(t.target).length&&0==$(t.target).closest(".combo-p").length||!$(t.target).hasClass("widget-show")&&0==$(t.target).closest(".widget-show").length&&0==$(t.target).closest(".combo-p").length)&&Strack.widget_update();var a=$("#project_top_name");a.is(t.target)||0!==a.has(t.target).length||a.is(":visible")&&obj.modify_project_name(a);var i=$(".filter-task-list");i.is(t.target)||0!==i.has(t.target).length||i.slideUp(100);var d=$(".layui-layer-content");!d.is(t.target)&&0===d.has(t.target).length&&0<$(".layui-layer-tips").length&&layer.tips("close");var r=$(".datagrid-btable");if(!r.is(t.target)&&0===r.has(t.target).length&&0==$(t.target).closest(".combo-p").length){var o=$(".datagrid-editable");if(0<o.length){var n=parseInt(o.closest(".datagrid-row").attr("datagrid-row-index"));o.closest(".datagrid-view").find(".datagrid-f").datagrid("endEdit",n)}}})},G:{Default_Mail:"@strack.com",Jcrop_Thumb:"",Note_Uploadifive_Imgs:[],Jcrop_Canvas:"",Media_Server:{},cnotedom:"",topMenuActive:!1,Geditor:{},GeditorParam:{},MDeditor:null,Gfilter_data:{},Group_data:{},Gfilter_list:{},GanttFilter:{},MediaFilter:{},WebplayerPage:!1,GacPlaylist:[],Gmindex:0,GridPage:{},KankanItem:{},FilterAutoCheck:!1,FilterProjFirst:0,FilterStepsFirst:0,FilterData:{},FilterProj:"",FilterEntity:"",FilterTopJob:{},FilterTopMsg:{},InputExCkfields:{},CustomEditIndex:[],MenuName:"",ProjectId:0,ModuleId:0,AccMenu:"",TlStart:0,TllogTerval:{},SumFilters:null,IsNewfileds:!1,Gplaylistid:0,GridStepsHidelist:[],FrameRates:{film:24,NTSC:29.97,NTSC_Film:23.98,NTSC_HD:59.94,PAL:25,PAL_HD:50,web:30,high:60},Timesheet:"now",TimesheetOld:"",FilterWidget:[],CurrentView:{},ViewsetData:{},DialogAddSetting:{},ImgViewzoom:1,ImgZoomSpeed:.1,ImgZoomX:0,ImgZoomY:0,Project_Menu:[],comboxItemType:0,comboxItemDom:"",comboxStepDom:"",groupview:null,gridFieldCache:{},leftScrolling:0,TopMenuData:[],jsonEditor:{},entityStepTaskAddData:{status:!1,data:{}},shiftOrCtrlKeyPress:!1,importExcelStep:null,importExcelData:{},mediaScreenshotStatus:!1}};Strack.Websocket={List:{},heartbeatList:{},init:function(e,a){if(window.WebSocket)if(Strack.Websocket.List[e])a.afterInit&&a.afterInit({status:"exist"});else{var t="";t=0<$(".st-bg-black").length?"black":"white",$(".pushable").prepend(Strack.loading_dom(t,StrackLang.Starting_Action,"run_action"));var i=new WebSocket(a.url);i.onopen=function(t){Strack.Websocket.List[e]=i,Strack.Websocket.heartbeat(e),a.afterInit&&($("#st-load_run_action").remove(),a.afterInit({status:"new",data:t.data}))},i.onclose=function(t){a.onClose&&a.onClose(t.data)},i.onmessage=function(t){a.onMessage&&a.onMessage(t.data)},i.onerror=function(t){Strack.Websocket.close(e),a.afterInit&&($("#st-load_run_action").remove(),a.afterInit({status:"error",data:t,message:"Connection error."}))}}else a.afterInit&&a.afterInit({status:"error",message:"No support for webSocket."})},heartbeat:function(t){Strack.Websocket.List[t]&&(Strack.Websocket.heartbeatList[t]=window.setInterval(function(){Strack.Websocket.List[t].send(JSON.stringify({method:"heartbeat"}))},3e4))},send:function(t,e){Strack.Websocket.List[t].send(JSON.stringify(e))},close:function(t){var e={},a={};if(Strack.Websocket.List[t]){for(var i in Strack.Websocket.List[t].send("close"),Strack.Websocket.List[t].close(),Strack.Websocket.List)t!==i&&(e[i]=Strack.Websocket.List[i]);for(var d in Strack.Websocket.List=e,clearInterval(Strack.heartbeatList.List[t]),Strack.heartbeatList.List)t!==d&&(a[d]=Strack.heartbeatList.List[d]);Strack.heartbeatList.List=a}}},Strack.Notify={obj:null,init:function(){Strack.Notify.obj=new Notify({effect:"flash",interval:500,audio:{file:StrackPHP.IMG+"/notify.mp4"},notification:{title:"Notification",icon:StrackPHP.IMG+"/strack_notice.ico",body:"You have a new message!"}})},show:function(t,e){Strack.Notify.obj.notify({title:t,body:e}).player()}},Strack.update={init:function(){$.ajax({type:"POST",url:StrackPHP.getLogServerConfig,dataType:"json",success:function(t){"yes"===t.active&&Strack.Websocket.init("action",{url:t.websocket_url,afterInit:function(t){"error"===t.status?console.log("ws error:"+t.message):console.log(t)},onMessage:function(t){console.log(t),Strack.Notify.show("test",JSON.stringify(t))}})}})},refresh:function(){},message:function(t){},widget:function(t){var e=t.data.param,a=t.data.update,i=e.module+"_"+e.field+"_"+e.primary_value,d=$("."+i),r=d.find(".widget-edit"),o=d.find(".info-content-show");r.attr("data-value",e.val);var n="";switch(e.editor){case"combobox":switch(e.field){case"status_id":n=Strack.hex_to_rgb(a.color,.3),d.css("background-color",n),o.html(Strack.widget_status_dom(a.icon,a.name,a.color));break;default:o.html(a.name)}break;default:o.html(e.val)}console.log(t),Strack.update.excessive_color(t.status,d,n)},note:function(t){},thumbnail:function(t){},excessive_color:function(t,e,a){var i=200===parseInt(t)?"#00FF54":"#FF4739",d=a||"transparent";e.css({"background-color":i,transition:"background-color 100ms ease-in","-moz-transition":"background-color 100ms ease-in","-webkit-transition":"background-color 100ms ease-in","-o-transition":"background-color 100ms ease-in"}),setTimeout(function(){e.css({"background-color":d,transition:"background-color 300ms ease-in","-moz-transition":"background-color 300ms ease-in","-webkit-transition":"background-color 300ms ease-in","-o-transition":"background-color 300ms ease-in"})},300)}},$(function(){if(Strack.init_dropdown(),Strack.body_click_event(),Strack.Notify.init(),Strack.build_top_menu(),Strack.top_header(),Strack.G.MenuName){var t=$("#admin_"+Strack.G.MenuName);if(t.length){var e=Strack.read_storage("admin_menu_top"),a=$(".admin-page-left");t.addClass("admin-menu-active");var i=0,d=document.documentElement.clientHeight;if(0<e)i=e;else a.scrollTop(0),i=t.offset().top-d+82;0<i&&a.scrollTop(i)}}Strack.G.AccMenu&&$("#account-"+Strack.G.AccMenu).addClass("account-menu-active"),Strack.update.init()});