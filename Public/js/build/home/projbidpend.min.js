$(function(){function t(t,e,i){var a=Strack.build_filter({project_id:["eq",e]},{},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]);Strack.G.Gfilter_data.bidpend=a,$("#datagrid_box").datagrid({url:BiddingPHP.getBidpendData,fitColumns:!1,height:Strack.panel_height(".entity-datalist",0),rowheight:49,differhigh:!1,singleSelect:!1,DragSelect:!0,adaptive:{dom:".entity-datalist",min_width:510,exth:0,domresize:1},queryParams:{filter:JSON.stringify(a),op_type:t,ptype:10010,project_id:e,tab:"bidpend"},frozenColumns:[[{field:"bid_pend_id",title:StrackPHP.ID,checkbox:!0}]],columns:[i],toolbar:"#bid_tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onRowContextMenu:function(t,e,i){Strack.grid_clipboard(t.target),t.preventDefault(),$("#st_menu_bidpend").menu("show",{left:t.pageX,top:t.pageY})}}),Strack.SortDown(e,10010,"datagrid_box",{SortChange:"Strack.sort_change",SortAdv:"Strack.DataSortAdv",SortItem:"Strack.DataSortItem"})}obj={addBidShot:function(t){var e=$(t).data("pid"),i=$(t).data("grid"),a={type:"bidpend",pid:e,custom:"yes",multi:"no",etype:10010,upmod:"newBidpend"};Strack.open_dialog("dialog",{title:BiddingPHP.Add_Pend_Bidding,width:560,height:360,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mup_type",type:"hidden",name:"up_type",valid:1,value:a.upmod},{case:101,id:"Mproject_id",type:"hidden",name:"project_id",valid:1,value:e},{case:101,id:"Mtype",type:"hidden",name:"type",valid:1,value:a.etype},{case:101,id:"Mitype",type:"hidden",name:"type",valid:1,value:"new"}],items:[{case:1,id:"Mup_fields",type:"text",lang:StrackPHP.Fields,name:"fields",valid:1,value:""}],update:!0,footer:[{obj:"BatchUpdate",type:5,title:StrackPHP.Submit},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){$("#Mup_fields").combobox({url:StrackPHP.EditFields,width:350,valueField:"id",textField:"lang",multiple:!0,value:"",queryParams:a,onSelect:function(t){if(0==$("#dgup_i_"+t.id).length){var i=Strack.BatchUpItem(t,"new");$("#st_dgup").append(i.item_dom),Strack.BatchItemInit(t,e,10010,i.id,a.type,t)}},onUnselect:function(t){$.inArray(t.id,[10012,10015])<0?$("#dgup_i_"+t.id).remove():($(this).combobox("select",t.id),layer.msg(StrackPHP.Must_Field,{icon:2,time:1200,anim:6}))},onLoadSuccess:function(){$(this).combobox("select",10012).combobox("select",10015)}})},close:function(){$("#"+i).datagrid("reload")}})},SideModify_ThumbBnt:function(t){var e=$(t).attr("data-pid"),i=[];$("#datagrid_box").datagrid("getSelections").forEach(function(t){i.push(t.bid_pend_id)}),0==i.length?layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6}):i.length>1?layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6}):Strack.change_item_thumb(10010,i.join(","),e,"bidding")},BathEditBid:function(t){var e=$(t).data("grid"),a=($(t).data("ftype"),Strack.GetTaskDatagrid(e,"bid_pend_id",!1));switch(a.verify){case-3:layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6});break;case 200:Strack.BatchUpDialog("#"+e,BiddingPHP.Pend_Bidding_Upadte_Title,a.ids.join(","),{type:"bidpend",pid:i,custom:"yes",etype:10010,upmod:"bidpend",multi:"no"},StrackPHP.EditFields,a)}},BidpendtoTrash:function(t){var e=$("#datagrid_box").datagrid("getSelections"),a=[];e.forEach(function(t){a.push(t.bid_pend_id)}),Strack.ajax_grid_delete(e,BiddingPHP.Pend_Bidding_Delete_Comfirm,BiddingPHP.DeleteBidpend,{bid_pend_id:a.join(","),pid:i},"#datagrid_box",BiddingPHP.Pend_Bidding_Delete_SC)}};var e=$(".projpage-main");if(PARSE_VAR.auth.authority){var i=$("input[name=proj_id]").val(),a=$("input[name=p_type]").val(),d=Strack.verify_project_data(i),n={};d>0?(function(t){for(var e in t){var i=t[e];switch(n[i.alias]=i,i.alias){case"bidpend_thumb":case"batch_update":case"import_excel":case"export_excel":case"bidpend_add":case"bidpend_del":case"bidpend_action":"no"==i.allow&&$(".ah_"+i.alias).remove()}}}(PARSE_VAR.rules),e.show(),$("#url_bidlist").append('<a href="'+Strack.remove_html_ext(StrackPHP.ProjBidding)+"/"+i+'.html" target="_blank"><span class="stp-title">'+BiddingPHP.Offer_Sheet+"</span></a>"),Strack.project_sub_menu(i,a),function(t){var e=[];"yes"==n.bidpend_thumb.allow&&e.push({name:"sedit",text:StrackPHP.Upload_Thumb,iconCls:"icon-uniE70C2",type:"function",click:"obj.SideModify_ThumbBnt(this)",attr_data:{pid:t,type:10010,grid:"datagrid_box"}}),"yes"==n.batch_update.allow&&e.push({name:"sedit",text:StrackPHP.Edit_Selected,iconCls:"icon-uniF044",type:"function",click:"obj.BathEditBid(this)",attr_data:{pid:t,type:10010,grid:"datagrid_box",mode:"bidpend"}}),"yes"==n.import_excel.allow&&e.push({name:"eimport_excel",text:StrackPHP.Import_ExcelT,iconCls:"icon-uniE986",type:"function",click:"Strack.import_excel_data(this)",attr_data:{pid:t,type:10010,done:"bidpend",grid:"datagrid_box"}}),"yes"==n.export_excel.allow&&e.push({name:"sexcel",text:StrackPHP.Export_Excel,iconCls:"icon-uniE6082",type:"function",click:"Strack.ExportExcel(this)",attr_data:{pid:t,type:10010,done:"bidpend",mode:"grid"}}),"yes"==n.bidpend_action.allow&&e.push({name:"saction",text:StrackPHP.Action,iconCls:"icon-uniE6BB",type:"function",click:"Strack.ClientActionBatch(this)",attr_data:{type:10010,grid:"datagrid_box",field:"bid_pend_id"}}),e.push({name:"sreset",text:StrackPHP.Reset,iconCls:"icon-uniE682",type:"function",click:"Strack.ResetDatagrid(this)",attr_data:{type:10010,pid:t,grid:"datagrid_box"}}),"yes"==n.bidpend_del.allow&&e.push({name:"sdelete",text:StrackPHP.DeleteSelect,iconCls:"icon-uniE9D5",type:"function",click:"obj.BidpendtoTrash(this)",attr_data:{}}),e.push({name:"scopy_cell",text:StrackPHP.Copy_Grip_Cell,iconCls:"icon-uniE943",type:"function",click:"Strack.copy_clipboard(this)",attr_data:{"clipboard-action":"copy","clipboard-target":"#grid_clipboard"}}),Strack.InitMenuItem("st_menu_bidpend",e),new Clipboard("#st_menu_scopy_cell")}(i),function(e,i,a){$.ajax({type:"POST",url:StrackPHP.DynamicFields,dataType:"json",data:{project_id:i,type:a},success:function(d){var n=[];d.forEach(function(t,e){t&&n.push(Strack.DynamicFieldset(a,t,e,"",{pid:i}))}),t(e,i,n)}})}(a,i,10010)):e.empty().append(Strack.ProjWarn(StrackPHP.Project_None_Warning)).show()}else e.empty().append(Strack.ProjWarn(StrackPHP.NoPermission)).show()});