$(function(){function a(e,s,n,l,c){var o=Strack.build_filter({project_id:["eq",e]},{},{},{});switch(s){case"preprod":o.request.e_type=["eq",30],o.request.media_id=["neq",0];break;case"assets":o.request.e_type=["eq",40],o.request.media_id=["neq",0];break;case"shots":o.request.e_type=["eq",70],o.request.media_id=["neq",0]}$.ajax({url:WebplayerPHP.LeftMediaData,type:"post",dataType:"json",data:{pid:e,etype:s,pagenum:n,pagesize:l,filter:JSON.stringify(o)},beforeSend:function(){$("#play_list").append(Strack.loading_dom("black","","plist"))},success:function(o){var r="",d=$("#play_list"),p=o.total,m="";switch($("#back_plist").show().attr("data-layer","Plist_"+e+"_"+s),s){case"favorites":case"playlist":m=v("plist_null");break;case"preprod":case"assets":case"shots":m=v(s)}if(p>0){switch(s){case"favorites":case"playlist":o.rows.forEach(function(a){r+=i(a)});break;case"preprod":case"assets":case"shots":o.rows.forEach(function(a){r+=t(a)})}"new"==c?($(".play-list-wrap").scroll(function(){if((this.scrollTop||this.scrollTop)==(this.scrollHeight||this.scrollHeight)-(this.clientHeight||this.clientHeight)){n++;var t=Math.ceil(p/l);n<=t&&a(e,s,n,l,"old")}}),d.empty().append(r)):(d.append(r),$("#st-load_plist").remove())}else d.empty().append(m)}})}function e(a,e){var t="";return t+='<div class="plist-search"><div class="plist-search-title"><i class="icon-uniF1ED icon-left"></i>'+a+'</div><div class="plist-search-wrap">'+e+"</div></div>"}function t(a){var e="";return e+='<li class="play-list-items p_version_item" data-listid="'+a.plist_id+'"><div class="pver-i-thumb aign-left">'+u(a.media_info)+'</div><div class="playlist-name text-ellipsis  aign-left"><div class="list-name-top"><span class="list_date">'+a.version+'</span><span class="list_createby">'+a.Created_by+'</span></div><div class="list-name-bottom">'+a.content+'</div></div><a href="javascript:;" class="playlist-button aign-right" onclick="obj.addToTimeline(this)" data-mtype="version"  data-vid="'+a.version_id+'"><i class="icon plus"></i></a></li>'}function i(a){var e="",t=a.favtype,i="";if("com"==t){var s="yes"==a.infav?"icon-uniEA02":"icon-uniEA00";i+='<a href="javascript:;" class="playlist-button aign-right" onclick="Strack.FavPlist(this,event)" data-pid="'+a.project_id+'" data-listid="'+a.plist_id+'"><i class="'+s+'"></i></a>'}return e+='<li class="play-list-items"  data-listid="'+a.plist_id+'"><div class="playlist-thumb aign-left">'+Strack.BuildPlistTumb(a.thumbs[0],a.thumbs[1],a.thumbs[2],a.thumbs[3])+'</div><div class="playlist-name text-ellipsis  aign-left"><div class="list-name-top"><span class="list_date">'+a.created+'</span><span class="list_createby">'+a.user_name+'</span></div><div class="list-name-bottom">'+a.plist_name+'</div></div><a href="javascript:;" class="playlist-button aign-right" onclick="obj.ResetToTimeline(this)" data-mtype="plist" data-listid="'+a.plist_id+'"><i class="icon-uniE658"></i></a>'+i+"</li>"}function s(a,e,t){$.ajax({url:WebplayerPHP.PlayListTrack,type:"post",dataType:"json",data:{mtype:a,link_id:e},beforeSend:function(){$("#time_track").append(Strack.loading_dom("black","","tlist"))},success:function(a){var e="";a.forEach(function(a,t){e+=h(a,t)}),$("#time_track").html(e),k(),"reset"==t&&obj.PlayLoad()}})}function n(a){$.ajax({url:WebplayerPHP.AddTrackItem,type:"post",dataType:"json",data:{vid:a},beforeSend:function(){$("#time_track").append(Strack.loading_dom("black","","tlist"))},success:function(a){var e=$("#time_track"),t=e.find("a").length,i=h(a,t);e.append(i),k(),$("#st-load_tlist").remove()}})}function l(a){var e="";e+='<li class="meta-show">'+a.taskdata.task_name+'</li><li class="meta-show">'+a.taskdata.version+'</li><li class="meta-show">'+a.taskdata.t_type+'</li><li class="meta-show">'+a.taskdata.item_name+'</li><li class="meta-show">'+a.taskdata.p_name+'</li><li class="meta-show">'+a.taskdata.artist+'</li><li class="meta-show">'+a.taskdata.status.status_name+'</li><li class="meta-show">'+a.taskdata.steps+'</li><li class="meta-show">'+a.metadata.m_width+"Ã—"+a.metadata.m_height+'</li><li class="meta-show">'+a.metadata.m_rate+"</li>",$("#metadata_show").html(e)}function c(a){var e=a.taskdata,t=parseInt(a.project_id);parseInt(a.link_type);$("#wpny_tname").html(e.task_name);var i="";a.headerdata.forEach(function(e){i+=Strack.SideColumnEInfoBase(e,1,"top",0,a.task_id,t,"tasks",0,10,"")}),$("#wpny_detail").empty().append(i),$("#wpny_thumb").html(Strack.NolazyTaskThumb(StrackPHP.TASK_THUMB,StrackPHP.pagetask,e.folder,e.thumb,a.task_id,e.project_id,e.item_type,"max")),R(Wa),$(".pyn-fd-wrap").css("height","calc(100% - "+la+"px)"),Aa&&$("#mlist_action").attr("data-linkid",a.task_id),p()}function o(a){$.ajax({url:WebplayerPHP.GetScreenshot,type:"post",dataType:"json",data:{verid:a,page_session:pa},beforeSend:function(){$("#pyn_sst").append(Strack.loading_dom("black","","paint"))},success:function(a){var e="";a.length>0?a.forEach(function(a,t){e+=_(a)}):e+=r(),$("#sst_list").empty().append(e),$("#st-load_paint").remove()}})}function r(){return'<div class="pyn-st-null">'+WebplayerPHP.Screenshot_Null+"</div>"}function d(a,e,t){$("#pyn_editor").empty().append('<textarea id="editor" autocomplete="off"></textarea>'),Strack.G.Geditor.e_0=new Simditor({textarea:$("#editor"),placeholder:StrackPHP.Add_Note_Notice,toolbarHidden:!0,toolbartype:0,proj_id:a,task_id:e,link_type:t,panel_type:"webplayer",note_from:na,footer_control:!1,toolbar:["color","bold","emoji"],emoji:{imagePath:"images/emoji/"},mention:{url:StrackPHP.DataUserAT,nameKey:"name",pinyinKey:"pinyin",abbrKey:"abbr"}}),Strack.G.Geditor.e_0.on("focus",function(a,e){Strack.HideNotereply(),$(".toolbar_0").show()})}function p(){$("#pyn_editor").find(".simditor").on("mresize",function(){var a=$(this).height()+la-69,e="calc(100% - "+a+"px)";$(".pyn-fd-wrap").css({height:e})})}function m(a,e,t,i,s,n){var l=$(".pyn-fd-wrap"),c=$("#side_task_comm");$.ajax({type:"POST",dataType:"json",url:StrackPHP.DataPtask,data:{dload:200,op_type:e,pid:a,t_id:t,tab:"activity",pagesize:i,pagenum:s,note_from:na,link_ver:K},beforeSend:function(){"new"==n&&(l.append(Strack.loading_dom("black","","notes")),c.empty())},success:function(l){var o=l.total;"new"==n&&($("#st-load_notes").remove(),$(".pyn-fd-wrap").on("scroll",function(){if((this.scrollTop||this.scrollTop)==(this.scrollHeight||this.scrollHeight)-(this.clientHeight||this.clientHeight)){s++;var n=Math.ceil(o/i);s<=n&&m(a,e,t,i,s,"more")}})),c.append(Strack.ShowAllNotes(l.rows,"main")),Strack.initPhotoSwipeFromDOM(".note_att"),Strack.UsersTips(".avatar-show","right")}})}function _(a){var e="",t=StrackPHP.UPLOADS+"/temp/"+a.img+"_temp.jpg";return e+='<a href="javascript:;" class="pyn-st-img aign-left" onclick="obj.paintThumb(this)" data-thumb="'+a.img+'" data-paintid="'+a.paint_id+'"><img src="'+t+'"><div class="pyn-st-frame">'+a.frame+"</div></a>"}function h(a,e){var t="";return t+='<a href="javascript:;" id="tkitem_'+a.media_id+'" class="time-track-item tk-no-load aign-left" onclick="obj.timeItemPlay(this)" data-index="'+e+'" data-vid="'+a.version_id+'" data-vnum="'+a.version+'" data-mid="'+a.media_id+'"  data-tid="'+a.task_id+'"><div class="track-item-header"><span class="track-item-sta myhome-status-dot aign-left" style="color: #00A7F7"><i class="icon-uniF04D"></i></span><span class="aign-right">'+a.version+'</span></div><div class="track-item-thumb">'+u(a.media_details.media_info)+'</div><div class="track-item-gress"><div id="progress_'+a.version_id+'"></div></div><div class="track-item-bottom"><span class="track-item-name aign-left">'+a.task_name+"</span></div></a>"}function u(a){var e=JSON.parse(a),t=e.thumb;return t?'<img src="'+StrackPHP.UPLOADS+"/Media/"+t+'">':'<img src="'+StrackPHP.IMG+'/thumb_media.jpg">'}function v(a){var e="";switch(a){case"proj_null":e=WebplayerPHP.No_Project_List;break;case"plist_null":e=WebplayerPHP.No_Playlist_Data;break;case"preprod":case"assets":case"shots":e=WebplayerPHP.No_Version_List}return'<div class="pl-list-null">'+e+"</div>"}function y(a){var e=[{e_type:"favorites",e_icon:'<i class="icon-uniEA02"></i>',e_name:WebplayerPHP.Favorites},{e_type:"playlist",e_icon:'<i class="icon-uniE948"></i>',e_name:WebplayerPHP.Playlist},{e_type:"preprod",e_icon:'<i class="icon-uniF1E9 "></i>',e_name:StrackPHP.PreProduction},{e_type:"assets",e_icon:'<i class="icon-small_assets"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></i>',e_name:StrackPHP.Assets},{e_type:"shots",e_icon:'<i class="icon-icon_shots"></i>',e_name:StrackPHP.Shots}],t="";$("#play_list").empty().append(Strack.loading_dom("black","","plist")),e.forEach(function(e){t+=C(a,e)}),setTimeout(function(){$("#back_plist").show().attr("data-layer","Item_"+a),$("#play_list").empty().append(t)},250)}function f(a,e,t){var i=Strack.build_filter(),s=$("#play_list");$.ajax({url:WebplayerPHP.LeftPlistData,type:"post",dataType:"json",data:{list_type:"project",pagenum:a,pagesize:e,filter:JSON.stringify(i)},beforeSend:function(){$("#play_list").append(Strack.loading_dom("black","","plist"))},success:function(i){var n="",l=i.total;l>0?(i.rows.forEach(function(a){n+=E(a)}),"new"==t?($(".play-list-wrap").scroll(function(){if((this.scrollTop||this.scrollTop)==(this.scrollHeight||this.scrollHeight)-(this.clientHeight||this.clientHeight)){a++;var t=Math.ceil(l/e);a<=t&&f(a,e,"old")}}),$("#back_plist").attr("data-layer","project").hide(),s.empty().append(n)):(s.append(n),$("#st-load_plist").remove())):s.empty().append(v("proj_null"))}})}function k(){var a=$("#time_track").find("a").length;$(".p-time-wrap").css("width",192*a)}function P(a,e){$("#mc_play").html('<i class="icon-uniEA46"></i>'),$("#preview_control").removeClass("preview-none"),Strack.G.Gmindex=a,X=Strack.G.GacPlaylist[a].metadata.m_type,K=Strack.G.GacPlaylist[a].v_id,g(Strack.G.GacPlaylist[a].metadata,Strack.G.GacPlaylist[a].v_id),e||(Ia||l(Strack.G.GacPlaylist[a]),c(Strack.G.GacPlaylist[a])),$("#current_ver").val(K)}function g(a,e){function t(){z.readyState==z.HAVE_ENOUGH_DATA&&(s.needsUpdate=!0),Z.clear(),Z.render(ea,aa)}function i(){ia.update(),t(),requestAnimationFrame(i)}var s,n=$("#video_main"),l=a.m_width,c=a.m_height;switch(Y=l,Q=c,$(".time-track-item").removeClass("tkitem_ac"),$("#tkitem_"+a.m_id).addClass("tkitem_ac"),ea&&n.empty(),parseInt(a.m_type)){case 10:z=document.createElement("img"),z.src=StrackPHP.UPLOADS+"/Media/"+a.m_path;break;case 20:z=document.createElement("video"),z.src=StrackPHP.UPLOADS+"/Media/"+a.m_path,J=VideoFrame({vobj:z,type:"vobj",frameRate:a.m_rate})}z.width=l,z.height=c;var o,r=n.width(),d=n.height(),p=parseInt(a.m_type);Z=new THREE.WebGLRenderer({antialias:!0}),aa=new THREE.PerspectiveCamera(45,r/d,.1,1e4),ea=new THREE.Scene,ea.add(aa),aa.position.z=872,Z.setSize(r,d),document.getElementById("video_main").appendChild(Z.domElement),ta=new THREE.AmbientLight(16777215),ea.add(ta),ia=new THREE.TrackballControls(aa,Z.domElement),s=new THREE.Texture(z),s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s.format=THREE.RGBFormat;var m,_,h=new THREE.MeshLambertMaterial({map:s,side:THREE.FrontSide}),u=l/c;switch(u>u?(m=1280,_=m/u):(_=720,m=_*u),sa=new THREE.Mesh(new THREE.PlaneGeometry(m,_),h),sa.name="main_version",ea.add(sa),H(Strack.G.Gmindex),p){case 10:Ca="images",i(),Ga.slider({mode:"h",max:72,height:14,step:1,progressbar:!0,onComplete:function(a){if(a<72){(a/24).toFixed(2)}}}),b(1);break;case 20:Ca="video",i(),z.load(),z.volume=ja?1:0,z.addEventListener("loadedmetadata",function(){z.play(),o=Strack.TimeToFrame(this.duration),Ga.slider({mode:"h",max:o,height:14,step:1,progressbar:!0,onComplete:function(a){if(a<o){var e=(a/24).toFixed(2);z.currentTime=e}}})}),z.addEventListener("timeupdate",function(){var a=Strack.TimeToFrame(this.currentTime);Ga.slider("setValue",a),Strack.SetMFrames(a,o)}),z.addEventListener("ended",function(){if(j(Strack.G.Gmindex),parseInt(Strack.G.Gmindex)<Strack.G.GacPlaylist.length-1)switch(Ta){case"all_loop":case"onece":P(Strack.G.Gmindex+1,!1);break;case"self_loop":P(Strack.G.Gmindex,!0)}else switch(Ta){case"all_loop":P(0,!1);break;case"onece":obj.vplay("#mc_play");break;case"self_loop":P(Strack.G.Gmindex,!0)}})}}function b(a){var e=1e3/Strack.G.FrameRates.film;w(),ca=setInterval(function(){if(a++,Ga.slider("setValue",a),Strack.SetMFrames(a,72),72==a)if(j(Strack.G.Gmindex),parseInt(Strack.G.Gmindex)<Strack.G.GacPlaylist.length-1)switch(Ta){case"all_loop":case"onece":w(),P(Strack.G.Gmindex+1,!1);break;case"self_loop":a=1}else switch(Ta){case"all_loop":w(),P(0,!1);break;case"onece":w();break;case"self_loop":a=1}},e)}function S(){switch(parseInt(X)){case 10:w();break;case 20:z.pause(),$("#mc_play").html('<i class="icon-uniEA45"></i>')}}function w(){ca&&(window.clearInterval(ca),ca=null)}function G(){switch(X){case 10:break;case 20:z.play()}}function H(a){Strack.G.GacPlaylist[a].position&&(aa.position.z=Strack.G.GacPlaylist[a].position.camera_zoom,aa.position.x=Strack.G.GacPlaylist[a].position.camera_x,aa.position.y=Strack.G.GacPlaylist[a].position.camera_y,ia.target.x=Strack.G.GacPlaylist[a].position.camera_x,ia.target.y=Strack.G.GacPlaylist[a].position.camera_y,aa.updateProjectionMatrix(),sa.position.set(Strack.G.GacPlaylist[a].position.plane_x,Strack.G.GacPlaylist[a].position.plane_y,0))}function j(a){Strack.G.GacPlaylist[a].position={camera_x:aa.position.x,camera_y:aa.position.y,plane_x:sa.position.x,plane_y:sa.position.y,camera_zoom:aa.position.z}}function T(a){var e=$(a).width(),t=$(a).height(),i=e/t;$(a).find("canvas").css({width:e,height:t}),aa.position.z=872,aa.aspect=i,aa.updateProjectionMatrix(),sa.position.set(ia.target.x,ia.target.y,0),Z.setSize(e,t)}function x(){var a=$("#mc_play");a.hasClass("on_play")&&a.removeClass("on_play").html('<i class="icon-uniEA45"></i>')}function E(a){var e="",t={thumb_arr:{}};return t.thumb_arr.p_folder=a.p_folder,t.thumb_arr.p_thumb=a.p_thumb,e+='<li class="play-list-entity"><a href="javascript:;" class="playlist-item" onclick="obj.CPlistItem(this)" data-itype="project" data-pid="'+a.project_id+'"><div class="plist-e-thumb aign-left">'+Strack.build_thumb_dom(a.p_thumb,t,"min")+'</div><div class="plist-e-name text-ellipsis aign-left">'+a.p_name+"</div></a></li>"}function C(a,e){var t="";return t+='<li class="play-list-entity"><a href="javascript:;" class="playlist-item" onclick="obj.CPlistItem(this)" data-itype="item" data-pid="'+a+'" data-etype="'+e.e_type+'"><div class="plist-e-icon aign-left">'+e.e_icon+'</div><div class="plist-e-name text-ellipsis aign-left">'+e.e_name+"</div></a></li>"}function A(){var a=$("#r_handle"),e=$("#note_panel"),t=$("#left_panel"),i=$("#note_name"),s=$("#note_info");a.hasClass("r_panel_open")?(e.css("width",40),t.css("width","calc(100% - 48px)"),a.html('<i class="icon-uniF0D9"></i>').removeClass("r_panel_open"),s.hide(),Sa.hide(),i.show()):(e.css("width",660),t.css("width","calc(100% - 668px)"),a.html('<i class="icon-uniF0DA"></i>').addClass("r_panel_open"),i.hide(),"yes"==Ha?s.show():Sa.show())}function W(){var a=$("#time_panel"),e=$("#t_panel_main"),t=$("#timeline_name"),i=$("#pt_top"),s=$("#timeline_warp");a.hasClass("t_panel_open")?(e.css("height",40),i.css("height","calc(100% - 48px)"),a.html('<i class="icon-uniE76C"></i>').removeClass("t_panel_open"),t.show(),s.hide()):(e.css("height",260),i.css("height","calc(100% - 268px)"),a.html('<i class="icon-uniE76B"></i>').addClass("t_panel_open"),t.hide(),s.show())}function I(a){$("#preview_paint").hide(),a.removeClass("mc-active"),$(".preview-main").css("width","100%")}function F(a){a.addClass("mc-active"),$("#preview_paint").show(),$(".preview-main").css("width","calc(100% - 34px)")}function M(a,e){var t=document.createElement("canvas");t.width=a,t.height=e,t.getContext("2d").drawImage(z,0,0,t.width,t.height);var i=document.createElement("img");return i.src=t.toDataURL(),i.src}function L(a,e,t,i){var s=$("#lseq_list");$.ajax({type:"POST",url:StrackPHP.getVersionData,dataType:"json",data:{filter:JSON.stringify(a),pagenum:e,pagesize:t},beforeSend:function(){s.append(Strack.loading_dom("black","","lseq"))},success:function(n){var l=n.total,c="";if(l>0)switch(n.rows.forEach(function(a){c+=D(a)}),i){case"new":s.on("scroll",function(){if((this.scrollTop||this.scrollTop)==(this.scrollHeight||this.scrollHeight)-(this.clientHeight||this.clientHeight)){e++;var i=Math.ceil(l/t);e<=i&&L(a,e,t,"more")}}),s.empty().append(c);break;case"more":s.append(c)}else s.empty().append('<div class="datagrid-empty-no">'+Strack.DataNullTip(2010)+"</div>");$("#st-load_lseq").remove()}})}function D(a){var e="";return e+='<div class="seq-left-items"><a href="javascript:;" class="list-item-main" onclick="obj.ShowItem(this)" data-verid="'+a.version_id+'"><div id="thumb_left_50_'+a.version_id+'" class="sleft-items-thumb">'+Strack.VersionThumb(a)+'</div><div class="sleft-items-content"><div class="sleft-items-ctop"><span class="items-ctop-icon aign-left">'+Strack.publishGridIcon(a.publish)+'</span><span class="items-ctop-title aign-left text-ellipsis">'+a.version+" ( "+a.status_name+' ) </span></div><div class="sleft-items-cbottom"><span class="items-ctop-status aign-left">'+a.user_name+" - "+a.created+'</span></div></div></a><div class="tver-b-bnt"><a href="javascript:;" class="tver-a-bnt" onclick="obj.mediaVerWipe(this)"  data-verid="'+a.version_id+'">'+StrackPHP.Wipe+'</a><a href="javascript:;" class="tver-a-bnt" onclick="obj.mediaVerLoad(this)"  data-verid="'+a.version_id+'">'+StrackPHP.Load+'</a><a href="javascript:;" class="tver-a-bnt" onclick="obj.mediaVerCancel(this)"  data-verid="'+a.version_id+'">'+StrackPHP.Cancel+"</a></div></div>"}function N(a){var e=$("#todo_list");$.ajax({type:"POST",url:StrackPHP.getVersionTodos,dataType:"json",data:{ver_id:a},beforeSend:function(){e.append(Strack.loading_dom("black","","vtodo"))},success:function(a){var t=Strack.TodoListBase(a.project_id,a.task_id,a.type,a,a.todo_list,a.user_list,!1,StrackPHP.Version_Todo_None);e.empty().append(t)}})}function R(a){switch($(".pitem-wrap").removeClass("active"),$("#item_"+a).addClass("active"),$("#tab_"+a).addClass("active"),a){case"activity":o(Strack.G.GacPlaylist[Strack.G.Gmindex].v_id),d(Strack.G.GacPlaylist[Strack.G.Gmindex].project_id,Strack.G.GacPlaylist[Strack.G.Gmindex].task_id,Strack.G.GacPlaylist[Strack.G.Gmindex].link_type),m(Strack.G.GacPlaylist[Strack.G.Gmindex].project_id,Strack.G.GacPlaylist[Strack.G.Gmindex].link_type,Strack.G.GacPlaylist[Strack.G.Gmindex].task_id,10,1,"new");break;case"version":oa=Strack.build_filter({project_id:["eq",Strack.G.GacPlaylist[Strack.G.Gmindex].project_id],task_id:["eq",Strack.G.GacPlaylist[Strack.G.Gmindex].task_id]},{},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]),L(oa,1,20,"new");break;case"todo":N(Strack.G.GacPlaylist[Strack.G.Gmindex].v_id)}}obj={vpainter:function(a){var e,t=$(a);if(t.hasClass("mc-active")){xa=!0,Ga.slider("enable"),Ga.slider("setValue",Ea);var i=$("#video_paint").wPaint("image");I(t),$("#vp_wrap").hide(),e="images"==Ca?1:Strack.TimeToFrame(z.currentTime),$("#video_paint").wPaint("clearUndo"),$.ajax({url:WebplayerPHP.SaveScreenshot,type:"post",dataType:"json",data:{imgData:i,verid:K,cframe:e,page_session:pa,upload:StrackPHP.UPLOADS},success:function(a){$("#sst_list").find(".pyn-st-null").remove(),$("#sst_list").append(_(a))}})}else{"images"==Ca&&w(),xa=!1,Ea=Ga.slider("getValue"),Ga.slider("disable"),S(),$("#mc_play").removeClass("on_play").html('<i class="icon-uniEA45"></i>'),F(t);var s,n,l,c=$("#vp_wrap"),o=c.height(),r=c.width(),d=Y/Q,p=r/o;p>d?(s=o,n=Math.round(s*d)):(n=r,s=Math.round(n/d)),l=(r-n)/2,$("#video_paint").css({width:n,height:s,left:l}),$("#video_paint canvas").attr({width:n,height:s}),$("#video_paint").wPaint("imageBg",M(n,s)),$("#vp_wrap").show()}},vplay:function(a){if(z&&xa)if($(a).hasClass("on_play")){switch(Ca){case"images":w();break;case"video":S()}$(a).removeClass("on_play").html('<i class="icon-uniEA45"></i>')}else{switch(Ca){case"images":b(Ga.slider("getValue"));break;case"video":z.play(),G()}$(a).addClass("on_play").html('<i class="icon-uniEA46"></i>')}else layer.msg(WebplayerPHP.On_Screenshot,{icon:2,time:1200,anim:6})},cvoice:function(a){var e=$(a);e.hasClass("voice-on")?(e.html('<i class="icon-uniEA53"></i>').removeClass("voice-on").addClass("voice-off"),z.volume=0,ja=!1):(e.html('<i class="icon-uniEA50"></i>').removeClass("voice-off").addClass("voice-on"),z.volume=1,ja=!0)},vfullscreen:function(a){window.fullScreenApi.supportsFullScreen&&(window.fullScreenApi.isFullScreen()?($("#mc_fullscreen").html('<i class="icon-uniE74B"></i>'),window.fullScreenApi.cancelFullScreen()):($("#mc_fullscreen").html('<i class="icon-uniE9B5"></i>'),window.fullScreenApi.requestFullScreen(document.getElementById("view_main"))))},ShowMeta:function(a){var e=$("#mc_metadata");e.hasClass("meta_ac")?e.removeClass("meta_ac").hide():e.addClass("meta_ac").show()},vloopset:function(a){var e=$(a),t=$("#mc_loop"),i=e.attr("data-vloop");switch(parseInt(i)){case 1:e.attr("data-vloop",2),t.html('<i class="icon-uniF178"></i>'),Ta="onece";break;case 2:e.attr("data-vloop",3),t.html('<i class="icon-uF0030"></i>'),Ta="self_loop";break;case 3:e.attr("data-vloop",1),t.html('<i class="icon-uniEA56"></i>'),Ta="all_loop"}},timeItemPlay:function(a){var e=$(a).data("index");$(a).hasClass("tk-no-load")?layer.msg(WebplayerPHP.Please_Load_Track,{icon:2,time:1200,anim:6}):xa?(j(Strack.G.Gmindex),K=$(a).data("vid"),S(),P(e,!1)):layer.msg(WebplayerPHP.On_Screenshot,{icon:2,time:1200,anim:6})},addToTimeline:function(a){var e=$(a).data("vid"),t=!0;$("#time_track").find("a").each(function(){e==$(this).data("vid")&&(layer.msg(WebplayerPHP.Timeline_Media_Exist,{icon:2,time:1200,anim:6}),t=!1)}),$(".time-track-null").length>0&&$(".time-track-null").remove(),t&&n(e)},ResetToTimeline:function(a){var e=$(a).data("listid");S(),s("lists",e,"reset")},TogglePlist:function(a){$(a).hasClass("mc-active")?($(".timeline-left").hide(),$("#mpl_plist").removeClass("mc-active"),$(".timeline-right").css("width","100%")):($(a).addClass("mc-active"),$(".timeline-left").show(),$(".timeline-right").css("width","calc(100% - 321px)"))},BackPlist:function(a){var e=$(a).attr("data-layer"),t=e.split("_");switch(t[0]){case"Item":f(1,100,"new");break;case"Plist":y(t[1])}},CPlistItem:function(e){var t,i=$(e).data("itype"),s=$(e).data("pid");switch(i){case"project":y(s);break;case"item":t=$(e).data("etype"),a(s,t,1,100,"new")}},PlayLoad:function(){if(xa){w(),z&&S();var a=[];$(".time-track-item").each(function(){$(this).removeClass("tk-no-load"),a.push({vid:$(this).data("vid"),mid:$(this).data("mid"),tid:$(this).data("tid"),vnum:$(this).data("vnum")})}),a.length>0?($("#mc_load").addClass("mc-load"),$.ajax({url:WebplayerPHP.LoadTimeTrack,type:"post",dataType:"json",data:{tk_list:JSON.stringify(a),upload:StrackPHP.UPLOADS},beforeSend:function(){$("#view_main").append(Strack.loading_dom("black","","pload"))},success:function(a){Strack.G.GacPlaylist=a,Ha="yes",Sa.hide(),$a.show(),P(0,!1),$("#st-load_pload").remove()}})):layer.msg(WebplayerPHP.Timeline_Is_Empty,{icon:2,time:1200,anim:6})}else layer.msg(WebplayerPHP.On_Screenshot,{icon:2,time:1200,anim:6})},PlistSave:function(){var a=[];$("#time_track").find("a").each(function(){a.push($(this).data("vid"))});var e=a.join(",");e.length>0?0==parseInt(ma)?Strack.open_dialog("dialog",{title:WebplayerPHP.Add_Playlist,width:480,height:220,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mvids",type:"hidden",name:"vids",valid:1,value:e}],items:[{case:1,id:"Mplist_name",type:"text",lang:StrackPHP.Name,name:"plist_name",valid:1,value:""},{case:2,id:"Mproject_id",type:"text",lang:StrackPHP.Project,name:"project_id",valid:1,value:""}],footer:[{obj:"Add_Playlist",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){Strack.combobox_widget("#Mproject_id",{url:StrackPHP.loadAllProject,valueField:"project_id",textField:"p_name"})}}):$.ajax({type:"POST",url:WebplayerPHP.Uplaylist,data:{listid:ma,ver_ids:e},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(a){Strack.top_message({bg:"g",msg:WebplayerPHP.Playlist_Modify_SC}),$.messager.progress("close")}}):layer.msg(WebplayerPHP.Timeline_Is_Empty,{icon:2,time:1200,anim:6})},plistMarker:function(a){if(ma>0&&$.inArray(_a,["lists","client"])>=0)obj.doPlistMarker(ma,"list");else if(0==ma&&"single"==_a){var e=$("#m_ids").val();obj.doPlistMarker(e,_a)}else layer.msg(WebplayerPHP.Timeline_Is_Empty,{icon:2,time:1200,anim:6})},doPlistMarker:function(a,e){$.ajax({type:"POST",url:WebplayerPHP.markPlaylist,data:{listid:a,mtype:e},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(a){Strack.top_message({bg:"g",msg:WebplayerPHP.Playlist_Reviewed_SC}),$.messager.progress("close")}})},Add_Playlist:function(){Strack.ajax_dialog_form("#st_dialog_form input",Fa,WebplayerPHP.Add_Playlist,{back:function(a){var e=JSON.parse(a);switch(parseInt(e.status)){case-1:layer.msg(WebplayerPHP.Playlist_Name_Length,{icon:7,time:1200,anim:6});break;case 200:ma=e.data,Strack.G.Gplaylistid=ma,Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:WebplayerPHP.Playlist_Version_Add_SC})}}})},SearchPlaylist:function(a){var t=$("#search_plist").val();t.length>0?$.ajax({type:"POST",url:WebplayerPHP.SearchPlaylist,dataType:"json",data:{search_val:t},beforeSend:function(){$("#play_list").append(Strack.loading_dom("black","","plist"))},success:function(a){var t=a.total,s=a.rows,n="",l=$("#play_list");if(parseInt(t)>0){for(var c in s){var o="";s[c].forEach(function(a){o+=i(a)}),n+=e(c,o)}l.empty().append(n)}else l.empty().append('<div class="datagrid-empty-no">'+WebplayerPHP.No_Playlist_Data+"</div>");$("#back_plist").hide(),$("#reset_plist").show()}}):layer.msg(WebplayerPHP.Please_Input_Search,{icon:2,time:1200,anim:6})},ResetSearch:function(){f(1,100,"new"),$("#back_plist").hide(),$("#reset_plist").hide()},paintThumb:function(a){$(a).hasClass("st-selected")?$(a).removeClass("st-selected"):$(a).addClass("st-selected")},RefreshNote:function(a,e,t,i,s,n){m(a,e,t,i,s,n)},switchTab:function(a){var e=$(a).data("tab");$("#task_tabs").find(".item").removeClass("active"),Wa=e,R(e)},mediaVerWipe:function(){},mediaVerLoad:function(){},mediaVerCancel:function(){}};var O=$(".st-bg-black");if(PARSE_VAR.auth.authority){!function(a){var e=0;for(var t in a){var i=a[t];switch(i.alias){case"webplayer_mdtrack":case"webplayer_maker":"no"==i.allow&&(e++,$(".ah_"+i.alias).remove());break;case"task_action":"no"==i.allow&&(Aa=!1,$(".ah_"+i.alias).remove())}}2==e&&$("#time_ebnt").remove()}(PARSE_VAR.rules);var q,V,B,U,z,J,K,X,Y,Q,Z,aa,ea,ta,ia,sa,na,la,ca,oa,ra=$("#m_type").val(),da=$("#m_ids").val(),pa=($("#m_session").val(),$("#m_psession").val()),ma=0,_a="",ha=$("#r_handle"),ua=$("#note_panel"),va=$("#left_panel"),ya=$("#paint_show"),fa=$("#time_panel"),ka=$("#t_panel_main"),Pa=$("#timeline_name"),ga=$("#pt_top"),ba=$("#note_name"),Sa=$("#player_note_null"),$a=$("#note_info"),wa=$("#timeline_warp"),Ga=$("#preview_slider"),Ha=$("#player_isload").val(),ja=!0,Ta="all_loop",xa=!0,Ea=0,Ca="none",Aa=!0,Wa="activity",Ia=!1;Strack.G.WebplayerPage=!0;var Fa={"plist_name-1":WebplayerPHP.Playlist_Name_NULL,"project_id-1":WebplayerPHP.Not_Select_Project};!function(a,e,t){switch(_a=a,a){case"single":s(a,e),na="review_inside",la=135,Strack.G.Gplaylistid=0;break;case"lists":ma=e,Strack.G.Gplaylistid=ma,s(a,e),na="review_inside",la=135;break;case"client":na="review_client",Ia=!0,ma=e,la=23,Strack.G.Gplaylistid=ma,s(a,e),obj.TogglePlist("#mpl_plist"),$("#mpl_plist").parent().remove(),$("#mc_tsave").parent().remove(),$(".pyn-h-info").remove()}}(ra,da),Strack.CancelGload(),Ia||f(1,100,"new"),function(){ya.on("click",function(){I($("#mc_paint"))}),fa.on("click",function(){W()}),Pa.on("click",function(){W()}),ha.on("click",function(){A()}),ba.on("click",function(){A()}),$(".center-handle").on("mousedown",function(a){a.preventDefault(),B=document.body.clientHeight-48,$(".webplayer-wrap").on("mousemove",function(a){var e=document.body.clientHeight-a.pageY;U=e<140?40:e>=B?B:e;var t=U+8;U<140?(ka.css("height",40),ga.css("height","calc(100% - 48px)"),fa.html('<i class="icon-uniE76C"></i>').removeClass("t_panel_open"),Pa.show(),wa.hide()):(ka.css("height",U),ga.css("height","calc(100% - "+t+"px)"),fa.html('<i class="icon-uniE76B"></i>').addClass("t_panel_open"),Pa.hide(),wa.show())}).on("mouseup",function(a){$(this).off("mousemove")})}),$(".right-handle").on("mousedown",function(a){a.preventDefault(),q=880,$(".webplayer-wrap").on("mousemove",function(a){var e=document.body.clientWidth-a.pageX;V=e<660?30:e>=q?q:e;var t=V+8;V<660?(ua.css("width",40),va.css("width","calc(100% - 48px)"),ha.html('<i class="icon-uniF0D9"></i>').removeClass("r_panel_open"),$a.hide(),Sa.hide(),ba.show()):(ua.css("width",V),va.css("width","calc(100% - "+t+"px)"),ha.html('<i class="icon-uniF0DA"></i>').addClass("r_panel_open"),ba.hide(),"yes"==Ha?$a.show():Sa.show())}).on("mouseup",function(a){$(this).off("mousemove")})})}(),function(){$("#video_paint").wPaint({fontSizeMax:25,menuDom:"#paint_menu",menuOrientation:"vertical",imageBg:StrackPHP.PUBLIC+"/images/screenshot.png"}),$("body").append(Strack.PhotoSwipeButtonDOM())}(),function(){$("#preview_main").on("mresize",function(){ea&&T("#video_main")})}(),function(){$(document).on("keydown",function(a){if(ea&&xa&&0==$("#pyn_editor").find(".focus").length)switch(a.keyCode){case 32:obj.vplay($("#mc_play"));break;case 37:"video"==Ca?(x(),J.seekBackward(1)):layer.msg(WebplayerPHP.Play_Media_Is_Img,{icon:2,time:1200,anim:6});break;case 39:"video"==Ca?(x(),J.seekForward(1)):layer.msg(WebplayerPHP.Play_Media_Is_Img,{icon:2,time:1200,anim:6});break;case 70:T("#video_main");break;case 73:obj.ShowMeta()}})}()}else O.empty().append(Strack.ProjWarn(StrackPHP.NoPermission)).show()});