$(function(){function e(){$(".job_check").on("change",function(){var e=$(this).attr("data-jobid");$(this).is(":checked")?($("#job_active_"+e).show(),$("#job_enddate_"+e).hide()):($("#job_active_"+e).hide(),$("#job_enddate_"+e).show())})}function t(e){var t="";return t+='<span class="tag-items"><span class="aign-left">'+e.tag_name+"</span>",b&&(t+='<a href="javascript:;" class="uedit-tags aign-left" onclick="obj.remove_skill(this)" data-skillid="'+e.skill_id+'"><i class="icon-uniE765 tag-icon widget-edit"></i></a>'),t+="</span>"}function a(e){var t="";return t+='<div id="uc_edu_'+e+'" class="uc-job-edit"><div class="ucjob-edit-title">'+UInfoSetPHP.School+'</div><div class="ucjob-edit-input"><input id="edu_school_'+e+'" class="userinfo-input uinfo-edit" name="edu_school" autocomplete="off"></div><div class="ucjob-edit-title">'+UInfoSetPHP.FieldofStudy+'</div><div class="ucjob-edit-input"><input id="edu_field_'+e+'" class="userinfo-input uinfo-edit" name="edu_field" autocomplete="off"></div><div class="ucjob-edit-title">'+UInfoSetPHP.Degree+'</div><div class="ucjob-edit-input"><input id="edu_degree_'+e+'" class="userinfo-input uinfo-edit" name="edu_degree" autocomplete="off"></div><div class="ucjob-edit-title">'+UInfoSetPHP.DatesAttended+'</div><div class="ucjob-edit-date"><div class="ucedu-date icon-left aign-left"><input id="edu_start_'+e+'" class="ujobdate-input" name="edu_start" autocomplete="off"></div><div class="ucjob-to-icon icon-left aign-left">–</div><div class="ucedu-date aign-left"><input id="edu_end_'+e+'" class="ujobdate-input" name="edu_end" autocomplete="off"></div></div><div class="ucjob-edit-bottom"><div class="st-dialog-footer"><a href="javascript:;" class="st-dialog-button st-button-base button-dgsub" onclick="obj.edu_submit(this);" data-eduid="'+e+'">'+StrackPHP.Submit+'</a><a href="javascript:;" class="st-dialog-button st-button-base button-dgcel" onclick="obj.edu_cancel(this);" data-eduid="'+e+'">'+StrackPHP.Cancel+"</a>",e>0&&(t+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgcel" onclick="obj.edu_deleted(this);" data-eduid="'+e+'">'+UInfoSetPHP.RemoveEducation+"</a>"),t+="</div></div></div>"}function i(e,t){var a="";return a+='<div id="cedu_wrap_'+e.edu_id+'" class="uc-job-wrap" data-school="'+e.school+'" data-field="'+e.field+'" data-degree="'+e.degree+'" data-sdate="'+e.start_date+'" data-edate="'+e.end_date+'"><div class="c-job-name c-job-item cw-job-item">',b&&(a+='<a href="javascript:;" class="cjob-md-work aign-left" onclick="obj.edit_education(this)" data-eduid="'+e.edu_id+'"><i class="icon-uniE684"></i></a>'),a+='<div class="aign-left">'+e.school+'</div></div><div class="c-job-company c-job-item"><span>'+e.field+"</span><span> | </span><span>"+e.degree_name+'</span></div><div class="c-job-time c-job-item"><span>'+e.start_date+"</span><span> - </span><span>"+e.end_date+"</span></div></div>","new"==t?'<div id="userinfo_cedu_'+e.edu_id+'" class="userinfo-c-job">'+a+"</div>":a}function o(e){var t="";return t+='<div id="uc_job_'+e+'" class="uc-job-edit"><div class="ucjob-edit-title">'+UInfoSetPHP.CompanyName+'</div><div class="ucjob-edit-input"><input  id="job_compname_'+e+'" class="userinfo-input uinfo-edit" name="job_company_name" autocomplete="off"></div><div class="ucjob-edit-title">'+UInfoSetPHP.PositionTitle+'</div><div class="ucjob-edit-input"><input  id="job_title_'+e+'" class="userinfo-input uinfo-edit" name="job_title" autocomplete="off"></div><div class="ucjob-edit-title">'+UInfoSetPHP.Location+'</div><div class="ucjob-edit-input"><input  id="job_location_'+e+'" class="userinfo-input uinfo-edit" name="job_location" autocomplete="off"></div><div class="ucjob-edit-title">'+UInfoSetPHP.TimePeriod+'</div><div class="ucjob-edit-date"><div id="job_startdate_'+e+'" class="aign-left"><div class="ucjob-date-sy icon-left aign-left"><input id="job_datesy_'+e+'" class="ujobdate-input" type="text" autocomplete="off" placeholder="'+UInfoSetPHP.Year+'"></div><div class="ucjob-combobox-sy icon-left aign-left"><input id="job_combsy_'+e+'" class="ujobdate-input" autocomplete="off"></div></div><div class="ucjob-to-icon icon-left aign-left">–</div><div id="job_active_'+e+'" class="ucjob-active ucjob-to-icon icon-left aign-left">'+UInfoSetPHP.Present+'</div><div id="job_enddate_'+e+'" class="aign-left"><div class="ucjob-date-ey icon-left aign-left"><input id="job_dateey_'+e+'" class="ujobdate-input" type="text" autocomplete="off" placeholder="'+UInfoSetPHP.Year+'"></div><div class="ucjob-combobox-ey aign-left"><input id="job_combey_'+e+'" class="ujobdate-input" autocomplete="off"></div></div></div><div class="ucjob-edit-job"><div class="edit-job-check aign-left"><input id="job_check_'+e+'" class="job_check" type="checkbox" autocomplete="off" data-jobid="'+e+'"></div><div class="aign-left">'+UInfoSetPHP.WorkStill+'</div></div><div class="ucjob-edit-title">'+StrackPHP.Description+'</div><div class="ucjob-edit-content"><textarea id="job_textarea_'+e+'" class="widget-edit" name="p_description"></textarea></div><div class="ucjob-edit-bottom"><div class="st-dialog-footer"><a href="javascript:;" class="st-dialog-button st-button-base button-dgsub" onclick="obj.job_submit(this);" data-jobid="'+e+'">'+StrackPHP.Submit+'</a><a href="javascript:;" class="st-dialog-button st-button-base button-dgcel" onclick="obj.job_cancel(this);" data-jobid="'+e+'">'+StrackPHP.Cancel+"</a>",e>0&&(t+='<a href="javascript:;" class="st-dialog-button st-button-base button-dgcel" onclick="obj.job_deleted(this);" data-jobid="'+e+'">'+UInfoSetPHP.RemovePosition+"</a>"),t+="</div></div></div>"}function s(e,t){var a="",i="",o="";return i=parseInt(e.count_year)>0?"("+e.count_year+'<span class="icon-left"></span>'+UInfoSetPHP.Years+'<span class="icon-left"></span>'+e.count_month+'<span class="icon-left"></span>'+UInfoSetPHP.Months+")":"("+e.count_month+'<span class="icon-left"></span>'+UInfoSetPHP.Months+")",o=parseInt(e.end_year)&&parseInt(e.end_month)?e.end_year+"-"+e.show_emonth:UInfoSetPHP.Present,a+='<div id="cjob_wrap_'+e.exp_id+'"  class="uc-job-wrap" data-cname="'+e.company+'" data-title="'+e.title+'" data-location="'+e.location+'" data-starty="'+e.start_year+'" data-startm="'+e.start_month+'" data-desc="'+e.job_description+'" data-endy="'+e.end_year+'" data-endm="'+e.end_month+'"><div class="c-job-name c-job-item cw-job-item">',b&&(a+='<a href="javascript:;" class="cjob-md-work aign-left" onclick="obj.edit_workexp(this)" data-jobid="'+e.exp_id+'"><i class="icon-uniE684"></i></a>'),a+='<div class="aign-left">'+e.title+'</div></div><div class="c-job-company c-job-item">'+e.company+'</div><div class="c-job-time c-job-item"><div class="cjob-time-range aign-left"><span>'+e.start_year+"-"+e.show_smonth+"</span><span> - </span><span>"+o+'</span><span class="icon-right">'+i+'</span></div><span class="cjob-date-sep">|</span><span>'+e.location+'</span></div><div class="c-job-do c-job-item">'+e.job_description+"</div></div>","new"==t?'<div id="userinfo_cjob_'+e.exp_id+'"  class="userinfo-c-job">'+a+"</div>":a}function d(e){_(e),$("#ac_my_name").append(e.name),$("#ac_my_dept").append(e.department_name),$("#ac_my_scope").append(e.scope_name),$("#ac_my_group").append(e.group_name)}function n(e){var a="";e.forEach(function(e){a+=t(e)}),$("#userinfo_siklls").empty().append(a)}function c(e){var t="";e.forEach(function(e){t+=i(e,"new")}),$("#uedu_list").empty().append(t)}function l(e){var t="";e.forEach(function(e){t+=s(e,"new")}),$("#ujob_list").empty().append(t)}function u(e){$(".userinfo-c-one").each(function(){var t=$(this).data("field"),a=$("#uedit_n_"+t),i="",o="";switch(t){case"sex":i=e.sex_name,o=e.sex;break;case"lang":i=e.lang_name,o=e.lang;break;case"nation":i='<i class="'+e.nation+' flag"></i>'+e.name,o=e.nation;break;case"birth":i=e.birth,o=e.birth;break;default:i=e[t],o=e[t]}a.find(".uitem-show-name").html(i),a.append(r(t,o))})}function r(e,t){var a="",i="";switch(e){case"sex":case"lang":case"nation":i="combobox";break;case"birth":i="date";break;case"origo":case"location":case"phone":case"email":case"qq":case"wexin":case"linkedin":case"website":i="text"}if(t||(t=""),b)return a+='<a href="javascript:;" class="item-show-icon uinfo-edit" onclick="obj.column_edit(this)"  data-value="'+t+'" data-field="'+e+'" data-type="'+i+'"  data-validate=""><i class="icon-uniE684"></i></a>'}function _(e){$("#ac_my_avatar").empty().append(Strack.build_avatar(e.user_id,e.avatar,Strack.upper_first_str(e.pinyin)))}obj={column_edit:function(e){Strack.update_userInfo();var t=$(e),a=t.data("field"),i=t.attr("data-value"),o=t.data("type"),s=$("#uitem_"+a),d=$("#uedit_i_"+a);$("#uedit_n_"+a).hide(),d.show();var n=!1;switch($.inArray(a,["lang"])>=0&&(n=!0),o){case"text":s.val(i).addClass("uedit_i_ac");break;case"combobox":s.addClass("uedit_i_ac").combobox({url:UInfoSetPHP.getUserinfoCombobox,valueField:"id",textField:"name",value:i,multiple:n,queryParams:{field:a},height:32,formatter:function(e){switch(a){case"nation":$(this).combobox("options");return'<i class="'+e.id+' flag"></i>'+e.name;default:return e.name}}}),d.find("input").addClass("uinfo-edit");break;case"date":s.addClass("uedit_i_ac").datebox({value:i,height:32}),d.find("input").addClass("uinfo-edit")}},add_workexp:function(){if(0==$("#userinfo_cjob_0").length){var t="";t='<div id="userinfo_cjob_0" class="userinfo-c-job">'+o(0)+"</div>",$("#ujob_list").prepend(t),e(),Strack.combobox_widget("#job_combsy_0",{url:UInfoSetPHP.getYearMonthList,valueField:"id",textField:"name",width:110,height:35,value:1}),Strack.combobox_widget("#job_combey_0",{url:UInfoSetPHP.getYearMonthList,valueField:"id",textField:"name",width:110,height:35,value:1})}},edit_workexp:function(t){var a=$(t).data("jobid"),i=$("#cjob_wrap_"+a);if(0==$("#uc_job_"+a).length){$("#userinfo_cjob_"+a).prepend(o(a)),i.hide();var s=i.data("cname"),d=i.data("title"),n=i.data("location"),c=i.data("starty"),l=i.data("startm"),u=i.data("endy"),r=i.data("endm"),_=i.data("desc");$("#job_compname_"+a).val(s),$("#job_title_"+a).val(d),$("#job_location_"+a).val(n),$("#job_datesy_"+a).val(c),Strack.combobox_widget("#job_combsy_"+a,{url:UInfoSetPHP.getYearMonthList,valueField:"id",textField:"name",width:110,height:35,value:l}),0==parseInt(u)&&0==parseInt(r)?($("#job_active_"+a).show(),$("#job_enddate_"+a).hide(),$("#job_check_"+a).attr("checked",!0),Strack.combobox_widget("#job_combey_"+a,{url:UInfoSetPHP.getYearMonthList,valueField:"id",textField:"name",width:110,height:35,value:1})):($("#job_dateey_"+a).val(u),Strack.combobox_widget("#job_combey_"+a,{url:UInfoSetPHP.getYearMonthList,valueField:"id",textField:"name",width:110,height:35,value:r})),$("#job_textarea_"+a).val(_),e()}},job_submit:function(e){var t=parseInt($(e).data("jobid")),a=$("#job_compname_"+t).val(),i=$("#job_title_"+t).val(),o=$("#job_location_"+t).val(),d=$("#job_datesy_"+t).val(),n=Strack.get_combos_val("#job_combsy_"+t,"combobox","getValue"),c=$("#job_dateey_"+t).val(),l=Strack.get_combos_val("#job_combey_"+t,"combobox","getValue"),u=$("#job_check_"+t).is(":checked"),r=$("#job_textarea_"+t).val();0==a.length||a.length>128?layer.msg(UInfoSetPHP.Job_CompName_Length,{icon:2,time:1200,anim:6}):0==i.length||i.length>64?layer.msg(UInfoSetPHP.Job_Title_Length,{icon:2,time:1200,anim:6}):0==d.length?layer.msg(UInfoSetPHP.Job_SYdate_Null,{icon:2,time:1200,anim:6}):1==n?layer.msg(UInfoSetPHP.Job_SCdate_Null,{icon:2,time:1200,anim:6}):u||0!=c.length?u||1!=l?$.ajax({type:"POST",url:UInfoSetPHP.modifyWorkExp,dataType:"json",data:{jobid:t,comp_name:a,title:i,location:o,datesy:d,combsy:n,checkac:u,dateey:c,combey:l,descp:r},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){if($.messager.progress("close"),200==parseInt(e.status)){var a="";Strack.top_message({bg:"g",msg:e.message}),0==t?($("#userinfo_cjob_0").remove(),a=s(e.data,"new"),$("#ujob_list").append(a)):(a=s(e.data,"old"),$("#userinfo_cjob_"+t).empty().append(a))}else layer.msg(e.message,{icon:7,time:1200,anim:6})}}):layer.msg(UInfoSetPHP.Job_ECdate_Null,{icon:2,time:1200,anim:6}):layer.msg(UInfoSetPHP.Job_EYdate_Null,{icon:2,time:1200,anim:6})},job_deleted:function(e){var t=$(e).data("jobid");$.ajax({type:"POST",url:UInfoSetPHP.deletedWorkExp,dataType:"json",data:{jobid:t},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close"),Strack.top_message({bg:"g",msg:e.message}),$("#userinfo_cjob_"+t).remove()}})},job_cancel:function(e){var t=$(e).data("jobid");t>0?($("#uc_job_"+t).remove(),$("#cjob_wrap_"+t).show()):$("#userinfo_cjob_"+t).remove()},add_education:function(e){if(0==$("#userinfo_cedu_0").length){var t="";t='<div id="userinfo_cedu_0" class="userinfo-c-job">'+a(0)+"</div>",$("#uedu_list").prepend(t),Strack.combobox_widget("#edu_degree_0",{url:UInfoSetPHP.getDegreeList,valueField:"degree_id",textField:"degree_name",width:400,height:35,value:"bachelor"}),$("#edu_start_0").datebox({width:110,height:33}),$("#edu_end_0").datebox({width:110,height:33})}},edit_education:function(e){var t=$(e).data("eduid"),i=$("#cedu_wrap_"+t);if(0==$("#uc_edu_"+t).length){$("#userinfo_cedu_"+t).prepend(a(t)),i.hide();var o=i.data("school"),s=i.data("field"),d=i.data("degree"),n=i.data("sdate"),c=i.data("edate");$("#edu_school_"+t).val(o),$("#edu_field_"+t).val(s),Strack.combobox_widget("#edu_degree_"+t,{url:UInfoSetPHP.getDegreeList,valueField:"degree_id",textField:"degree_name",width:400,height:35,value:d}),$("#edu_start_"+t).datebox({width:110,height:33,value:n}),$("#edu_end_"+t).datebox({width:110,height:33,value:c})}},edu_submit:function(e){var t=parseInt($(e).data("eduid")),a=$("#edu_school_"+t).val(),o=$("#edu_field_"+t).val(),s=Strack.get_combos_val("#edu_degree_"+t,"combobox","getValue"),d=$("#edu_start_"+t).datebox("getValue"),n=$("#edu_end_"+t).datebox("getValue");0==a.length||a.length>255?layer.msg(UInfoSetPHP.Edu_School_Length,{icon:2,time:1200,anim:6}):0==o.length||o.length>128?layer.msg(UInfoSetPHP.Edu_Field_Length,{icon:2,time:1200,anim:6}):0==s.length?layer.msg(UInfoSetPHP.Edu_Degree_Null,{icon:2,time:1200,anim:6}):d?n?$.ajax({type:"POST",url:UInfoSetPHP.modifyEducation,dataType:"json",data:{eduid:t,school:a,field:o,degree:s,start_date:d,end_date:n},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){if($.messager.progress("close"),200==parseInt(e.status)){var a="";Strack.top_message({bg:"g",msg:e.message}),0==t?($("#userinfo_cedu_0").remove(),a=i(e.data,"new"),$("#uedu_list").append(a)):(a=i(e.data,"old"),$("#userinfo_cedu_"+t).empty().append(a))}else layer.msg(e.message,{icon:7,time:1200,anim:6})}}):layer.msg(UInfoSetPHP.Edu_endDate_Null,{icon:2,time:1200,anim:6}):layer.msg(UInfoSetPHP.Edu_startDate_Null,{icon:2,time:1200,anim:6})},edu_deleted:function(e){var t=$(e).data("eduid");$.ajax({type:"POST",url:UInfoSetPHP.deletedEducation,dataType:"json",data:{eduid:t},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close"),Strack.top_message({bg:"g",msg:e.message}),$("#userinfo_cedu_"+t).remove()}})},edu_cancel:function(e){var t=$(e).data("eduid");t>0?($("#uc_edu_"+t).remove(),$("#cedu_wrap_"+t).show()):$("#userinfo_cedu_"+t).remove()},add_user_skill:function(e){$("#edit_u_tags").show()},skill_submit:function(e){var a=$("#add_u_tags").val();0==a.length?layer.msg(UInfoSetPHP.Userinfo_Tags_Null,{icon:2,time:1200,anim:6}):a.length>40?layer.msg(UInfoSetPHP.Userinfo_Tags_Length,{icon:2,time:1200,anim:6}):$.ajax({type:"POST",url:UInfoSetPHP.addSkill,dataType:"json",data:{skill_name:a},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){if($.messager.progress("close"),200==parseInt(e.status)){$("#userinfo_siklls").append(t(e.data)),$("#edit_u_tags").hide(),Strack.top_message({bg:"g",msg:e.message})}else layer.msg(e.message,{icon:7,time:1200,anim:6})}})},remove_skill:function(e){var t=$(e).data("skillid");$.ajax({type:"POST",url:UInfoSetPHP.deletedSkill,data:{skill_id:t},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(t){$.messager.progress("close"),200==parseInt(t.status)?($(e).closest(".tag-items").remove(),Strack.top_message({bg:"g",msg:t.message})):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},skill_cancel:function(e){$("#edit_u_tags").hide()}},function(){$.ajax({type:"POST",url:UInfoSetPHP.getUserInfoDetails,dataType:"json",beforeSend:function(){$(".userinfo-m-main").append(Strack.loading_dom("white","","infobase"))},success:function(e){$("#st-load_infobase").remove(),d(e),u(e.UserDetail),l(e.UserExp),c(e.UserEdu),n(e.UserSkill)}})}();var b=!0});