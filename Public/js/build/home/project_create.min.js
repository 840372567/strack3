$(function(){var _={template_id:0,info:{},disk:{},has_media:!(obj={step_prev:function(){f.preStep()},step_next:function(){f.nextStep()},select_template:function(e){$(".step-template").removeClass("step-template-ac"),$(e).addClass("step-template-ac"),_.template_id=$(e).attr("data-tempid")},step_disks_add:function(){add_entity_disk_dialog()},add_entity_disk:function(){add_entity_disk()},delete_disk_item:function(e){var t=$(e).attr("data-moduleid");$("#entity_disk_"+t).remove()},step_submit:function(){0<$("#project_thumb_queue .uploadifive-queue-item").length?(_.has_media=!0,$("#choice_project_thumb").uploadifive("upload")):(_.has_media=!1,k())},nav_add_disk:function(e){Strack.open_dialog("dialog",{title:StrackLang.Add_Entity_Disk_Title,width:480,height:370,content:Strack.dialog_dom({type:"normal",hidden:[],items:[{case:1,id:"Ndisk_name",type:"text",lang:StrackLang.Name,name:"name",valid:"",value:""},{case:1,id:"Ndisk_code",type:"text",lang:StrackLang.Code,name:"code",valid:"",value:""},{case:1,id:"Nwin_path",type:"text",lang:StrackLang.Win_Path,name:"win_path",valid:"",value:""},{case:1,id:"Nmac_path",type:"text",lang:StrackLang.Mac_Path,name:"mac_path",valid:"",value:""},{case:1,id:"Nlinux_path",type:"text",lang:StrackLang.Linux_Path,name:"linux_path",valid:"",value:""}],footer:[{obj:"submit_add_disk",type:1,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){}})},submit_add_disk:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",StrackPHP.addProjectDisk,{back:function(e){var t;200===parseInt(e.status)?($("#add_project_disk").find(".combobox-f").each(function(){t=$(this).attr("id"),$("#"+t).combobox("reload")}),Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message})):layer.msg(e.message,{icon:7,time:1200,anim:6})}})}}),media:{mode:"single",module_id:Strack.generate_hidden_param().module_id}},u=[],g=!1,f=$("#project_step").step({mustStep:[1,2],stepCallBack:function(e){!function(n){var e={template:StrackLang.Please_Select_Template,info:StrackLang.Please_Fill_Project_Info,disk:StrackLang.Please_Set_Disk,group:""},s=!0,c=0,d="";if(["template","info","disk","group"].forEach(function(e,t){if(!(t+1<n&&s))return!1;switch(d=e){case"template":s=0<_.template_id;break;case"info":o=Strack.validate_form("add_project_info"),console.log(o.data),s=200===parseInt(o.status)?(_.info=o.data,!0):!(g=!0);break;case"disk":i={},$("#add_project_disk").find(".combobox-f").each(function(){a=$(this).attr("id"),i[$(this).attr("name")]=Strack.get_combos_val("#"+a,"combobox","getValue")}),_.disk=i,s=!0}return c=t+1,!!s&&void 0;var a,i,o}),s){switch(c+1){case 2:$.inArray(c,u)<0&&u.push(c),o=_.hasOwnProperty("info")?_.info.status_id:"",r=_.hasOwnProperty("info")?_.info.start_time:"",l=_.hasOwnProperty("info")?_.info.end_time:"",m=_.hasOwnProperty("info")?_.info.group_open:"",(p=$("#add_project_info")).hasClass("load-active")?$("#info_project_status").combobox("setValue",o):(p.addClass("load-active"),Strack.combobox_widget("#info_project_status",{url:StrackPHP.getProjectStatusCombobox,valueField:"id",textField:"name",width:626,height:39,value:o,queryParams:{template_id:_.template_id}}),$("#info_project_start").datebox({width:626,height:39,value:r,end_limit:"info_project_end"}),$("#info_project_end").datebox({width:626,height:39,value:l,start_limit:"info_project_start"}),$("#info_project_name").inputmask("*{1,128}"),$("#info_project_code").inputmask("alphaDash"),$("#info_project_rate").inputmask("decimal"),Strack.init_open_switch({dom:"#project_group_open",value:m,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100}),Strack.get_media_server(function(i){$("#choice_project_thumb").uploadifive({auto:!1,formData:{timestamp:Strack.current_time(),token:i.token,size:"250Ã—140"},multi:!1,queueSizeLimit:1,queueID:"project_thumb_queue",uploadScript:i.upload_url,onUpload:function(e){0==e?layer.msg(StrackLang.Please_Select_File,{icon:2,time:1200,anim:6}):$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},onUploadComplete:function(e,t){var a=JSON.parse(t);200===parseInt(a.status)?(_.media.media_server=i,_.media.media_data=a.data,k()):layer.msg(a.message,{icon:7,time:1200,anim:6})}})}));break;case 3:$.inArray(c,u)<0&&(u.push(c),$.ajax({type:"POST",url:ProjectPHP.getCreateProjectDiskConfig,data:JSON.stringify(_),dataType:"json",contentType:"application/json",beforeSend:function(){$("#overview_disk").prepend(Strack.loading_dom("white","","disk"))},success:function(o){Strack.combobox_widget("#disk_global_combobox",{url:StrackPHP.getDiskCombobox,prompt:StrackLang.Please_Select_Disk,valueField:"id",textField:"name",value:o.disk_config.global,width:300,height:30,onSelect:function(e){}});var n,s=$("#entity_disk_list");0<o.module_list.length&&(s.empty(),o.module_list.forEach(function(e){var t,a,i;$.inArray(e.code,["project"])<0&&(n=o.disk_config[e.code]?o.disk_config[e.code]:"",s.append((a="",i="disk_"+(t=e).code,a+='<div class="ui grid disk-setting-item"><div class="two column row"><div class="five wide column"><span class="title">'+t.name+'</span></div><div class="eleven wide column combobox"><input id="'+i+'" name="'+t.code+'" autocomplete="off"/></div></div></div>')),Strack.combobox_widget("#disk_"+e.code,{url:StrackPHP.getDiskCombobox,prompt:StrackLang.Please_Select_Disk,valueField:"id",textField:"name",value:n,width:300,height:30,onSelect:function(e){}}))})),$("#st-load_disk").remove()}}))}var t=$("#bottom_bnt_prev"),a=$("#bottom_bnt_next"),i=$("#bottom_bnt_submit");switch(f.goStep(n),n){case 1:t.hide(),a.show(),i.hide();break;case 3:t.show(),a.hide(),i.show();break;default:t.show(),a.show(),i.hide()}}else g||layer.msg(e[d],{icon:2,time:1200,anim:6});var o,r,l,m,p}(e)}});function k(){$.ajax({type:"POST",url:ProjectPHP.addProject,data:JSON.stringify(_),dataType:"json",contentType:"application/json",beforeSend:function(){_.has_media||$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){$.messager.progress("close"),200===parseInt(e.status)?layer.msg(e.message,{icon:1,shade:.2,time:1e3},function(){location.href=ProjectPHP.project_create}):layer.msg(e.message,{icon:7,time:1200,anim:6})}})}function n(e){var t="",a="";return a=0===parseInt(e.project_id)?'<div class="panel-thumb-null"><i class="icon-uniF1ED"></i></div>':e.hasOwnProperty("thumb")?'<img src="'+e.thumb+'">':'<div class="panel-thumb-null"><i class="icon-uniF1ED"></i></div>',t+='<a href="javascript:;" class="wide column step-template" onclick="obj.select_template(this)" data-tempid="'+e.project_template_id+'"><div class="template-item"><div class="template-card">'+a+'<p class="template-name">'+e.name+"</p></div></div></a>"}f.goStep(1),$.ajax({type:"POST",url:ProjectPHP.getTemplateList,dataType:"json",beforeSend:function(){$(".project-step-content").append(Strack.loading_dom("white","","template"))},success:function(e){var t=$("#template_builtin_list"),a=!0,i=$("#template_project_list"),o=!0;e.rows.forEach(function(e){0===parseInt(e.project_id)?(a&&(t.empty(),a=!1),t.append(n(e))):(o&&(i.empty(),o=!1),i.append(n(e)))}),$(".st-load").remove()}})});