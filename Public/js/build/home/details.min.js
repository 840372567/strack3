$(function(){obj={show_details_tab_page:function(i){e(i)},create_single_grid_data:function(i){var e=$(i).data("lang");Strack.item_operate_dialog(e,{mode:"create",field_list_type:["edit"],module_id:g.module_id,project_id:g.project_id,page:g.page,type:"add_panel"},function(){obj.reset_single_grid_data()})},modify_single_grid_data:function(i){var e=$(i).data("lang");Strack.get_datagrid_select_data("#single_main_datagrid_box",function(i){Strack.item_operate_dialog(e,{mode:"modify",field_list_type:["edit"],module_id:g.module_id,project_id:g.project_id,page:g.page,type:"update_panel",primary_id:i.join(",")},function(){obj.reset_single_grid_data()})})},delete_single_grid_data:function(i){var e=$(i).attr("data-code"),t="Delete_"+Strack.string_ucwords(e)+"_Notice";Strack.ajax_grid_delete("single_main_datagrid_box","id",StrackLang[t],DetailPHP.deleteSingleGridData)},reset_single_grid_data:function(){$("#single_main_datagrid_box").datagrid("reload")},create_entity_grid_data:function(i){var e=$(i).data("lang");Strack.item_operate_dialog(e,{mode:"create",field_list_type:["edit"],module_id:g.module_id,project_id:g.project_id,page:g.page,type:"add_panel"},function(){obj.reset_entity_grid_data()})},modify_entity_grid_data:function(i){var e=$(i).data("lang");Strack.get_datagrid_select_data("#main_datagrid_box",function(i){Strack.item_operate_dialog(e,{mode:"modify",field_list_type:["edit"],module_id:g.module_id,project_id:g.project_id,page:g.page,type:"update_panel",primary_id:i.join(",")},function(){obj.reset_entity_grid_data()})})},delete_entity_grid_data:function(i){var e=$(i).attr("data-code"),t="Delete_"+Strack.string_ucwords(e)+"_Notice";Strack.ajax_grid_delete("main_datagrid_box","id",StrackLang[t],DetailPHP.deleteEntityGridData)},reset_entity_grid_data:function(){$("#main_datagrid_box").datagrid("reload")},init_timelog_bnt:function(i){l(i)}};var n,g=Strack.generate_hidden_param();function l(i){var e=$("#top_timelog_bnt");switch(e.data("timelogid",i.id),i.color){case"red":e.removeClass("green").addClass("red"),e.html('<i class="icon-uniE974 icon-left"></i>'+StrackLang.Stop);break;case"green":e.removeClass("red").addClass("green"),e.html('<i class="icon-uniE974 icon-left"></i>'+StrackLang.Start)}}function e(i){switch(Strack.active_select_tab("details_tab",i.tab_id),$(".pitem-wrap").hide(),i.type){case"fixed":var e=$("#tab_"+i.tab_id),t=$("#tab_single_grid");switch(i.tab_id){case"note":e.show(),(_=g).status="new",_.page_number=1,_.page_size=10,Strack.load_notes({page_id:".projpage-main",content_id:".task-mainwrap",avatar_id:"#comments_avatar",editor_id:"comments_editor",list_id:"comments_list",tab_id:"#details_tab",details_top_bar:!0,tab_bar_id:"task_hidebar"},_);break;case"info":e.show(),(l=g).category="main_field",Strack.load_info_panel({id:"#details_info",mask:"main_info",pos:"max",url:StrackPHP.getModuleItemInfo,data:l,loading_type:"white"});break;case"onset":e.show(),(n=g).category="onset_field",Strack.load_info_panel({id:"#onset_info",mask:"onset_info",pos:"onset",url:DetailPHP.getOnsetInfoData,data:n,loading_type:"white"},function(i){console.log(i)}),$.ajax({type:"POST",url:DetailPHP.getOnsetAttachment,data:g,dataType:"json",beforeSend:function(){$(".onset-wrap-right").prepend(Strack.loading_dom("white","","onset_att"))},success:function(i){console.log(i),$("#st-load_onset_att").remove()}});break;case"file":t.show(),s(i);break;case"reference":e.show();break;case"history":e.show(),a=$("#tab_history"),r=$("#history_datagrid"),a.hasClass("load_active")?r.datagrid("reload"):(a.addClass("load_active"),r.datagrid({url:StrackPHP.getModuleItemHistory,height:Strack.panel_height(".task-history-wrap",0),singleSelect:!0,fitColumns:!1,adaptive:{dom:".task-history-wrap",min_width:510,exth:0},queryParams:g,frozenColumns:[[{field:"event_log_id",checkbox:!0}]],columns:[[{field:"id",title:StrackLang.ID,align:"center",width:120,frozen:"frozen",findex:0,formatter:function(i,e,t){return e.id}},{field:"operate",title:StrackLang.Operate,align:"center",width:120,frozen:"frozen",findex:1},{field:"type",title:StrackLang.Type,align:"center",width:180,frozen:"frozen",findex:2},{field:"record",title:StrackLang.Record,align:"center",width:600,frozen:"frozen",findex:3,formatter:function(i,e,t){return JSON.stringify(i)}},{field:"from",title:StrackLang.From,align:"center",width:120,frozen:"frozen",findex:4},{field:"created_by",title:StrackLang.Created_by,align:"center",width:160,frozen:"frozen",findex:5},{field:"created",title:StrackLang.Created,align:"center",width:180,frozen:"frozen",findex:6}]],pagination:!0,pageSize:100,pageList:[100,300,500],pageNumber:1,pagePosition:"bottom",remoteSort:!1}));break;case"correlation_base":t.show(),s(i)}break;case"horizontal_relationship":$("#tab_entity_grid").show(),o="details_"+(d=i).tab_id,Strack.load_grid_columns("#table_grid",{loading_id:"#tab_entity_grid",page:o,module_id:d.module_id,project_id:g.project_id,temp_fields:{add:{},cut:{}}},function(i){var e=$("#tab_entity_grid"),t=$("#main_datagrid_box"),a={},r={filter:{temp_fields:{add:{},cut:{}},group:i.grid.group_name,sort:i.grid.sort_config.sort_query,request:[],filter_input:i.grid.filter_config.filter_input,filter_panel:i.grid.filter_config.filter_panel,filter_advance:i.grid.filter_config.filter_advance},page:o,module_id:d.module_id,project_id:g.project_id};e.hasClass("load_active")?(a={moduleId:d.module_id,queryParams:{filter_data:JSON.stringify(r)},panelConfig:{active_filter_id:i.grid.filter_config.filter_id},sortConfig:i.grid.sort_config,sortData:i.grid.sort_config.sort_data,toolbarConfig:{id:"grid_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,stepAllow:!0,actionAllow:!0},searchConfig:{id:"main_grid_search",bar_show:i.filter_bar_show,filterBar:{main_dom:"grid_datagrid_main",bar_dom:"grid_filter_main"}},filterConfig:{id:"grid_filter_main",barParam:{}},columnsFieldConfig:i.grid.columnsFieldConfig,frozenColumns:i.grid.frozenColumns,columns:i.grid.columns},i.grid.group_name.length&&(a.groupActive=!0,a.groupField=i.grid.group_name,a.groupFormatter=function(i,e){return'<span class="">'+i+"( "+e.length+" )</span>"}),t.datagrid("setOptions",a).datagrid("reload")):(e.addClass("load_active"),a={url:DetailPHP.getEntityGridData,height:Strack.panel_height("#grid_datagrid_main",0),view:scrollview,rowheight:50,differhigh:!0,singleSelect:!1,adaptive:{dom:".base-m-grid",min_width:680,exth:0,domresize:1},multiSort:!0,DragSelect:!0,moduleId:d.module_id,queryParams:{filter_data:JSON.stringify(r)},panelConfig:{active_filter_id:i.grid.filter_config.filter_id},sortConfig:i.grid.sort_config,sortData:i.grid.sort_config.sort_data,toolbarConfig:{id:"grid_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,stepAllow:!0,actionAllow:!0},searchConfig:{id:"main_grid_search",bar_show:i.filter_bar_show,filterBar:{main_dom:"grid_datagrid_main",bar_dom:"grid_filter_main"}},filterConfig:{id:"grid_filter_main",barParam:{}},columnsFieldConfig:i.grid.columnsFieldConfig,frozenColumns:i.grid.frozenColumns,columns:i.grid.columns,toolbar:"#tb_grid",pagination:!0,pageNumber:1,pageSize:100,pageList:[100,150],pagePosition:"bottom",showPageList:!1,remoteSort:!1,onDblClickRow:function(i,e){}},i.grid.group_name.length&&(a.groupActive=!0,a.groupField=i.grid.group_name,a.groupFormatter=function(i,e){return'<span class="">'+i+"( "+e.length+" )</span>"}),t.datagrid(a).datagrid("enableCellEditing").datagrid("disableCellSelecting").datagrid("gotoCell",{index:0,field:"id"}).datagrid("columnMoving"))})}var d,o,a,r,n,l,_}function s(d){var o="details_"+d.tab_id;Strack.load_grid_columns("#tab_single_grid",{loading_id:"#tab_single_grid",page:o,module_id:d.module_id,project_id:g.project_id,view_type:"grid",temp_fields:{add:{},cut:{}}},function(i){var e=$("#tab_single_grid"),t=$("#single_main_datagrid_box"),a={},r={filter:{temp_fields:{add:{},cut:{}},group:i.grid.group_name,sort:i.grid.sort_config.sort_query,request:[],filter_input:i.grid.filter_config.filter_input,filter_panel:i.grid.filter_config.filter_panel,filter_advance:i.grid.filter_config.filter_advance},page:o,module_id:d.module_id,project_id:g.project_id,item_id:g.item_id,module_code:g.module_code,module_type:g.module_type};e.hasClass("load_active")?(a={queryParams:{filter_data:JSON.stringify(r)},panelConfig:{active_filter_id:i.grid.filter_config.filter_id},sortConfig:i.grid.sort_config,sortData:i.grid.sort_config.sort_data,toolbarConfig:{id:"single_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,actionAllow:!0},searchConfig:{id:"single_grid_search",bar_show:i.filter_bar_show,filterBar:{main_dom:"single_datagrid_main",bar_dom:"single_filter_main"}},filterConfig:{id:"single_filter_main",barParam:{}},columnsFieldConfig:i.grid.columnsFieldConfig,frozenColumns:i.grid.frozenColumns,columns:i.grid.columns},i.grid.group_name.length&&(a.groupActive=!0,a.groupField=i.grid.group_name,a.groupFormatter=function(i,e){return'<span class="">'+i+"( "+e.length+" )</span>"}),t.datagrid("setOptions",a).datagrid("reload")):(e.addClass("load_active"),a={url:DetailPHP.getDetailGridData,height:Strack.panel_height("#single_datagrid_main",0),view:scrollview,rowheight:50,differhigh:!1,singleSelect:!1,adaptive:{dom:"#single_datagrid_main",min_width:680,exth:0,domresize:1},multiSort:!0,DragSelect:!0,queryParams:{filter_data:JSON.stringify(r)},panelConfig:{active_filter_id:i.grid.filter_config.filter_id},sortConfig:i.grid.sort_config,sortData:i.grid.sort_config.sort_data,toolbarConfig:{id:"single_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,actionAllow:!0},searchConfig:{id:"single_grid_search",bar_show:i.filter_bar_show,filterBar:{main_dom:"single_datagrid_main",bar_dom:"single_filter_main"}},filterConfig:{id:"single_filter_main",barParam:{}},columnsFieldConfig:i.grid.columnsFieldConfig,frozenColumns:i.grid.frozenColumns,columns:i.grid.columns,toolbar:"#single_tb_grid",pagination:!0,pageNumber:1,pageSize:100,pageList:[100,150],pagePosition:"bottom",showPageList:!1,remoteSort:!1},i.grid.group_name.length&&(a.groupActive=!0,a.groupField=i.grid.group_name,a.groupFormatter=function(i,e){return'<span class="">'+i+"( "+e.length+" )</span>"}),t.datagrid(a).datagrid("enableCellEditing").datagrid("disableCellSelecting").datagrid("gotoCell",{index:0,field:"id"}).datagrid("columnMoving"))})}$.ajax({type:"POST",url:DetailPHP.getDetailTopThumb,data:g,dataType:"json",beforeSend:function(){$(".item-thumb-warp").prepend(Strack.loading_dom("white"),"thumb")},success:function(i){var e,t,a=i.data;a.link_id=g.item_id,a.module_id=g.module_id,a.param.icon="icon-uniE61A",Strack.thumb_media_widget("#details_thumb",a),(e=a).has_media,t="",$("#hidebar_thumb").empty().append(Strack.build_thumb_dom(t,e.param.icon)),$("#st-load_thumb").remove()}}),(n=g).category="top_field",Strack.load_info_panel({id:"#details_top_info",mask:"top_info",pos:"min",url:StrackPHP.getModuleItemInfo,data:n,loading_type:"white"},function(i){var e,t,a,r,d,o;e=n,t=i.prev_and_next,a="",r=Strack.remove_html_ext(StrackPHP.details),d=0<t.prev?r+"/"+e.module_id+"-"+e.project_id+"-"+t.prev+".html":"javascript:;",o=0<t.next?r+"/"+e.module_id+"-"+e.project_id+"-"+t.next+".html":"javascript:;",a+='<a href="'+d+'" class="ui labeled icon button"><i class="left chevron icon"></i> '+StrackLang.Prev_One+'</a><a href="'+o+'" class="ui right labeled icon button">'+StrackLang.Next_One+' <i class="right chevron icon"></i></a>',$("#prev_next_bnt").html(a),l(i.timelog)}),Strack.init_tab_list("details_tab",g,function(i){e({tab_id:"note",type:"fixed",group:"固定模块"})}),Strack.init_breadcrumb("item_breadcrumb",g,function(i){$("#hidebar_breadcrumb").html(i)})});