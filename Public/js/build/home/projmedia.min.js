$(function(){function e(e,i){$.ajax({url:MediaPHP.mediaMarker,type:"post",data:{pid:Y,vids:e},dataType:"json",success:function(e){switch(Strack.top_message({bg:"g",msg:MediaPHP.Media_Reviewed_SC}),i){case"list":obj.DoResetMedia(i,Y,"");break;case"grid":$("#proj_table_column").datagrid("reload")}}})}function i(e,i,t){$("#enable_drag").switchbutton("uncheck"),$.messager.confirm(StrackPHP.Confirmation_Box,MediaPHP.Version_Delete_Confirm,function(a){a&&$.ajax({url:MediaPHP.DeplistVersion,type:"post",dataType:"json",data:{listid:i,vid:t},beforeSend:function(){$("#plist_vers").append(Strack.loading_dom("black","","plistver"))},success:function(i){$("#st-load_plistver").remove(),$(e).closest(".plist_iver").remove(),Strack.top_message({bg:"g",msg:MediaPHP.Playlist_Delete_SC})}})})}function t(e){$.ajax({url:MediaPHP.LoadVersionInfo,type:"post",dataType:"json",data:{vid:e},beforeSend:function(){$("#plist_info").append(Strack.loading_dom("black","","plistinfo"))},success:function(e){var i=[{lang:StrackPHP.Name,val:e.content},{lang:StrackPHP.Media_Type,val:e.mtype_name},{lang:StrackPHP.Steps,val:e.type_name},{lang:StrackPHP.Entity,val:e.entity},{lang:StrackPHP.EntityName,val:e.item_name},{lang:MediaPHP.Review_Status,val:e.ver_status},{lang:StrackPHP.Created_by,val:e.user_name},{lang:StrackPHP.Version,val:e.version},{lang:StrackPHP.Created,val:e.created}],t="";$("#plist_info_thumb").empty().append(Strack.PlistverThumb(e.media_info)),i.forEach(function(e){t+=a(e)}),$("#plist_info_des").empty().append(t),$("#st-load_plistinfo").remove()}})}function a(e){var i="";return i+='<div class="task-info-items overflow-hide"><div class="task-info-title aign-left">'+e.lang+'</div><div class="task-info-content aign-left item-hover"><a href="javascript:;" class="aign-right icon-hide widget-edit"><i class="icon-uniE63D2"></i></a><div class="info-content-show text-ellipsis taskm_p_name">'+e.val+"</div></div></div>"}function s(e){$.ajax({url:MediaPHP.LoadPlistVdata,type:"post",dataType:"json",data:{listid:e},beforeSend:function(){$("#plist_vers").append(Strack.loading_dom("black","","plistv"))},success:function(i){var t="";i.forEach(function(i){t+=o(e,i)}),$("#plist_vers").empty().append(t),n()}})}function n(){$(".plist_iver").draggable({proxy:"clone",revert:!0,disabled:!0,onStartDrag:function(e){q=$(e.target).closest(".p_version_item"),q.addClass("drag-source")},onStopDrag:function(e){if($(".p_version_item").removeClass("drag-source").removeClass("drag-hover"),ee){q.offset().top>$(ee).offset().top?$(ee).before(q[0]):$(ee).after(q[0]);d(q.data("listid"))}}}).droppable({disabled:!0,onDragOver:function(e,i){ee=e.target,$(e.target).addClass("drag-hover")},onDragLeave:function(e,i){$(".p_version_item").removeClass("drag-hover")}})}function l(e,i){Strack.open_dialog("dialog",{title:MediaPHP.Version_Lists,width:680,height:420,content:Strack.dialog_dom({type:1,mainType:"datalist",hidden:[{case:101,id:"Nproject_id",type:"hidden",name:"project_id",valid:1,value:e},{case:101,id:"Nlistid",type:"hidden",name:"listid",valid:1,value:i}],datalist:{domwrap:"dialog_wrap",domname:"dialog_data",toolbar:"dialog_tb",filter:"content",height:328},footer:[{obj:"newPlistVers",type:2,title:StrackPHP.Submit},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){var t=r(),a=Strack.build_filter({project_id:["eq",e],media_id:["neq",0],version_id:["NOT IN",t]},{},{},{});$("#dialog_data").datagrid({url:StrackPHP.MediaData,fitColumns:!1,height:Strack.panel_height("#dialog_wrap",0),differhigh:!1,rowheight:49,queryParams:{pid:e,listid:i,filter:JSON.stringify(a)},DragSelect:!0,DataNull:Strack.DataNullTip(2010),frozenColumns:[[{field:"version_id",align:"center",checkbox:!0}]],columns:[[{field:"thumb",title:StrackPHP.Thumbnail,align:"center",width:85,formatter:function(e,i,t){return'<div class="plm-g-thumb">'+Strack.PlistverThumb(i.media_info)+"</div>"}},{field:"content",title:StrackPHP.task_name,align:"center",width:220},{field:"version",title:StrackPHP.Version,align:"center",width:120},{field:"mtype_name",title:StrackPHP.Media_Type,align:"center",width:120},{field:"status",title:StrackPHP.Status,align:"center",width:120},{field:"type_name",title:StrackPHP.Steps,align:"center",width:180},{field:"Created_by",title:StrackPHP.Created_by,align:"center",width:180},{field:"created",title:StrackPHP.Created,align:"center",width:180}]],toolbar:"#dialog_tb",pagination:!0,pageSize:100,pageList:[100,200,300],pageNumber:1,pagePosition:"bottom",remoteSort:!1})}})}function d(e){var i=r();$.ajax({url:MediaPHP.SortPlistVers,type:"post",dataType:"json",data:{listid:e,ver_ids:i.join(",")},beforeSend:function(){$("#plist_vers").append(Strack.loading_dom("black","","plistv"))},success:function(e){$("#st-load_plistv").remove(),ee=null}})}function r(){var e=[];return $("#plist_vers").find(".plist_iver").each(function(){e.push($(this).data("vid"))}),e}function o(e,i){var t="";return t+='<li class="p_version_item plist_iver" data-vid="'+i.version_id+'" data-listid="'+e+'"><div class="pver-i-thumb aign-left">'+Strack.PlistverThumb(i.media_info)+'</div><div class="pver-i-name text-ellipsis aign-left">'+i.content+"</div>","yes"==F&&(t+='<a href="javascript:;" class="pver-i-del playlist-button aign-right" onclick="obj.RePlistVer(this,event)" data-vid="'+i.version_id+'" data-listid="'+e+'"><i class="icon-uniE6DB" ></i></a>'),t+='<a href="javascript:;" class="pver-i-del playlist-button aign-right" onclick="obj.ShowPlistVer(this,event)" data-vid="'+i.version_id+'" data-listid="'+e+'"><i class="icon-uniEAA4"></i></a><div class="pver-i-number aign-right">'+i.version+"</div></li>"}function c(e,i,t,a,s){$.ajax({url:MediaPHP.PlaylistData,type:"post",dataType:"json",data:{pid:i,m_type:e,pagenum:a,pagesize:s,filter:JSON.stringify(t)},beforeSend:function(){$("#plists_data").empty().append(Strack.loading_dom("black","","plist"))},success:function(i){var t="";i.total>0?i.rows.forEach(function(i){t+=Strack.PlaylistItem(i,"details","",_(e))}):t+=P(e),$("#plists_data").empty().append(t),$("#enable_drag").switchbutton({checked:!1,onChange:function(e){e?$(".plist_iver").draggable("enable").droppable("enable"):$(".plist_iver").draggable("disable").droppable("disable")}}),"no"==z&&$("#enable_drag").switchbutton("disable")}})}function m(e,i,t,a,s){$.ajax({url:MediaPHP.PlaylistData,type:"post",dataType:"json",data:{pid:i,m_type:e,pagenum:a,pagesize:s,filter:JSON.stringify(t)},beforeSend:function(){$("#cplists_data").empty().append(Strack.loading_dom("black","","cplist"))},success:function(i){var t="";i.total>0?i.rows.forEach(function(i){t+=Strack.PlaylistItem(i,"client","",_(e))}):t+=P(e),$("#cplists_data").empty().append(t)}})}function p(e){$("#reclt_table").datagrid({url:MediaPHP.ClientFeedbacks,height:Strack.panel_height(".reclt-grid-wrap",0),differhigh:!1,rowheight:58,DragSelect:!0,adaptive:{dom:".reclt-grid-wrap",min_width:510,exth:0},queryParams:{listid:e},DataNull:MediaPHP.PlistNoSend,columns:[[{field:"note_id",checkbox:!0},{field:"thumb",title:StrackPHP.Thumbnail,align:"center",width:85,frozen:"frozen",findex:0,formatter:function(e,i,t){return Strack.DataTaskThumb(StrackPHP.TASK_THUMB,StrackPHP.pagetask,i.p_folder,e,i.task_id,i.project_id,i.link_type,"min")}},{field:"content",title:StrackPHP.task_name,align:"center",width:180},{field:"note_status",title:StrackPHP.Status,align:"center",width:80},{field:"note_text",title:StrackPHP.NoteText,align:"center",width:360},{field:"from",title:StrackPHP.NoteFrom,align:"center",width:160},{field:"created",title:StrackPHP.Created,align:"center",width:120}]],pagination:!0,pageSize:25,pageList:[25,50],pageNumber:1,pagePosition:"bottom",remoteSort:!1})}function u(e){$.ajax({type:"POST",url:MediaPHP.getPlistSession,dataType:"json",data:{plist_id:e},beforeSend:function(){$("#projover_rmain").append(Strack.loading_dom("black","","replist"))},success:function(e){var i=Math.floor(1e3*Math.random()+1);J=i;var t="",a="";switch($("#projover_rmain").empty().append(f(i,e.data)),parseInt(e.status)){case 200:W=!1,t=e.data.sub_date,a=e.data.due_date;break;case 400:W=!0}$("#review_startime_"+i).datebox({width:220,height:25,value:t,onSelect:function(e){if(!W){h("sub_date",e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate())}}}),$("#review_endtime_"+i).datebox({width:220,height:25,value:a,onSelect:function(e){if(!W){h("due_date",e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate())}}}),$("#st-load_replist").remove()}})}function h(e,i){$.ajax({type:"POST",url:MediaPHP.upSessionDate,dataType:"json",data:{from:e,date:i,Gplistid:te},beforeSend:function(){},success:function(e){}})}function f(e,i){var t="";return t+='<div class="rclient-time"><div class="rclient-time-item"><div class="rclient-name aign-left">'+StrackPHP.SubDate+':</div><div class="aign-left"><input id="review_startime_'+e+'"/></div></div><div class="rclient-time-item"><div class="rclient-name aign-left">'+StrackPHP.DueDate+':</div><div class="aign-left"><input id="review_endtime_'+e+'"/></div></div></div><div class="rclient-uers"><div class="rclient-b-title"><div class="aign-left">'+MediaPHP.Clients+'</div><a href="javascript:;" class="rclient-plus aign-right" onclick="obj.addClients(this)" data-psessionid = "'+i.plist_session_id+'"><i class="icon plus"></i></a></div><div id="rclient_list" class="rclient-ulist" data-psessionid = "'+i.plist_session_id+'">'+g(i.user_ids)+'</div></div><div class="rclient-bottom"><a href="javascript:;" class="form-button-long-gray form-button-hover-gray" onclick="obj.CreatedSession();" >'+MediaPHP.CreatedSession+'</a><a href="javascript:;" class="form-button-long form-button-hover" onclick="obj.SendInvites(this);" data-psessionid = "'+i.plist_session_id+'">'+MediaPHP.Send_Invites+"</a></div>"}function g(e){if(e&&e.length>0){var i="";return e.forEach(function(e){i+='<div class="rclient-b-uitem"><div class="uitem-mail text-ellipsis aign-left">'+e+'</div><a href="javascript:;" class="uitem-del aign-left" onclick="obj.delRclient(this)"><i class="icon-uniE6DB"></i></a></div>'}),i}return'<div class="datagrid-empty-no">'+MediaPHP.Add_Review_Client+"</div>"}function P(e){var i="";switch(e){case 50:i='<div class="empty">'+MediaPHP.Review_Lists_Null+"</div>";break;case 60:i='<div class="empty">'+MediaPHP.Client_Lists_Null+"</div>";break;case 70:i='<div class="empty">'+MediaPHP.My_Favorite_Playlist_Null+"</div>";break;case 90:i='<div class="empty">'+MediaPHP.My_Create_Playlists_Null+"</div>";break;case 100:i='<div class="empty">'+MediaPHP.My_Review_Lists_Null+"</div>";break;case 110:i='<div class="empty">'+MediaPHP.Reviewed_PlayLists_Null+"</div>";break;case 120:i='<div class="empty">'+MediaPHP.NoSessionLists_Null+"</div>";break;case 130:i='<div class="empty">'+MediaPHP.IPSessionLists_Null+"</div>";break;case 140:i='<div class="empty">'+MediaPHP.ExSessionLists_Null+"</div>"}return i}function _(e){switch(parseInt(e)){case 50:case 60:case 100:return!1;case 70:case 90:case 110:return!0}}function v(e,i){$.ajax({type:"POST",url:MediaPHP.saveClients,data:{psessionId:e,clientEmail:i},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){switch($.messager.progress("close"),parseInt(e.status)){case 200:Strack.top_message({bg:"g",msg:MediaPHP.Add_Review_Clients_SC}),Strack.dialog_cancel(),b(e.data);break;default:layer.msg(MediaPHP.Email_Format_Error,{icon:7,time:1200,anim:6})}}})}function k(e,i){$.ajax({type:"POST",url:MediaPHP.delClients,data:{psessionId:e,clientEmail:i},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){Strack.top_message({bg:"g",msg:MediaPHP.Delete_Review_Clients_SC}),$.messager.progress("close"),b(e.data)}})}function b(e){$("#rclient_list").empty().append(g(e))}function y(e,i){var t="";return t+='<div class="media_m_item '+e+'"><a href="'+i.url+'" class="m_item_name">'+i.lang+"</a></div>"}function S(e,i,t,a,s,n){var l=$("#stm_postwall");$.ajax({type:"POST",url:StrackPHP.MediaListData,dataType:"json",data:{project_id:e,mode:i,pagenum:a,pagesize:s,filter:JSON.stringify(t),group:JSON.stringify(R)},beforeSend:function(){"new"==n&&l.empty().off("mousedown"),l.append(Strack.loading_dom("black","","plistv"))},success:function(d){var r=d.total,o="";if(r>0)if("no"==R.need)d.rows.forEach(function(e){o+=C(e,e.progress,d.review_set)});else for(var c in d.rows){var m="",p=md5(c),u=d.rows[c].length;if(d.rows[c].forEach(function(e){m+=C(e,e.progress,d.review_set)}),$("#"+p).length>0){$("#"+p).append(m);var h=$("#num_"+p),f=parseInt(h.html())+u;h.html(f)}else o+=T(c,u,m)}else o=Strack.DataNullTip(2010);"new"==n?(M(),$("#stm_postwall").scroll(function(){if((this.scrollTop||this.scrollTop)==(this.scrollHeight||this.scrollHeight)-(this.clientHeight||this.clientHeight)){a++;var n=Math.ceil(r/s);a<=n&&S(e,i,t,a,s,"old")}}),l.append(o),V&&($(".stm-items-info").show(),$("#toggleinfo_icon").html('<i class="icon-uniE8FB"></i>'),$(".stm-items-tshow ").hide(),$(".stm-items-hold").css("height","25px"),$("#stm_postwall").removeClass("stm_post_hide").addClass("stm_post_show"))):l.append(o),$("#st-load_plistv").remove()}})}function w(){var e=[];"yes"==U.meidalist_add.allow&&e.push({name:"ladd_plist",text:MediaPHP.Add_Playlist,iconCls:"icon-uniE60B",type:"function",click:"obj.Add_Playlist(this)",attr_data:{mode:"list"}}),"yes"==U.meida_maker.allow&&e.push({name:"lmark_review",text:MediaPHP.MarkReview,iconCls:"icon-uniE764",type:"function",click:"obj.markReview(this)",attr_data:{mode:"list"}}),"yes"==U.version_action.allow&&e.push({name:"laction",text:StrackPHP.Action,iconCls:"icon-uniE6BB",type:"function",click:"Strack.ClientActionBatch(this)",attr_data:{type:90,grid:"media_list",field:"version_id"}}),e.push({name:"lreset",text:StrackPHP.Reset,iconCls:"icon-uniE682",type:"function",click:"obj.ResetMedia(this)",attr_data:{type:2010,grid:"stm_postwall",mode:"list"}}),"yes"==U.meida_del.allow&&e.push({name:"ldelete",text:StrackPHP.MovetoTrash,iconCls:"icon-uniE9D5",type:"function",click:"obj.MediatoTrash(this)",attr_data:{grid:"stm_postwall",mode:"list"}}),Strack.InitMenuItem("st_menu_list",e)}function H(e,i){var t=[];"yes"==U.meidalist_add.allow&&t.push({name:"gadd_plist",text:MediaPHP.Add_Playlist,iconCls:"icon-uniE60B",type:"function",click:"obj.Add_Playlist(this)",attr_data:{mode:"grid"}}),"yes"==U.meida_maker.allow&&t.push({name:"gmark_review",text:MediaPHP.MarkReview,iconCls:"icon-uniE764",type:"function",click:"obj.markReview(this)",attr_data:{mode:"grid"}}),"yes"==U.export_excel.allow&&t.push({name:"gexcel",text:StrackPHP.Export_Excel,iconCls:"icon-uniE6082",type:"function",click:"Strack.ExportExcel(this)",attr_data:{pid:e,type:2020,mode:"grid",done:"versions",from:i}}),"yes"==U.version_action.allow&&t.push({name:"gaction",text:StrackPHP.Action,iconCls:"icon-uniE6BB",type:"function",click:"Strack.ClientActionBatch(this)",attr_data:{type:90,grid:"proj_table_column",field:"version_id"}}),t.push({name:"lreset",text:StrackPHP.Reset,iconCls:"icon-uniE682",type:"function",click:"obj.ResetMedia(this)",attr_data:{type:2020,grid:"proj_table_column",mode:"grid"}}),"yes"==U.meida_del.allow&&t.push({name:"gdelete",text:StrackPHP.MovetoTrash,iconCls:"icon-uniE9D5",type:"function",click:"obj.MediatoTrash(this)",attr_data:{grid:"proj_table_column",mode:"grid"}}),t.push({name:"lcopy_cell",text:StrackPHP.Copy_Grip_Cell,iconCls:"icon-uniE943",type:"function",click:"Strack.copy_clipboard(this)",attr_data:{"clipboard-action":"copy","clipboard-target":"#grid_clipboard"}}),Strack.InitMenuItem("st_menu_grid",t),new Clipboard("#st_menu_lcopy_cell")}function M(){$("#stm_postwall").on("mousedown",function(e){if(3==e.which)return!1;if(console.log(e),$(e.target).hasClass("play_media"))return!1;var i=!0,t=!0,a=$(".stm-items"),s=$(e.target).closest(".stm-items-main");if(ae||se?(s.hasClass("stm-imain-ac")&&(t=!1),$(e.target).hasClass("stm-i-click")&&s.toggleClass("stm-imain-ac")):($(".stm-items-main").removeClass("stm-imain-ac"),$(e.target).hasClass("stm-i-click")&&s.addClass("stm-imain-ac")),ae)if(ne){var n=s.data("vid"),l=!1,d=!1;if(n>0){for(var r=0;r<a.length;r++){var o=$(a[r]).find(".stm-items-main"),c=o.data("vid");c!=ne&&c!=n||(l?d=!0:l=!0),l&&!d&&o.addClass("stm-imain-ac")}ne=""}}else t&&(ne=s.data("vid"));$("body").append("<div class='selection_box'></div>");var m=$(this).offset(),p=$(".selection_box"),u=e.x||e.clientX,h=e.y||e.clientY;p.css({left:u,top:h});var f=null,g=null;$(document).on("mousemove",function(e){if(i){f=e.x||e.clientX,g=e.y||e.clientY,f<m.left&&(f=m.left),g<m.top&&(g=m.top);var t=Math.abs(f-u),s=Math.abs(g-h),n=Math.min(f,u),l=Math.min(g,h);p.css({width:t,height:s,left:n,top:l});for(var d=p.offset().left,r=p.offset().top,o=p.width(),c=p.height(),P=0;P<a.length;P++){var _=$(a[P]),v=_.width()+_.offset().left,k=_.height()+_.offset().top,b=$(a[P]).find(".stm-items-main");v>d&&k>r&&$(a[P]).offset().left<d+o&&$(a[P]).offset().top<r+c?b.hasClass("stm-imain-ac")||b.addClass("stm-imain-ac"):b.hasClass("stm-imain-ac")&&b.removeClass("stm-imain-ac")}}}).on("mouseup",function(e){$(this).off("mousemove"),i=!1,p.remove(),a=null,f=null,g=null,u=null,h=null,null,ae=!1,se=!1})}).on("contextmenu",function(e){return e.preventDefault(),$("#st_menu_list").menu("show",{left:e.pageX,top:e.pageY}),!1})}function T(e,i,t){var a="";return a+='<div class="stm-i-group"><a href="javascript:;" class="stm-i-gheader play_media" onclick="obj.toggleOpen(this)"><i class="icon-uniE93F play_media icon-left"></i><span class="stm-i-ghname play_media"> '+e+' ( <span id="num_'+md5(e)+'">'+i+"</span> "+StrackPHP.Tasks+' )</span></a><div id="'+md5(e)+'" class="stm-i-glist">'+t+"</div></div>"}function C(e,i,t){var a,s,n="";return i?(s="yes",a='<img src="'+StrackPHP.IMG+'/transcoding.gif">'):(s="no",a=Strack.PlistverThumb(e.media_info)),n+='<div class="stm-items choice-m-items"><div class="stm-items-wrap"><div class="stm-items-top"><div class="stm-items-thumb">'+a+'</div><div class="stm-items-bgc stm-translate-bgc"></div>'+Strack.MediaUrl(e,s,t)+'</div><div class="stm-items-center"></div><div class="stm-items-bottom"><ul class="stm-items-main stm-i-click" data-vid="'+e.version_id+'"><li class="stm-items-hold st-border-bottom-dark stm-i-click"><div class="stm-i-click text-ellipsis"><span class="stm-items-play stm-i-click"><i class="icon-uniE657 stm-i-click"></i></span><span class="stm-items-title stm-i-click">'+e.content+'</span></div><div class="stm-items-tshow stm-i-click" style="overflow: hidden"><span class="stm-items-iname text-ellipsis stm-i-click">'+e.item_name+'</span><span class="stm-items-ver stm-i-click">'+e.version+'</span></div></li><li class="stm-items-info st-border-bottom-dark text-ellipsis stm-i-click"><span class="stm-items-title stm-i-click">'+StrackPHP.EntityName+'：</span><span class="stm-items-name stm-i-click">'+e.item_name+'</span></li><li class="stm-items-info st-border-bottom-dark text-ellipsis stm-i-click"><span class="stm-items-title stm-i-click">'+StrackPHP.Steps+'：</span><span class="stm-items-name stm-i-click">'+e.type_name+'</span></li><li class="stm-items-info st-border-bottom-dark text-ellipsis stm-i-click"><span class="stm-items-title stm-i-click">'+StrackPHP.Created_by+'：</span><span class="stm-items-name stm-i-click">'+e.Created_by+'</span></li><li class="stm-items-info st-border-bottom-dark text-ellipsis stm-i-click"><span class="stm-items-title stm-i-click">'+StrackPHP.Version+'：</span><span class="stm-items-name stm-i-click">'+e.version+'</span></li><li class="stm-items-info st-border-bottom-dark text-ellipsis stm-i-click"><span class="stm-items-title stm-i-click">'+StrackPHP.Created+'：</span><span class="stm-items-name stm-i-click">'+e.created+"</span></li></ul></div></div></div>"}function j(e,i){var t=Strack.build_filter({project_id:["eq",e],media_id:["neq",0]},{},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]);Strack.G.Gfilter_data.versions=t,$("#proj_table_column").datagrid({url:StrackPHP.MediaData,fitColumns:!1,height:Strack.panel_height(".stm-grid-content",0),rowheight:49,differhigh:!1,singleSelect:!1,adaptive:{dom:"#datalist_main_2020",min_width:510,exth:41,domresize:1},DragSelect:!0,DataNull:Strack.DataNullTip(2010),queryParams:{project_id:e,mode:i,filter:JSON.stringify(t)},frozenColumns:[[{field:"media_id",checkbox:!0}]],columns:[[{field:"player",title:'<i class="icon-uniE657"></i>',align:"center",width:50,frozen:"frozen",findex:0,formatter:function(e,i,t){return Strack.MediaGridUrl(i)}},{field:"version_id",title:StrackPHP.ID,align:"center",width:60,frozen:"frozen",findex:1},{field:"thumb",title:StrackPHP.Thumbnail,align:"center",width:85,frozen:"frozen",findex:2,formatter:function(e,i,t){return'<div class="plm-g-thumb">'+Strack.PlistverThumb(i.media_info)+"</div>"}},{field:"mtype_name",title:StrackPHP.Media_Type,align:"center",width:120,frozen:"frozen",findex:3},{field:"status",title:StrackPHP.Status,align:"center",width:120,sortable:!0,frozen:"frozen",findex:4},{field:"item_name",title:StrackPHP.EntityName,align:"center",width:120,frozen:"frozen",findex:5},{field:"content",title:StrackPHP.task_name,align:"center",width:220,frozen:"frozen",findex:6},{field:"version",title:StrackPHP.Version,align:"center",width:120,sortable:!0,frozen:"frozen",findex:7},{field:"type_name",title:StrackPHP.Steps,align:"center",width:180,frozen:"frozen",findex:8},{field:"Created_by",title:StrackPHP.Created_by,align:"center",width:180,sortable:!0,frozen:"frozen",findex:9},{field:"created",title:StrackPHP.Created,align:"center",width:180,sortable:!0,frozen:"frozen",findex:10}]],pagination:!0,pageSize:100,pageList:[100,200,300],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onRowContextMenu:function(e,i,t){Strack.grid_clipboard(e.target),e.preventDefault(),$("#st_menu_grid").menu("show",{left:e.pageX,top:e.pageY})}})}function x(e,i){$.ajax({type:"POST",url:StrackPHP.SortGroupFields,dataType:"json",data:{project_id:e,ptype:i},success:function(t){var a=D(e,i,"media_list");t.group_fields.forEach(function(t){a+=E(e,i,t,"media_list")}),$("#mlist_group_"+i).empty().append(a)}})}function D(e,i,t){var a="";return a+='<a href="javascript:;" class="item field-disable" onclick="obj.mediaGroupDel(this);" data-pid="'+e+'" data-ptype="'+i+'" data-grid="'+t+'"><i class="icon-uniE682"></i> '+StrackPHP.ClearGroup+'</a><div class="divider"></div>'}function E(e,i,t,a){var s="";return s+='<a href="javascript:;" id="gtfd_'+t.alias+"_"+i+'" class="item gitem_'+i+'" onclick="obj.mediaGroupItem(this);" data-field="'+t.alias+'" data-pid="'+e+'" data-ptype="'+i+'" data-grid="'+a+'"><i class="icon-left filter_list icon-unchecked"></i>'+t.lang+"</a>"}function N(e,i,t,a){$(".stm-list-wrap").removeClass("stm-list-ac"),$("#media_"+i).addClass("stm-list-ac");switch(i){case"list":B&&(O(2020),x(Y,2020),B=!1),w(),S(Y,e,L(),1,a,"new");break;case"grid":G&&(O(2010),Strack.GroupDown(Y,2020,"proj_table_column",{SortChange:"Strack.sort_change",SortAdv:"Strack.DataSortAdv",SortItem:"Strack.DataSortItem"}),G=!1),H(Y,e),j(Y,e,t,a)}}function L(){return Strack.G.MediaFilter=Strack.build_filter({project_id:["eq",Y],media_id:["neq",0]},{},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]),Strack.G.MediaFilter}function O(e){$("#filter_proj_"+e).remove(),$("#filter_main_"+e).empty().removeClass("filter-full-active"),$("#datalist_main_"+e).removeClass("datalist-border"),$(".combo-p").remove(),$("#mtbs_grid").css("right",0),$("#media_content").css("right",0)}obj={ShowDetails:function(){var e=$("#stm_postwall"),i=$(".stm-items-info"),t=$("#toggleinfo_icon");e.hasClass("stm_post_hide")?(V=!0,$(".stm-items-tshow ").hide(),$(".stm-items-hold").css("height","25px"),i.show(),t.html('<i class="icon-uniE8FB"></i>'),e.removeClass("stm_post_hide").addClass("stm_post_show")):(V=!1,i.hide(),$(".stm-items-hold").css("height","50px"),$(".stm-items-tshow ").show(),t.html('<i class="icon-uniE8FA"></i>'),e.removeClass("stm_post_show").addClass("stm_post_hide"))},media_mhide:function(e){switch($(e).data("menu")){case"playlist":$("#media_lib_menu").toggle(300);break;case"review":$("#media_list_menu").toggle(300);break;case"client":$("#media_client_menu").toggle(300)}},switchView:function(e){var i=$(e).data("view");Strack.save_storage("Mediaview_"+X,i),N(X,i,1,100)},EditSelectMedia:function(e){console.log(e)},markReview:function(i){var t=$(i).data("mode"),a=[];switch(t){case"list":$(".stm-items-main").each(function(){$(this).hasClass("stm-imain-ac")&&a.push($(this).data("vid"))});break;case"grid":$("#proj_table_column").datagrid("getSelections").forEach(function(e){a.push(e.version_id)})}a.length>0?e(a.join(","),t):layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6})},Add_Playlist:function(e){var i=$(e).data("mode"),t=[];switch(i){case"list":$(".stm-items-main").each(function(){$(this).hasClass("stm-imain-ac")&&t.push($(this).data("vid"))});break;case"grid":$("#proj_table_column").datagrid("getSelections").forEach(function(e){t.push(e.version_id)})}t.length>0?Strack.open_dialog("dialog",{title:MediaPHP.Add_Playlist,width:480,height:290,content:Strack.dialog_dom({type:1,hidden:[{case:101,id:"Mproject_id",type:"hidden",name:"project_id",valid:1,value:Y},{case:101,id:"Mver_ids",type:"hidden",name:"ver_ids",valid:1,value:t.join(",")}],items:[{case:1,id:"Mplist_name",type:"text",lang:MediaPHP.Playlist_Name,name:"plist_name",valid:1,value:""},{case:2,id:"Mplist_type",lang:MediaPHP.Playlist_Type,name:"plist_type",valid:1},{case:1,id:"Massignee",lang:MediaPHP.Playlist_Assessor,name:"assignee",valid:""}],footer:[{obj:"subplaylist",type:1,title:StrackPHP.Submit},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){Strack.combobox_widget(1,"#Mplist_type",MediaPHP.PlistTypeComb,"plist_id","plist_type",10),Strack.combobox_widget(21,"#Massignee",StrackPHP.AssigUserlist,"uid","uname","","","","deptname",{pid:Y})}}):layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6})},subplaylist:function(){Strack.ajax_dialog_form("#st_dialog_form input,#st_dialog_form textarea",le,MediaPHP.NewPlistList,{back:function(e){switch(JSON.parse(e).status){case-1:Strack.top_message({bg:"w",msg:MediaPHP.Playlist_Name_Length});break;case-2:Strack.top_message({bg:"w",msg:MediaPHP.Playlist_Type_NULL});break;case 200:Strack.top_message({bg:"g",msg:MediaPHP.Playlist_Add_SC}),Strack.dialog_cancel()}}})},SelectPlist:function(e){var i=$(e).data("listid");$(".play-list-items").removeClass("selected"),$(e).addClass("selected"),$("#plist_info_thumb").html('<div class="empty">'+MediaPHP.Please_Select_Version+"</div>"),$("#plist_info_des").empty(),$("#enable_drag").switchbutton("uncheck"),$("#current_plist").show().attr("data-listid",i),$("#delete_plist").show().attr("data-listid",i),s(i)},SelectCltPlist:function(e){var i=$(e).data("listid");$(".play-list-items").removeClass("selected"),$(e).addClass("selected"),$("#clt_empty").find(".empty").remove(),$("#reclt_hbnt").show(),te=i,p(i),u(i)},ShowPlistVer:function(e,i){i.stopPropagation();var a=$(e).data("vid");$(".plist_iver").removeClass("selected"),$(e).closest(".plist_iver").addClass("selected"),t(a)},RePlistVer:function(e,t){t.stopPropagation();var a=$(e).data("vid");i(e,$(e).data("listid"),a)},AddPlistVers:function(e){var i=$(e).data("listid");$("#enable_drag").switchbutton("uncheck"),l(Y,i)},newPlistVers:function(){for(var e=$("#dialog_data").datagrid("getSelections"),i=$("#Nproject_id").val(),t=$("#Nlistid").val(),a=[],n=0;n<e.length;n++)a.push(e[n].version_id);a.length>0?$.ajax({type:"POST",url:MediaPHP.UpPlistVersion,data:{pid:i,listid:t,ver_ids:a.join(",")},beforeSend:function(){$("#dialog").prepend(Strack.loading_dom("black"))},success:function(e){$("#st-load").remove(),Strack.top_message({bg:"g",msg:MediaPHP.Playlist_Version_Add_SC}),s(t),Strack.dialog_cancel()}}):layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6})},SelectFavlist:function(e){var i=$(e).data("listid"),t=$(e).data("ptype"),a=$(e).data("status"),s="";switch(parseInt(a)){case 10:switch(parseInt(t)){case 10:s=de+"/rev_"+Y+".html?listid="+i;break;case 20:s=de+"/clt_"+Y+".html?listid="+i}break;case 20:s=de+"/pass_"+Y+".html?listid="+i}window.location.href=s},FilterPlist:function(e){var i=$("#plist_search").val();i.length>0?ie.filter_bar=[{type:20,field:"plist_name",value:{epress:"70",val:i},class:"plist",alias:"plist_name"}]:ie.filter_bar={},$("#plist_info_thumb").html('<div class="empty">'+MediaPHP.Please_Select_Version+"</div>"),$("#plist_info_des").empty(),$("#enable_drag").switchbutton("uncheck"),$("#current_plist").hide().attr("data-listid",""),$("#delete_plist").hide().attr("data-listid",""),$("#plist_vers").html(P(X)),c(X,Y,ie,1,100)},ResetMedia:function(e){var i=$(e).data("mode"),t=($(e).data("grid"),$(e).data("pid")),a=$(e).data("type");obj.DoResetMedia(i,t,a)},DoResetMedia:function(e,i,t){switch(e){case"list":R.need="no",R.groupBy="",S(i,X,L(),1,100,"new");break;case"grid":Strack.DoResetDatagrid("proj_table_column",i,t)}},FilterMedia:function(e,i){S(Y,e,i,1,100,"new")},MediatoTrash:function(e){var i=$(e).data("mode"),t=$(e).data("grid"),a=[];switch(i){case"list":$(".stm-items-main").each(function(){$(this).hasClass("stm-imain-ac")&&a.push($(this).data("vid"))});break;case"grid":$("#proj_table_column").datagrid("getSelections").forEach(function(e){a.push(e.version_id)})}a.length>0?Strack.DoDeletedMedia(Y,i,t,a.join(",")):layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6})},LoadListMedia:function(){S(Y,X,L(),1,100,"new")},DeletePlistVers:function(e){var i=$(e).data("listid");i>0&&$.messager.confirm(StrackPHP.Confirmation_Box,MediaPHP.Playlist_Delete_Confirm,function(e){e&&$.ajax({type:"POST",url:MediaPHP.DeletePlist,dataType:"json",data:{listid:i,pid:Y},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){Strack.top_message({bg:"g",msg:MediaPHP.Playlist_Delete_SC}),obj.FilterPlist(),$.messager.progress("close")}})})},toggleOpen:function(e){$(e).closest(".stm-i-group").find(".stm-i-glist").toggle(200);var i=$(e).find("i");i.hasClass("icon-uniE93F")?i.removeClass("icon-uniE93F").addClass("icon-uniE946"):i.removeClass("icon-uniE946").addClass("icon-uniE93F")},mediaGroupItem:function(e){var i=$(e).data("grid"),t=$(e).data("ptype"),a=$(e).data("pid"),s=$(e).data("field");$("#"+i);$("#mlist_group_"+t).find(".gitem_"+t+" i").removeClass("icon-checked").addClass("icon-unchecked"),$(e).find("i").removeClass("icon-unchecked").addClass("icon-checked"),R.need="yes",R.groupBy=s;var n=Strack.mapGroupFileds(s);Strack.G.MediaFilter.groupsort=[{sortName:n.gfield,sortOrder:"asc"}],S(a,X,Strack.G.MediaFilter,1,100,"new")},mediaGroupDel:function(e){var i=($(e).data("grid"),$(e).data("ptype")),t=$(e).data("pid");$("#mlist_group_"+i).find(".gitem_"+i+" i").removeClass("icon-checked").addClass("icon-unchecked"),R.need="no",R.groupBy="",S(t,X,L(),1,100,"new")},CreatedSession:function(){if(W){var e=$("#review_startime_"+J).datebox("getValue"),i=$("#review_endtime_"+J).datebox("getValue");e?i?$.ajax({type:"POST",url:MediaPHP.AddClientSession,dataType:"json",data:{sub_date:e,due_date:i,listid:te},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){switch($.messager.progress("close"),parseInt(e.status)){case-1:layer.msg(StrackPHP.Illegal_Operation,{icon:7,time:1200,anim:6});break;case 200:W=!1,Q=e.plist_session_id}}}):layer.msg(MediaPHP.Session_End_Date_Null,{icon:2,time:1200,anim:6}):layer.msg(MediaPHP.Session_Start_Date_Null,{icon:2,time:1200,anim:6})}else layer.msg(MediaPHP.Client_Session_Exist,{icon:2,time:1200,anim:6})},addClients:function(e){var i=$(e).data("psessionid");W?layer.msg(MediaPHP.Please_Created_Session,{icon:2,time:1200,anim:6}):Strack.open_dialog("dialog",{title:MediaPHP.Add_Review_Client,width:480,height:260,content:Strack.dialog_dom({type:1,hidden:[{case:101,id:"Mplist_id",type:"hidden",name:"plist_id",valid:1,value:i}],items:[{case:7,id:"Mmail_list",type:"text",lang:MediaPHP.Add_Client_Email,name:"notice_text",valid:1,value:""}],footer:[{obj:"saveClients",type:1,title:StrackPHP.Submit},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){}})},saveClients:function(){var e=$("#Mmail_list").val(),i=$("#Mplist_id").val();e.length<1?layer.msg(MediaPHP.Please_Add_Client_Email,{icon:2,time:1200,anim:6}):v(i,e)},delRclient:function(e){var i=$("#rclient_list").data("psessionid");$(e).closest(".rclient-uitem").remove();var t=[]
;$(".rclient-uitem").each(function(){t.push($(this).find(".uitem-mail").html())}),k(i,t.join(","))},SendInvites:function(e){if(W)layer.msg(MediaPHP.Please_Created_Session,{icon:2,time:1200,anim:6});else{var i=$(e).data("psessionid"),t=MediaPHP.Clientreview.replace(".html","");$.ajax({type:"POST",url:MediaPHP.SendInvitesUrl,data:{psessionId:i,baseUrl:t},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close");var i="";switch(parseInt(e.status)){case 200:e.data.length>0?(e.data.forEach(function(e){i+='<li> <div style="color: #58B9EB;font-weight: 600"> '+e.email+" </div> <div> "+e.url+" </div></li>"}),layer.alert("<ul>"+i+"</ul>",{title:MediaPHP.ClientreviewUrl,area:"620px"})):layer.msg(MediaPHP.NoReviewclient,{icon:2,time:1200,anim:6});break;case-2:layer.msg(MediaPHP.SessionEndless,{icon:2,time:1200,anim:6})}}})}},AcceptFeedback:function(e){var i=($(e).data("pid"),$("#reclt_table").datagrid("getSelections"));if(i.length<1)layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6});else{for(var t=[],e=0;e<i.length;e++)t.push(i[e].note_id);$.ajax({type:"POST",url:MediaPHP.activeClientNote,data:{note_ids:t.join(",")},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close"),$("#reclt_table").datagrid("reload"),Strack.top_message({bg:"g",msg:MediaPHP.Reviewed_Clients_Note})}})}},FilterClientPlist:function(e){var i=$("#plist_clt_search").val();i.length>0?ie.filter_bar=[{type:20,field:"plist_name",value:{epress:"70",val:i},class:"plist",alias:"plist_name"}]:ie.filter_bar={},te=0,$("#reclt_hbnt").hide(),$("#projover_rmain").empty(),$("#clt_empty").html('<div class="empty">'+MediaPHP.ClientFeedbacksNull+'</div><table id="reclt_table"></table>'),$("#plist_vers").html(P(X)),m(X,Y,ie,1,100)}};var I=$("#tac_project");if(PARSE_VAR.auth.authority){var z,F,R,A=PARSE_VAR.rules,V=!1,B=!0,G=!0,U={};!function(e){for(var i in e){var t=e[i];switch(U[t.alias]=t,t.alias){case"meidalist_add":case"export_excel":case"meida_del":case"meidalist_delete":case"meidalist_append":case"meida_maker":case"version_action":"no"==t.allow&&$(".ah_"+t.alias).remove();break;case"client_review":"no"==t.allow&&$("#media_clt_review").remove()}}}(A),z=PARSE_VAR.rules.meidalist_sort.allow,F=PARSE_VAR.rules.meidalist_delete_ver.allow,R={need:"no",groupBy:""},I.show();var q,W,J,Q,Y=$("#proj_id").val(),X=parseInt($("#m_type").val()),K=parseInt($("#c_listid").val()),Z=Strack.verify_project_data(Y),ee=null,ie="",te=0,ae=!1,se=!1,ne="",le={};if(le["plist_name-1"]=MediaPHP.Playlist_Name_NULL,le["plist_type-1"]=MediaPHP.Playlist_Type_NULL,Z>0){Strack.project_sub_menu(Y,20);var de=Strack.get_base_path(MediaPHP.baseurl),re=$("#media_lib_menu"),oe=$("#media_list_menu"),ce=$("#media_client_menu");re.empty().append(function(e,i,t){var a="";return[{m_id:10,url:e+"/a_"+i+".html",lang:MediaPHP.All_Versions},{m_id:20,url:e+"/m_"+i+".html",lang:MediaPHP.My_Versions},{m_id:30,url:e+"/l_"+i+".html",lang:MediaPHP.Last_Upload},{m_id:40,url:e+"/u_"+i+".html",lang:MediaPHP.Unviewed},{m_id:80,url:e+"/c_"+i+".html",lang:MediaPHP.Reviewed}].forEach(function(e){e.m_id==t?a+=y("selected",e):a+=y("",e)}),a}(de,Y,X)),oe.empty().append(function(e,i,t){var a="";return[{m_id:50,url:e+"/rev_"+i+".html",lang:MediaPHP.Review_Lists},{m_id:60,url:e+"/clt_"+i+".html",lang:MediaPHP.Client_Lists},{m_id:90,url:e+"/mcl_"+i+".html",lang:MediaPHP.My_Create_Playlists},{m_id:100,url:e+"/mrl_"+i+".html",lang:MediaPHP.My_Review_Lists},{m_id:70,url:e+"/fav_"+i+".html",lang:MediaPHP.My_Favorite_Playlist},{m_id:110,url:e+"/pass_"+i+".html",lang:MediaPHP.Reviewed}].forEach(function(e){e.m_id==t?a+=y("selected",e):a+=y("",e)}),a}(de,Y,X)),ce.empty().append(function(e,i,t){var a="";return[{m_id:120,url:e+"/cns_"+i+".html",lang:MediaPHP.Not_Session},{m_id:130,url:e+"/cas_"+i+".html",lang:MediaPHP.Already_Session},{m_id:140,url:e+"/cfs_"+i+".html",lang:MediaPHP.Session_Expired}].forEach(function(e){e.m_id==t?a+=y("selected",e):a+=y("",e)}),a}(de,Y,X));var me=Strack.read_storage("Mediaview_"+X);me||(me="list"),function(e,i,t,a,s,n,l,d){switch(i){case 10:case 20:case 30:case 40:case 80:$("#stm_versions").show(),N(i,t,s,n);break;case 50:case 60:case 70:case 90:case 100:case 110:$("#stm_reviews").show();var r,o;switch(i){case 50:case 100:r=["EQ",10],o=["EQ",10];break;case 60:r=["EQ",20],o=["EQ",10];break;case 70:r=["IN","10,20"],o=["EQ",10];break;case 90:r=["IN","10,20"],o=["IN","10,20"];break;case 110:o=["EQ",20],r=["IN","10,20"]}ie=Strack.build_filter({project_id:["eq",e],plist_type:r,status:o},{},{},{},"and",{},{},[{sortName:"status",sortOrder:"asc"},{sortName:"created",sortOrder:"desc"}]),a&&(ie.filter_bar=[{type:20,field:"plist_id",value:{epress:"10",val:a},class:"plist",alias:"plist_id"}]),c(i,e,ie,l,d);break;case 120:case 130:case 140:$("#stm_client").show(),ie=Strack.build_filter({project_id:["eq",e],plist_type:20},{},{},{},"and",{},{},[{sortName:"status",sortOrder:"asc"},{sortName:"created",sortOrder:"desc"}]),m(i,e,ie,s,n)}}(Y,X,me,K,1,100,1,100),function(){$(document).keydown(function(e){switch(e.keyCode){case 16:ae=!0;break;case 17:se=!0}}).keyup(function(e){switch(e.keyCode){case 16:ae=!1;break;case 17:se=!1}})}()}else I.empty().append(Strack.ProjWarn(StrackPHP.Project_None_Warning)).show()}else I.empty().append(Strack.ProjWarn(StrackPHP.NoPermission)).show()});