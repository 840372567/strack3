$(function(){function a(a,t,e,i){var s="#datalist_main_"+e+"10",o=e+"10",n={};Strack.read_storage("isreport_"+e)&&(n={isreport:["eq",10]});var c=Strack.build_filter({project_id:["eq",t],type:["eq",e],active:["eq",1]},n,{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]);Strack.G.Gfilter_data[r(e+"10")]=c,$("#proj_table_column").datagrid({url:StrackPHP.DataEntity,fitColumns:!1,height:Strack.panel_height(s,0),rowheight:49,differhigh:!0,autocolumns:!0,gridname:i,adaptive:{dom:s,min_width:0,exth:0,domresize:1},DragSelect:!0,DataNull:Strack.DataNullTip(e+"10"),queryParams:{steps:a,pype:10,pid:t,type:e,ptype:e+"10",filter:JSON.stringify(c),thumb:StrackPHP.ITEM_THUMB,url:StrackPHP.projitem,turl:StrackPHP.pagetask},toolbar:"#tb_column",pagination:!0,pageSize:100,pageList:[100,200,300,400,500,"All"],pageNumber:1,pagePosition:"bottom",remoteSort:!1,groupActive:!1,onDblClickRow:function(a,i){Strack.SideColumnOpen(i.item_id,e,20,t,"proj_table_column")},onBeforeSortColumn:function(a,t){return Strack.DataSortAc($(this),$("#stfd_"+a+"_"+o),o,a,t),!1},onRowContextMenu:function(a,t,e){Strack.grid_clipboard(a.target),a.preventDefault(),$("#st_menu_item").menu("show",{left:a.pageX,top:a.pageY})}})}function t(a,t,e,i){var s="#datalist_main_"+x+"20",o={},n=Strack.build_filter({project_id:["eq",t],type:["eq",a],active:["eq",1]},o,{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}],[{sortName:"item_id",sortOrder:"asc"}]);Strack.G.Gfilter_data[r(x+"20")]=n,Strack.G.Group_data[r(x+"20")]={groupField:"item_name"},$("#proj_table_list").datagrid({url:StrackPHP.DataTaskList,fitColumns:!1,height:Strack.panel_height(s,0),rowheight:49,differhigh:!1,singleSelect:!1,adaptive:{dom:s,min_width:510,exth:0,domresize:1},DragSelect:!0,DataNull:Strack.DataNullTip(x+"20"),queryParams:{pid:t,ptype:e,filter:JSON.stringify(n)},frozenColumns:[[{field:"task_id",title:StrackPHP.Taskid,checkbox:!0}]],columns:[i],toolbar:"#tb_list",pagination:!0,pageSize:100,pageList:[100,200,300,400,500,"All"],pageNumber:1,pagePosition:"bottom",remoteSort:!1,groupActive:!0,groupField:"item_name",view:groupview,groupFormatter:function(a,t){return'<span class="">'+a+" - "+t.length+" "+Strack.ShowGUnit(e)+"</span>"},onDblClickRow:function(e,i){Strack.SideColumnOpen(i.task_id,a,10,t,"proj_table_list")},onRowContextMenu:function(a,t,e){Strack.grid_clipboard(a.target),a.preventDefault(),$("#st_menu_task").menu("show",{left:a.pageX,top:a.pageY})}})}function e(a,e,i){$.ajax({type:"POST",url:StrackPHP.DynamicFields,dataType:"json",data:{project_id:e,type:i},success:function(s){var o=[];s.forEach(function(a,t){a&&o.push(Strack.DynamicFieldset(i,a,t,""))}),t(a,e,i,o)}})}function i(a){var t="";return t+='<div id="tb_'+a+'" class="proj-tb"></div><table id="proj_table_'+a+'"></table>'}function s(a,t,e){var i="",s="",o="";switch(parseInt(t)){case 10:s="active-list";break;case 20:o="active-list"}return i+='<div class="st-buttons aign-left"><a href="javascript:;" class="datagrid-mode list_10 '+s+'" onclick="obj.switchDatagrid(this,10,'+e+');" data-pid="'+a+'" data-ptype="'+e+'"><i class="icon-uniE746"></i></a><a href="javascript:;" class="datagrid-mode list_20 '+o+'" onclick="obj.switchDatagrid(this,20,'+e+');" data-pid="'+a+'" data-ptype="'+e+'"><i class="icon-uniE749"></i></a></div>'}function o(a,t,e,i,s){var o="";return o+='<div class="st-buttons-sig aign-left"><a href="javascript:;"  onclick="'+s+'(this);" data-pid="'+a+'" data-type="'+t+'" data-grid="'+i+'" data-eid="0" data-seqid="0"><i class="icon plus"></i><span class="stp-title"> '+e+"</span></a></div>"}function n(a,t,e,i){var s="";s+='<div class="ui dropdown st-dropdown">',s+='<i class="icon-uniE684 icon-left"></i>'+a.Edit+'<i class="dropdown icon"></i>',s+='<div class="menu">',"yes"==F.tasks_report.allow&&(s+='<a href="javascript:;" class="item" onclick="Strack.ItemReport(this);" data-grid="proj_table_column" data-pid="'+e+'" data-type="'+t+'" >',s+='<i class="icon-uniF046 icon-left"></i>',s+=a.Add_Task,s+="</a>"),"yes"==F.batch_update.allow&&(s+='<a href="javascript:;" class="item ah_batch_update" onclick="obj.BathEditItems(this);" data-pid="'+e+'" data-ftype="'+i+'" data-mode="'+r(i)+'" data-grid="proj_table_column">',s+='<i class="icon-uniF044 icon-left"></i>',s+=a.Edit_Selected,s+="</a>",s+='<div class="divider"></div>'),"yes"==F.import_excel.allow&&(s+='<a href="javascript:;"  class="item" onclick="Strack.import_excel_data(this);" data-pid="'+e+'" data-type="'+t+'" data-done="'+r(i)+'" data-grid="proj_table_column">',s+='<i class="icon-uniE986 icon-left"></i>',s+=a.Import,s+="</a>"),"yes"==F.export_excel.allow&&(s+='<a href="javascript:;" class="item" onclick="Strack.ExportExcel(this);" data-pid="'+e+'" data-type="'+i+'" data-done="'+r(i)+'" data-mode="grid">',s+='<i class="icon-uniE6082 icon-left"></i>',s+=a.Export_Excel,s+="</a>",s+='<div class="divider"></div>');var o="";switch(parseInt(t)){case 30:o="pre_action";break;case 40:o="assets_action";break;case 41:o="system_action";break;case 42:o="program_action";break;case 43:o="bug_action";break;case 70:o="shots_action"}return"yes"==F[o].allow&&(s+='<a href="javascript:;"  class="item" onclick="Strack.ClientActionBatch(this);" data-type="'+t+'" data-grid="proj_table_column" data-field="item_id">',s+='<i class="icon-uniE6BB icon-left"></i>',s+=a.Action,s+="</a>"),s+='<a href="javascript:;" class="item" onclick="Strack.ResetDatagrid(this);" data-grid="proj_table_column" data-pid="'+e+'" data-type="'+i+'">',s+='<i class="icon-uniE682 icon-left"></i>',s+=a.Reset,s+="</a>","yes"==E&&(s+='<a href="javascript:;" class="item" onclick="obj.ItemstoTrash(this);" data-grid="proj_table_column" data-id="item_id" data-ftype="'+i+'">',s+='<i class="icon-uniE9D5 icon-left"></i>',s+=a.MovetoTrash,s+="</a>"),s+="</div>",s+="</div>"}function c(a,t,e,i){var s="";return s+='<div class="ui dropdown st-dropdown">',s+='<i class="icon-uniE684 icon-left"></i>'+a.Edit+'<i class="dropdown icon"></i>',s+='<div class="menu">',"yes"==F.myhome_assign.allow&&(s+='<a href="javascript:;" class="item" onclick="Strack.TasksAssign(this);" data-grid="proj_table_list" data-pid="'+e+'" data-type="'+t+'" >',s+='<i class="icon-uniE99B icon-left"></i>',s+=a.Assign,s+="</a>"),"yes"==F.myhome_copyto.allow&&(s+='<a href="javascript:;" class="item" onclick="Strack.TasksCopyTo(this);" data-grid="proj_table_list">',s+='<i class="icon-uniE629 icon-left"></i>',s+=a.CopyTo,s+="</a>"),"yes"==F.batch_update.allow&&(s+='<a href="javascript:;" class="item" onclick="obj.TasksUpdate(this);" data-pid="'+e+'" data-ftype="'+i+'" data-mode="'+r(i)+'" data-grid="proj_table_list">',s+='<i class="icon-uniE9AB icon-left"></i>',s+=a.TasksUpdate,s+="</a>",s+='<div class="divider"></div>'),s+='<a href="javascript:;"  class="item" onclick="Strack.EntityTodayTask(this);" data-pid="'+e+'" data-type="'+t+'" data-grid="proj_table_list" data-done="tasks">',s+='<i class="icon-uniF06A icon-left"></i>',s+=a.Today,s+="</a>",s+='<a href="javascript:;"  class="item" onclick="Strack.EntityDailyTask(this);" data-pid="'+e+'" data-type="'+t+'" data-grid="proj_table_list" data-done="tasks">',s+='<i class="icon-uniE60B icon-left"></i>',s+=a.Daily,s+="</a>",s+='<div class="divider"></div>',"yes"==F.export_excel.allow&&(s+='<a href="javascript:;" class="item" onclick="Strack.ExportExcel(this);" data-pid="'+e+'" data-type="'+i+'" data-done="'+r(i)+'" data-mode="grid">',s+='<i class="icon-uniE6082 icon-left"></i>',s+=a.Export_Excel,s+="</a>",s+='<div class="divider"></div>'),"yes"==F.task_action.allow&&(s+='<a href="javascript:;"  class="item" onclick="Strack.ClientActionBatch(this);" data-type="20" data-grid="proj_table_list" data-field="task_id">',s+='<i class="icon-uniE6BB icon-left"></i>',s+=a.Action,s+="</a>"),s+='<a href="javascript:;" class="item" onclick="Strack.ResetDatagrid(this);" data-grid="proj_table_list" data-pid="'+e+'" data-type="'+i+'">',s+='<i class="icon-uniE682 icon-left"></i>',s+=a.Reset,s+="</a>","yes"==F.tasks_del.allow&&(s+='<a href="javascript:;" class="item" onclick="obj.TaskstoTrash(this);" data-grid="proj_table_list" data-id="task_id" data-ftype="'+i+'">',s+='<i class="icon-uniE9D5 icon-left"></i>',s+=a.MovetoTrash,s+="</a>"),s+="</div>",s+="</div>"}function r(a){var t;switch(parseInt(a)){case 3010:t="preprods";break;case 3020:t="preprod_tasks";break;case 4010:t="assets";break;case 4020:t="asset_tasks";break;case 4110:t="system";break;case 4120:t="system_tasks";break;case 4210:t="program";break;case 4220:t="program_tasks";break;case 4310:t="bug";break;case 4320:t="bug_tasks";break;case 7010:t="shots";break;case 7020:t="shot_tasks"}return t}function d(a,t,e,i){var s="";return s+='<div class="ui dropdown st-dropdown"><i class="icon-uniE93F icon-left"></i>'+a.Sort+'<i class="dropdown icon"></i><div id="edit_sort_'+t+'"  class="menu data-fields"></div></div>'}function l(a,t,e,i){var s="";return s+='<div class="ui dropdown st-dropdown">'+a.Group+'<i class="dropdown icon"></i><div id="edit_group_'+t+'"  class="menu data-fields"></div></div>'}function p(a,t,e,i){var s="";return s+='<div class="ui dropdown st-dropdown">'+a.Fields+'<i class="dropdown icon"></i><div id="edit_fields_'+t+'"  class="menu data-fields"></div></div>'}function u(a,t,e,i){$.ajax({type:"POST",url:StrackPHP.SortGroupFields,data:{ptype:t,project_id:e},success:function(s){var o=JSON.parse(s),n="",c="";n+=k(a,e,t,i),o.sort_fields.forEach(function(a){n+=_(e,t,a,i)}),$("#edit_sort_"+t).empty().append(n),c+=m(a,e,t,i),o.group_fields.forEach(function(a){c+=h(e,t,a,i)}),$("#edit_group_"+t).empty().append(c),$.inArray(parseInt(t),[3020,4020,4120,4220,4320,7020])>=0&&Strack.setGroupItem(document.getElementById("gtfd_item_name_"+t),e,t,"item_name",[{sortName:"item_id",sortOrder:"asc"}])}})}function k(a,t,e,i){var s="";return s+='<a href="javascript:;" id="asc_sort_'+e+'" class="item field-disable edit_sort" onclick="Strack.sort_change(this);" data-pid="'+t+'" data-ptype="'+e+'" data-grid="'+i+'" data-sort="asc"><i class="icon-uniE93F"></i> '+a.SortAsc+'</a><a href="javascript:;" id="desc_sort_'+e+'" class="item field-disable edit_sort" onclick="Strack.sort_change(this);" data-pid="'+t+'" data-ptype="'+e+'" data-grid="'+i+'" data-sort="desc"><i class="icon-uniE946"></i> '+a.SortDesc+'</a><a href="javascript:;" id="adv_sort_'+e+'" class="item field-disable edit_sort" onclick="Strack.DataSortAdv(this);" data-pid="'+t+'" data-ptype="'+e+'" data-grid="'+i+'">'+a.SortAdvs+'</a><div class="divider"></div>'}function _(a,t,e,i){var s="";return s+='<a href="javascript:;" id="stfd_'+e.alias+"_"+t+'" class="item sort_fields" onclick="Strack.DataSortItem(this);" data-field="'+e.alias+'" data-pid="'+a+'" data-ptype="'+t+'" data-grid="'+i+'"><i class="icon-left sort_list icon-unchecked"></i>'+e.lang+"</a>"}function m(a,t,e,i){var s="";return s+='<a href="javascript:;" id="gasc_sort_'+e+'" class="item field-disable edit_sort" onclick="Strack.group_sort_change(this);" data-pid="'+t+'" data-ptype="'+e+'" data-grid="'+i+'" data-sort="asc"><i class="icon-uniE93F"></i> '+a.SortGroupAsc+'</a><a href="javascript:;" id="gdesc_sort_'+e+'" class="item field-disable edit_sort" onclick="Strack.group_sort_change(this);" data-pid="'+t+'" data-ptype="'+e+'" data-grid="'+i+'" data-sort="desc"><i class="icon-uniE946"></i> '+a.SortGroupDesc+'</a><a href="javascript:;" class="item field-disable" onclick="Strack.DataGroupDel(this);" data-pid="'+t+'" data-ptype="'+e+'" data-grid="'+i+'"><i class="icon-uniE682"></i> '+a.ClearGroup+'</a><div class="divider"></div>'}function h(a,t,e,i){var s="";return s+='<a href="javascript:;" id="gtfd_'+e.alias+"_"+t+'" class="item gitem_'+t+'" onclick="Strack.DataGroupItem(this);" data-field="'+e.alias+'" data-pid="'+a+'" data-ptype="'+t+'" data-grid="'+i+'"><i class="icon-left filter_list icon-unchecked"></i>'+e.lang+"</a>"}function P(a,t,e,i){var s="";return s+='<div class="ui dropdown st-dropdown">',s+=a.Steps+'<i class="dropdown icon"></i>',s+='<div id="steps_pipeline" class="menu">',s+='<div class="divider"></div>',s+='<a href="javascript:;" class="item steps_box-text" onclick="obj.StepsShowAll();" >',s+='<i class="icon-uniE8FA icon-left"></i>',s+=a.Show_All_Steps,s+="</a>",s+='<a href="javascript:;" class="item steps_box-text" onclick="obj.StepsHideAll();" >',s+='<i class="icon-uniE8FB icon-left"></i>',s+=a.Hide_All_Steps,s+="</a>",s+='<div class="divider"></div>',"yes"==C&&(s+='<a href="javascript:;" class="item" onclick="obj.Manage_Steps(this);" data-ptype="'+e+'">',s+='<i class="icon-uniE688 icon-left"></i>',s+=a.Manage_Steps,s+="</a>"),s+="</div>",s+="</div>"}function S(a){var t="";return t+='<div class="ui dropdown st-dropdown">'+StrackPHP.View+'<i class="dropdown icon"></i><div id="view_fields_'+a+'" class="menu data-fields"></div></div>'}function g(a,t,e,i,s){$.ajax({type:"POST",url:DataPHP.StepsDown,data:{project_id:a},dataType:"json",success:function(a){$("#temp_id").val(a.temp_id),G=a.steps_alias,G[0]&&$("#steps_pipeline").prepend(Strack.StepsDownDOM(a,t,e,i,s))}})}function f(a,t,e,i,s,o){var n="";return n+='<div class="ui search aign-right"><div class="ui icon input"><a href="javascript:;" class="st-down-filter stdown-filter" onclick="Strack.dropdown_panel(this,'+t+","+a+',240);" data-dtype="'+t+'" data-height="240" data-filter="'+w(t)+'" data-grid="'+e+'"><i class="filter icon project_filter"></i></a><input id="search_val_'+o+'" class="prompt" placeholder="'+StrackPHP.Search_More+'" type="text" autocomplete="off"><a href="javascript:;" class="st-filter-action" onclick="Strack.filter_action(this);" data-dtype="'+t+'" data-filter="'+o+'" data-field="'+i+'" data-mode="'+s+'" data-grid="'+e+'"><i class="search icon"></i></a></div><div class="results"></div></div>'}function b(a,t,e){switch(parseInt(a)){case 10:t.parent().css("z-index",9),e.parent().css("z-index",0);break;case 20:t.parent().css("z-index",0),e.parent().css("z-index",9)}}function y(a,t,e,i,s){Strack.open_dialog("dialog",{title:e,width:800,height:520,content:Strack.dialog_dom({type:1,hidden:[{case:101,id:"Mtemp_id",type:"hidden",name:"mtemp_id",valid:1,value:a},{case:101,id:"Mptype",type:"hidden",name:"mptype",valid:1,value:t}],items:[{case:5,id:"",type:"text",lang:"",name:"",valid:"",value:0}],footer:[{obj:i,type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){var t,e=null,i=$("#template-field").datalist({url:DataPHP.TfieldList,width:320,height:380,idField:"type_id",valueField:"type_id",textField:"type_name",groupField:"group",checkbox:!0,singleSelect:!1,queryParams:{columns:11},onLoadSuccess:function(o){var n=o.rows,c=[];$.ajax({type:"POST",url:s,data:{temp_id:a},beforeSend:function(){$("#dialog").prepend(Strack.loading_dom("white"))},success:function(a){$("#st-load").remove();for(var s=JSON.parse(a),o=0;o<s.length;o++)i.datalist("selectRecord",s[o]);e=1,$.each(s,function(a,t){$.each(n,function(a,e){if(e.type_id==t)return c.push(e),!0})}),$("#template-columns").datagrid({data:c,width:380,height:380,rownumbers:!0,fitColumns:!0,columns:[[{field:"type_id",checkbox:!0},{field:"type_name",title:StrackPHP.Name,align:"center",width:160},{field:"group",title:StrackPHP.Group,align:"center",width:160}]],dragSelection:!0,onLoadSuccess:function(){t=$(this),t.datagrid("enableDnd")}})}})},onSelect:function(a,i){if(e){$("#template-columns").datagrid("appendRow",i),t.datagrid("enableDnd")}},onUnselect:function(a,t){var e=$("#template-columns"),i=e.datagrid("getRowIndex",t);e.datagrid("deleteRow",i)}})}})}function v(a,t,e,i,s,o){Strack.open_dialog("dialog",{title:t,width:800,height:520,content:Strack.dialog_dom({type:1,hidden:[{case:101,id:"Mtemp_id",type:"hidden",name:"mtemp_id",valid:1,value:a},{case:101,id:"Mptype",type:"hidden",name:"mptype",valid:1,value:o}],items:[{case:5,id:"",type:"text",lang:"",name:"",valid:"",value:0}],footer:[{obj:e,type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:8,title:StrackPHP.Cancel}]}),inits:function(){var t,e=null,o=$("#template-field").datalist({url:DataPHP.TfieldList,width:320,height:380,idField:"type_id",valueField:"type_id",textField:"type_name",groupField:"group",checkbox:!0,singleSelect:!1,queryParams:{columns:s},onLoadSuccess:function(s){var n=s.rows,c=[];$.ajax({type:"POST",url:i,data:{temp_id:a},beforeSend:function(){$("#dialog").prepend(Strack.loading_dom("white"))},success:function(a){$("#st-load").remove();for(var i=JSON.parse(a),s=0;s<i.length;s++)o.datalist("selectRecord",i[s]);e=1,$.each(i,function(a,t){$.each(n,function(a,e){if(e.type_id==t)return c.push(e),!0})}),$("#template-columns").datagrid({data:c,width:380,height:380,rownumbers:!0,fitColumns:!0,columns:[[{field:"type_id",checkbox:!0},{field:"type_name",title:StrackPHP.Name,align:"center",width:160},{field:"group",title:StrackPHP.Group,align:"center",width:160}]],dragSelection:!0,onLoadSuccess:function(){t=$(this),t.datagrid("enableDnd")}})}})},onSelect:function(a,i){if(e){$("#template-columns").datagrid("appendRow",i),t.datagrid("enableDnd")}},onUnselect:function(a,t){var e=$("#template-columns"),i=e.datagrid("getRowIndex",t);e.datagrid("deleteRow",i)}})}})}function T(a,t,e){var i=[];"yes"==F.tasks_report.allow&&i.push({name:"ereport",text:DataPHP.Add_Task,iconCls:"icon-uniF046",type:"function",click:"Strack.ItemReport(this)",attr_data:{grid:"proj_table_column",pid:a,type:t}}),"yes"==F.batch_update.allow&&i.push({name:"eedit",text:StrackPHP.Edit_Selected,iconCls:"icon-uniF044",type:"function",click:"obj.BathEditItems(this)",attr_data:{pid:a,ftype:e,mode:r(e),grid:"proj_table_column"}}),"yes"==F.import_excel.allow&&i.push({name:"eimport_excel",text:StrackPHP.Import_ExcelT,iconCls:"icon-uniE986",type:"function",click:"Strack.import_excel_data(this)",attr_data:{pid:a,type:t,done:r(e),grid:"proj_table_column"}}),"yes"==F.export_excel.allow&&i.push({name:"eexcel",text:StrackPHP.Export_Excel,iconCls:"icon-uniE6082",type:"function",click:"Strack.ExportExcel(this)",attr_data:{pid:a,type:e,done:r(e),mode:"grid"}});var s="";switch(parseInt(t)){case 30:s="pre_action";break;case 40:s="assets_action";break;case 41:s="system_action";break;case 42:s="program_action";break;case 43:s="bug_action";break;case 70:s="shots_action"}"yes"==F[s].allow&&i.push({name:"eaction",text:StrackPHP.Action,iconCls:"icon-uniE6BB",type:"function",click:"Strack.ClientActionBatch(this)",attr_data:{type:t,grid:"proj_table_column",field:"item_id"}}),i.push({name:"ereset",text:StrackPHP.Reset,iconCls:"icon-uniE682",type:"function",click:"Strack.ResetDatagrid(this)",attr_data:{type:e,pid:a,grid:"proj_table_column"}}),"yes"==E&&i.push({name:"tdelete",text:StrackPHP.MovetoTrash,iconCls:"icon-uniE9D5",type:"function",click:"obj.ItemstoTrash(this)",attr_data:{id:"item_id",ftype:e,grid:"proj_table_column"}}),i.push({name:"ecopy_cell",text:StrackPHP.Copy_Grip_Cell,iconCls:"icon-uniE943",type:"function",click:"Strack.copy_clipboard(this)",attr_data:{"clipboard-action":"copy","clipboard-target":"#grid_clipboard"}}),Strack.InitMenuItem("st_menu_item",i),new Clipboard("#st_menu_ecopy_cell")}function D(a,t,e){var i=[];"yes"==F.myhome_assign.allow&&i.push({name:"tassign",text:StrackPHP.Assign,iconCls:"icon-uniE99B",type:"function",click:"Strack.TasksAssign(this)",attr_data:{grid:"proj_table_list",pid:a,type:t}}),"yes"==F.myhome_copyto.allow&&i.push({name:"tcopyto",text:StrackPHP.CopyTo,iconCls:"icon-uniE629",type:"function",click:"Strack.TasksCopyTo(this)",attr_data:{grid:"proj_table_list"}}),"yes"==F.batch_update.allow&&i.push({name:"tedit",text:StrackPHP.TasksUpdate,iconCls:"icon-uniE9AB",type:"function",click:"obj.TasksUpdate(this)",attr_data:{pid:a,ftype:e,mode:r(e),grid:"proj_table_list"}}),i.push({name:"ttoay",text:StrackPHP.Today,iconCls:"icon-uniF06A",type:"function",click:"Strack.EntityTodayTask(this)",attr_data:{type:e,pid:a,grid:"proj_table_list",done:"tasks"}}),i.push({name:"tdaily",text:StrackPHP.Daily,iconCls:"icon-uniE60B",type:"function",click:"Strack.EntityDailyTask(this)",attr_data:{type:e,pid:a,grid:"proj_table_list",done:"tasks"}}),"yes"==F.export_excel.allow&&i.push({name:"texcel",text:StrackPHP.Export_Excel,iconCls:"icon-uniE6082",type:"function",click:"Strack.ExportExcel(this)",attr_data:{pid:a,type:e,done:r(e),mode:"grid"}}),"yes"==F.task_action.allow&&i.push({name:"taction",text:StrackPHP.Action,iconCls:"icon-uniE6BB",type:"function",click:"Strack.ClientActionBatch(this)",attr_data:{type:20,grid:"proj_table_list",field:"task_id"}}),i.push({name:"treset",text:StrackPHP.Reset,iconCls:"icon-uniE682",type:"function",click:"Strack.ResetDatagrid(this)",attr_data:{type:e,pid:a,grid:"proj_table_list"}}),"yes"==F.tasks_del.allow&&i.push({name:"tdelete",text:StrackPHP.MovetoTrash,iconCls:"icon-uniE9D5",type:"function",click:"obj.TaskstoTrash(this)",attr_data:{id:"task_id",ftype:e,grid:"proj_table_list"}}),i.push({name:"tcopy_cell",text:StrackPHP.Copy_Grip_Cell,iconCls:"icon-uniE943",type:"function",click:"Strack.copy_clipboard(this)",attr_data:{"clipboard-action":"copy","clipboard-target":"#grid_clipboard"}}),Strack.InitMenuItem("st_menu_task",i),new Clipboard("#st_menu_tcopy_cell")}function w(a){var t="";switch(parseInt(a)){case 3010:t="prodcolumn";break;case 3020:t="prodlist";break;case 4010:t="assetcolumn";break;case 4020:t="assetlist";break;case 7010:t="shotcolumn";break;case 7020:t="shottlist"}return t}obj={switchDatagrid:function(a,t,e){var s=$(a).data("pid"),o=$(a).data("ptype");if($(".p-wrap-filter").length>0)switch(parseInt(t)){case 10:Strack.DoFilterClose(o+"20",$("#proj_table_list"));break;case 20:Strack.DoFilterClose(o+"10",$("#proj_table_column"))}Strack.SetdataListSession(o,t),$(".datagrid-mode").removeClass("active-list"),$(".list_"+t).addClass("active-list");var n=$("#datalist_main_"+e+"10"),c=$("#datalist_main_"+e+"20");switch(Strack.SideColumnClose(),parseInt(t)){case 10:c.addClass("projtable-hide"),n.hasClass("projtable-ok")?(n.removeClass("projtable-hide"),$("#proj_table_column").datagrid("reload")):(T(A,o,o+"10"),n.removeClass("projtable-hide").addClass("projtable-ok").append(i("column")),obj.switchDatagridTab(t,s,o,I)),b(10,n,c);break;case 20:n.addClass("projtable-hide"),c.hasClass("projtable-ok")?(c.removeClass("projtable-hide"),$("#proj_table_list").datagrid("reload")):(D(A,o,o+"20"),c.removeClass("projtable-hide").addClass("projtable-ok").append(i("list")),obj.switchDatagridTab(t,A,o,I)),b(20,n,c)}},switchDatagridTab:function(t,i,r,k){var _="",m="",h=($("#datalist_main_"+r+"10"),$("#datalist_main_"+r+"20"),{Edit:DataPHP.Edit,Report:DataPHP.Report,Edit_Selected:DataPHP.Edit_Selected,Add_Note:DataPHP.Add_Note,Add_Task:DataPHP.Add_Task,Export_Excel:DataPHP.Export_Excel,NotReport:DataPHP.NotReport,MovetoTrash:StrackPHP.MovetoTrash,Reset:StrackPHP.Reset,Action:StrackPHP.Action,Assign:StrackPHP.Assign,AddTags:StrackPHP.AddTagsT,TasksUpdate:StrackPHP.TasksUpdate,Import:StrackPHP.Import_ExcelT,Today:StrackPHP.Today,Daily:StrackPHP.Daily,CopyTo:DataPHP.CopyTo}),b={Pipeline:DataPHP.Pipeline,Show_All_Steps:DataPHP.Show_All_Steps,Hide_All_Steps:DataPHP.Hide_All_Steps,Steps:StrackPHP.Steps,Fields:DataPHP.Fields,Sort:StrackPHP.Sort,Group:StrackPHP.Group,Action:StrackPHP.Action,ShowColumns:DataPHP.ShowColumns,Manage_Steps:DataPHP.Manage_Steps,ManageColumns:DataPHP.ManageColumns,Manage_Fields:StrackPHP.Manage_Fields,SortAsc:StrackPHP.SortAsc,SortDesc:StrackPHP.SortDesc,SortGroupAsc:StrackPHP.SortGroupAsc,SortGroupDesc:StrackPHP.SortGroupDesc,SortAdvs:StrackPHP.SortAdvs,ClearGroup:StrackPHP.ClearGroup};switch(parseInt(t)){case 10:m=x+"10";var y="projnav_"+i,v=JSON.parse(Strack.read_storage(y)),T=v[0].shot_item_cols.replace(/,9999/,"");_+=s(i,t,r),"yes"==H&&(_+=o(i,r,DataPHP.ToolAdd,"proj_table_column","Strack.addNewEntity")),_+=n(h,r,i,m),_+=d(b,r+"10",i,"proj_table_column"),_+=l(b,r+"10",i,"proj_table_column"),_+=P(b,i,m,"proj_table_column"),_+=S(m),_+=f(i,m,"proj_table_column","item_name","items","items"),$("#tb_column").empty().append(_),g(i,"proj_table_column",i,k,"column"),u(b,r+"10",i,"proj_table_column");var D=[];"yes"==PARSE_VAR.rules.view_save.allow&&(D.push({obj:"Strack.ViewSave",css:"icon-uniF0C7",name:StrackPHP.Save,pid:A,ptype:m,grid:"proj_table_column"}),D.push({obj:"Strack.ViewSaveAs",css:"icon-uniF0C5",name:StrackPHP.SaveAs,pid:A,ptype:m,grid:"proj_table_column"}),D.push({obj:"Strack.ViewRemove",css:"icon-uniE9D5",name:StrackPHP.Deleted,pid:A,ptype:m,grid:"proj_table_column"})),"yes"==PARSE_VAR.rules.custom_fields.allow&&D.push({obj:"Strack.Manage_Fields",css:"icon-uniE71D",name:StrackPHP.Manage_Fields,pid:A,ptype:m,grid:"proj_table_column"}),"yes"==PARSE_VAR.rules.view_manage.allow&&D.push({obj:"Strack.ViewManage",css:"icon-uniEA9B",name:StrackPHP.Manage_View,pid:A,ptype:m,grid:"proj_table_column"}),"yes"==PARSE_VAR.rules.view_column.allow&&D.push({obj:"Strack.ViewColumns",css:"icon-uniE68E",name:StrackPHP.ManageColumns,pid:A,ptype:m,grid:"proj_table_column"}),Strack.getViewSet(A,m,"proj_table_column",PARSE_VAR.rules,D),a(T,i,r,k);break;case 20:m=x+"20",_+=s(i,t,r),"yes"==F.tasks_add.allow&&(_+=o(i,r,StrackPHP.Tasks,"proj_table_list","Strack.addEntityTask")),_+=c(h,r,i,m),_+=d(b,r+"20",i,"proj_table_list"),_+=l(b,r+"20",i,"proj_table_list"),_+=p(b,r+"20",i,"proj_table_list"),_+=S(m),_+=f(i,m,"proj_table_list","content","tasks","itasks"),$("#tb_list").empty().append(_),Strack.LoadFieldsList(r+"20",i,"proj_table_list",PARSE_VAR.rules.custom_fields.allow),u(b,r+"20",i,"proj_table_list"),Strack.getViewSet(A,m,"proj_table_list",PARSE_VAR.rules,""),e(r,i,m)}$(".ui.menu , .ui.dropdown").dropdown({on:"hover"})},StepsShowAll:function(a){G.forEach(function(a){Strack.DoStepsToggle(a,A,I,"proj_table_column","column","allshow")})},StepsHideAll:function(a){G.forEach(function(a){Strack.DoStepsToggle(a,A,I,"proj_table_column","column","allhide")})},Manage_Steps:function(a){var t=$("#temp_id").val(),e=parseInt($(a).data("ptype")),i="",s="";switch(e){case 3010:i=DataPHP.MDProdSteps_Title,s=DataPHP.ProdStepsTemp;break;case 4110:i=DataPHP.MDSystemSteps_Title,s=DataPHP.SystemStepsTemp;break;case 4210:i=DataPHP.MDProgramSteps_Title,s=DataPHP.ProgramStepsTemp;break;case 4310:i=DataPHP.MDBugSteps_Title,s=DataPHP.BugStepsTemp;break;case 4010:i=DataPHP.MDASteps_Title,s=DataPHP.AStepsTemp;break;case 7010:i=DataPHP.MDSSteps_Title,s=DataPHP.SStepsTemp}y(t,e,i,"StepsUpdate",s)},StepsUpdate:function(){for(var a,t=$("#Mtemp_id").val(),e=parseInt($("#Mptype").val()),i=$("#template-columns").datagrid("getRows"),s=[],o="",n=0;n<i.length;n++)s.push(i[n].type_id);switch(e){case 3010:a=DataPHP.UpProdStepsTemp,o="prod";break;case 4110:a=DataPHP.UpSystemStepsTemp,o="system";break;case 4210:a=DataPHP.UpProgramStepsTemp,o="program";break;case 4310:a=DataPHP.UpBugStepsTemp,o="bug";break;case 4010:a=DataPHP.UpAStepsTemp,o="asset";break;case 7010:a=DataPHP.UpSStepsTemp,o="shot"}$.ajax({type:"POST",url:a,data:{temp_id:t,steps:s.join(",")},beforeSend:function(){$("#dialog").prepend(Strack.loading_dom("white"))},success:function(a){$("#st-load").remove(),Strack.dialog_cancel(),Strack.DEProjcolumns(A,o,e),window.location.reload()}})},ManageColumns:function(a){var t,e=$("#temp_id").val(),i=$(a).data("ptype"),s="",o="";switch(parseInt(i)){case 3010:s=DataPHP.MDProdIcolumns_Title,o=DataPHP.ProdIColumnsTemp,t=22;break;case 4010:s=DataPHP.MDAIcolumns_Title,o=DataPHP.AIColumnsTemp,t=12;break;case 7010:s=DataPHP.MDSIcolumns_Title,o=DataPHP.SIColumnsTemp,t=22}v(e,s,"ColumnsUpdate",o,t,i)},ColumnsUpdate:function(){for(var a,t=$("#Mtemp_id").val(),e=parseInt($("#Mptype").val()),i=$("#template-columns").datagrid("getRows"),s=[],o="",n=0;n<i.length;n++)s.push(i[n].type_id);switch(e){case 3010:a=DataPHP.UpIProdTemp,o="prod";break;case 4010:a=DataPHP.UpIAssetTemp,o="asset";break;case 7010:a=DataPHP.UpIShotTemp,o="shot"}$.ajax({type:"POST",url:a,data:{temp_id:t,item_cols:s.join(",")},beforeSend:function(){$("#dialog").prepend(Strack.loading_dom("white"))},success:function(a){$("#st-load").remove(),Strack.dialog_cancel(),Strack.DEProjcolumns(A,o,e),window.location.reload()}})},BathEditItems:function(a){var t=$(a).data("grid"),e=$(a).data("ftype"),i=Strack.GetTaskDatagrid(t,"item_id",!1);switch(i.verify){case-3:layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6});break;case 200:var s="";switch(parseInt(e)){case 3010:s=DataPHP.TUpdateEditProds;break;case 4010:s=DataPHP.TUpdateEditAssets;break;case 4110:s=DataPHP.TUpdateEditsystem;break;case 4210:s=DataPHP.TUpdateEditprogram;break;case 4310:s=DataPHP.TUpdateEditbug;break;case 7010:s=DataPHP.TUpdateEditShots}Strack.BatchUpDialog("#"+t,s,i.ids.join(","),{type:"items",pid:A,custom:"yes",etype:e,upmod:r(e),multi:"no"},StrackPHP.EditFields,i)}},ItemstoTrash:function(a){var t,e,i=$("#proj_table_column").datagrid("getSelections"),s=[],o=$(a).data("ftype");switch(i.forEach(function(a){s.push(a.item_id)}),parseInt(o)){case 3010:t=StrackPHP.DePreprods_notice,e=StrackPHP.DePreprodsSC;break;case 4010:t=StrackPHP.DeAssets_notice,e=StrackPHP.DeAssetsSC;break;case 4110:t=StrackPHP.DeSystem_notice,e=StrackPHP.DeSystemSC;break;case 4210:t=StrackPHP.DeProgram_notice,e=StrackPHP.DeProgramC;break;case 4310:t=StrackPHP.DeBug_notice,e=StrackPHP.DeBugSC;break;case 7010:t=StrackPHP.DeShots_notice,e=StrackPHP.DeShotsSC}Strack.ajax_grid_delete(i,t,StrackPHP.DeleteItems,{item_ids:s.join(","),pid:A,ptype:o},"#proj_table_column",e)},TasksUpdate:function(a){var t=$(a).data("grid"),e=$(a).data("ftype"),i=Strack.GetTaskDatagrid(t,"task_id",!1);switch(i.verify){case-3:layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6});break;case 200:var s="";switch(parseInt(e)){case 3020:s=DataPHP.TUpdateEditProdtasks;break;case 4020:s=DataPHP.TUpdateEditAssettasks;break;case 4120:s=DataPHP.TUpdateEditSystemtasks;break;case 4220:s=DataPHP.TUpdateEditProgramtasks;break;case 4320:s=DataPHP.TUpdateEditBugtasks;break;case 7020:s=DataPHP.TUpdateEditShottasks}Strack.BatchUpDialog("#"+t,s,i.ids.join(","),{type:"tasks",pid:A,custom:"yes",etype:e,upmod:r(e),multi:"no"},StrackPHP.EditFields,i)}},TaskstoTrash:function(a){var t,e,i=$("#proj_table_list").datagrid("getSelections"),s=[],o=$(a).data("ftype");switch(i.forEach(function(a){s.push(a.task_id)}),parseInt(o)){case 3020:t=StrackPHP.DeProdtasks_notice,e=StrackPHP.DeProdtasksSC;break;case 4020:t=StrackPHP.DeAssettasks_notice,e=StrackPHP.DeAssettasksSC;break;case 4120:t=StrackPHP.DeSystemtasks_notice,e=StrackPHP.DeSystemtasksSC;break;case 4220:t=StrackPHP.DeProgramtasks_notice,e=StrackPHP.DeProgramtasksSC;break;case 4320:t=StrackPHP.DeBugtasks_notice,e=StrackPHP.DeBugtasksSC;break;case 7020:t=StrackPHP.DeShottasks_notice,e=StrackPHP.DeShottasksSC}Strack.ajax_grid_delete(i,t,StrackPHP.DeleteTasks,{task_ids:s.join(","),pid:A,ptype:o},"#proj_table_list",e)}};var j=$(".projpage-main");if(PARSE_VAR.auth.authority){var H,E,C,A=$("input[name=proj_id]").val(),x=$("input[name=p_type]").val(),I=$("input[name=e_type]").val(),M=$("#datalist_main_"+x+"10"),R=$("#datalist_main_"+x+"20"),U=Strack.verify_project_data(A),F=PARSE_VAR.rules;switch(parseInt(x)){case 30:H=F.projprod_add.allow,E=F.projprod_del.allow,C=F.pre_stepset.allow,F.pre_colunm.allow;break;case 40:H=F.assets_add.allow,E=F.assets_del.allow,C=F.assets_stepset.allow,F.assets_colunm.allow;break;case 41:H=F.system_add.allow,E=F.system_del.allow,C=F.system_stepset.allow,F.system_colunm.allow;break;case 42:H=F.program_add.allow,E=F.program_del.allow,C=F.program_stepset.allow,F.program_colunm.allow;break;case 43:H=F.bug_add.allow,E=F.bug_del.allow,C=F.bug_stepset.allow,F.bug_colunm.allow;break;case 70:H=F.shots_add.allow,E=F.shots_del.allow,C=F.shots_stepset.allow,F.shots_colunm.allow}if(U>0){j.show();var B=[];B["content-1"]=StrackPHP.TaskNameNULL,B["task_status-1"]=StrackPHP.TaskStatusNULL,B["task_item-1"]=StrackPHP.TaskItemNULL,B["task_step-1"]=StrackPHP.Task_StepsNULL,B["assign-1"]=StrackPHP.TaskAssignNULL;var G;Strack.save_storage("projid",[A,x]),Strack.project_sub_menu(A,x);var N=Strack.GetdataListSession(x);switch(N||(N=10),parseInt(N)){case 10:T(A,x,x+"10"),M.removeClass("projtable-hide").addClass("projtable-ok").append(i("column")),b(10,M,R);break;case 20:D(A,x,x+"20"),R.removeClass("projtable-hide").addClass("projtable-ok").append(i("list")),b(20,M,R)}obj.switchDatagridTab(N,A,x,I)
}else j.empty().append(Strack.ProjWarn(StrackPHP.Project_None_Warning)).show()}else j.empty().append(Strack.ProjWarn(StrackPHP.NoPermission)).show()});