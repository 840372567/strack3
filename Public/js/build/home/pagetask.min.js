$(function(){function t(t,a,e,s,i,r){P(t,a,e,s,i,r),Strack.TodoAjax(t,e,a,!0)}function a(t,i,r,o,n,l,d){var p=$("#lseq_list");$.ajax({type:"POST",url:StrackPHP.getVersionData,dataType:"json",data:{project_id:i,type:t,t_id:r,filter:JSON.stringify(o),pagenum:n,pagesize:l},beforeSend:function(){$(".seq-left-wrap").append(Strack.loading_dom("white","","lseq"))},success:function(c){var k=c.total,_="";if(k>0)switch(c.rows.forEach(function(t){_+=s(t)}),d){case"new":p.on("scroll",function(){if((this.scrollTop||this.scrollTop)==(this.scrollHeight||this.scrollHeight)-(this.clientHeight||this.clientHeight)){n++;var e=Math.ceil(k/l);n<=e&&a(t,i,r,o,n,l,"more")}}),p.empty().append(_);break;case"more":p.append(_)}else p.empty().append('<div class="datagrid-empty-no">'+Strack.DataNullTip(2010)+"</div>");$("#st-load_lseq").remove(),e()}}),c()}function e(){$(".tver-play").on("mouseover",function(){$(this).css("opacity",1)}).on("mouseout",function(){$(this).css("opacity",0)})}function s(t){var a="";return a+='<div class="seq-left-items"><a href="javascript:;" class="list-item-main" onclick="obj.ShowItem(this)" data-verid="'+t.version_id+'"><div id="thumb_left_50_'+t.version_id+'" class="sleft-items-thumb">'+Strack.VersionThumb(t)+'</div><div class="sleft-items-content"><div class="sleft-items-ctop"><span class="items-ctop-icon aign-left">'+Strack.publishGridIcon(t.publish)+'</span><span class="items-ctop-title aign-left text-ellipsis">'+t.version+" ( "+t.status_name+' ) </span></div><div class="sleft-items-cbottom"><span class="items-ctop-status aign-left">'+t.user_name+" - "+t.created+"</span></div></div></a>"+i(t)+"</div>"}function i(t){var a,e,s,i,r="";switch(t.progress_id?(s="yes",i=1):s="no",t.media_id?(a=t.version_id,e=t.media_type,i=parseInt(t.direct_jump)):(a=0,e=0,i=0),i){case 0:r+='<a href="javascript:;" class="tver-play" onclick="Strack.play_media(this)" data-jump="preview" data-vid="'+a+'" data-mtype="'+e+'" data-progress ="'+s+'"><i class="icon-uniE657"></i></a>';break;case 1:r+='<a href="javascript:;" class="tver-play" onclick="Strack.jump_to_webpalyer(this)" data-jump="webplayer" data-src="'+(Strack.remove_html_ext(StrackPHP.WebplayerPath)+"?type=single&&mid="+t.media_id)+'"><i class="icon-uniE657"></i></a>'}return r}function r(t){var a={version_id:PtaskPHP.VersionId,description:StrackPHP.Description,path:StrackPHP.Path,user_id:StrackPHP.Assignee,sub_date:StrackPHP.StartTime,due_date:StrackPHP.EndTime,created:StrackPHP.Created};$.ajax({type:"POST",url:StrackPHP.getVersionDetails,dataType:"json",data:{ver_id:t},beforeSend:function(){$("#tver_details").append(Strack.loading_dom("white","","ver_details"))},success:function(t){var e="",s="";$("#tver_d_todo").show(),$("#st-load_ver_details").remove(),e+=o(10,PtaskPHP.VersionInfo);for(var i in t.version_data)e+=o(20,{lang:a[i],val:t.version_data[i]});e+=o(10,PtaskPHP.PublishInfo),e+=o(20,{lang:StrackPHP.Whether_Publish,val:t.is_publish.lang}),"yes"==t.is_publish.status&&t.publish_data.forEach(function(t){e+=o(20,{lang:t.type_name,val:t.file_path})}),s+=Strack.TodoListBase(H,j,w,t.todo_data,t.todo_data.todo_list,t.todo_data.user_list,!1,StrackPHP.Version_Todo_None),$("#tver_d_info").empty().append(e),$("#ver_todo_list").empty().append(s)}})}function o(t,a){var e="";switch(t){case 10:e+='<div class="tver-rm-item tver-bold"><div class="tver-rm-name aign-left">'+a+"</div></div>";break;case 20:e+='<div class="tver-rm-item tver-border"><div class="tver-rm-name aign-left">'+a.lang+'</div><div class="tver-rm-content aign-left">'+a.val+"</div></div>"}return e}function c(){var t,a,e=$(".seq-left-wrap"),s=$(".proj-seq-left"),i=$(".items-ctop-title"),r=$(".proj-seq-right");$("#myhome_handle").on("mousedown",function(o){o.preventDefault(),t=680,$(document).on("mousemove",function(o){a=o.pageX<140?7:o.pageX>=t?t:o.pageX,a<140?e.hide():e.show(),i.css("width",a-200),s.css("width",a),r.css("width","calc(100% - "+a+"px)"),a<230?$(".sleft-items-content").hide():$(".sleft-items-content").show()}).on("mouseup",function(t){$(this).off("mousemove")})})}function n(t,a,e,s,i){var r=Strack.build_filter({project_id:["eq",a],task_id:["neq",e],active:["eq",1]},{},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"},{sortName:"created",sortOrder:"desc"}]);Strack.G.Gfilter_data.relation_tasks=r,$("#proj_table_list").datagrid({url:StrackPHP.DataPtask,fitColumns:!1,height:Strack.panel_height(".task-related-wrap",0),rowheight:49,differhigh:!1,adaptive:{dom:".task-related-wrap",min_width:510,exth:0,domresize:1},DragSelect:!0,DataNull:StrackPHP.DataNoReTasks,queryParams:{filter:JSON.stringify(r),op_type:t,pid:a,t_id:e,tab:"related"},frozenColumns:[[{field:"task_id",title:StrackPHP.Taskid,checkbox:!0}]],columns:[i],toolbar:"#related_tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,groupField:"type_id",view:groupview,groupActive:!0,groupFormatter:function(t,a){return'<span class="">'+a[0].type_name+" - "+a.length+" "+StrackPHP.TasksUnit+"</span>"},onDblClickRow:function(e,s){Strack.SideColumnOpen(s.task_id,t,10,a)},onLoadSuccess:function(t){$("a.athumb").on("click",function(t){Strack.save_storage("task_panel_tab","activity")})},onRowContextMenu:function(t,a,e){Strack.grid_clipboard(t.target),t.preventDefault(),$("#st_menu_task").menu("show",{left:t.pageX,top:t.pageY})}}),Strack.LoadFieldsList(s,1,"proj_table_list"),Strack.GroupDown(a,s,"proj_table_list",{SortChange:"Strack.sort_change",SortAdv:"Strack.DataSortAdv",SortItem:"Strack.DataSortItem"})}function l(t,a,e,s){$.ajax({type:"POST",url:StrackPHP.DynamicFields,dataType:"json",data:{project_id:a,type:s},success:function(i){var r=[];i.forEach(function(t,e){t&&r.push(Strack.DynamicFieldset(s,t,e,"",{pid:a}))}),n(t,a,e,s,r)}})}function d(t,a,e){var s=Strack.build_filter({project_id:["eq",t],active:["eq",1]},{},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]);Strack.G.Gfilter_data.assets=s,$("#proj_table_column").datagrid({url:PtaskPHP.DataLinkAsset,fitColumns:!1,height:Strack.panel_height(".pitem_linkasset",0),rowheight:49,differhigh:!0,autocolumns:!0,gridname:"asset",adaptive:{dom:".pitem_linkasset",min_width:0,exth:0,domresize:1},DragSelect:!0,DataNull:Strack.DataNullTip(a+"10"),queryParams:{eid:e,pid:t,pype:10,type:40,ptype:4010,filter:JSON.stringify(s),thumb:StrackPHP.ITEM_THUMB,url:StrackPHP.projitem,turl:StrackPHP.pagetask,from:"task"},toolbar:"#lasset_tb",pagination:!0,pageSize:40,pageList:[40,80],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(a,e){Strack.SideColumnOpen(e.item_id,40,20,t,"proj_table_column")},onRowContextMenu:function(t,a,e){Strack.grid_clipboard(t.target),t.preventDefault(),$("#st_menu_linkasset").menu("show",{left:t.pageX,top:t.pageY})}})}function p(t,a,e){$("#task_history").datagrid({url:StrackPHP.DataPtask,height:Strack.panel_height(".task-history-wrap",0),differhigh:!1,singleSelect:!0,fitColumns:!1,striped:!0,adaptive:{dom:".task-history-wrap",min_width:510,exth:0},DataNull:StrackPHP.DataNoHis,queryParams:{op_type:t,pid:a,t_id:e,tab:"history",log_type:"10,1020,1030,611"},frozenColumns:[[{field:"log_id",checkbox:!0}]],columns:[[{field:"operate",title:StrackPHP.Operate,align:"center",width:120,frozen:"frozen",findex:0},{field:"projname",title:StrackPHP.Project,align:"center",width:180,frozen:"frozen",findex:1},{field:"summary",title:StrackPHP.EventLog_Summary,align:"center",width:450,frozen:"frozen",findex:2},{field:"log_val",title:StrackPHP.TMeta,align:"center",width:650,frozen:"frozen",findex:3},{field:"log_link",title:StrackPHP.EventLog_Link_Id,align:"center",width:80,frozen:"frozen",findex:4},{field:"log_type",title:StrackPHP.EventLog_Type,align:"center",width:120,frozen:"frozen",findex:5},{field:"user_id",title:StrackPHP.User,align:"center",width:160,frozen:"frozen",findex:6},{field:"created",title:StrackPHP.Created,align:"center",width:180,frozen:"frozen",findex:7}]],pagination:!0,pageSize:40,pageList:[40,80],pageNumber:1,pagePosition:"bottom",remoteSort:!1})}function k(t,a,e){$.ajax({type:"POST",url:PtaskPHP.LoadTaskImg,data:{t_id:t,project_id:a,type:10},beforeSend:function(){$(".item-thumb-warp").prepend(Strack.loading_dom("white"))},success:function(t){var a=JSON.parse(t),s=$("#task_thumb"),i="";if($("#st-load").remove(),"no"==PARSE_VAR.rules.upload_thumb.allow&&$("#task_up_thumb").empty().html(StrackPHP.Thumbnail),400==parseInt(a.status))i='<div class="task-thumb-null">'+Strack.ProjTaskIcon(e)+"</div>",s.empty().append(i);else{var r=StrackPHP.TASK_THUMB+"/"+a.thumb+"_max.jpg";s.empty().append('<img src="'+r+'">')}}})}function _(t,a,e,s,i,r,o){var c="",n=StrackPHP.projitem.replace(".html",""),l=n+"/"+a+"_"+t+"_"+e+".html";return c+='<div class="ui small breadcrumb">',c+='<a class="section" href="'+Strack.remove_html_ext(Strack.ProjSubUrl(t))+"/"+a+'.html" >'+Strack.ProjSubName(t)+"</a>",c+='<i class="right angle icon divider"></i>',c+='<a class="section" href="'+l+'">'+s+"</a>",c+='<i class="right angle icon divider"></i>',c+='<div class="ui dropdown st-dropdown">',c+='<div class="active section taskm_content">'+r+'</div> <i class="dropdown icon"></i>',c+='<div class="menu">',o.forEach(function(e){c+=m(t,a,e.task_id,e.content,e.type_name)}),c+="</div>",c+="</div>",c+="</div>"}function m(t,a,e,s,i){var r="";return r+='<a href="'+StrackPHP.pagetask.replace(".html","")+"/"+a+"_"+t+"_"+e+'.html" class="item" >',r+=Strack.ProjTaskIcon(t),r+="["+i+"] "+s,r+="</a>"}function u(t,a,e,s){var i="";return i+='<a class="section" href="'+Strack.remove_html_ext(Strack.ProjSubUrl(t))+"/"+a+'.html" >'+Strack.ProjSubName(t)+'</a><i class="right angle icon divider"></i><i class="'+s.status_icon+' icon-left" style="color:#'+s.status_color+'"></i><div class="active section taskm_content">'+e+"</div>"}function P(t,a,e,s,i,r){Strack.NotesAjax(t,a,e,s,i,r,"task_notes"),setInterval(function(){$(".simditor-toolbar").is(":hidden")&&Strack.NotesAjax(t,a,e,s,i,r,"task_notes")},6e5)}function h(t,a,e){$.ajax({type:"POST",url:StrackPHP.DataPtask,data:{tab:"onset",op_type:t,e_id:a,allow_edit:"noedit"},beforeSend:function(){$(".item-mainwrap").append(Strack.loading_dom("white","","onset"))},success:function(s){var i=JSON.parse(s),r=Strack.SideColumnBuildOnset(i.e_id,e,i.data,"onset",t);$(".onset-info-edit").empty().append(r),$("#st-load_onset").remove(),$(".pswp").length<1&&$("body").append(Strack.PhotoSwipeButtonDOM()),Strack.LoadOnsetAtt(e,a)}})}function S(t){var a="";switch(t){case 10:a='<a href="javascript:;" id="tab_activity" class="item tab_item" style="margin-left:20px;" onclick="obj.SwitchTabs(this);" data-tab="activity">'+StrackPHP.Activity+"</a>";break;case 20:a='<a href="javascript:;" id="tab_task_info" class="item tab_item" onclick="obj.SwitchTabs(this);" data-tab="task_info">'+StrackPHP.TaskInfo+"</a>";break;case 30:a='<a href="javascript:;" id="tab_onset" class="item tab_item" onclick="obj.SwitchTabs(this);" data-tab="onset">'+StrackPHP.OnSet+"</a>";break;case 40:a='<a href="javascript:;" id="tab_versions" class="item tab_item" onclick="obj.SwitchTabs(this);" data-tab="versions">'+StrackPHP.Task_Versions+"</a>";break;case 50:a='<a href="javascript:;" id="tab_related" class="item tab_item" onclick="obj.SwitchTabs(this);" data-tab="related">'+StrackPHP.Entity_Tasks+"</a>";break;case 60:a='<a href="javascript:;" id="tab_linkasset" class="item tab_item" onclick="obj.SwitchTabs(this);" data-tab="linkasset">'+StrackPHP.Assets+"</a>";break;case 70:a='<a href="javascript:;" id="tab_history" class="item tab_item" onclick="obj.SwitchTabs(this);" data-tab="history">'+StrackPHP.History+"</a>"}return a}function f(t,a){var e=[];"yes"==E.myhome_assign.allow&&e.push({name:"tassign",text:StrackPHP.Assign,iconCls:"icon-uniE99B",type:"function",click:"Strack.TasksAssign(this)",attr_data:{grid:"proj_table_list",pid:t,type:a}}),"yes"==E.myhome_copyto.allow&&e.push({name:"tcopyto",text:StrackPHP.CopyTo,iconCls:"icon-uniE629",type:"function",click:"Strack.TasksCopyTo(this)",attr_data:{grid:"proj_table_list",pid:t,type:a}}),"yes"==E.batch_update.allow&&e.push({name:"tedit",text:StrackPHP.TasksUpdate,iconCls:"icon-uniE9AB",type:"function",click:"obj.TasksUpdate(this)",attr_data:{pid:t,ftype:a+"20",mode:"tasks",grid:"proj_table_list"}}),"yes"==E.export_excel.allow&&e.push({name:"texcel",text:StrackPHP.Export_Excel,iconCls:"icon-uniE6082",type:"function",click:"Strack.ExportExcel(this)",attr_data:{pid:t,type:a+"20",done:"relation_tasks",mode:"grid"}}),"yes"!=E.pre_action.allow&&"yes"!=E.assets_action.allow&&"yes"!=E.shots_action.allow||e.push({name:"taction",text:StrackPHP.Action,iconCls:"icon-uniE6BB",type:"function",click:"Strack.ClientActionBatch(this)",attr_data:{type:20,grid:"proj_table_list",field:"task_id"}}),e.push({name:"treset",text:StrackPHP.Reset,iconCls:"icon-uniE682",type:"function",click:"Strack.ResetDatagrid(this)",attr_data:{type:a+"20",pid:t,grid:"proj_table_list"}}),"yes"==E.tasks_del.allow&&e.push({name:"tdelete",text:StrackPHP.MovetoTrash,iconCls:"icon-uniE9D5",type:"function",click:"obj.TaskstoTrash(this)",attr_data:{id:"task_id",ftype:a+"20",grid:"proj_table_list"}}),e.push({name:"tcopy_cell",text:StrackPHP.Copy_Grip_Cell,iconCls:"icon-uniE943",type:"function",click:"Strack.copy_clipboard(this)",attr_data:{"clipboard-action":"copy","clipboard-target":"#grid_clipboard"}}),Strack.InitMenuItem("st_menu_task",e),new Clipboard("#st_menu_tcopy_cell")}function v(){var t=[];t.push({name:"lcopy_cell",text:StrackPHP.Copy_Grip_Cell,iconCls:"icon-uniE943",type:"function",click:"Strack.copy_clipboard(this)",attr_data:{"clipboard-action":"copy","clipboard-target":"#grid_clipboard"}}),Strack.InitMenuItem("st_menu_linkasset",t),new Clipboard("#st_menu_lcopy_cell")}function b(e){switch($(".pitem-wrap").removeClass("active").each(function(){$(this).data("tab")==e&&$(this).addClass("active")}),e){case"activity":t(H,w,j,C,D,"new");break;case"task_info":Strack.AjaxMfields(w,j,H,StrackPHP.DataPtask,"tasks",10,"task_info_list");break;case"onset":h(w,j,H);break;case"versions":x=Strack.build_filter({project_id:["eq",H],task_id:["eq",j]},{},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]),a(w,H,j,x,1,100,"new");break;case"related":f(H,w),l(w,H,j,T),Strack.getViewSet(H,T,"proj_table_list",PARSE_VAR.rules,"");break;case"linkasset":v(),d(H,w,j),Strack.GroupDown(H,4010,"proj_table_column",{SortChange:"Strack.sort_change",SortAdv:"Strack.DataSortAdv",SortItem:"Strack.DataSortItem"});break;case"history":p(w,H,j)}}function g(t){var a;switch(parseInt(t)){case 3010:a="preprods";break;case 3020:a="preprod_tasks";break;case 4010:a="assets";break;case 4020:a="asset_tasks";break;case 4110:a="system";break;case 4120:a="system_tasks";break;case 4210:a="program";break;case 4220:a="program_tasks";break;case 4310:a="bug";break;case 4320:a="bug_tasks";break;case 7010:a="shots";break;case 7020:a="shot_tasks"}return a}obj={SwitchTabs:function(t){var a=$(t),e=$(t).data("tab");if($(".p-wrap-filter").length>0)switch(e){case"related":Strack.DoFilterClose(4010,$("#proj_table_column"));break;case"linkasset":Strack.DoFilterClose(T,$("#proj_table_list"))}$(".tab_item").removeClass("active"),a.addClass("active"),$(".pitem-wrap").removeClass("active").each(function(){$(this).data("tab")==e&&$(this).addClass("active")}),b(e),Strack.save_storage("task_panel_tab",e),Strack.SideColumnClose()},Modify_Thumb:function(t){Strack.open_dialog("dialog",{title:PtaskPHP.Upload_Thumb,width:480,height:180,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mproj_id",type:"hidden",name:"proj_id",valid:1,value:H},{case:102,id:"Mproj_canvas"}],items:[{case:1,id:"Mproj_thumb",type:"text",lang:StrackPHP.Name,name:"proj_thumb",valid:0,value:""}],footer:[{obj:"choice_thumb",type:4,title:""},{obj:"up_thumb",type:1,title:StrackPHP.Update},{obj:"dialog_cancel",type:5,title:StrackPHP.Cancel}]}),inits:function(){Strack.upload_image("img_up_bnt","Mproj_thumb","Mproj_canvas")},close:function(){Strack.G.Jcrop_Canvas=null}})},up_thumb:function(){if(Strack.G.Jcrop_Canvas){var t=($("input[id=Mproj_id]").val(),Strack.G.Jcrop_Canvas.toDataURL("image/jpg"));$.ajax({type:"POST",url:PtaskPHP.UPTaskThumb,data:{pid:H,t_id:j,type:10,up_url:StrackPHP.UPLOADS,img:t},beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(t){$.messager.progress("close");var a=JSON.parse(t);-1==a.status?$.messager.alert(StrackPHP.Warning,StrackPHP.Illegal_Operation,"warning"):-400==a.status?$.messager.alert(StrackPHP.Warning,StrackPHP.Upload_Failed,"warning"):200==a.status&&($("#dialog").dialog("close"),k(j,H),Strack.top_message({bg:"g",msg:PtaskPHP.Thumb_Upload_SC}))}})}else $.messager.alert(StrackPHP.Notice,PtaskPHP.Please_Select_Image,"info")},TasksUpdate:function(t){var a=$(t).data("grid"),e=$(t).data("ftype"),s=Strack.GetTaskDatagrid(a,"task_id",!1);switch(s.verify){case-3:layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6});break;case 200:var i="";switch(parseInt(e)){case 3020:i=PtaskPHP.TUpdateEditProdtasks;break;case 4020:i=PtaskPHP.TUpdateEditAssettasks;break;case 4120:i=PtaskPHP.TUpdateEditSystemtasks;break;case 4220:i=PtaskPHP.TUpdateEditProgramtasks;break;case 4320:i=PtaskPHP.TUpdateEditBugtasks;break;case 7020:i=PtaskPHP.TUpdateEditShottasks}Strack.BatchUpDialog("#"+a,i,s.ids.join(","),{type:"tasks",pid:H,custom:"yes",etype:e,upmod:g(e),multi:"no"},StrackPHP.EditFields,s)}},TaskstoTrash:function(t){var a,e,s=$("#proj_table_list").datagrid("getSelections"),i=[],r=$(t).data("ftype");switch(s.forEach(function(t){i.push(t.task_id)}),parseInt(r)){case 3020:a=StrackPHP.DeProdtasks_notice,e=StrackPHP.DeProdtasksSC;break;case 4020:a=StrackPHP.DeAssettasks_notice,e=StrackPHP.DeAssettasksSC;break;case 4120:a=StrackPHP.DeSystemtasks_notice,e=StrackPHP.DeSystemtasksSC;break;case 4220:a=StrackPHP.DeProgramtasks_notice,e=StrackPHP.DeProgramtasksSC;break;case 4320:a=StrackPHP.DeBugtasks_notice,e=StrackPHP.DeBugtasksSC;break;case 7020:a=StrackPHP.DeShottasks_notice,e=StrackPHP.DeShottasksSC}Strack.ajax_grid_delete(s,a,StrackPHP.DeleteTasks,{task_ids:i.join(","),pid:H,ptype:r},"#proj_table_list",e)},MediatoTrash:function(t){var a=$(".sleft-items-active").data("verid"),e=($(t).data("mode"),$(t).data("grid"));a>0?Strack.DoDeletedMedia(H,"task_ver",e,a):layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6})},ShowItem:function(t){var a=$(t).data("verid");$(".list-item-main").removeClass("sleft-items-active"),$(t).addClass("sleft-items-active"),r(a)},FilterAction:function(t){var e=$(t).data("pid"),s=$(t).data("filter"),i=($(t).data("grid"),$("#search_val_"+s).val());x=Strack.build_filter({project_id:["eq",e],task_id:["eq",j]},{version:["LIKE","%"+i+"%"]},{},{},"and",{},{},[{sortName:"created",sortOrder:"desc"}]),a(w,e,j,x,1,100,"new")},resetVerlist:function(){a(w,H,j,x,1,100,"new"),$("#tver_d_info").empty().append('<div class="datagrid-empty-no">'+PtaskPHP.VersionNotInfo+"</div>"),$("#tver_d_todo").hide()}};var y=$(".projpage-main");if(PARSE_VAR.auth.authority){var H=$("input[name=proj_id]").val(),w=$("input[name=p_ty]").val(),j=$("input[name=t_id]").val(),T=parseInt(w+"20"),C=10,D=1;if(1==parseInt(PARSE_VAR.count_task)){var x,E=[];y.show(),function(t){for(var a in t){var e=t[a];switch(E[e.alias]=e,e.alias){case"batch_update":case"top_fields_edit":case"export_excel":case"tasks_add":case"tasks_del":case"myhome_assign":case"myhome_copyto":case"main_fields_edit":case"task_follow":case"todo_add":case"tiemlog_add":case"tasks_add_ver":case"task_action":case"meida_del":case"version_action":"no"==e.allow&&$(".ah_"+e.alias).remove()}}}(PARSE_VAR.rules),Strack.save_storage("projid",[H,w]),Strack.project_sub_menu(H,w),function(t){var a,e="";switch(parseInt(t)){case 30:a=[10,20,40,50,60,70];break;case 40:case 41:case 42:case 43:a=[10,20,40,50,70];break;case 70:a=[10,20,30,40,50,60,70]}a.forEach(function(t){e+=S(t)}),$("#task_tabs").empty().append(e)}(w),Strack.AjaxHfields(w,j,H,PtaskPHP.DomTHfields,"tasks",10),k(j,H,w),$(".special.cards .image").dimmer({on:"hover"}),function(t,a,e){$.ajax({type:"POST",url:PtaskPHP.LoadTaskBase,data:{t_id:t,project_id:a,op_type:e},success:function(a){var e=JSON.parse(a),s="";s+=Strack.ProjTaskIcon(e.type),s+='<span class="taskm_content">'+e.t_name+"</span>",$(".item-mid-name").empty().append(s);var i=_(e.type,e.project_id,e.entity_id,e.entity,t,e.t_name,e.related);$(".item-breadcrumb-left").empty().append(i),$(".ui.menu , .ui.dropdown").dropdown({on:"hover"}),Strack.CheckFollow(e.follow)}})}(j,H,w);var A=function(t,a){var e;switch(parseInt(t)){case 30:e=["activity","task_info","versions","related","linkasset","history"];break;case 40:case 41:case 42:case 43:e=["activity","task_info","versions","related","history"];break;case 70:e=["activity","task_info","onset","versions","related","linkasset","history"]}return $.inArray(a,e)>=0?a:"activity"}(w,Strack.read_storage("task_panel_tab"));$("#tab_"+A).addClass("active"),b(A),function(t,a,e){var s=$("#task_hidebar");$(".projpage-main").on("scroll",function(){this.scrollTop||this.scrollTop,this.scrollHeight||this.scrollHeight,this.clientHeight||this.clientHeight,$("#projitem_footer").offset().top<80?s.hasClass("active")?s.show(200):(s.show(200).addClass("active"),$.ajax({type:"POST",url:PtaskPHP.LoadHideBar,data:{e_id:t,project_id:a,type:30},success:function(t){var s=JSON.parse(t),i=$("#hidebar_thumb"),r="";s.thumb?(r=PtaskPHP._TASK_THUMB_+"/"+s.thumb+"_min.jpg",i.empty().append('<img src="'+r+'">')):(r='<div class="task-thumb-null">'+Strack.ProjTaskIcon(e)+"</div>",i.empty().append(r)),$("#hidebar_bread").empty().append(u(e,a,s.task_name,s.status_info))}})):s.hide(200).removeClass("active")})}(j,H,w)}else y.empty().append(Strack.ProjWarn(StrackPHP.Task_None_Warning)).show()}else y.empty().append(Strack.ProjWarn(StrackPHP.NoPermission)).show()});