$(function(){function t(t,r){switch($(".item-chart").removeClass("active-blue"),$("#m_"+r).addClass("active-blue"),r){case"general":break;case"pre_schedule":case"asset_schedule":case"shot_schedule":a(t,r,1,10,"new");break;case"task_distribute":e(t)}}function a(t,e,r,i,s){$.ajax({type:"POST",url:ReportDetailPHP.loadEntityChart,dataType:"json",data:{project_id:t,type:e,pageNum:r,pageSize:i},beforeSend:function(){"new"==s&&$("#projc_dmain").empty().append(Strack.loading_dom("white","","main"))},success:function(o){var n=o.total;for(var c in o.rows)$("#projc_dmain").append(l(c,o.rows[c].item.item_name)),v(c,o.rows[c].cake),k(c,o.rows[c].rect);"new"==s&&($("#projc_dmain").on("scroll",function(){if((this.scrollTop||this.scrollTop)==(this.scrollHeight||this.scrollHeight)-(this.clientHeight||this.clientHeight)){r++;var s=Math.ceil(n/i);r<=s&&a(t,e,r,i,"more")}}),$("#st-load_main").remove())}})}function e(t){$.ajax({type:"POST",url:ReportDetailPHP.userListData,dataType:"json",data:{project_id:t},beforeSend:function(){var t='<div class="projc-tree aign-left"><div id="projc_tree"  class="ui list"></div></div><div id="projc_utask"  class="projc-utask aign-left"><div id="utask_top" class="utask-top"><div class="datagrid-empty-no">'+ReportDetailPHP.SelectUser+'</div></div><div id="utask_bottom" class="utask-bottom"></div></div>';$("#projc_dmain").empty().append(t).append(Strack.loading_dom("white","","user"))},success:function(t){var a="",e=[];t.forEach(function(t){a+=d(t,e)}),$("#projc_tree").append(a),$("#st-load_user").remove()}})}function r(t,a){$.ajax({type:"POST",url:ReportDetailPHP.loadUtaskChart,dataType:"json",data:{project_id:t,user_id:a},beforeSend:function(){$("#projc_dmain").append(Strack.loading_dom("white","","utask"));var t=n(ReportDetailPHP.ReportLoad,"utask_lchart"+a)+n(ReportDetailPHP.ReportProjDone,"utask_dchart"+a)+n(ReportDetailPHP.UnderReview,"utask_rchart"+a)+n(ReportDetailPHP.Undone,"utask_nchart"+a);$("#utask_top").empty().append(t);var e=c(ReportDetailPHP.WorkHeat,"utask_hot"+a);$("#utask_bottom").empty().append(e)},success:function(t){echarts.init(document.getElementById("utask_lchart"+a),"walden").setOption(i(t.load_chart),!0),echarts.init(document.getElementById("utask_dchart"+a),"walden").setOption(s(t.task_chart.done),!0),echarts.init(document.getElementById("utask_rchart"+a),"walden").setOption(s(t.task_chart.daily),!0),echarts.init(document.getElementById("utask_nchart"+a),"walden").setOption(s(t.task_chart.no_done),!0),echarts.init(document.getElementById("utask_hot"+a),"walden").setOption(o(t.heat_chart),!0),$("#st-load_utask").remove()}})}function i(t){return{tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{name:ReportDetailPHP.ReportLoad,type:"gauge",radius:"88%",axisLine:{lineStyle:{width:10}},axisTick:{splitNumber:5,length:14,lineStyle:{color:"auto"}},splitLine:{length:9,lineStyle:{color:"auto"}},detail:{textStyle:{fontWeight:"bolder"},formatter:"{value}%"},data:[{value:t,name:""}]}]}}function s(t){var a=[];for(var e in t)a.push(t[e]);return 0==a.length&&a.push({name:"none",value:0}),{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:StrackPHP.Status,type:"pie",radius:"50%",center:["50%","50%"],data:a,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}function o(t){var a=["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],e=[StrackPHP.Sunday,StrackPHP.Saturday,StrackPHP.Friday,StrackPHP.Thursday,StrackPHP.Wednesday,StrackPHP.Tuesday,StrackPHP.Monday];return t=t.map(function(t){return[t[1],t[0],t[2]||"-"]}),{tooltip:{position:"top"},animation:!1,grid:{height:"50%",y:"10%"},xAxis:{type:"category",data:a,splitArea:{show:!0}},yAxis:{type:"category",data:e,splitArea:{show:!0}},visualMap:{min:0,max:100,calculable:!0,orient:"horizontal",left:"center",bottom:"15%"},series:[{name:StrackPHP.Activity,type:"heatmap",data:t,label:{normal:{show:!0}},itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}function n(t,a){var e="";return e+='<div class="col-lg-3 no-box-sizing"><div class="strep-ibox float-e-margins"><div class="ibox-title"><div class="aign-left">'+t+'</div></div><div class="ibox-content"><div id="'+a+'" class="utask-item"></div></div></div></div>'}function c(t,a){var e="";return e+='<div class="col-lg-12 no-box-sizing"><div class="strep-ibox float-e-margins"><div class="ibox-title">'+t+'</div><div class="ibox-content"><div id="'+a+'" class="utask-hot"></div></div></div></div>'}function d(t,a){var e="";if($.inArray(parseInt(t.uid),a)<0){var r=Strack.build_avatar(t.avatar,"e-avatar-small","d-avatar-small",Strack.JointLetter(t.first_name,t.last_name));e+='<a href="javascript:;" class="item projc-tree-b" onclick="obj.showUserChart(this)" data-uid="'+t.uid+'"><div class="u-avatar aign-left">'+r+'</div><div class="content"><div class="header text-ellipsis">'+t.uname+'</div><div class="description text-ellipsis">'+t.deptname+"</div></div></a>",a.push(parseInt(t.uid))}return e}function l(t,a){return'<div class="entity-chart"><div class="entity-name">'+a+'</div><div class="col-lg-3 no-box-sizing chart-item"><div id="icake_chart_'+t+'" class="projc-chart"></div></div><div class="col-lg-9 no-box-sizing chart-item"><div id="irect_chart_'+t+'" class="projc-chart"></div></div></div>'}function p(t){var a="",e="";switch(parseInt(t)){case 20:a=StrackPHP.InProgress,e="green";break;case 40:a=StrackPHP.Blocked,e="blue";break;case 50:a=StrackPHP.Done,e="violet"}return'<div class="ui '+e+' horizontal label">'+a+"</div>"}function u(t){var a="";switch(t){case"blocked":a=StrackPHP.Blocked;break;case"notStarted":a=StrackPHP.NotStarted;break;case"inProgress":a=StrackPHP.InProgress;break;case"daily":a=StrackPHP.Daily;break;case"done":a=StrackPHP.Done}return a}function h(t){var a="";switch(parseInt(t)){case 10:a="blocked";break;case 20:a="notStarted";break;case 30:a="inProgress";break;case 40:a="daily";break;case 50:a="done"}return a}function m(t){var a=[];for(var e in t)a.push({name:u(e),type:"bar",stack:"task",label:{normal:{show:!0,position:"insideRight"}},data:[t[e]]});return{tooltip:{trigger:"item",axisPointer:{type:"shadow"}},grid:{top:"20%",left:"3%",right:"4%",bottom:"20%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:[ReportDetailPHP.TaskStatus]},series:a}}function v(t,a){var e=[],r=[];for(var i in a){e.push({value:a[i].number,name:u(h(i))});for(var s in a[i].data)r.push({value:a[i].data[s].number,name:a[i].data[s].name})}echarts.init(document.getElementById("icake_chart_"+t),"walden").setOption(b(e,r))}function k(t,a){var e=[],r=[],i={},s=[];for(var o in a){e.push(a[o].step),r.push(o);for(var n in a[o].data){var c=a[o].data[n].name;if(i.hasOwnProperty(c))if(i[c].hasOwnProperty(parseInt(o))){var d=i[c][o];i[c][o]=parseInt(d)+1}else i[c][o]=parseInt(a[o].data[n].number);else i[c]={},i[c][o]=parseInt(a[o].data[n].number)}}for(var n in i){var l={name:u(h(n)),type:"bar",stack:"task",label:{normal:{show:!0,position:"insideRight"}},data:[]};r.forEach(function(t){var a=i[n][parseInt(t)];a>0?l.data.push(a):l.data.push(0)}),s.push(l)}echarts.init(document.getElementById("irect_chart_"+t),"walden").setOption(_(e,s))}function b(t,a){return{tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:StrackPHP.Corresponds,type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"inner"}},labelLine:{normal:{show:!1}},data:t},{name:StrackPHP.Status,type:"pie",radius:["40%","55%"],data:a}]}}function _(t,a){return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:"5%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:t},series:a}}obj={ReportChart:function(a){var e=$(a).attr("data-type");t(P,e)},showUserChart:function(t){var a=$(t).attr("data-uid");$(".projc-tree-b").removeClass("active-blue"),$(t).addClass("active-blue"),r(P,a)}};var P=$("#project_id").val();!function(t){$.ajax({type:"POST",url:ReportDetailPHP.loadProjheadData,dataType:"json",data:{project_id:t},beforeSend:function(){$("#projc_head").append(Strack.loading_dom("white","","head"))},success:function(t){var a={thumb_arr:{}};a.thumb_arr.p_folder=t.project.p_folder,a.thumb_arr.p_thumb=t.project.p_thumb,$("#projc_tumb").html(Strack.build_thumb_dom(t.project.p_thumb,a,"max")),$("#projc_status").html(p(t.project.p_status)),$("#projc_name").html(t.project.p_name),$("#st-load_head").remove(),echarts.init(document.getElementById("projc_h_chart"),"walden").setOption(m(t.status))}})}(P),t(P,"task_distribute")});